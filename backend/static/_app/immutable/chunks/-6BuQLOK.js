import{p as f}from"./BXMn-U5u.js";const e=f({tilts:new Map,connected:!1,ambient:null,heater:{state:null,entity_id:null,last_changed:null,available:!1,loading:!1}});let o=null,r=null;function h(){if(o?.readyState===WebSocket.OPEN)return;const t=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;console.log("Connecting to WebSocket:",t),o=new WebSocket(t),o.onopen=()=>{console.log("WebSocket connected"),e.connected=!0,r&&(clearTimeout(r),r=null)},o.onmessage=s=>{try{const a=JSON.parse(s.data);if(a.type==="ambient"){e.ambient={temperature:a.temperature,humidity:a.humidity,timestamp:a.timestamp};return}if(a.type==="control_event"){a.action==="heat_on"?(e.heater.state="on",e.heater.last_changed=a.timestamp):a.action==="heat_off"&&(e.heater.state="off",e.heater.last_changed=a.timestamp);return}const i=a;e.tilts.set(i.id,i),e.tilts=new Map(e.tilts)}catch(a){console.error("Failed to parse WebSocket message:",a)}},o.onclose=()=>{console.log("WebSocket disconnected"),e.connected=!1,o=null,r=setTimeout(h,3e3)},o.onerror=s=>{console.error("WebSocket error:",s),o?.close()}}function u(){r&&(clearTimeout(r),r=null),o?.close(),o=null}let l=null;async function c(){try{e.heater.loading=!0;const n=await fetch("/api/control/heater");if(n.ok){const t=await n.json();e.heater.state=t.state,e.heater.entity_id=t.entity_id,e.heater.last_changed=t.last_changed,e.heater.available=t.available}}catch(n){console.error("Failed to fetch heater state:",n)}finally{e.heater.loading=!1}}async function p(n){try{e.heater.loading=!0;const t=await fetch("/api/control/heater",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:n})});if(t.ok){const s=await t.json();if(s.success)return e.heater.state=s.new_state,e.heater.last_changed=new Date().toISOString(),!0}return!1}catch(t){return console.error("Failed to toggle heater:",t),!1}finally{e.heater.loading=!1}}function g(n=3e4){c(),l&&clearInterval(l),l=setInterval(c,n)}function m(){l&&(clearInterval(l),l=null)}async function y(n,t){try{if((await fetch(`/api/tilts/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({beer_name:t})})).ok){const a=e.tilts.get(n);return a&&(a.beer_name=t,e.tilts=new Map(e.tilts)),!0}}catch(s){console.error("Failed to update beer name:",s)}return!1}export{e as a,m as b,h as c,u as d,c as f,g as s,p as t,y as u};
