import{d as Ve,f as n,a as i,c as we,s as p,e as fa,t as Pe}from"./DFbRLFGc.js";import{ah as $e,ao as d,p as x,ap as ea,aj as aa,ak as l,al as s,s as o,c as e,ai as pe,an as r,ar as $,as as b,aq as Re,at as _e,aw as ma}from"./-s7GvDYA.js";import{e as De,i as Ge}from"./DSjxYGfQ.js";import{i as m}from"./DiA6E_7b.js";import{r as ne}from"./CXlnwKpw.js";import{b as V}from"./BXlrlxF0.js";import{b as je}from"./D9NHjgjI.js";import{b as ta,d as _a}from"./DLyiWXp0.js";import{c as qe,f as pa,a as ha,g as ba}from"./BH1aWYKn.js";import{f as ga}from"./BssyGhMx.js";var ya=n('<button type="button" class="clear-btn svelte-1m8neh9">Clear Selection</button>'),xa=n('<div class="loading svelte-1m8neh9"><div class="spinner svelte-1m8neh9"></div> <p>Loading recipes...</p></div>'),wa=n('<div class="error-box svelte-1m8neh9"><p class="error-text svelte-1m8neh9"> </p></div>'),Sa=n('<div class="empty svelte-1m8neh9"><p class="empty-text svelte-1m8neh9">No recipes yet.</p> <a href="/recipes/import" class="import-link svelte-1m8neh9">Import your first recipe</a></div>'),Fa=n('<p class="recipe-gravity svelte-1m8neh9"> </p>'),Ca=n('<p class="recipe-yeast svelte-1m8neh9"> </p>'),Ta=n('<div class="selected-recipe svelte-1m8neh9"><div class="recipe-info svelte-1m8neh9"><p class="recipe-name svelte-1m8neh9"> </p> <!> <!></div></div>'),Ra=n('<span class="recipe-item-og svelte-1m8neh9"> </span>'),Da=n('<button type="button" class="recipe-item svelte-1m8neh9"><span class="recipe-item-name svelte-1m8neh9"> </span> <!></button>'),ka=n('<input id="recipe-search" type="text" placeholder="Search recipes..." class="search-input svelte-1m8neh9"/> <div class="recipe-list svelte-1m8neh9"></div>',1),Ea=n('<div class="recipe-selector svelte-1m8neh9"><div class="selector-header svelte-1m8neh9"><label for="recipe-search" class="selector-label svelte-1m8neh9">Select Recipe (Optional)</label> <!></div> <!></div>');function Ha(ke,v){$e(v,!0);let k=d(x([])),O=d(!0),ee=d(null),Y=d(""),ve=pe(()=>e(k).filter(c=>!e(Y)||c.name.toLowerCase().includes(e(Y).toLowerCase())||c.author?.toLowerCase().includes(e(Y).toLowerCase()))),g=pe(()=>v.selectedRecipeId?e(k).find(c=>c.id===v.selectedRecipeId):null);ea(async()=>{try{o(k,await ta(),!0)}catch(c){o(ee,c instanceof Error?c.message:"Failed to load recipes",!0),console.error("Failed to load recipes:",c)}finally{o(O,!1)}});function ce(c){v.onSelect(c)}function he(){v.onSelect(null)}var q=Ea(),de=s(q),Se=l(s(de),2);{var be=c=>{var I=ya();I.__click=he,i(c,I)};m(Se,c=>{e(g)&&c(be)})}r(de);var ge=l(de,2);{var Q=c=>{var I=xa();i(c,I)},ue=c=>{var I=we(),ae=$(I);{var ye=U=>{var E=wa(),h=s(E),te=s(h,!0);r(h),r(E),b(()=>p(te,e(ee))),i(U,E)},z=U=>{var E=we(),h=$(E);{var te=y=>{var fe=Sa();i(y,fe)},Ee=y=>{var fe=we(),He=$(fe);{var Fe=J=>{var H=Ta(),L=s(H),N=s(L),P=s(N,!0);r(N);var B=l(N,2);{var K=S=>{var C=Fa(),A=s(C);r(C),b((re,se)=>p(A,`${re??""} → ${se??""}`),[()=>e(g).og_target.toFixed(3),()=>e(g).fg_target.toFixed(3)]),i(S,C)};m(B,S=>{e(g).og_target&&e(g).fg_target&&S(K)})}var W=l(B,2);{var xe=S=>{var C=Ca(),A=s(C,!0);r(C),b(()=>p(A,e(g).yeast_name)),i(S,C)};m(W,S=>{e(g).yeast_name&&S(xe)})}r(L),r(H),b(()=>p(P,e(g).name)),i(J,H)},Ce=J=>{var H=ka(),L=$(H);ne(L);var N=l(L,2);De(N,21,()=>e(ve),P=>P.id,(P,B)=>{var K=Da();K.__click=()=>ce(e(B));var W=s(K),xe=s(W,!0);r(W);var S=l(W,2);{var C=A=>{var re=Ra(),se=s(re,!0);r(re),b(Te=>p(se,Te),[()=>e(B).og_target.toFixed(3)]),i(A,re)};m(S,A=>{e(B).og_target&&A(C)})}r(K),b(()=>p(xe,e(B).name)),i(P,K)}),r(N),V(L,()=>e(Y),P=>o(Y,P)),i(J,H)};m(He,J=>{e(g)?J(Fe):J(Ce,!1)})}i(y,fe)};m(h,y=>{e(k).length===0?y(te):y(Ee,!1)},!0)}i(U,E)};m(ae,U=>{e(ee)?U(ye):U(z,!1)},!0)}i(c,I)};m(ge,c=>{e(O)?c(Q):c(ue,!1)})}r(q),i(ke,q),aa()}Ve(["click"]);var Ia=n('<div class="error-banner svelte-8ou9a2"><span class="error-icon svelte-8ou9a2">!</span> </div>'),La=n('<p class="reference-text svelte-8ou9a2"> <!></p>'),Na=n('<div class="recipe-reference svelte-8ou9a2"><p class="reference-label svelte-8ou9a2">From Recipe:</p> <!></div>'),Ba=n("<option> </option>"),Aa=n('<span class="form-hint svelte-8ou9a2">Loading devices...</span>'),Ma=n('<div class="warning-message svelte-8ou9a2"><p class="svelte-8ou9a2">No paired devices available. Please <a href="/devices" class="svelte-8ou9a2">pair a device</a> before creating a batch.</p></div>'),Oa=n("<option> <!></option>"),Ya=n('<select id="device" class="form-select svelte-8ou9a2"><option>No device assigned</option><!></select> <span class="form-hint svelte-8ou9a2">Link a Tilt to track live gravity and temperature</span>',1),Ua=n('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="fg">Measured FG</label> <input type="number" id="fg" class="form-input svelte-8ou9a2" placeholder="1.010" step="0.001" min="0.990" max="1.100"/></div>'),Pa=n("<option> </option>"),Ga=n('<span class="form-hint svelte-8ou9a2">Loading available switches from Home Assistant...</span>'),ja=n('<span class="form-hint svelte-8ou9a2">No switches found in Home Assistant</span>'),qa=n('<span class="form-hint svelte-8ou9a2">Select a switch or input_boolean entity to control the heater</span>'),Qa=n('<div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempTarget"> </label> <input type="number" id="tempTarget" class="form-input svelte-8ou9a2" placeholder="68" step="0.5" min="32" max="100"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempHysteresis"> </label> <input type="number" id="tempHysteresis" class="form-input svelte-8ou9a2" placeholder="1.0" step="0.5" min="0.5" max="10"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div></div>'),za=n('<div class="form-section svelte-8ou9a2"><h3 class="section-title svelte-8ou9a2">Temperature Control</h3> <span class="section-hint svelte-8ou9a2">Link a heater switch from Home Assistant to control fermentation temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="heaterEntity">Heater Switch</label> <select id="heaterEntity" class="form-select svelte-8ou9a2"><option>No heater assigned</option><!></select> <!></div> <!>',1),Ja=n('<span class="spinner svelte-8ou9a2"></span> Saving...',1),Ka=n('<form class="batch-form svelte-8ou9a2"><div class="form-header svelte-8ou9a2"><h2 class="form-title svelte-8ou9a2"> </h2> <p class="form-description svelte-8ou9a2"> </p></div> <!> <div class="form-body svelte-8ou9a2"><!> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="name">Batch Name</label> <input type="text" id="name" class="form-input svelte-8ou9a2" placeholder="e.g., Summer IPA #3" maxlength="200"/> <span class="form-hint svelte-8ou9a2">Optional - defaults to recipe name</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="status">Status</label> <select id="status" class="form-select svelte-8ou9a2"></select></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="device">Tracking Device</label> <!></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="brewDate">Brew Date</label> <input type="date" id="brewDate" class="form-input date-input svelte-8ou9a2"/> <span class="form-hint svelte-8ou9a2">DD/MM/YYYY</span></div> <div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="og">Measured OG</label> <input type="number" id="og" class="form-input svelte-8ou9a2" placeholder="1.050" step="0.001" min="0.990" max="1.200"/></div> <!></div> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="notes">Notes</label> <textarea id="notes" class="form-textarea svelte-8ou9a2" placeholder="Brewing notes, observations, etc." rows="3"></textarea></div></div> <div class="form-footer svelte-8ou9a2"><button type="button" class="btn-cancel svelte-8ou9a2">Cancel</button> <button type="submit" class="btn-submit svelte-8ou9a2"><!></button></div></form>');function lt(ke,v){$e(v,!0);let k=d(x(v.batch?.name||"")),O=d(x(v.batch?.recipe_id||null)),ee=d(x(v.batch?.device_id||null)),Y=d(x(v.batch?.status||"planning")),ve=d(x(v.batch?.brew_date?v.batch.brew_date.split("T")[0]:"")),g=d(x(v.batch?.measured_og?.toString()||"")),ce=d(x(v.batch?.measured_fg?.toString()||"")),he=d(x(v.batch?.notes||"")),q=d(x(v.batch?.heater_entity_id||""));function de(a){return a==null?"":qe.config.temp_units==="C"?pa(a).toFixed(1):a.toFixed(1)}function Se(a){if(!a)return;const t=parseFloat(a);if(!isNaN(t))return qe.config.temp_units==="C"?ha(t):t}let be=d(x(de(v.batch?.temp_target))),ge=d(x(de(v.batch?.temp_hysteresis))),Q=d(x([])),ue=d(x([])),c=d(x([])),I=d(!0),ae=d(!1),ye=d(!1),z=d(!1),U=pe(ba),E=d(null),h=d(null),te=pe(()=>qe.config.ha_enabled);const Ee=[{value:"planning",label:"Planning"},{value:"fermenting",label:"Fermenting"},{value:"conditioning",label:"Conditioning"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}];let y=pe(()=>!!v.batch);async function fe(){o(I,!0);try{o(Q,await ta(),!0)}catch(a){console.error("Failed to load recipes:",a)}finally{o(I,!1)}}async function He(){o(ye,!0);try{o(c,await ga(!0),!0)}catch(a){console.error("Failed to load devices:",a)}finally{o(ye,!1)}}async function Fe(){if(e(te)){o(ae,!0);try{o(ue,await _a(),!0)}catch(a){console.error("Failed to load heater entities:",a)}finally{o(ae,!1)}}}function Ce(a){o(h,a,!0),a?(o(k,a.name,!0),o(O,a.id,!0),a.og_target&&o(g,a.og_target.toString(),!0)):o(O,null)}async function J(a){if(a.preventDefault(),!e(z)){o(z,!0),o(E,null);try{const t={name:e(k)||void 0,status:e(Y),device_id:e(ee)||void 0,brew_date:e(ve)?new Date(e(ve)).toISOString():void 0,measured_og:e(g)?parseFloat(e(g)):void 0,notes:e(he)||void 0,heater_entity_id:e(q)||void 0,temp_target:Se(e(be)),temp_hysteresis:Se(e(ge))};e(y)?t.recipe_id=e(O)||void 0:t.recipe_id=e(O)||void 0,e(y)&&e(ce)&&(t.measured_fg=parseFloat(e(ce))),await v.onSubmit(t)}catch(t){o(E,t instanceof Error?t.message:"Failed to save batch",!0)}finally{o(z,!1)}}}Re(()=>{if(!e(y)&&e(O)&&!e(k)){const a=e(Q).find(t=>t.id===e(O));a&&o(k,a.name,!0)}}),Re(()=>{e(te)&&e(ue).length===0&&!e(ae)&&Fe()}),Re(()=>{if(v.initialRecipeId&&e(Q).length>0&&!e(h)){const a=e(Q).find(t=>t.id===v.initialRecipeId);a&&Ce(a)}}),Re(()=>{if(e(y)&&v.batch?.recipe&&e(Q).length>0&&!e(h)){const a=e(Q).find(t=>t.id===v.batch.recipe_id);a&&o(h,a,!0)}}),ea(()=>{fe(),He(),Fe()});var H=Ka(),L=s(H),N=s(L),P=s(N,!0);r(N);var B=l(N,2),K=s(B,!0);r(B),r(L);var W=l(L,2);{var xe=a=>{var t=Ia(),_=l(s(t));r(t),b(()=>p(_,` ${e(E)??""}`)),i(a,t)};m(W,a=>{e(E)&&a(xe)})}var S=l(W,2),C=s(S);{let a=pe(()=>e(h)?.id);Ha(C,{get selectedRecipeId(){return e(a)},onSelect:Ce})}var A=l(C,2);{var re=a=>{var t=Na(),_=l(s(t),2);{var F=T=>{var R=La(),G=s(R),le=l(G);{var ie=oe=>{var X=Pe();b((u,f)=>p(X,`(${u??""}-${f??""}°C)`),[()=>e(h).yeast_temp_min.toFixed(0),()=>e(h).yeast_temp_max.toFixed(0)]),i(oe,X)};m(le,oe=>{e(h).yeast_temp_min&&e(h).yeast_temp_max&&oe(ie)})}r(R),b(()=>p(G,`Yeast: ${e(h).yeast_name??""} `)),i(T,R)};m(_,T=>{e(h).yeast_name&&T(F)})}r(t),i(a,t)};m(A,a=>{e(h)&&a(re)})}var se=l(A,2),Te=l(s(se),2);ne(Te),_e(2),r(se);var Ie=l(se,2),Le=l(s(Ie),2);De(Le,21,()=>Ee,Ge,(a,t)=>{var _=Ba(),F=s(_,!0);r(_);var T={};b(()=>{p(F,e(t).label),T!==(T=e(t).value)&&(_.value=(_.__value=e(t).value)??"")}),i(a,_)}),r(Le),r(Ie);var Ne=l(Ie,2),ra=l(s(Ne),2);{var sa=a=>{var t=Aa();i(a,t)},la=a=>{var t=we(),_=$(t);{var F=R=>{var G=Ma();i(R,G)},T=R=>{var G=Ya(),le=$(G),ie=s(le);ie.value=(ie.__value=null)??"";var oe=l(ie);De(oe,17,()=>e(c),Ge,(X,u)=>{var f=Oa(),w=s(f),j=l(w);{var Z=M=>{var me=Pe();b(()=>p(me,`- ${e(u).beer_name??""}`)),i(M,me)};m(j,M=>{e(u).beer_name&&e(u).beer_name!=="Untitled"&&M(Z)})}r(f);var D={};b(()=>{p(w,`${e(u).color??""} Tilt `),D!==(D=e(u).id)&&(f.value=(f.__value=e(u).id)??"")}),i(X,f)}),r(le),_e(2),je(le,()=>e(ee),X=>o(ee,X)),i(R,G)};m(_,R=>{e(c).length===0?R(F):R(T,!1)},!0)}i(a,t)};m(ra,a=>{e(ye)?a(sa):a(la,!1)})}r(Ne);var Be=l(Ne,2),Qe=l(s(Be),2);ne(Qe),_e(2),r(Be);var Ae=l(Be,2),Me=s(Ae),ze=l(s(Me),2);ne(ze),r(Me);var ia=l(Me,2);{var oa=a=>{var t=Ua(),_=l(s(t),2);ne(_),r(t),V(_,()=>e(ce),F=>o(ce,F)),i(a,t)};m(ia,a=>{e(y)&&a(oa)})}r(Ae);var Je=l(Ae,2);{var na=a=>{var t=za(),_=l($(t),2),F=l(s(_),2),T=s(F);T.value=T.__value="";var R=l(T);De(R,17,()=>e(ue),Ge,(u,f)=>{var w=Pa(),j=s(w);r(w);var Z={};b(()=>{p(j,`${e(f).friendly_name??""} (${e(f).state??""})`),Z!==(Z=e(f).entity_id)&&(w.value=(w.__value=e(f).entity_id)??"")}),i(u,w)}),r(F);var G=l(F,2);{var le=u=>{var f=Ga();i(u,f)},ie=u=>{var f=we(),w=$(f);{var j=D=>{var M=ja();i(D,M)},Z=D=>{var M=qa();i(D,M)};m(w,D=>{e(ue).length===0?D(j):D(Z,!1)},!0)}i(u,f)};m(G,u=>{e(ae)?u(le):u(ie,!1)})}r(_);var oe=l(_,2);{var X=u=>{var f=Qa(),w=s(f),j=s(w),Z=s(j);r(j);var D=l(j,2);ne(D),_e(2),r(w);var M=l(w,2),me=s(M),ua=s(me);r(me);var Ze=l(me,2);ne(Ze),_e(2),r(M),r(f),b(()=>{p(Z,`Target Temperature (${e(U)??""})`),p(ua,`Hysteresis (${e(U)??""})`)}),V(D,()=>e(be),Ue=>o(be,Ue)),V(Ze,()=>e(ge),Ue=>o(ge,Ue)),i(u,f)};m(oe,u=>{e(q)&&u(X)})}b(()=>F.disabled=e(ae)),je(F,()=>e(q),u=>o(q,u)),i(a,t)};m(Je,a=>{e(te)&&a(na)})}var Ke=l(Je,2),We=l(s(Ke),2);ma(We),r(Ke),r(S);var Xe=l(S,2),Oe=s(Xe);Oe.__click=function(...a){v.onCancel?.apply(this,a)};var Ye=l(Oe,2),va=s(Ye);{var ca=a=>{var t=Ja();_e(),i(a,t)},da=a=>{var t=Pe();b(()=>p(t,e(y)?"Save Changes":"Create Batch")),i(a,t)};m(va,a=>{e(z)?a(ca):a(da,!1)})}r(Ye),r(Xe),r(H),b(()=>{p(P,e(y)?"Edit Batch":"New Batch"),p(K,e(y)?"Update batch details and measurements":"Create a new fermentation batch"),Oe.disabled=e(z),Ye.disabled=e(z)}),fa("submit",H,J),V(Te,()=>e(k),a=>o(k,a)),je(Le,()=>e(Y),a=>o(Y,a)),V(Qe,()=>e(ve),a=>o(ve,a)),V(ze,()=>e(g),a=>o(g,a)),V(We,()=>e(he),a=>o(he,a)),i(ke,H),aa()}Ve(["click"]);export{lt as B};
