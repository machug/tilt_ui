import{d as fa,f as n,a as i,c as ge,s as h,e as Na,t as aa}from"./BQ88CgEU.js";import{ah as _a,ao as d,p as x,ap as ma,aj as pa,ak as s,al as l,s as o,c as e,ai as P,an as r,ar as V,as as y,aq as Se,at as be,ax as ka}from"./CGXqq0_G.js";import{e as Fe,i as He}from"./payu-7ZH.js";import{i as _}from"./ziKwUJ4R.js";import{r as de,s as Re}from"./D2zVhfuI.js";import{b as le}from"./CL9D8AtU.js";import{b as Ne}from"./C5J5lxM1.js";import{j as ha,k as Ia,l as La}from"./DVIH5Hsv.js";import{c as Z,f as Ma,a as Aa,g as Ba}from"./Do2ytZ8P.js";import{f as Oa}from"./BssyGhMx.js";var Ya=n('<button type="button" class="clear-btn svelte-1m8neh9">Clear Selection</button>'),Ua=n('<div class="loading svelte-1m8neh9"><div class="spinner svelte-1m8neh9"></div> <p>Loading recipes...</p></div>'),Pa=n('<div class="error-box svelte-1m8neh9"><p class="error-text svelte-1m8neh9"> </p></div>'),ja=n('<div class="empty svelte-1m8neh9"><p class="empty-text svelte-1m8neh9">No recipes yet.</p> <a href="/recipes/import" class="import-link svelte-1m8neh9">Import your first recipe</a></div>'),Ga=n('<p class="recipe-gravity svelte-1m8neh9"> </p>'),qa=n('<p class="recipe-yeast svelte-1m8neh9"> </p>'),Qa=n('<div class="selected-recipe svelte-1m8neh9"><div class="recipe-info svelte-1m8neh9"><p class="recipe-name svelte-1m8neh9"> </p> <!> <!></div></div>'),za=n('<span class="recipe-item-og svelte-1m8neh9"> </span>'),Ja=n('<button type="button" class="recipe-item svelte-1m8neh9"><span class="recipe-item-name svelte-1m8neh9"> </span> <!></button>'),Ka=n('<input id="recipe-search" type="text" placeholder="Search recipes..." class="search-input svelte-1m8neh9"/> <div class="recipe-list svelte-1m8neh9"></div>',1),Wa=n('<div class="recipe-selector svelte-1m8neh9"><div class="selector-header svelte-1m8neh9"><label for="recipe-search" class="selector-label svelte-1m8neh9">Select Recipe (Optional)</label> <!></div> <!></div>');function Xa(ke,c){_a(c,!0);let L=d(x([])),j=d(!0),ie=d(null),G=d(""),ue=P(()=>e(L).filter(u=>!e(G)||u.name.toLowerCase().includes(e(G).toLowerCase())||u.author?.toLowerCase().includes(e(G).toLowerCase()))),C=P(()=>c.selectedRecipeId?e(L).find(u=>u.id===c.selectedRecipeId):null);ma(async()=>{try{o(L,await ha(),!0)}catch(u){o(ie,u instanceof Error?u.message:"Failed to load recipes",!0),console.error("Failed to load recipes:",u)}finally{o(j,!1)}});function fe(u){c.onSelect(u)}function ye(){c.onSelect(null)}var $=Wa(),ee=l($),Ie=s(l(ee),2);{var Le=u=>{var S=Ya();S.__click=ye,i(u,S)};_(Ie,u=>{e(C)&&u(Le)})}r(ee);var Me=s(ee,2);{var Ae=u=>{var S=Ua();i(u,S)},xe=u=>{var S=ge(),_e=V(S);{var me=q=>{var T=Pa(),Y=l(T),oe=l(Y,!0);r(Y),r(T),y(()=>h(oe,e(ie))),i(q,T)},we=q=>{var T=ge(),Y=V(T);{var oe=Q=>{var pe=ja();i(Q,pe)},ae=Q=>{var pe=ge(),Be=V(pe);{var Oe=M=>{var m=Qa(),D=l(m),te=l(D),w=l(te,!0);r(te);var z=s(te,2);{var re=E=>{var A=Ga(),H=l(A);r(A),y((J,ne)=>h(H,`${J??""} → ${ne??""}`),[()=>e(C).og_target.toFixed(3),()=>e(C).fg_target.toFixed(3)]),i(E,A)};_(z,E=>{e(C).og_target&&e(C).fg_target&&E(re)})}var se=s(z,2);{var he=E=>{var A=qa(),H=l(A,!0);r(A),y(()=>h(H,e(C).yeast_name)),i(E,A)};_(se,E=>{e(C).yeast_name&&E(he)})}r(D),r(m),y(()=>h(w,e(C).name)),i(M,m)},Ye=M=>{var m=Ka(),D=V(m);de(D);var te=s(D,2);Fe(te,21,()=>e(ue),w=>w.id,(w,z)=>{var re=Ja();re.__click=()=>fe(e(z));var se=l(re),he=l(se,!0);r(se);var E=s(se,2);{var A=H=>{var J=za(),ne=l(J,!0);r(J),y(Ue=>h(ne,Ue),[()=>e(z).og_target.toFixed(3)]),i(H,J)};_(E,H=>{e(z).og_target&&H(A)})}r(re),y(()=>h(he,e(z).name)),i(w,re)}),r(te),le(D,()=>e(G),w=>o(G,w)),i(M,m)};_(Be,M=>{e(C)?M(Oe):M(Ye,!1)})}i(Q,pe)};_(Y,Q=>{e(L).length===0?Q(oe):Q(ae,!1)},!0)}i(q,T)};_(_e,q=>{e(ie)?q(me):q(we,!1)},!0)}i(u,S)};_(Me,u=>{e(j)?u(Ae):u(xe,!1)})}r($),i(ke,$),pa()}fa(["click"]);var Za=n('<div class="error-banner svelte-8ou9a2"><span class="error-icon svelte-8ou9a2">!</span> </div>'),Va=n('<p class="reference-text svelte-8ou9a2"> <!></p>'),$a=n('<div class="recipe-reference svelte-8ou9a2"><p class="reference-label svelte-8ou9a2">From Recipe:</p> <!></div>'),et=n("<option> </option>"),at=n('<span class="form-hint svelte-8ou9a2">Loading devices...</span>'),tt=n('<div class="warning-message svelte-8ou9a2"><p class="svelte-8ou9a2">No paired devices available. Please <a href="/devices" class="svelte-8ou9a2">pair a device</a> before creating a batch.</p></div>'),rt=n("<option> <!></option>"),st=n('<select id="device" class="form-select svelte-8ou9a2"><option>No device assigned</option><!></select> <span class="form-hint svelte-8ou9a2">Link a Tilt to track live gravity and temperature</span>',1),lt=n('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="fg">Measured FG</label> <input type="number" id="fg" class="form-input svelte-8ou9a2" placeholder="1.010" step="0.001" min="0.990" max="1.100"/></div>'),it=n("<option> </option>"),ot=n('<span class="form-hint svelte-8ou9a2">Loading available switches from Home Assistant...</span>'),nt=n('<span class="form-hint svelte-8ou9a2">No switches found in Home Assistant</span>'),vt=n('<span class="form-hint svelte-8ou9a2">Select a switch or input_boolean entity to control the heater</span>'),ct=n("<option> </option>"),dt=n('<span class="form-hint svelte-8ou9a2">Loading available switches from Home Assistant...</span>'),ut=n('<span class="form-hint svelte-8ou9a2">No switches found in Home Assistant</span>'),ft=n('<span class="form-hint svelte-8ou9a2">Select a switch or input_boolean entity to control the cooler</span>'),_t=n('<div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempTarget"> </label> <input type="number" id="tempTarget" class="form-input svelte-8ou9a2" placeholder="68" step="0.5"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempHysteresis"> </label> <input type="number" id="tempHysteresis" class="form-input svelte-8ou9a2" placeholder="1.0" step="0.5"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div></div>'),mt=n('<div class="form-section svelte-8ou9a2"><h3 class="section-title svelte-8ou9a2">Temperature Control</h3> <span class="section-hint svelte-8ou9a2">Link heater and/or cooler switches from Home Assistant to control fermentation temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="heaterEntity">Heater Switch</label> <select id="heaterEntity" class="form-select svelte-8ou9a2"><option>No heater assigned</option><!></select> <!></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="coolerEntity">Cooler Switch</label> <select id="coolerEntity" class="form-select svelte-8ou9a2"><option>No cooler assigned</option><!></select> <!></div> <!>',1),pt=n('<span class="spinner svelte-8ou9a2"></span> Saving...',1),ht=n('<form class="batch-form svelte-8ou9a2"><div class="form-header svelte-8ou9a2"><h2 class="form-title svelte-8ou9a2"> </h2> <p class="form-description svelte-8ou9a2"> </p></div> <!> <div class="form-body svelte-8ou9a2"><!> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="name">Batch Name</label> <input type="text" id="name" class="form-input svelte-8ou9a2" placeholder="e.g., Summer IPA #3" maxlength="200"/> <span class="form-hint svelte-8ou9a2">Optional - defaults to recipe name</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="status">Status</label> <select id="status" class="form-select svelte-8ou9a2"></select></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="device">Tracking Device</label> <!></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="brewDate">Brew Date</label> <input type="date" id="brewDate" class="form-input date-input svelte-8ou9a2"/> <span class="form-hint svelte-8ou9a2">DD/MM/YYYY</span></div> <div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="og">Measured OG</label> <input type="number" id="og" class="form-input svelte-8ou9a2" placeholder="1.050" step="0.001" min="0.990" max="1.200"/></div> <!></div> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="notes">Notes</label> <textarea id="notes" class="form-textarea svelte-8ou9a2" placeholder="Brewing notes, observations, etc." rows="3"></textarea></div></div> <div class="form-footer svelte-8ou9a2"><button type="button" class="btn-cancel svelte-8ou9a2">Cancel</button> <button type="submit" class="btn-submit svelte-8ou9a2"><!></button></div></form>');function Et(ke,c){_a(c,!0);let L=d(x(c.batch?.name||"")),j=d(x(c.batch?.recipe_id||null)),ie=d(x(c.batch?.device_id||null)),G=d(x(c.batch?.status||"planning")),ue=d(x(c.batch?.brew_date?c.batch.brew_date.split("T")[0]:"")),C=d(x(c.batch?.measured_og?.toString()||"")),fe=d(x(c.batch?.measured_fg?.toString()||"")),ye=d(x(c.batch?.notes||"")),$=d(x(c.batch?.heater_entity_id||"")),ee=d(x(c.batch?.cooler_entity_id||""));function Ie(a){return a==null?"":Z.config.temp_units==="C"?Ma(a).toFixed(1):a.toFixed(1)}function Le(a){return a==null?"":Z.config.temp_units==="C"?(a*5/9).toFixed(1):a.toFixed(1)}function Me(a){if(!a)return;const t=parseFloat(a);if(!isNaN(t))return Z.config.temp_units==="C"?Aa(t):t}function Ae(a){if(!a)return;const t=parseFloat(a);if(!isNaN(t))return Z.config.temp_units==="C"?t*9/5:t}let xe=d(x(Ie(c.batch?.temp_target))),u=d(x(Le(c.batch?.temp_hysteresis))),S=d(x([])),_e=d(x([])),me=d(x([])),we=d(x([])),q=d(!0),T=d(!1),Y=d(!1),oe=d(!1),ae=d(!1),Q=P(Ba),pe=P(()=>Z.config.temp_units==="C"?0:32),Be=P(()=>Z.config.temp_units==="C"?38:100),Oe=P(()=>Z.config.temp_units==="C"?.3:.5),Ye=P(()=>Z.config.temp_units==="C"?5.5:10),M=d(null),m=d(null),D=P(()=>Z.config.ha_enabled);const te=[{value:"planning",label:"Planning"},{value:"fermenting",label:"Fermenting"},{value:"conditioning",label:"Conditioning"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}];let w=P(()=>!!c.batch);async function z(){o(q,!0);try{o(S,await ha(),!0)}catch(a){console.error("Failed to load recipes:",a)}finally{o(q,!1)}}async function re(){o(oe,!0);try{o(we,await Oa(!0),!0)}catch(a){console.error("Failed to load devices:",a)}finally{o(oe,!1)}}async function se(){if(e(D)){o(T,!0);try{o(_e,await Ia(),!0)}catch(a){console.error("Failed to load heater entities:",a)}finally{o(T,!1)}}}async function he(){if(e(D)){o(Y,!0);try{o(me,await La(),!0)}catch(a){console.error("Failed to load cooler entities:",a)}finally{o(Y,!1)}}}function E(a){o(m,a,!0),a?(o(L,a.name,!0),o(j,a.id,!0),a.og_target&&o(C,a.og_target.toString(),!0)):o(j,null)}async function A(a){if(a.preventDefault(),!e(ae)){o(ae,!0),o(M,null);try{const t={name:e(L)||void 0,status:e(G),device_id:e(ie)||void 0,brew_date:e(ue)?new Date(e(ue)).toISOString():void 0,measured_og:e(C)?parseFloat(e(C)):void 0,notes:e(ye)||void 0,heater_entity_id:e($)||void 0,cooler_entity_id:e(ee)||void 0,temp_target:Me(e(xe)),temp_hysteresis:Ae(e(u))};e(w)?t.recipe_id=e(j)||void 0:t.recipe_id=e(j)||void 0,e(w)&&e(fe)&&(t.measured_fg=parseFloat(e(fe))),await c.onSubmit(t)}catch(t){o(M,t instanceof Error?t.message:"Failed to save batch",!0)}finally{o(ae,!1)}}}Se(()=>{if(!e(w)&&e(j)&&!e(L)){const a=e(S).find(t=>t.id===e(j));a&&o(L,a.name,!0)}}),Se(()=>{e(D)&&e(_e).length===0&&!e(T)&&se()}),Se(()=>{e(D)&&e(me).length===0&&!e(Y)&&he()}),Se(()=>{if(c.initialRecipeId&&e(S).length>0&&!e(m)){const a=e(S).find(t=>t.id===c.initialRecipeId);a&&E(a)}}),Se(()=>{if(e(w)&&c.batch?.recipe&&e(S).length>0&&!e(m)){const a=e(S).find(t=>t.id===c.batch.recipe_id);a&&o(m,a,!0)}}),ma(()=>{z(),re(),se(),he()});var H=ht(),J=l(H),ne=l(J),Ue=l(ne,!0);r(ne);var ta=s(ne,2),ba=l(ta,!0);r(ta),r(J);var ra=s(J,2);{var ga=a=>{var t=Za(),b=s(l(t));r(t),y(()=>h(b,` ${e(M)??""}`)),i(a,t)};_(ra,a=>{e(M)&&a(ga)})}var Pe=s(ra,2),sa=l(Pe);{let a=P(()=>e(m)?.id);Xa(sa,{get selectedRecipeId(){return e(a)},onSelect:E})}var la=s(sa,2);{var ya=a=>{var t=$a(),b=s(l(t),2);{var F=R=>{var N=Va(),K=l(N),ve=s(K);{var ce=W=>{var k=aa();y((I,X)=>h(k,`(${I??""}-${X??""}°C)`),[()=>e(m).yeast_temp_min.toFixed(0),()=>e(m).yeast_temp_max.toFixed(0)]),i(W,k)};_(ve,W=>{e(m).yeast_temp_min&&e(m).yeast_temp_max&&W(ce)})}r(N),y(()=>h(K,`Yeast: ${e(m).yeast_name??""} `)),i(R,N)};_(b,R=>{e(m).yeast_name&&R(F)})}r(t),i(a,t)};_(la,a=>{e(m)&&a(ya)})}var je=s(la,2),ia=s(l(je),2);de(ia),be(2),r(je);var Ge=s(je,2),qe=s(l(Ge),2);Fe(qe,21,()=>te,He,(a,t)=>{var b=et(),F=l(b,!0);r(b);var R={};y(()=>{h(F,e(t).label),R!==(R=e(t).value)&&(b.value=(b.__value=e(t).value)??"")}),i(a,b)}),r(qe),r(Ge);var Qe=s(Ge,2),xa=s(l(Qe),2);{var wa=a=>{var t=at();i(a,t)},Ca=a=>{var t=ge(),b=V(t);{var F=N=>{var K=tt();i(N,K)},R=N=>{var K=st(),ve=V(K),ce=l(ve);ce.value=(ce.__value=null)??"";var W=s(ce);Fe(W,17,()=>e(we),He,(k,I)=>{var X=rt(),Te=l(X),Ze=s(Te);{var Ve=Ce=>{var v=aa();y(()=>h(v,`- ${e(I).beer_name??""}`)),i(Ce,v)};_(Ze,Ce=>{e(I).beer_name&&e(I).beer_name!=="Untitled"&&Ce(Ve)})}r(X);var De={};y(()=>{h(Te,`${e(I).color??""} Tilt `),De!==(De=e(I).id)&&(X.value=(X.__value=e(I).id)??"")}),i(k,X)}),r(ve),be(2),Ne(ve,()=>e(ie),k=>o(ie,k)),i(N,K)};_(b,N=>{e(we).length===0?N(F):N(R,!1)},!0)}i(a,t)};_(xa,a=>{e(oe)?a(wa):a(Ca,!1)})}r(Qe);var ze=s(Qe,2),oa=s(l(ze),2);de(oa),be(2),r(ze);var Je=s(ze,2),Ke=l(Je),na=s(l(Ke),2);de(na),r(Ke);var Sa=s(Ke,2);{var Fa=a=>{var t=lt(),b=s(l(t),2);de(b),r(t),le(b,()=>e(fe),F=>o(fe,F)),i(a,t)};_(Sa,a=>{e(w)&&a(Fa)})}r(Je);var va=s(Je,2);{var Ta=a=>{var t=mt(),b=s(V(t),2),F=s(l(b),2),R=l(F);R.value=R.__value="";var N=s(R);Fe(N,17,()=>e(_e),He,(v,f)=>{var p=it(),B=l(p);r(p);var O={};y(()=>{h(B,`${e(f).friendly_name??""} (${e(f).state??""})`),O!==(O=e(f).entity_id)&&(p.value=(p.__value=e(f).entity_id)??"")}),i(v,p)}),r(F);var K=s(F,2);{var ve=v=>{var f=ot();i(v,f)},ce=v=>{var f=ge(),p=V(f);{var B=g=>{var U=nt();i(g,U)},O=g=>{var U=vt();i(g,U)};_(p,g=>{e(_e).length===0?g(B):g(O,!1)},!0)}i(v,f)};_(K,v=>{e(T)?v(ve):v(ce,!1)})}r(b);var W=s(b,2),k=s(l(W),2),I=l(k);I.value=I.__value="";var X=s(I);Fe(X,17,()=>e(me),He,(v,f)=>{var p=ct(),B=l(p);r(p);var O={};y(()=>{h(B,`${e(f).friendly_name??""} (${e(f).state??""})`),O!==(O=e(f).entity_id)&&(p.value=(p.__value=e(f).entity_id)??"")}),i(v,p)}),r(k);var Te=s(k,2);{var Ze=v=>{var f=dt();i(v,f)},Ve=v=>{var f=ge(),p=V(f);{var B=g=>{var U=ut();i(g,U)},O=g=>{var U=ft();i(g,U)};_(p,g=>{e(me).length===0?g(B):g(O,!1)},!0)}i(v,f)};_(Te,v=>{e(Y)?v(Ze):v(Ve,!1)})}r(W);var De=s(W,2);{var Ce=v=>{var f=_t(),p=l(f),B=l(p),O=l(B);r(B);var g=s(B,2);de(g),be(2),r(p);var U=s(p,2),$e=l(U),Ra=l($e);r($e);var Ee=s($e,2);de(Ee),be(2),r(U),r(f),y(()=>{h(O,`Target Temperature (${e(Q)??""})`),Re(g,"min",e(pe)),Re(g,"max",e(Be)),h(Ra,`Hysteresis (${e(Q)??""})`),Re(Ee,"min",e(Oe)),Re(Ee,"max",e(Ye))}),le(g,()=>e(xe),ea=>o(xe,ea)),le(Ee,()=>e(u),ea=>o(u,ea)),i(v,f)};_(De,v=>{(e($)||e(ee))&&v(Ce)})}y(()=>{F.disabled=e(T),k.disabled=e(Y)}),Ne(F,()=>e($),v=>o($,v)),Ne(k,()=>e(ee),v=>o(ee,v)),i(a,t)};_(va,a=>{e(D)&&a(Ta)})}var ca=s(va,2),da=s(l(ca),2);ka(da),r(ca),r(Pe);var ua=s(Pe,2),We=l(ua);We.__click=function(...a){c.onCancel?.apply(this,a)};var Xe=s(We,2),Da=l(Xe);{var Ea=a=>{var t=pt();be(),i(a,t)},Ha=a=>{var t=aa();y(()=>h(t,e(w)?"Save Changes":"Create Batch")),i(a,t)};_(Da,a=>{e(ae)?a(Ea):a(Ha,!1)})}r(Xe),r(ua),r(H),y(()=>{h(Ue,e(w)?"Edit Batch":"New Batch"),h(ba,e(w)?"Update batch details and measurements":"Create a new fermentation batch"),We.disabled=e(ae),Xe.disabled=e(ae)}),Na("submit",H,A),le(ia,()=>e(L),a=>o(L,a)),Ne(qe,()=>e(G),a=>o(G,a)),le(oa,()=>e(ue),a=>o(ue,a)),le(na,()=>e(C),a=>o(C,a)),le(da,()=>e(ye),a=>o(ye,a)),i(ke,H),pa()}fa(["click"]);export{Et as B};
