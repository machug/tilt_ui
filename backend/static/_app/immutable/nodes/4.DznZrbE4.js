import{d as Xe,f as o,s as v,a as l,c as Ce}from"../chunks/BQ88CgEU.js";import{al as a,ak as s,an as t,as as g,ah as Ge,ar as K,c as e,ai as G,at as Se,aj as Me,ap as Ht,aL as Vt,aF as It,am as Wt,ao as ye,s as S}from"../chunks/CGXqq0_G.js";import{e as jt,i as yt}from"../chunks/payu-7ZH.js";import{i as u}from"../chunks/ziKwUJ4R.js";import{h as Jt}from"../chunks/BP8qDDK3.js";import{s as kt}from"../chunks/D2zVhfuI.js";import{s as ke}from"../chunks/DqcjHxzZ.js";import{s as Ee}from"../chunks/BSw_pJTS.js";import{i as Yt,s as qt}from"../chunks/C5J5lxM1.js";import{s as Kt,a as Qt}from"../chunks/C-ohbqfQ.js";import{p as Xt}from"../chunks/Cq8iFhuK.js";import{g as Zt}from"../chunks/KAfJh7Uj.js";import{o as $t,g as pt,v as Ae,u as bt,h as ea,w as Ke}from"../chunks/DVIH5Hsv.js";import{b as ta,g as xt,d as Ze,e as zt,c as ht}from"../chunks/Do2ytZ8P.js";import{t as aa}from"../chunks/DThvY6M2.js";import{B as sa}from"../chunks/CdazY9DQ.js";import{s as ra}from"../chunks/CUQuFe4_.js";import{p as Qe}from"../chunks/B3wItnqC.js";const ia=!1,ys=Object.freeze(Object.defineProperty({__proto__:null,prerender:ia},Symbol.toStringTag,{value:"Module"}));function la(M){return M>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:M>=-60?{bars:3,color:"var(--positive)",label:"Good"}:M>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function wt(M){const i=Math.floor((Date.now()-new Date(M).getTime())/1e3);if(i<10)return"just now";if(i<60)return`${i}s ago`;const p=Math.floor(i/60);if(p<60)return`${p}m ago`;const z=Math.floor(p/60);return z<24?`${z}h ago`:`${Math.floor(z/24)}d ago`}var va=o('<div class="accent-bar svelte-1oyrwd9"></div>'),na=o('<span class="card-icon svelte-1oyrwd9"> </span>'),oa=o('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),da=o('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function Le(M,i){let p=Qe(i,"highlight",3,!1),z=Qe(i,"collapsible",3,!1),b=Qe(i,"expanded",3,!1);var h=da();let c;var r=a(h);{var T=k=>{var C=va();l(k,C)};u(r,k=>{p()&&k(T)})}var n=s(r,2),B=a(n),R=a(B);{var O=k=>{var C=na(),U=a(C,!0);t(C),g(()=>v(U,i.icon)),l(k,C)};u(R,k=>{i.icon&&k(O)})}var _=s(R,2),f=a(_,!0);t(_),t(B);var j=s(B,2);{var w=k=>{var C=oa();C.__click=function(...D){i.onToggle?.apply(this,D)};var U=a(C);let P;t(C),g(()=>{kt(C,"aria-label",b()?"Collapse":"Expand"),P=ke(U,0,"expand-icon svelte-1oyrwd9",null,P,{"rotate-180":b()})}),l(k,C)};u(j,k=>{z()&&i.onToggle&&k(w)})}t(n);var y=s(n,2);let m;var F=a(y);ra(F,()=>i.children),t(y),t(h),g(()=>{c=ke(h,1,"batch-card svelte-1oyrwd9",null,c,{highlight:p()}),v(f,i.title),m=ke(y,1,"card-content svelte-1oyrwd9",null,m,{collapsed:z()&&!b()})}),l(M,h)}Xe(["click"]);var ca=o('<span class="unit svelte-lzskfi"> </span>'),ua=o('<div class="raw-values svelte-lzskfi"><span class="raw-label svelte-lzskfi">Raw:</span> <span class="raw-value svelte-lzskfi"> </span> <span class="raw-separator svelte-lzskfi">¬∑</span> <span class="raw-value svelte-lzskfi"> </span></div>'),_a=o('<div class="last-seen svelte-lzskfi"> </div>'),ga=o('<div class="live-badge svelte-lzskfi"><span class="live-dot svelte-lzskfi"></span> <span class="live-text svelte-lzskfi">LIVE</span></div> <div class="readings-grid svelte-lzskfi"><div class="reading svelte-lzskfi"><div class="reading-value svelte-lzskfi"> <!></div> <div class="reading-label svelte-lzskfi"> </div></div> <div class="reading svelte-lzskfi"><div class="reading-value temp svelte-lzskfi"> <span class="unit svelte-lzskfi"> </span></div> <div class="reading-label svelte-lzskfi">Temperature</div></div></div> <!> <!>',1);function fa(M,i){Ge(i,!0);let p=G(()=>i.liveReading?.sg??i.currentSg),z=G(()=>i.liveReading?.temp??i.currentTemp),b=G(()=>i.liveReading?.sg_raw),h=G(()=>i.liveReading?.temp_raw),c=G(()=>i.liveReading?.last_seen),r=G(()=>i.liveReading&&(i.liveReading.sg!==i.liveReading.sg_raw||i.liveReading.temp!==i.liveReading.temp_raw)),T=G(ta),n=G(xt);function B(_){return _==null?"--":Ze(_)}function R(_){return _==null?"--":zt(_)}let O=G(()=>e(c)?wt(e(c)):null);Le(M,{title:"Live Readings",highlight:!0,children:(_,f)=>{var j=ga(),w=s(K(j),2),y=a(w),m=a(y),F=a(m),k=s(F);{var C=A=>{var E=ca(),d=a(E,!0);t(E),g(()=>v(d,e(T))),l(A,E)};u(k,A=>{e(T)!=="SG"&&A(C)})}t(m);var U=s(m,2),P=a(U,!0);t(U),t(y);var D=s(y,2),Y=a(D),V=a(Y),Q=s(V),re=a(Q,!0);t(Q),t(Y),Se(2),t(D),t(w);var le=s(w,2);{var X=A=>{var E=ua(),d=s(a(E),2),J=a(d,!0);t(d);var Z=s(d,4),L=a(Z);t(Z),t(E),g(($,I)=>{v(J,$),v(L,`${I??""}${e(n)??""}`)},[()=>B(e(b)),()=>R(e(h))]),l(A,E)};u(le,A=>{e(r)&&A(X)})}var ie=s(le,2);{var fe=A=>{var E=_a(),d=a(E);t(E),g(()=>v(d,`Updated ${e(O)??""}`)),l(A,E)};u(ie,A=>{e(O)&&A(fe)})}g((A,E)=>{v(F,`${A??""} `),v(P,e(T)==="SG"?"Gravity":e(T)==="¬∞P"?"Plato":"Brix"),v(V,`${E??""} `),v(re,e(n))},[()=>B(e(p)),()=>R(e(z))]),l(_,j)},$$slots:{default:!0}}),Me()}var ma=o('<div class="gravity-point target svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Target FG</div> <div class="point-value svelte-t80j9z"> </div></div>'),pa=o('<div class="progress-remaining svelte-t80j9z"> </div>'),ba=o('<div class="progress-section svelte-t80j9z"><div class="progress-header svelte-t80j9z"><span class="progress-label svelte-t80j9z">Fermentation Progress</span> <span class="progress-percent svelte-t80j9z"> </span></div> <div class="progress-bar-container svelte-t80j9z"><div class="progress-bar-bg svelte-t80j9z"></div> <div class="progress-bar-fill svelte-t80j9z"></div> <div class="progress-bar-shine svelte-t80j9z"></div></div> <!></div>'),ha=o('<div class="current-sg svelte-t80j9z"><div class="sg-label svelte-t80j9z">Current Specific Gravity</div> <div class="sg-value svelte-t80j9z"> <span class="fermenting-badge svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> Fermenting</span></div></div> <div class="gravity-timeline svelte-t80j9z"><div class="timeline-line svelte-t80j9z"></div> <div class="gravity-point start svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Original Gravity</div> <div class="point-value svelte-t80j9z"> </div></div> <!> <div class="gravity-point current svelte-t80j9z"><div class="point-marker pulsing svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Current FG</div> <div class="point-value svelte-t80j9z"> </div></div></div> <div class="metrics-grid svelte-t80j9z"><div class="metric abv-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">%</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Alcohol by Volume</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div> <div class="metric attenuation-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">‚Üì</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Apparent Attenuation</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div></div> <!>',1),ja=o('<div class="measurements-grid svelte-t80j9z"><div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Original Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Final Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">ABV</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Attenuation</div> <div class="measurement-value svelte-t80j9z"> </div></div></div>'),ya=o('<div class="no-data svelte-t80j9z"><div class="no-data-icon svelte-t80j9z">‚óã</div> <p class="no-data-text svelte-t80j9z">Set Original Gravity to begin tracking fermentation metrics</p></div>');function ka(M,i){Ge(i,!0);let p=G(()=>{if(!i.batch.measured_og)return null;const c=i.currentSg??i.progress?.measured?.current_sg;if(!c)return null;const r=(i.batch.measured_og-c)*131.25,T=i.batch.measured_og-1,n=T!==0?(i.batch.measured_og-c)/T*100:0;return{currentSg:c,abv:Math.max(0,r),attenuation:Math.max(0,Math.min(100,n)),isFermenting:i.batch.status==="fermenting"||i.batch.status==="conditioning"}}),z=G(()=>e(p)?.isFermenting??!1);function b(c){return c==null?"--":Ze(c)}function h(c){return c==null?"--":`${c.toFixed(1)}%`}{let c=G(()=>e(z)?"Fermentation Progress":"Fermentation Measurements");Le(M,{get title(){return e(c)},children:(r,T)=>{var n=Ce(),B=K(n);{var R=_=>{var f=ha(),j=K(f),w=s(a(j),2),y=a(w);Se(),t(w),t(j);var m=s(j,2),F=s(a(m),2),k=s(a(F),4),C=a(k,!0);t(k),t(F);var U=s(F,2);{var P=L=>{var $=ma(),I=s(a($),4),ee=a(I,!0);t(I),t($),g(ve=>v(ee,ve),[()=>b(i.batch.recipe.fg_target)]),l(L,$)};u(U,L=>{i.batch.recipe?.fg_target&&L(P)})}var D=s(U,2),Y=s(a(D),4),V=a(Y,!0);t(Y),t(D),t(m);var Q=s(m,2),re=a(Q),le=s(a(re),2),X=s(a(le),2),ie=a(X);Se(),t(X),t(le),t(re);var fe=s(re,2),A=s(a(fe),2),E=s(a(A),2),d=a(E);Se(),t(E),t(A),t(fe),t(Q);var J=s(Q,2);{var Z=L=>{var $=ba(),I=a($),ee=s(a(I),2),ve=a(ee);t(ee),t(I);var xe=s(I,2),Pe=s(a(xe),2);Se(2),t(xe);var me=s(xe,2);{var Be=ze=>{var De=pa(),Ue=a(De);t(De),g(pe=>v(Ue,`${pe??""} gravity points remaining`),[()=>i.progress.progress.sg_remaining.toFixed(3)]),l(ze,De)};u(me,ze=>{i.progress.progress.sg_remaining!=null&&ze(Be)})}t($),g(ze=>{v(ve,`${ze??""}%`),Ee(Pe,`width: ${i.progress.progress.percent_complete??""}%`)},[()=>i.progress.progress.percent_complete.toFixed(0)]),l(L,$)};u(J,L=>{i.progress?.progress?.percent_complete!=null&&L(Z)})}g((L,$,I,ee,ve)=>{v(y,`${L??""} `),v(C,$),v(V,I),v(ie,`${ee??""} `),v(d,`${ve??""} `)},[()=>b(e(p).currentSg),()=>b(i.batch.measured_og),()=>b(e(p).currentSg),()=>h(e(p).abv),()=>h(e(p).attenuation)]),l(_,f)},O=_=>{var f=Ce(),j=K(f);{var w=m=>{var F=ja(),k=a(F),C=s(a(k),2),U=a(C,!0);t(C),t(k);var P=s(k,2),D=s(a(P),2),Y=a(D,!0);t(D),t(P);var V=s(P,2),Q=s(a(V),2),re=a(Q,!0);t(Q),t(V);var le=s(V,2),X=s(a(le),2),ie=a(X,!0);t(X),t(le),t(F),g((fe,A,E,d)=>{v(U,fe),v(Y,A),v(re,E),v(ie,d)},[()=>b(i.batch.measured_og),()=>b(i.batch.measured_fg),()=>i.batch.measured_abv!=null?h(i.batch.measured_abv):"--",()=>i.batch.measured_attenuation!=null?h(i.batch.measured_attenuation):"--"]),l(m,F)},y=m=>{var F=ya();l(m,F)};u(j,m=>{i.batch.measured_og?m(w):m(y,!1)},!0)}l(_,f)};u(B,_=>{e(p)&&e(z)?_(R):_(O,!1)})}l(r,n)},$$slots:{default:!0}})}Me()}var xa=o('<div class="timeline svelte-yskb8i"><div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Brew Date</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Started</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Ended</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Created</span> <span class="timeline-value svelte-yskb8i"> </span></div></div>');function za(M,i){Ge(i,!0);function p(b){return b?new Date(b).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}):"--"}function z(b){return b?new Date(b).toLocaleString("en-GB",{day:"numeric",month:"short",hour:"numeric",minute:"2-digit"}):"--"}Le(M,{title:"Timeline",children:(b,h)=>{var c=xa(),r=a(c),T=s(a(r),2),n=a(T,!0);t(T),t(r);var B=s(r,2),R=s(a(B),2),O=a(R,!0);t(R),t(B);var _=s(B,2),f=s(a(_),2),j=a(f,!0);t(f),t(_);var w=s(_,2),y=s(a(w),2),m=a(y,!0);t(y),t(w),t(c),g((F,k,C,U)=>{v(n,F),v(O,k),v(j,C),v(m,U)},[()=>p(i.batch.brew_date),()=>z(i.batch.start_time),()=>z(i.batch.end_time),()=>z(i.batch.created_at)]),l(b,c)},$$slots:{default:!0}}),Me()}var wa=o('<div class="signal-bar svelte-1kdxwtz"></div>'),Fa=o('<div class="signal-details svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="signal-text svelte-1kdxwtz"> </span></div>'),Ca=o('<div class="device-last-seen svelte-1kdxwtz"> </div>'),Sa=o('<div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!> <!>',1),Ba=o('<div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <div class="device-last-seen svelte-1kdxwtz">Not receiving data</div>',1),Ta=o('<div class="device-info svelte-1kdxwtz"><!></div>'),Ra=o('<button type="button" class="link-btn svelte-1kdxwtz">Link a device</button>'),Oa=o('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function Ga(M,i){Ge(i,!0);let p=G(()=>i.liveReading?.rssi?la(i.liveReading.rssi):null),z=G(()=>i.liveReading?.last_seen?wt(i.liveReading.last_seen):null);Le(M,{title:"Tracking Device",children:(b,h)=>{var c=Ce(),r=K(c);{var T=B=>{var R=Ta(),O=a(R);{var _=j=>{var w=Sa(),y=K(w),m=s(a(y));t(y);var F=s(y,2);{var k=P=>{var D=Fa(),Y=a(D);jt(Y,20,()=>Array(4),yt,(re,le,X)=>{var ie=wa();g(()=>Ee(ie,`
										height: ${6+X*3}px;
										background: ${(X<e(p).bars?e(p).color:"var(--bg-hover)")??""};
										opacity: ${X<e(p).bars?1:.4};
									`)),l(re,ie)}),t(Y);var V=s(Y,2),Q=a(V);t(V),t(D),g(()=>{Ee(V,`color: ${e(p).color??""}`),v(Q,`${e(p).label??""} (${i.liveReading.rssi??""} dBm)`)}),l(P,D)};u(F,P=>{e(p)&&P(k)})}var C=s(F,2);{var U=P=>{var D=Ca(),Y=a(D);t(D),g(()=>v(Y,`Updated ${e(z)??""}`)),l(P,D)};u(C,P=>{e(z)&&P(U)})}g(()=>v(m,` ${i.liveReading.color??""} Tilt - Connected`)),l(j,w)},f=j=>{var w=Ba(),y=K(w),m=s(a(y));t(y),Se(2),g(()=>v(m,` Device: ${i.batch.device_id??""}`)),l(j,w)};u(O,j=>{i.liveReading?j(_):j(f,!1)})}t(R),l(B,R)},n=B=>{var R=Oa(),O=s(a(R),2);{var _=f=>{var j=Ra();j.__click=function(...w){i.onEdit?.apply(this,w)},l(f,j)};u(O,f=>{i.onEdit&&f(_)})}t(R),l(B,R)};u(r,B=>{i.batch.device_id?B(T):B(n,!1)})}l(b,c)},$$slots:{default:!0}}),Me()}Xe(["click"]);var Ma=o('<div class="target wide svelte-19u9n31"><span class="target-label svelte-19u9n31">Yeast</span> <span class="target-value svelte-19u9n31"> </span></div>'),La=o('<div class="targets-grid svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div> <!></div>');function Pa(M,i){Ge(i,!0);function p(z){return z==null?"--":Ze(z)}Le(M,{title:"Recipe Targets",children:(z,b)=>{var h=La(),c=a(h),r=s(a(c),2),T=a(r,!0);t(r),t(c);var n=s(c,2),B=s(a(n),2),R=a(B,!0);t(B),t(n);var O=s(n,2),_=s(a(O),2),f=a(_,!0);t(_),t(O);var j=s(O,2);{var w=y=>{var m=Ma(),F=s(a(m),2),k=a(F,!0);t(F),t(m),g(()=>v(k,i.recipe.yeast_name)),l(y,m)};u(j,y=>{i.recipe.yeast_name&&y(w)})}t(h),g((y,m,F)=>{v(T,y),v(R,m),v(f,F)},[()=>p(i.recipe.og_target),()=>p(i.recipe.fg_target),()=>i.recipe.abv_target!=null?`${i.recipe.abv_target.toFixed(1)}%`:"--"]),l(z,h)},$$slots:{default:!0}}),Me()}var Da=o('<p class="notes-content svelte-hkv31i"> </p>');function Aa(M,i){Le(M,{title:"Notes",children:(p,z)=>{var b=Da(),h=a(b,!0);t(b),g(()=>v(h,i.notes)),l(p,b)},$$slots:{default:!0}})}var Ea=o('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),Ua=o('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),Na=o('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),Ha=o('<span class="recipe-type svelte-g5au2j"> </span>'),Va=o('<a class="recipe-link svelte-g5au2j"> <!></a>'),Ia=o('<option class="svelte-g5au2j"> </option>'),Wa=o('<div class="device-status heater svelte-g5au2j"><div>üî•</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Heater</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),Ja=o('<div class="device-status cooler svelte-g5au2j"><div>‚ùÑÔ∏è</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Cooler</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),Ya=o('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">‚ö°</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),qa=o('<button type="button" class="override-btn heat-on svelte-g5au2j">Force Heat ON</button> <button type="button" class="override-btn heat-off svelte-g5au2j">Force Heat OFF</button>',1),Ka=o('<button type="button" class="override-btn cool-on svelte-g5au2j">Force Cool ON</button> <button type="button" class="override-btn cool-off svelte-g5au2j">Force Cool OFF</button>',1),Qa=o('<div class="control-details svelte-g5au2j"><div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns-grid svelte-g5au2j"><!> <!> <button type="button" class="override-btn auto-mode svelte-g5au2j">Auto Mode</button></div></div>',1),Xa=o('<div><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="device-status-grid svelte-g5au2j"><!> <!></div> <!></div>'),Za=o('<span class="svelte-g5au2j"> </span>'),$a=o('<span class="svelte-g5au2j"> </span>'),es=o('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><!> <!> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),ts=o('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!></div></div>',1),as=o('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div>');function ks(M,i){Ge(i,!0);const p=()=>Qt(Xt,"$page",z),[z,b]=Kt();let h=null,c=null,r=ye(null),T=ye(null),n=ye(null),B=ye(!0),R=ye(null),O=ye(!1),_=ye(!1),f=ye(!1),j=G(()=>parseInt(p().params.id??"0"));const w={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},y=["planning","fermenting","conditioning","completed","archived"];let m=G(()=>e(r)?w[e(r).status]:w.planning),F=G(xt),k=G(()=>ht.config.ha_enabled&&ht.config.temp_control_enabled&&(e(r)?.heater_entity_id||e(r)?.cooler_entity_id)),C=G(()=>{if(!e(r)?.device_id)return null;const d=e(r).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!d?.[1])return null;const J=d[1].toUpperCase();for(const Z of aa.tilts.values())if(Z.color.toUpperCase()===J)return Z;return null});async function U(){S(B,!0),S(R,null);try{if(S(r,await $t(e(j)),!0),e(r).status==="fermenting"||e(r).status==="conditioning")try{S(T,await pt(e(j)),!0)}catch{}if(e(r).heater_entity_id||e(r).cooler_entity_id)try{S(n,await Ae(e(j)),!0)}catch{}}catch(d){S(R,d instanceof Error?d.message:"Failed to load batch",!0)}finally{S(B,!1)}}async function P(d){if(!(!e(r)||e(_))){S(_,!0);try{S(r,await bt(e(r).id,{status:d}),!0),(d==="fermenting"||d==="conditioning")&&S(T,await pt(e(r).id),!0)}catch(J){console.error("Failed to update status:",J)}finally{S(_,!1)}}}async function D(d){if(e(r)&&(S(r,await bt(e(r).id,d),!0),S(O,!1),e(r).heater_entity_id||e(r).cooler_entity_id))try{S(n,await Ae(e(r).id),!0)}catch{}}async function Y(){if(e(r)&&confirm(`Are you sure you want to delete "${e(r).name||"this batch"}"?`))try{await ea(e(r).id),Zt("/batches")}catch{alert("Failed to delete batch")}}async function V(d,J){if(!(!e(r)||e(f))){S(f,!0);try{await Ke(e(r).id,J,60,d),S(n,await Ae(e(r).id),!0)}catch(Z){console.error("Failed to set override:",Z)}finally{S(f,!1)}}}async function Q(){if(!(!e(r)||e(f))){S(f,!0);try{e(r).heater_entity_id&&await Ke(e(r).id,null,60,"heater"),e(r).cooler_entity_id&&await Ke(e(r).id,null,60,"cooler"),S(n,await Ae(e(r).id),!0)}catch(d){console.error("Failed to clear overrides:",d)}finally{S(f,!1)}}}function re(){if(h?.readyState===WebSocket.OPEN)return;const J=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;h=new WebSocket(J),h.onmessage=async Z=>{try{const L=JSON.parse(Z.data);L.type==="control_event"&&L.batch_id===e(j)&&e(n)&&(L.action==="heat_on"?S(n,{...e(n),heater_state:"on"},!0):L.action==="heat_off"?S(n,{...e(n),heater_state:"off"},!0):L.action==="cool_on"?S(n,{...e(n),cooler_state:"on"},!0):L.action==="cool_off"&&S(n,{...e(n),cooler_state:"off"},!0))}catch{}},h.onclose=()=>{h=null,c=setTimeout(re,3e3)},h.onerror=()=>{h?.close()}}function le(){c&&(clearTimeout(c),c=null),h?.close(),h=null}function X(d){return d==null?"--":zt(d)}Ht(()=>{U(),re()}),Vt(()=>{le()});var ie=as();Jt("g5au2j",d=>{It(()=>{Wt.title=`${(e(r)?.name||"Batch")??""} | BrewSignal`})});var fe=s(a(ie),2);{var A=d=>{var J=Ea();l(d,J)},E=d=>{var J=Ce(),Z=K(J);{var L=I=>{var ee=Ua(),ve=s(a(ee),2),xe=a(ve,!0);t(ve);var Pe=s(ve,2);Pe.__click=U,t(ee),g(()=>v(xe,e(R))),l(I,ee)},$=I=>{var ee=Ce(),ve=K(ee);{var xe=me=>{var Be=Na();l(me,Be)},Pe=me=>{var Be=Ce(),ze=K(Be);{var De=pe=>{sa(pe,{get batch(){return e(r)},onSubmit:D,onCancel:()=>S(O,!1)})},Ue=pe=>{var $e=ts(),Ne=K($e),He=a(Ne),Ve=a(He),Ft=a(Ve);t(Ve);var et=s(Ve,2),Ie=a(et),Ct=a(Ie,!0);t(Ie);var St=s(Ie,2);{var Bt=x=>{var N=Va(),q=a(N),_e=s(q);{var ne=ge=>{var be=Ha(),Te=a(be);t(be),g(()=>v(Te,`(${e(r).recipe.type??""})`)),l(ge,be)};u(_e,ge=>{e(r).recipe.type&&ge(ne)})}t(N),g(()=>{kt(N,"href",`/recipes/${e(r).recipe.id??""}`),v(q,`${e(r).recipe.name??""} `)}),l(x,N)};u(St,x=>{e(r).recipe&&x(Bt)})}t(et),t(He);var tt=s(He,2),We=a(tt),ue=a(We);ue.__change=x=>P(x.currentTarget.value),jt(ue,21,()=>y,yt,(x,N)=>{var q=Ia(),_e=a(q,!0);t(q);var ne={};g(()=>{v(_e,w[e(N)].label),ne!==(ne=e(N))&&(q.value=(q.__value=e(N))??"")}),l(x,q)}),t(ue);var at;Yt(ue),t(We);var st=s(We,2);st.__click=()=>S(O,!0);var Tt=s(st,2);Tt.__click=Y,t(tt),t(Ne);var rt=s(Ne,2),Je=a(rt),it=a(Je);{var Rt=x=>{{let N=G(()=>e(T)?.measured?.current_sg),q=G(()=>e(T)?.temperature?.current);fa(x,{get liveReading(){return e(C)},get currentSg(){return e(N)},get currentTemp(){return e(q)}})}};u(it,x=>{(e(C)||e(T)?.measured?.current_sg!=null)&&x(Rt)})}var lt=s(it,2);{let x=G(()=>e(C)?.sg??e(T)?.measured?.current_sg);ka(lt,{get batch(){return e(r)},get currentSg(){return e(x)},get progress(){return e(T)}})}var Ot=s(lt,2);{var Gt=x=>{Pa(x,{get recipe(){return e(r).recipe}})};u(Ot,x=>{e(r).recipe&&x(Gt)})}t(Je);var vt=s(Je,2),nt=a(vt);za(nt,{get batch(){return e(r)}});var ot=s(nt,2);Ga(ot,{get batch(){return e(r)},get liveReading(){return e(C)},onEdit:()=>S(O,!0)});var dt=s(ot,2);{var Mt=x=>{var N=Xa();let q;var _e=s(a(N),2),ne=a(_e);{var ge=te=>{var H=Wa(),W=a(H);let ae;var he=s(W,2),oe=s(a(he),2);let je;var Re=a(oe,!0);t(oe);var we=s(oe,2),Oe=a(we,!0);t(we),t(he),t(H),g(()=>{ae=ke(W,1,"device-icon-wrap svelte-g5au2j",null,ae,{active:e(n)?.heater_state==="on"}),je=ke(oe,1,"device-state svelte-g5au2j",null,je,{on:e(n)?.heater_state==="on"}),v(Re,e(n)?.heater_state==="on"?"ON":"OFF"),v(Oe,e(r).heater_entity_id)}),l(te,H)};u(ne,te=>{e(r).heater_entity_id&&te(ge)})}var be=s(ne,2);{var Te=te=>{var H=Ja(),W=a(H);let ae;var he=s(W,2),oe=s(a(he),2);let je;var Re=a(oe,!0);t(oe);var we=s(oe,2),Oe=a(we,!0);t(we),t(he),t(H),g(()=>{ae=ke(W,1,"device-icon-wrap svelte-g5au2j",null,ae,{active:e(n)?.cooler_state==="on"}),je=ke(oe,1,"device-state svelte-g5au2j",null,je,{on:e(n)?.cooler_state==="on"}),v(Re,e(n)?.cooler_state==="on"?"ON":"OFF"),v(Oe,e(r).cooler_entity_id)}),l(te,H)};u(be,te=>{e(r).cooler_entity_id&&te(Te)})}t(_e);var Ye=s(_e,2);{var qe=te=>{var H=Qa(),W=K(H),ae=a(W),he=s(a(ae),2),oe=a(he);t(he),t(ae);var je=s(ae,2),Re=s(a(je),2),we=a(Re);t(Re),t(je),t(W);var Oe=s(W,2);{var At=se=>{var de=Ya(),ce=s(a(de),2),Fe=a(ce);t(ce);var mt=s(ce,2);mt.__click=()=>Q(),t(de),g(Nt=>{v(Fe,`Override active: ${Nt??""}`),mt.disabled=e(f)},[()=>e(n).override_state?.toUpperCase()]),l(se,de)};u(Oe,se=>{e(n).override_active&&se(At)})}var ct=s(Oe,2),ut=s(a(ct),2),_t=a(ut);{var Et=se=>{var de=qa(),ce=K(de);ce.__click=()=>V("heater","on");var Fe=s(ce,2);Fe.__click=()=>V("heater","off"),g(()=>{ce.disabled=e(f),Fe.disabled=e(f)}),l(se,de)};u(_t,se=>{e(r).heater_entity_id&&se(Et)})}var gt=s(_t,2);{var Ut=se=>{var de=Ka(),ce=K(de);ce.__click=()=>V("cooler","on");var Fe=s(ce,2);Fe.__click=()=>V("cooler","off"),g(()=>{ce.disabled=e(f),Fe.disabled=e(f)}),l(se,de)};u(gt,se=>{e(r).cooler_entity_id&&se(Ut)})}var ft=s(gt,2);ft.__click=()=>Q(),t(ut),t(ct),g((se,de)=>{v(oe,`${se??""}${e(F)??""}`),v(we,`¬±${de??""}${e(F)??""}`),ft.disabled=e(f)},[()=>X(e(n).target_temp),()=>e(n).hysteresis?.toFixed(1)||"--"]),l(te,H)};u(Ye,te=>{e(n)&&te(qe)})}t(N),g(()=>q=ke(N,1,"info-card temp-control-card svelte-g5au2j",null,q,{"heater-on":e(n)?.heater_state==="on","cooler-on":e(n)?.cooler_state==="on"})),l(x,N)},Lt=x=>{var N=Ce(),q=K(N);{var _e=ne=>{var ge=es(),be=s(a(ge),2),Te=a(be);{var Ye=H=>{var W=Za(),ae=a(W);t(W),g(()=>v(ae,`Heater: ${e(r).heater_entity_id??""}`)),l(H,W)};u(Te,H=>{e(r).heater_entity_id&&H(Ye)})}var qe=s(Te,2);{var te=H=>{var W=$a(),ae=a(W);t(W),g(()=>v(ae,`Cooler: ${e(r).cooler_entity_id??""}`)),l(H,W)};u(qe,H=>{e(r).cooler_entity_id&&H(te)})}Se(2),t(be),t(ge),l(ne,ge)};u(q,ne=>{(e(r).heater_entity_id||e(r).cooler_entity_id)&&e(r).status!=="fermenting"&&ne(_e)},!0)}l(x,N)};u(dt,x=>{e(k)&&e(r).status==="fermenting"?x(Mt):x(Lt,!1)})}var Pt=s(dt,2);{var Dt=x=>{Aa(x,{get notes(){return e(r).notes}})};u(Pt,x=>{e(r).notes&&x(Dt)})}t(vt),t(rt),g(()=>{v(Ft,`#${(e(r).batch_number||"?")??""}`),v(Ct,e(r).name||e(r).recipe?.name||"Unnamed Batch"),ue.disabled=e(_),Ee(ue,`color: ${e(m).color??""}; background: ${e(m).bg??""};`),at!==(at=e(r).status)&&(ue.value=(ue.__value=e(r).status)??"",qt(ue,e(r).status))}),l(pe,$e)};u(ze,pe=>{e(O)?pe(De):pe(Ue,!1)},!0)}l(me,Be)};u(ve,me=>{e(r)?me(Pe,!1):me(xe)},!0)}l(I,ee)};u(Z,I=>{e(R)?I(L):I($,!1)},!0)}l(d,J)};u(fe,d=>{e(B)?d(A):d(E,!1)})}t(ie),l(M,ie),Me(),b()}Xe(["click","change"]);export{ks as component,ys as universal};
