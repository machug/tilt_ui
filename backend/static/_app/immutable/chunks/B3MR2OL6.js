import{d as Te,f as g,e as Ye,a as u,s as f,t as ee}from"./BMR6TOGE.js";import{aa as Ae,an as v,p as m,ai as Ee,b as e,ao as _e,s as i,ap as Ge,ad as o,aq as _,ab as Pe,ac as l,af as s,ar as B,as as Ue}from"./CJ9U_lt3.js";import{e as ae,i as te}from"./Bv8p5TEf.js";import{i as y}from"./BK4Po838.js";import{r as R}from"./CHurcNvB.js";import{b as C}from"./CAiyxBcm.js";import{b as le}from"./4F6_53_-.js";import{f as qe}from"./CTNLw3_F.js";import{t as Le}from"./7aIyeNsM.js";var je=g('<div class="error-banner svelte-8ou9a2"><span class="error-icon svelte-8ou9a2">!</span> </div>'),ze=g("<option> <!></option>"),He=g('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="recipe">Recipe</label> <select id="recipe" class="form-select svelte-8ou9a2"><option>No recipe (manual batch)</option><!></select> <span class="form-hint svelte-8ou9a2">Select a recipe to auto-fill targets</span></div>'),Je=g("<option> </option>"),Ke=g("<option> <!></option>"),Qe=g('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="fg">Measured FG</label> <input type="number" id="fg" class="form-input svelte-8ou9a2" placeholder="1.010" step="0.001" min="0.990" max="1.100"/></div>'),Ve=g('<span class="spinner svelte-8ou9a2"></span> Saving...',1),We=g('<form class="batch-form svelte-8ou9a2"><div class="form-header svelte-8ou9a2"><h2 class="form-title svelte-8ou9a2"> </h2> <p class="form-description svelte-8ou9a2"> </p></div> <!> <div class="form-body svelte-8ou9a2"><!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="name">Batch Name</label> <input type="text" id="name" class="form-input svelte-8ou9a2" placeholder="e.g., Summer IPA #3" maxlength="200"/> <span class="form-hint svelte-8ou9a2">Optional - defaults to recipe name</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="status">Status</label> <select id="status" class="form-select svelte-8ou9a2"></select></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="device">Tracking Device</label> <select id="device" class="form-select svelte-8ou9a2"><option>No device assigned</option><!></select> <span class="form-hint svelte-8ou9a2">Link a Tilt to track live gravity and temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="brewDate">Brew Date</label> <input type="date" id="brewDate" class="form-input date-input svelte-8ou9a2"/> <span class="form-hint svelte-8ou9a2">DD/MM/YYYY</span></div> <div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="og">Measured OG</label> <input type="number" id="og" class="form-input svelte-8ou9a2" placeholder="1.050" step="0.001" min="0.990" max="1.200"/></div> <!></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="notes">Notes</label> <textarea id="notes" class="form-textarea svelte-8ou9a2" placeholder="Brewing notes, observations, etc." rows="3"></textarea></div></div> <div class="form-footer svelte-8ou9a2"><button type="button" class="btn-cancel svelte-8ou9a2">Cancel</button> <button type="submit" class="btn-submit svelte-8ou9a2"><!></button></div></form>');function ra(pe,n){Ae(n,!0);let w=v(m(n.batch?.name||"")),S=v(m(n.batch?.recipe_id||null)),T=v(m(n.batch?.device_id||null)),Y=v(m(n.batch?.status||"planning")),k=v(m(n.batch?.brew_date?n.batch.brew_date.split("T")[0]:"")),M=v(m(n.batch?.measured_og?.toString()||"")),O=v(m(n.batch?.measured_fg?.toString()||"")),A=v(m(n.batch?.notes||"")),E=v(m([])),G=v(!0),h=v(!1),N=v(null),be=_e(()=>Array.from(Le.tilts.values()));const ge=[{value:"planning",label:"Planning"},{value:"fermenting",label:"Fermenting"},{value:"conditioning",label:"Conditioning"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}];let p=_e(()=>!!n.batch);async function he(){i(G,!0);try{i(E,await qe(),!0)}catch(a){console.error("Failed to load recipes:",a)}finally{i(G,!1)}}async function xe(a){if(a.preventDefault(),!e(h)){i(h,!0),i(N,null);try{const t={name:e(w)||void 0,status:e(Y),device_id:e(T)||void 0,brew_date:e(k)?new Date(e(k)).toISOString():void 0,measured_og:e(M)?parseFloat(e(M)):void 0,notes:e(A)||void 0};e(p)||(t.recipe_id=e(S)||void 0),e(p)&&e(O)&&(t.measured_fg=parseFloat(e(O))),await n.onSubmit(t)}catch(t){i(N,t instanceof Error?t.message:"Failed to save batch",!0)}finally{i(h,!1)}}}Ee(()=>{if(!e(p)&&e(S)&&!e(w)){const a=e(E).find(t=>t.id===e(S));a&&i(w,a.name,!0)}}),Ge(()=>{he()});var I=We(),P=o(I),U=o(P),ye=o(U,!0);s(U);var se=l(U,2),we=o(se,!0);s(se),s(P);var oe=l(P,2);{var Se=a=>{var t=je(),r=l(o(t));s(t),_(()=>f(r,` ${e(N)??""}`)),u(a,t)};y(oe,a=>{e(N)&&a(Se)})}var q=l(oe,2),re=o(q);{var De=a=>{var t=He(),r=l(o(t),2),d=o(r);d.value=(d.__value=null)??"";var x=l(d);ae(x,17,()=>e(E),te,(D,b)=>{var c=ze(),F=o(c),Ne=l(F);{var Ie=$=>{var me=ee();_(Re=>f(me,`(OG: ${Re??""})`),[()=>e(b).og_target.toFixed(3)]),u($,me)};y(Ne,$=>{e(b).og_target&&$(Ie)})}s(c);var fe={};_(()=>{f(F,`${e(b).name??""} `),fe!==(fe=e(b).id)&&(c.value=(c.__value=e(b).id)??"")}),u(D,c)}),s(r),B(2),s(t),_(()=>r.disabled=e(G)),le(r,()=>e(S),D=>i(S,D)),u(a,t)};y(re,a=>{e(p)||a(De)})}var L=l(re,2),ie=l(o(L),2);R(ie),B(2),s(L);var j=l(L,2),z=l(o(j),2);ae(z,21,()=>ge,te,(a,t)=>{var r=Je(),d=o(r,!0);s(r);var x={};_(()=>{f(d,e(t).label),x!==(x=e(t).value)&&(r.value=(r.__value=e(t).value)??"")}),u(a,r)}),s(z),s(j);var H=l(j,2),J=l(o(H),2),K=o(J);K.value=(K.__value=null)??"";var Fe=l(K);ae(Fe,17,()=>e(be),te,(a,t)=>{var r=Ke(),d=o(r),x=l(d);{var D=c=>{var F=ee();_(()=>f(F,`- ${e(t).beer_name??""}`)),u(c,F)};y(x,c=>{e(t).beer_name&&e(t).beer_name!=="Untitled"&&c(D)})}s(r);var b={};_(()=>{f(d,`${e(t).color??""} Tilt `),b!==(b=e(t).id)&&(r.value=(r.__value=e(t).id)??"")}),u(a,r)}),s(J),B(2),s(H);var Q=l(H,2),ne=l(o(Q),2);R(ne),B(2),s(Q);var V=l(Q,2),W=o(V),ve=l(o(W),2);R(ve),s(W);var Be=l(W,2);{var Ce=a=>{var t=Qe(),r=l(o(t),2);R(r),s(t),C(r,()=>e(O),d=>i(O,d)),u(a,t)};y(Be,a=>{e(p)&&a(Ce)})}s(V);var ue=l(V,2),de=l(o(ue),2);Ue(de),s(ue),s(q);var ce=l(q,2),X=o(ce);X.__click=function(...a){n.onCancel?.apply(this,a)};var Z=l(X,2),ke=o(Z);{var Me=a=>{var t=Ve();B(),u(a,t)},Oe=a=>{var t=ee();_(()=>f(t,e(p)?"Save Changes":"Create Batch")),u(a,t)};y(ke,a=>{e(h)?a(Me):a(Oe,!1)})}s(Z),s(ce),s(I),_(()=>{f(ye,e(p)?"Edit Batch":"New Batch"),f(we,e(p)?"Update batch details and measurements":"Create a new fermentation batch"),X.disabled=e(h),Z.disabled=e(h)}),Ye("submit",I,xe),C(ie,()=>e(w),a=>i(w,a)),le(z,()=>e(Y),a=>i(Y,a)),le(J,()=>e(T),a=>i(T,a)),C(ne,()=>e(k),a=>i(k,a)),C(ve,()=>e(M),a=>i(M,a)),C(de,()=>e(A),a=>i(A,a)),u(pe,I),Pe()}Te(["click"]);export{ra as B};
