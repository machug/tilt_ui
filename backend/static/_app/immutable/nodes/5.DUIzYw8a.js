import{d as Is,f as d,a as v,s as _,t as Bs,b as Ke}from"../chunks/BHvHOtuG.js";import{ab as Ns,ac as p,p as Os,ad as Ds,ae as Js,af as Ls,s as o,V as Es,ag as l,ah as n,ai as Hs,g as s,aj as a,an as S,al as z,ak as Ks}from"../chunks/BeYMcFNd.js";import{e as Vs,i as $s}from"../chunks/Cn7aBH5Z.js";import{i as f}from"../chunks/Cd5u1CHp.js";import{c as A,h as Ys,r as Le,s as Ee,u as qs}from"../chunks/BVbD26w7.js";import{s as Y}from"../chunks/CxgAQQFa.js";import{b as He}from"../chunks/BperHIsi.js";import{i as Gs,s as Qs,b as Ws}from"../chunks/UEX34lHC.js";var Xs=d('<div class="loading-state svelte-hj1sc2"><div class="loading-spinner svelte-hj1sc2"></div> <span class="svelte-hj1sc2">Loading system information...</span></div>'),Zs=d('<div class="info-grid svelte-hj1sc2"><div class="info-item svelte-hj1sc2"><span class="info-label svelte-hj1sc2">Hostname</span> <span class="info-value font-mono svelte-hj1sc2"> </span></div> <div class="info-item svelte-hj1sc2"><span class="info-label svelte-hj1sc2">Version</span> <span class="info-value font-mono svelte-hj1sc2"> </span></div> <div class="info-item svelte-hj1sc2"><span class="info-label svelte-hj1sc2">Uptime</span> <span class="info-value font-mono svelte-hj1sc2"> </span></div> <div class="info-item svelte-hj1sc2"><span class="info-label svelte-hj1sc2">IP Address</span> <span class="info-value font-mono svelte-hj1sc2"> </span></div></div>'),et=d('<p class="text-muted svelte-hj1sc2">Unable to load system information</p>'),st=d('<div class="setting-row sub-setting svelte-hj1sc2"><div class="setting-info svelte-hj1sc2"><span class="setting-label svelte-hj1sc2">Smoothing Samples</span> <span class="setting-description svelte-hj1sc2">Number of readings to average</span></div> <select class="select-input-sm svelte-hj1sc2"><option class="svelte-hj1sc2">3</option><option class="svelte-hj1sc2">5</option><option class="svelte-hj1sc2">10</option><option class="svelte-hj1sc2">15</option><option class="svelte-hj1sc2">20</option></select></div>'),tt=d('<span class="loading-dot svelte-hj1sc2"></span> Saving...',1),at=d('<p class="config-error svelte-hj1sc2"> </p>'),nt=d('<p class="config-success svelte-hj1sc2">Settings saved</p>'),it=d('<option class="svelte-hj1sc2"> </option>'),lt=d('<div class="loading-spinner-small svelte-hj1sc2"></div>'),ot=d('<div class="stat-item svelte-hj1sc2"><span class="stat-value font-mono svelte-hj1sc2"> </span> <span class="stat-label svelte-hj1sc2">Total Readings</span></div> <div class="stat-item svelte-hj1sc2"><span class="stat-value font-mono svelte-hj1sc2"> </span> <span class="stat-label svelte-hj1sc2">Estimated Size</span></div>',1),rt=d('<p class="text-muted svelte-hj1sc2">Unable to load storage stats</p>'),ct=d('<button type="button" class="btn-danger-sm svelte-hj1sc2"> </button>'),vt=d('<p class="cleanup-message svelte-hj1sc2"> </p>'),dt=d('<span class="loading-dot svelte-hj1sc2"></span> Rebooting...',1),pt=Ke('<svg class="w-4 h-4 svelte-hj1sc2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" class="svelte-hj1sc2"></path></svg> Reboot System',1),ut=d('<span class="loading-dot svelte-hj1sc2"></span> Shutting down...',1),ht=Ke('<svg class="w-4 h-4 svelte-hj1sc2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" class="svelte-hj1sc2"></path></svg> Shutdown System',1),_t=d('<div class="grid gap-6 svelte-hj1sc2"><div class="card svelte-hj1sc2"><div class="card-header svelte-hj1sc2"><h2 class="card-title svelte-hj1sc2">System Information</h2></div> <div class="card-body svelte-hj1sc2"><!></div></div> <div class="grid gap-6 md:grid-cols-2 svelte-hj1sc2"><div class="card svelte-hj1sc2"><div class="card-header svelte-hj1sc2"><h2 class="card-title svelte-hj1sc2">Application Settings</h2></div> <div class="card-body svelte-hj1sc2"><div class="setting-row svelte-hj1sc2"><div class="setting-info svelte-hj1sc2"><span class="setting-label svelte-hj1sc2">Temperature Units</span> <span class="setting-description svelte-hj1sc2">Display temperature in Celsius or Fahrenheit</span></div> <div class="unit-toggle svelte-hj1sc2"><button type="button">°C</button> <button type="button">°F</button></div></div> <div class="setting-row svelte-hj1sc2"><div class="setting-info svelte-hj1sc2"><span class="setting-label svelte-hj1sc2">Minimum RSSI</span> <span class="setting-description svelte-hj1sc2">Ignore readings below this signal strength</span></div> <div class="rssi-input svelte-hj1sc2"><input type="number" min="-100" max="0" class="input-field-sm svelte-hj1sc2"/> <span class="input-suffix svelte-hj1sc2">dBm</span></div></div> <div class="setting-row svelte-hj1sc2"><div class="setting-info svelte-hj1sc2"><span class="setting-label svelte-hj1sc2">Reading Smoothing</span> <span class="setting-description svelte-hj1sc2">Average multiple readings to reduce noise</span></div> <button type="button" aria-label="Toggle reading smoothing"><span class="toggle-slider svelte-hj1sc2"></span></button></div> <!> <div class="setting-row svelte-hj1sc2"><div class="setting-info svelte-hj1sc2"><span class="setting-label svelte-hj1sc2">Identify by MAC</span> <span class="setting-description svelte-hj1sc2">Use MAC address instead of broadcast ID</span></div> <button type="button" aria-label="Toggle identify by MAC address"><span class="toggle-slider svelte-hj1sc2"></span></button></div> <div class="mt-4 config-actions svelte-hj1sc2"><button type="button" class="btn-primary svelte-hj1sc2"><!></button> <!> <!></div></div></div> <div class="card svelte-hj1sc2"><div class="card-header svelte-hj1sc2"><h2 class="card-title svelte-hj1sc2">Timezone</h2></div> <div class="card-body svelte-hj1sc2"><p class="section-description svelte-hj1sc2">Current timezone: <span class="font-mono text-[var(--amber-400)] svelte-hj1sc2"> </span></p> <div class="timezone-selector svelte-hj1sc2"><select class="select-input svelte-hj1sc2"></select> <!></div></div></div></div> <div class="card svelte-hj1sc2"><div class="card-header svelte-hj1sc2"><h2 class="card-title svelte-hj1sc2">Storage & Data Cleanup</h2></div> <div class="card-body svelte-hj1sc2"><div class="storage-grid svelte-hj1sc2"><div class="storage-stats svelte-hj1sc2"><!></div> <div class="cleanup-section svelte-hj1sc2"><p class="section-description mb-3 svelte-hj1sc2">Remove old readings to free up storage. Readings older than the specified days will be permanently deleted.</p> <div class="cleanup-controls svelte-hj1sc2"><div class="cleanup-input-group svelte-hj1sc2"><label for="retention-days" class="svelte-hj1sc2">Keep readings from last</label> <input id="retention-days" type="number" min="1" max="365" class="input-field-sm svelte-hj1sc2"/> <span class="svelte-hj1sc2">days</span></div> <div class="cleanup-actions svelte-hj1sc2"><button type="button" class="btn-secondary-sm svelte-hj1sc2"> </button> <!></div></div> <!></div></div></div></div> <div class="card danger-zone svelte-hj1sc2"><div class="card-header svelte-hj1sc2"><h2 class="card-title svelte-hj1sc2">Power Controls</h2></div> <div class="card-body svelte-hj1sc2"><p class="section-description danger-text svelte-hj1sc2">These actions will affect the entire system. Make sure you have saved any pending work.</p> <div class="power-buttons svelte-hj1sc2"><button type="button" class="btn-warning svelte-hj1sc2"><!></button> <button type="button" class="btn-danger svelte-hj1sc2"><!></button></div></div></div></div>'),ft=d('<div class="page-container svelte-hj1sc2"><div class="page-header svelte-hj1sc2"><h1 class="page-title svelte-hj1sc2">System</h1> <p class="page-description svelte-hj1sc2">System settings, timezone configuration, and power controls</p></div> <!></div>');function xt(Ve,$e){Ns($e,!0);let k=p(null),D=p(null),ce=p(Os([])),F=p(""),ve=p(!0),c=p(null),M=p("C"),J=p(-100),x=p(!1),L=p(5),U=p(!1),E=p(!1),H=p(null),K=p(!1),P=p(30),m=p(null);async function Ye(){try{const t=await fetch("/api/system/info");t.ok&&o(k,await t.json(),!0)}catch(t){console.error("Failed to load system info:",t)}}async function de(){try{const t=await fetch("/api/system/storage");t.ok&&o(D,await t.json(),!0)}catch(t){console.error("Failed to load storage stats:",t)}}async function qe(){try{const[t,u]=await Promise.all([fetch("/api/system/timezones"),fetch("/api/system/timezone")]);if(t.ok){const g=await t.json();o(ce,g.timezones||[],!0)}if(u.ok){const g=await u.json();o(F,g.timezone||"UTC",!0)}}catch(t){console.error("Failed to load timezones:",t)}}function pe(){o(M,A.config.temp_units,!0),o(J,A.config.min_rssi,!0),o(x,A.config.smoothing_enabled,!0),o(L,A.config.smoothing_samples,!0),o(U,A.config.id_by_mac,!0)}async function Ge(){o(E,!0),o(H,null),o(K,!1);try{const t=await qs({temp_units:s(M),min_rssi:s(J),smoothing_enabled:s(x),smoothing_samples:s(L),id_by_mac:s(U)});t.success?(o(K,!0),setTimeout(()=>o(K,!1),3e3)):o(H,t.error||"Failed to save settings",!0)}finally{o(E,!1)}}async function Qe(t){o(c,"timezone");try{(await fetch("/api/system/timezone",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({timezone:t})})).ok&&o(F,t,!0)}catch(u){console.error("Failed to set timezone:",u)}finally{o(c,null)}}async function We(){o(c,"cleanup-preview");try{const t=await fetch("/api/system/cleanup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({retention_days:s(P),confirm:!1})});t.ok&&o(m,await t.json(),!0)}catch(t){console.error("Failed to preview cleanup:",t)}finally{o(c,null)}}async function Xe(){if(!(!s(m)||s(m).readings_to_delete===0)&&confirm(`Delete ${s(m).readings_to_delete.toLocaleString()} readings older than ${s(P)} days?`)){o(c,"cleanup");try{(await fetch("/api/system/cleanup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({retention_days:s(P),confirm:!0})})).ok&&(o(m,null),await de())}catch(t){console.error("Failed to execute cleanup:",t)}finally{o(c,null)}}}async function Ze(){if(confirm("Are you sure you want to reboot the system? The UI will be unavailable until restart completes.")){o(c,"reboot");try{await fetch("/api/system/reboot",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({confirm:!0})})}catch(t){console.error("Reboot command failed:",t)}finally{o(c,null)}}}async function es(){if(confirm("Are you sure you want to shut down the system? You will need physical access to restart.")){o(c,"shutdown");try{await fetch("/api/system/shutdown",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({confirm:!0})})}catch(t){console.error("Shutdown command failed:",t)}finally{o(c,null)}}}function ss(t){if(!t)return"Unknown";const u=Math.floor(t/86400),g=Math.floor(t%86400/3600),I=Math.floor(t%3600/60),C=[];return u>0&&C.push(`${u}d`),g>0&&C.push(`${g}h`),I>0&&C.push(`${I}m`),C.length>0?C.join(" "):"< 1m"}function ts(t){return!Number.isFinite(t)||t<0?"0 B":t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`}function ue(t){return t.toLocaleString()}Ds(async()=>{await Promise.all([Ye(),de(),qe()]),pe(),o(ve,!1)}),Js(()=>{A.loaded&&pe()});var q=ft();Ys("hj1sc2",t=>{Es(()=>{Hs.title="System | Tilt UI"})});var as=l(n(q),2);{var ns=t=>{var u=Xs();v(t,u)},is=t=>{var u=_t(),g=n(u),I=l(n(g),2),C=n(I);{var ls=e=>{var i=Zs(),r=n(i),h=l(n(r),2),j=n(h,!0);a(h),a(r);var b=l(r,2),w=l(n(b),2),R=n(w);a(w),a(b);var T=l(b,2),$=l(n(T),2),Ps=n($,!0);a($),a(T);var De=l(T,2),Je=l(n(De),2),Rs=n(Je,!0);a(Je),a(De),a(i),z(As=>{_(j,s(k).hostname),_(R,`v${s(k).version??""}`),_(Ps,As),_(Rs,s(k).ip_addresses.length>0?s(k).ip_addresses[0]:"Unknown")},[()=>ss(s(k).uptime_seconds)]),v(e,i)},os=e=>{var i=et();v(e,i)};f(C,e=>{s(k)?e(ls):e(os,!1)})}a(I),a(g);var G=l(g,2),Q=n(G),he=l(n(Q),2),W=n(he),_e=l(n(W),2),X=n(_e);let fe;X.__click=()=>o(M,"C");var me=l(X,2);let ge;me.__click=()=>o(M,"F"),a(_e),a(W);var Z=l(W,2),je=l(n(Z),2),be=n(je);Le(be),S(2),a(je),a(Z);var ee=l(Z,2),se=l(n(ee),2);let ye;se.__click=()=>o(x,!s(x)),a(ee);var we=l(ee,2);{var rs=e=>{var i=st(),r=l(n(i),2),h=n(r);h.value=h.__value=3;var j=l(h);j.value=j.__value=5;var b=l(j);b.value=b.__value=10;var w=l(b);w.value=w.__value=15;var R=l(w);R.value=R.__value=20,a(r),a(i),Ws(r,()=>s(L),T=>o(L,T)),v(e,i)};f(we,e=>{s(x)&&e(rs)})}var te=l(we,2),ae=l(n(te),2);let Se;ae.__click=()=>o(U,!s(U)),a(te);var ke=l(te,2),B=n(ke);B.__click=Ge;var cs=n(B);{var vs=e=>{var i=tt();S(),v(e,i)},ds=e=>{var i=Bs("Save Settings");v(e,i)};f(cs,e=>{s(E)?e(vs):e(ds,!1)})}a(B);var xe=l(B,2);{var ps=e=>{var i=at(),r=n(i,!0);a(i),z(()=>_(r,s(H))),v(e,i)};f(xe,e=>{s(H)&&e(ps)})}var us=l(xe,2);{var hs=e=>{var i=nt();v(e,i)};f(us,e=>{s(K)&&e(hs)})}a(ke),a(he),a(Q);var Ce=l(Q,2),Te=l(n(Ce),2),ne=n(Te),ze=l(n(ne)),_s=n(ze,!0);a(ze),a(ne);var Fe=l(ne,2),y=n(Fe);y.__change=e=>Qe(e.currentTarget.value),Vs(y,21,()=>s(ce),$s,(e,i)=>{var r=it(),h=n(r,!0);a(r);var j={};z(()=>{_(h,s(i)),j!==(j=s(i))&&(r.value=(r.__value=s(i))??"")}),v(e,r)}),a(y);var Me;Gs(y);var fs=l(y,2);{var ms=e=>{var i=lt();v(e,i)};f(fs,e=>{s(c)==="timezone"&&e(ms)})}a(Fe),a(Te),a(Ce),a(G);var ie=l(G,2),Ue=l(n(ie),2),Pe=n(Ue),le=n(Pe),gs=n(le);{var js=e=>{var i=ot(),r=Ks(i),h=n(r),j=n(h,!0);a(h),S(2),a(r);var b=l(r,2),w=n(b),R=n(w,!0);a(w),S(2),a(b),z((T,$)=>{_(j,T),_(R,$)},[()=>ue(s(D).total_readings),()=>ts(s(D).estimated_size_bytes)]),v(e,i)},bs=e=>{var i=rt();v(e,i)};f(gs,e=>{s(D)?e(js):e(bs,!1)})}a(le);var Re=l(le,2),oe=l(n(Re),2),re=n(oe),Ae=l(n(re),2);Le(Ae),S(2),a(re);var Ie=l(re,2),N=n(Ie);N.__click=We;var ys=n(N,!0);a(N);var ws=l(N,2);{var Ss=e=>{var i=ct();i.__click=Xe;var r=n(i,!0);a(i),z(h=>{i.disabled=s(c)!==null,_(r,h)},[()=>s(c)==="cleanup"?"Deleting...":`Delete ${ue(s(m).readings_to_delete)} readings`]),v(e,i)};f(ws,e=>{s(m)&&s(m).readings_to_delete>0&&e(Ss)})}a(Ie),a(oe);var ks=l(oe,2);{var xs=e=>{var i=vt(),r=n(i);a(i),z(()=>_(r,`No readings older than ${s(P)??""} days found.`)),v(e,i)};f(ks,e=>{s(m)&&s(m).readings_to_delete===0&&e(xs)})}a(Re),a(Pe),a(Ue),a(ie);var Be=l(ie,2),Ne=l(n(Be),2),Oe=l(n(Ne),2),O=n(Oe);O.__click=Ze;var Cs=n(O);{var Ts=e=>{var i=dt();S(),v(e,i)},zs=e=>{var i=pt();S(),v(e,i)};f(Cs,e=>{s(c)==="reboot"?e(Ts):e(zs,!1)})}a(O);var V=l(O,2);V.__click=es;var Fs=n(V);{var Ms=e=>{var i=ut();S(),v(e,i)},Us=e=>{var i=ht();S(),v(e,i)};f(Fs,e=>{s(c)==="shutdown"?e(Ms):e(Us,!1)})}a(V),a(Oe),a(Ne),a(Be),a(u),z(()=>{fe=Y(X,1,"unit-btn svelte-hj1sc2",null,fe,{active:s(M)==="C"}),ge=Y(me,1,"unit-btn svelte-hj1sc2",null,ge,{active:s(M)==="F"}),ye=Y(se,1,"toggle svelte-hj1sc2",null,ye,{active:s(x)}),Ee(se,"aria-pressed",s(x)),Se=Y(ae,1,"toggle svelte-hj1sc2",null,Se,{active:s(U)}),Ee(ae,"aria-pressed",s(U)),B.disabled=s(E),_(_s,s(F)),y.disabled=s(c)==="timezone",Me!==(Me=s(F))&&(y.value=(y.__value=s(F))??"",Qs(y,s(F))),N.disabled=s(c)!==null,_(ys,s(c)==="cleanup-preview"?"Checking...":"Preview"),O.disabled=s(c)!==null,V.disabled=s(c)!==null}),He(be,()=>s(J),e=>o(J,e)),He(Ae,()=>s(P),e=>o(P,e)),v(t,u)};f(as,t=>{s(ve)?t(ns):t(is,!1)})}a(q),v(Ve,q),Ls()}Is(["click","change"]);export{xt as component};
