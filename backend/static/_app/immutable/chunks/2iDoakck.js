import{d as ze,f as n,a as i,c as Se,s as p,e as ia,t as Ae}from"./DFbRLFGc.js";import{ah as Je,ao as d,p as g,ap as Ke,aj as Ve,ak as s,al as l,s as o,c as e,ai as Fe,an as r,ar as te,as as h,aq as Re,at as he,aw as oa}from"./-s7GvDYA.js";import{e as De,i as Me}from"./DSjxYGfQ.js";import{i as m}from"./DiA6E_7b.js";import{r as ve}from"./CXlnwKpw.js";import{b as ae}from"./BXlrlxF0.js";import{b as Oe}from"./D9NHjgjI.js";import{b as We,d as na}from"./DLyiWXp0.js";import{c as va}from"./BH1aWYKn.js";import{f as ca}from"./BssyGhMx.js";var da=n('<button type="button" class="clear-btn svelte-1m8neh9">Clear Selection</button>'),ua=n('<div class="loading svelte-1m8neh9"><div class="spinner svelte-1m8neh9"></div> <p>Loading recipes...</p></div>'),fa=n('<div class="error-box svelte-1m8neh9"><p class="error-text svelte-1m8neh9"> </p></div>'),ma=n('<div class="empty svelte-1m8neh9"><p class="empty-text svelte-1m8neh9">No recipes yet.</p> <a href="/recipes/import" class="import-link svelte-1m8neh9">Import your first recipe</a></div>'),_a=n('<p class="recipe-gravity svelte-1m8neh9"> </p>'),pa=n('<p class="recipe-yeast svelte-1m8neh9"> </p>'),ha=n('<div class="selected-recipe svelte-1m8neh9"><div class="recipe-info svelte-1m8neh9"><p class="recipe-name svelte-1m8neh9"> </p> <!> <!></div></div>'),ba=n('<span class="recipe-item-og svelte-1m8neh9"> </span>'),ga=n('<button type="button" class="recipe-item svelte-1m8neh9"><span class="recipe-item-name svelte-1m8neh9"> </span> <!></button>'),ya=n('<input id="recipe-search" type="text" placeholder="Search recipes..." class="search-input svelte-1m8neh9"/> <div class="recipe-list svelte-1m8neh9"></div>',1),xa=n('<div class="recipe-selector svelte-1m8neh9"><div class="selector-header svelte-1m8neh9"><label for="recipe-search" class="selector-label svelte-1m8neh9">Select Recipe (Optional)</label> <!></div> <!></div>');function wa(ke,c){Je(c,!0);let k=d(g([])),M=d(!0),re=d(null),O=d(""),ce=Fe(()=>e(k).filter(v=>!e(O)||v.name.toLowerCase().includes(e(O).toLowerCase())||v.author?.toLowerCase().includes(e(O).toLowerCase()))),b=Fe(()=>c.selectedRecipeId?e(k).find(v=>v.id===c.selectedRecipeId):null);Ke(async()=>{try{o(k,await We(),!0)}catch(v){o(re,v instanceof Error?v.message:"Failed to load recipes",!0),console.error("Failed to load recipes:",v)}finally{o(M,!1)}});function de(v){c.onSelect(v)}function be(){c.onSelect(null)}var Q=xa(),z=l(Q),ue=s(l(z),2);{var J=v=>{var E=da();E.__click=be,i(v,E)};m(ue,v=>{e(b)&&v(J)})}r(z);var fe=s(z,2);{var ge=v=>{var E=ua();i(v,E)},Ce=v=>{var E=Se(),K=te(E);{var me=L=>{var V=fa(),w=l(V),ye=l(w,!0);r(w),r(V),h(()=>p(ye,e(re))),i(L,V)},y=L=>{var V=Se(),w=te(V);{var ye=Y=>{var se=ma();i(Y,se)},Ee=Y=>{var se=Se(),He=te(se);{var _e=T=>{var W=ha(),P=l(W),X=l(P),B=l(X,!0);r(X);var G=s(X,2);{var N=H=>{var S=_a(),A=l(S);r(S),h((U,le)=>p(A,`${U??""} → ${le??""}`),[()=>e(b).og_target.toFixed(3),()=>e(b).fg_target.toFixed(3)]),i(H,S)};m(G,H=>{e(b).og_target&&e(b).fg_target&&H(N)})}var Z=s(G,2);{var pe=H=>{var S=pa(),A=l(S,!0);r(S),h(()=>p(A,e(b).yeast_name)),i(H,S)};m(Z,H=>{e(b).yeast_name&&H(pe)})}r(P),r(W),h(()=>p(B,e(b).name)),i(T,W)},xe=T=>{var W=ya(),P=te(W);ve(P);var X=s(P,2);De(X,21,()=>e(ce),B=>B.id,(B,G)=>{var N=ga();N.__click=()=>de(e(G));var Z=l(N),pe=l(Z,!0);r(Z);var H=s(Z,2);{var S=A=>{var U=ba(),le=l(U,!0);r(U),h(we=>p(le,we),[()=>e(G).og_target.toFixed(3)]),i(A,U)};m(H,A=>{e(G).og_target&&A(S)})}r(N),h(()=>p(pe,e(G).name)),i(B,N)}),r(X),ae(P,()=>e(O),B=>o(O,B)),i(T,W)};m(He,T=>{e(b)?T(_e):T(xe,!1)})}i(Y,se)};m(w,Y=>{e(k).length===0?Y(ye):Y(Ee,!1)},!0)}i(L,V)};m(K,L=>{e(re)?L(me):L(y,!1)},!0)}i(v,E)};m(fe,v=>{e(M)?v(ge):v(Ce,!1)})}r(Q),i(ke,Q),Ve()}ze(["click"]);var Sa=n('<div class="error-banner svelte-8ou9a2"><span class="error-icon svelte-8ou9a2">!</span> </div>'),Fa=n('<p class="reference-text svelte-8ou9a2"> <!></p>'),Ca=n('<div class="recipe-reference svelte-8ou9a2"><p class="reference-label svelte-8ou9a2">From Recipe:</p> <!></div>'),Ra=n("<option> </option>"),Da=n('<span class="form-hint svelte-8ou9a2">Loading devices...</span>'),ka=n('<div class="warning-message svelte-8ou9a2"><p class="svelte-8ou9a2">No paired devices available. Please <a href="/devices" class="svelte-8ou9a2">pair a device</a> before creating a batch.</p></div>'),Ea=n("<option> <!></option>"),Ha=n('<select id="device" class="form-select svelte-8ou9a2"><option>No device assigned</option><!></select> <span class="form-hint svelte-8ou9a2">Link a Tilt to track live gravity and temperature</span>',1),Ia=n('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="fg">Measured FG</label> <input type="number" id="fg" class="form-input svelte-8ou9a2" placeholder="1.010" step="0.001" min="0.990" max="1.100"/></div>'),La=n("<option> </option>"),Ta=n('<span class="form-hint svelte-8ou9a2">Loading available switches from Home Assistant...</span>'),Ba=n('<span class="form-hint svelte-8ou9a2">No switches found in Home Assistant</span>'),Na=n('<span class="form-hint svelte-8ou9a2">Select a switch or input_boolean entity to control the heater</span>'),Aa=n('<div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempTarget">Target Temperature (°F)</label> <input type="number" id="tempTarget" class="form-input svelte-8ou9a2" placeholder="68" step="0.5" min="32" max="100"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempHysteresis">Hysteresis (°F)</label> <input type="number" id="tempHysteresis" class="form-input svelte-8ou9a2" placeholder="1.0" step="0.5" min="0.5" max="10"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div></div>'),Ma=n('<div class="form-section svelte-8ou9a2"><h3 class="section-title svelte-8ou9a2">Temperature Control</h3> <span class="section-hint svelte-8ou9a2">Link a heater switch from Home Assistant to control fermentation temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="heaterEntity">Heater Switch</label> <select id="heaterEntity" class="form-select svelte-8ou9a2"><option>No heater assigned</option><!></select> <!></div> <!>',1),Oa=n('<span class="spinner svelte-8ou9a2"></span> Saving...',1),Ya=n('<form class="batch-form svelte-8ou9a2"><div class="form-header svelte-8ou9a2"><h2 class="form-title svelte-8ou9a2"> </h2> <p class="form-description svelte-8ou9a2"> </p></div> <!> <div class="form-body svelte-8ou9a2"><!> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="name">Batch Name</label> <input type="text" id="name" class="form-input svelte-8ou9a2" placeholder="e.g., Summer IPA #3" maxlength="200"/> <span class="form-hint svelte-8ou9a2">Optional - defaults to recipe name</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="status">Status</label> <select id="status" class="form-select svelte-8ou9a2"></select></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="device">Tracking Device</label> <!></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="brewDate">Brew Date</label> <input type="date" id="brewDate" class="form-input date-input svelte-8ou9a2"/> <span class="form-hint svelte-8ou9a2">DD/MM/YYYY</span></div> <div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="og">Measured OG</label> <input type="number" id="og" class="form-input svelte-8ou9a2" placeholder="1.050" step="0.001" min="0.990" max="1.200"/></div> <!></div> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="notes">Notes</label> <textarea id="notes" class="form-textarea svelte-8ou9a2" placeholder="Brewing notes, observations, etc." rows="3"></textarea></div></div> <div class="form-footer svelte-8ou9a2"><button type="button" class="btn-cancel svelte-8ou9a2">Cancel</button> <button type="submit" class="btn-submit svelte-8ou9a2"><!></button></div></form>');function Wa(ke,c){Je(c,!0);let k=d(g(c.batch?.name||"")),M=d(g(c.batch?.recipe_id||null)),re=d(g(c.batch?.device_id||null)),O=d(g(c.batch?.status||"planning")),ce=d(g(c.batch?.brew_date?c.batch.brew_date.split("T")[0]:"")),b=d(g(c.batch?.measured_og?.toString()||"")),de=d(g(c.batch?.measured_fg?.toString()||"")),be=d(g(c.batch?.notes||"")),Q=d(g(c.batch?.heater_entity_id||"")),z=d(g(c.batch?.temp_target?.toString()||"")),ue=d(g(c.batch?.temp_hysteresis?.toString()||"")),J=d(g([])),fe=d(g([])),ge=d(g([])),Ce=d(!0),v=d(!1),E=d(!1),K=d(!1),me=d(null),y=d(null),L=Fe(()=>va.config.ha_enabled);const V=[{value:"planning",label:"Planning"},{value:"fermenting",label:"Fermenting"},{value:"conditioning",label:"Conditioning"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}];let w=Fe(()=>!!c.batch);async function ye(){o(Ce,!0);try{o(J,await We(),!0)}catch(a){console.error("Failed to load recipes:",a)}finally{o(Ce,!1)}}async function Ee(){o(E,!0);try{o(ge,await ca(!0),!0)}catch(a){console.error("Failed to load devices:",a)}finally{o(E,!1)}}async function Y(){if(e(L)){o(v,!0);try{o(fe,await na(),!0)}catch(a){console.error("Failed to load heater entities:",a)}finally{o(v,!1)}}}function se(a){o(y,a,!0),a?(o(k,a.name,!0),o(M,a.id,!0),a.og_target&&o(b,a.og_target.toString(),!0)):o(M,null)}async function He(a){if(a.preventDefault(),!e(K)){o(K,!0),o(me,null);try{const t={name:e(k)||void 0,status:e(O),device_id:e(re)||void 0,brew_date:e(ce)?new Date(e(ce)).toISOString():void 0,measured_og:e(b)?parseFloat(e(b)):void 0,notes:e(be)||void 0,heater_entity_id:e(Q)||void 0,temp_target:e(z)?parseFloat(e(z)):void 0,temp_hysteresis:e(ue)?parseFloat(e(ue)):void 0};e(w)?t.recipe_id=e(M)||void 0:t.recipe_id=e(M)||void 0,e(w)&&e(de)&&(t.measured_fg=parseFloat(e(de))),await c.onSubmit(t)}catch(t){o(me,t instanceof Error?t.message:"Failed to save batch",!0)}finally{o(K,!1)}}}Re(()=>{if(!e(w)&&e(M)&&!e(k)){const a=e(J).find(t=>t.id===e(M));a&&o(k,a.name,!0)}}),Re(()=>{e(L)&&e(fe).length===0&&!e(v)&&Y()}),Re(()=>{if(c.initialRecipeId&&e(J).length>0&&!e(y)){const a=e(J).find(t=>t.id===c.initialRecipeId);a&&se(a)}}),Re(()=>{if(e(w)&&c.batch?.recipe&&e(J).length>0&&!e(y)){const a=e(J).find(t=>t.id===c.batch.recipe_id);a&&o(y,a,!0)}}),Ke(()=>{ye(),Ee(),Y()});var _e=Ya(),xe=l(_e),T=l(xe),W=l(T,!0);r(T);var P=s(T,2),X=l(P,!0);r(P),r(xe);var B=s(xe,2);{var G=a=>{var t=Sa(),_=s(l(t));r(t),h(()=>p(_,` ${e(me)??""}`)),i(a,t)};m(B,a=>{e(me)&&a(G)})}var N=s(B,2),Z=l(N);{let a=Fe(()=>e(y)?.id);wa(Z,{get selectedRecipeId(){return e(a)},onSelect:se})}var pe=s(Z,2);{var H=a=>{var t=Ca(),_=s(l(t),2);{var F=C=>{var R=Fa(),j=l(R),ie=s(j);{var oe=ne=>{var $=Ae();h((u,f)=>p($,`(${u??""}-${f??""}°C)`),[()=>e(y).yeast_temp_min.toFixed(0),()=>e(y).yeast_temp_max.toFixed(0)]),i(ne,$)};m(ie,ne=>{e(y).yeast_temp_min&&e(y).yeast_temp_max&&ne(oe)})}r(R),h(()=>p(j,`Yeast: ${e(y).yeast_name??""} `)),i(C,R)};m(_,C=>{e(y).yeast_name&&C(F)})}r(t),i(a,t)};m(pe,a=>{e(y)&&a(H)})}var S=s(pe,2),A=s(l(S),2);ve(A),he(2),r(S);var U=s(S,2),le=s(l(U),2);De(le,21,()=>V,Me,(a,t)=>{var _=Ra(),F=l(_,!0);r(_);var C={};h(()=>{p(F,e(t).label),C!==(C=e(t).value)&&(_.value=(_.__value=e(t).value)??"")}),i(a,_)}),r(le),r(U);var we=s(U,2),Xe=s(l(we),2);{var Ze=a=>{var t=Da();i(a,t)},$e=a=>{var t=Se(),_=te(t);{var F=R=>{var j=ka();i(R,j)},C=R=>{var j=Ha(),ie=te(j),oe=l(ie);oe.value=(oe.__value=null)??"";var ne=s(oe);De(ne,17,()=>e(ge),Me,($,u)=>{var f=Ea(),x=l(f),ee=s(x);{var q=I=>{var Qe=Ae();h(()=>p(Qe,`- ${e(u).beer_name??""}`)),i(I,Qe)};m(ee,I=>{e(u).beer_name&&e(u).beer_name!=="Untitled"&&I(q)})}r(f);var D={};h(()=>{p(x,`${e(u).color??""} Tilt `),D!==(D=e(u).id)&&(f.value=(f.__value=e(u).id)??"")}),i($,f)}),r(ie),he(2),Oe(ie,()=>e(re),$=>o(re,$)),i(R,j)};m(_,R=>{e(ge).length===0?R(F):R(C,!1)},!0)}i(a,t)};m(Xe,a=>{e(E)?a(Ze):a($e,!1)})}r(we);var Ie=s(we,2),Ye=s(l(Ie),2);ve(Ye),he(2),r(Ie);var Le=s(Ie,2),Te=l(Le),Pe=s(l(Te),2);ve(Pe),r(Te);var ea=s(Te,2);{var aa=a=>{var t=Ia(),_=s(l(t),2);ve(_),r(t),ae(_,()=>e(de),F=>o(de,F)),i(a,t)};m(ea,a=>{e(w)&&a(aa)})}r(Le);var Ge=s(Le,2);{var ta=a=>{var t=Ma(),_=s(te(t),2),F=s(l(_),2),C=l(F);C.value=C.__value="";var R=s(C);De(R,17,()=>e(fe),Me,(u,f)=>{var x=La(),ee=l(x);r(x);var q={};h(()=>{p(ee,`${e(f).friendly_name??""} (${e(f).state??""})`),q!==(q=e(f).entity_id)&&(x.value=(x.__value=e(f).entity_id)??"")}),i(u,x)}),r(F);var j=s(F,2);{var ie=u=>{var f=Ta();i(u,f)},oe=u=>{var f=Se(),x=te(f);{var ee=D=>{var I=Ba();i(D,I)},q=D=>{var I=Na();i(D,I)};m(x,D=>{e(fe).length===0?D(ee):D(q,!1)},!0)}i(u,f)};m(j,u=>{e(v)?u(ie):u(oe,!1)})}r(_);var ne=s(_,2);{var $=u=>{var f=Aa(),x=l(f),ee=s(l(x),2);ve(ee),he(2),r(x);var q=s(x,2),D=s(l(q),2);ve(D),he(2),r(q),r(f),ae(ee,()=>e(z),I=>o(z,I)),ae(D,()=>e(ue),I=>o(ue,I)),i(u,f)};m(ne,u=>{e(Q)&&u($)})}h(()=>F.disabled=e(v)),Oe(F,()=>e(Q),u=>o(Q,u)),i(a,t)};m(Ge,a=>{e(L)&&a(ta)})}var Ue=s(Ge,2),je=s(l(Ue),2);oa(je),r(Ue),r(N);var qe=s(N,2),Be=l(qe);Be.__click=function(...a){c.onCancel?.apply(this,a)};var Ne=s(Be,2),ra=l(Ne);{var sa=a=>{var t=Oa();he(),i(a,t)},la=a=>{var t=Ae();h(()=>p(t,e(w)?"Save Changes":"Create Batch")),i(a,t)};m(ra,a=>{e(K)?a(sa):a(la,!1)})}r(Ne),r(qe),r(_e),h(()=>{p(W,e(w)?"Edit Batch":"New Batch"),p(X,e(w)?"Update batch details and measurements":"Create a new fermentation batch"),Be.disabled=e(K),Ne.disabled=e(K)}),ia("submit",_e,He),ae(A,()=>e(k),a=>o(k,a)),Oe(le,()=>e(O),a=>o(O,a)),ae(Ye,()=>e(ce),a=>o(ce,a)),ae(Pe,()=>e(b),a=>o(b,a)),ae(je,()=>e(be),a=>o(be,a)),i(ke,_e),Ve()}ze(["click"]);export{Wa as B};
