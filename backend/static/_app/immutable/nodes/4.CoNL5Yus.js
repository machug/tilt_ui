import{d as Ie,f as o,s as v,a as n,c as me}from"../chunks/BQ88CgEU.js";import{al as a,ak as s,an as t,as as p,ah as be,ar as K,c as e,ai as O,at as pe,aj as je,ap as It,aL as Vt,aF as Wt,am as Jt,ao as ue,s as M}from"../chunks/CGXqq0_G.js";import{e as mt,i as pt}from"../chunks/payu-7ZH.js";import{i as m}from"../chunks/ziKwUJ4R.js";import{h as Yt}from"../chunks/BP8qDDK3.js";import{s as ht}from"../chunks/D2zVhfuI.js";import{s as ge}from"../chunks/DqcjHxzZ.js";import{s as Ce}from"../chunks/BSw_pJTS.js";import{i as qt,s as Kt}from"../chunks/C5J5lxM1.js";import{s as Qt,a as Xt}from"../chunks/C-ohbqfQ.js";import{p as Zt}from"../chunks/BCIJNM5D.js";import{g as $t}from"../chunks/BnEXi9Po.js";import{n as ea,g as gt,t as Ne,u as _t,h as ta,v as aa}from"../chunks/JVot2skt.js";import{b as sa,g as bt,d as Ve,e as jt,c as ft}from"../chunks/Do2ytZ8P.js";import{t as ra}from"../chunks/DThvY6M2.js";import{B as ia}from"../chunks/IxfwkYxb.js";import{s as va}from"../chunks/CUQuFe4_.js";import{p as He}from"../chunks/B3wItnqC.js";const la=!1,ps=Object.freeze(Object.defineProperty({__proto__:null,prerender:la},Symbol.toStringTag,{value:"Module"}));function na(L){return L>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:L>=-60?{bars:3,color:"var(--positive)",label:"Good"}:L>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function yt(L){const r=Math.floor((Date.now()-new Date(L).getTime())/1e3);if(r<10)return"just now";if(r<60)return`${r}s ago`;const _=Math.floor(r/60);if(_<60)return`${_}m ago`;const x=Math.floor(_/60);return x<24?`${x}h ago`:`${Math.floor(x/24)}d ago`}var da=o('<div class="accent-bar svelte-1oyrwd9"></div>'),oa=o('<span class="card-icon svelte-1oyrwd9"> </span>'),ca=o('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),ua=o('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function ye(L,r){let _=He(r,"highlight",3,!1),x=He(r,"collapsible",3,!1),f=He(r,"expanded",3,!1);var h=ua();let c;var i=a(h);{var F=y=>{var S=da();n(y,S)};m(i,y=>{_()&&y(F)})}var d=s(i,2),B=a(d),T=a(B);{var G=y=>{var S=oa(),U=a(S,!0);t(S),p(()=>v(U,r.icon)),n(y,S)};m(T,y=>{r.icon&&y(G)})}var u=s(T,2),C=a(u,!0);t(u),t(B);var b=s(B,2);{var z=y=>{var S=ca();S.__click=function(...D){r.onToggle?.apply(this,D)};var U=a(S);let P;t(S),p(()=>{ht(S,"aria-label",f()?"Collapse":"Expand"),P=ge(U,0,"expand-icon svelte-1oyrwd9",null,P,{"rotate-180":f()})}),n(y,S)};m(b,y=>{x()&&r.onToggle&&y(z)})}t(d);var j=s(d,2);let g;var w=a(j);va(w,()=>r.children),t(j),t(h),p(()=>{c=ge(h,1,"batch-card svelte-1oyrwd9",null,c,{highlight:_()}),v(C,r.title),g=ge(j,1,"card-content svelte-1oyrwd9",null,g,{collapsed:x()&&!f()})}),n(L,h)}Ie(["click"]);var ga=o('<span class="unit svelte-lzskfi"> </span>'),_a=o('<div class="raw-values svelte-lzskfi"><span class="raw-label svelte-lzskfi">Raw:</span> <span class="raw-value svelte-lzskfi"> </span> <span class="raw-separator svelte-lzskfi">Â·</span> <span class="raw-value svelte-lzskfi"> </span></div>'),fa=o('<div class="last-seen svelte-lzskfi"> </div>'),ma=o('<div class="live-badge svelte-lzskfi"><span class="live-dot svelte-lzskfi"></span> <span class="live-text svelte-lzskfi">LIVE</span></div> <div class="readings-grid svelte-lzskfi"><div class="reading svelte-lzskfi"><div class="reading-value svelte-lzskfi"> <!></div> <div class="reading-label svelte-lzskfi"> </div></div> <div class="reading svelte-lzskfi"><div class="reading-value temp svelte-lzskfi"> <span class="unit svelte-lzskfi"> </span></div> <div class="reading-label svelte-lzskfi">Temperature</div></div></div> <!> <!>',1);function pa(L,r){be(r,!0);let _=O(()=>r.liveReading?.sg??r.currentSg),x=O(()=>r.liveReading?.temp??r.currentTemp),f=O(()=>r.liveReading?.sg_raw),h=O(()=>r.liveReading?.temp_raw),c=O(()=>r.liveReading?.last_seen),i=O(()=>r.liveReading&&(r.liveReading.sg!==r.liveReading.sg_raw||r.liveReading.temp!==r.liveReading.temp_raw)),F=O(sa),d=O(bt);function B(u){return u==null?"--":Ve(u)}function T(u){return u==null?"--":jt(u)}let G=O(()=>e(c)?yt(e(c)):null);ye(L,{title:"Live Readings",highlight:!0,children:(u,C)=>{var b=ma(),z=s(K(b),2),j=a(z),g=a(j),w=a(g),y=s(w);{var S=E=>{var l=ga(),R=a(l,!0);t(l),p(()=>v(R,e(F))),n(E,l)};m(y,E=>{e(F)!=="SG"&&E(S)})}t(g);var U=s(g,2),P=a(U,!0);t(U),t(j);var D=s(j,2),V=a(D),I=a(V),Y=s(I),Z=a(Y,!0);t(Y),t(V),pe(2),t(D),t(z);var $=s(z,2);{var W=E=>{var l=_a(),R=s(a(l),2),ae=a(R,!0);t(R);var Q=s(R,4),q=a(Q);t(Q),t(l),p((A,H)=>{v(ae,A),v(q,`${H??""}${e(d)??""}`)},[()=>B(e(f)),()=>T(e(h))]),n(E,l)};m($,E=>{e(i)&&E(W)})}var te=s($,2);{var de=E=>{var l=fa(),R=a(l);t(l),p(()=>v(R,`Updated ${e(G)??""}`)),n(E,l)};m(te,E=>{e(G)&&E(de)})}p((E,l)=>{v(w,`${E??""} `),v(P,e(F)==="SG"?"Gravity":e(F)==="Â°P"?"Plato":"Brix"),v(I,`${l??""} `),v(Z,e(d))},[()=>B(e(_)),()=>T(e(x))]),n(u,b)},$$slots:{default:!0}}),je()}var ha=o('<div class="gravity-point target svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Target FG</div> <div class="point-value svelte-t80j9z"> </div></div>'),ba=o('<div class="progress-remaining svelte-t80j9z"> </div>'),ja=o('<div class="progress-section svelte-t80j9z"><div class="progress-header svelte-t80j9z"><span class="progress-label svelte-t80j9z">Fermentation Progress</span> <span class="progress-percent svelte-t80j9z"> </span></div> <div class="progress-bar-container svelte-t80j9z"><div class="progress-bar-bg svelte-t80j9z"></div> <div class="progress-bar-fill svelte-t80j9z"></div> <div class="progress-bar-shine svelte-t80j9z"></div></div> <!></div>'),ya=o('<div class="current-sg svelte-t80j9z"><div class="sg-label svelte-t80j9z">Current Specific Gravity</div> <div class="sg-value svelte-t80j9z"> <span class="fermenting-badge svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> Fermenting</span></div></div> <div class="gravity-timeline svelte-t80j9z"><div class="timeline-line svelte-t80j9z"></div> <div class="gravity-point start svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Original Gravity</div> <div class="point-value svelte-t80j9z"> </div></div> <!> <div class="gravity-point current svelte-t80j9z"><div class="point-marker pulsing svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Current FG</div> <div class="point-value svelte-t80j9z"> </div></div></div> <div class="metrics-grid svelte-t80j9z"><div class="metric abv-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">%</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Alcohol by Volume</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div> <div class="metric attenuation-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">â†“</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Apparent Attenuation</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div></div> <!>',1),ka=o('<div class="measurements-grid svelte-t80j9z"><div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Original Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Final Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">ABV</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Attenuation</div> <div class="measurement-value svelte-t80j9z"> </div></div></div>'),xa=o('<div class="no-data svelte-t80j9z"><div class="no-data-icon svelte-t80j9z">â—‹</div> <p class="no-data-text svelte-t80j9z">Set Original Gravity to begin tracking fermentation metrics</p></div>');function za(L,r){be(r,!0);let _=O(()=>{if(!r.batch.measured_og)return null;const c=r.currentSg??r.progress?.measured?.current_sg;if(!c)return null;const i=(r.batch.measured_og-c)*131.25,F=r.batch.measured_og-1,d=F!==0?(r.batch.measured_og-c)/F*100:0;return{currentSg:c,abv:Math.max(0,i),attenuation:Math.max(0,Math.min(100,d)),isFermenting:r.batch.status==="fermenting"||r.batch.status==="conditioning"}}),x=O(()=>e(_)?.isFermenting??!1);function f(c){return c==null?"--":Ve(c)}function h(c){return c==null?"--":`${c.toFixed(1)}%`}{let c=O(()=>e(x)?"Fermentation Progress":"Fermentation Measurements");ye(L,{get title(){return e(c)},children:(i,F)=>{var d=me(),B=K(d);{var T=u=>{var C=ya(),b=K(C),z=s(a(b),2),j=a(z);pe(),t(z),t(b);var g=s(b,2),w=s(a(g),2),y=s(a(w),4),S=a(y,!0);t(y),t(w);var U=s(w,2);{var P=q=>{var A=ha(),H=s(a(A),4),X=a(H,!0);t(H),t(A),p(re=>v(X,re),[()=>f(r.batch.recipe.fg_target)]),n(q,A)};m(U,q=>{r.batch.recipe?.fg_target&&q(P)})}var D=s(U,2),V=s(a(D),4),I=a(V,!0);t(V),t(D),t(g);var Y=s(g,2),Z=a(Y),$=s(a(Z),2),W=s(a($),2),te=a(W);pe(),t(W),t($),t(Z);var de=s(Z,2),E=s(a(de),2),l=s(a(E),2),R=a(l);pe(),t(l),t(E),t(de),t(Y);var ae=s(Y,2);{var Q=q=>{var A=ja(),H=a(A),X=s(a(H),2),re=a(X);t(X),t(H);var _e=s(H,2),oe=s(a(_e),2);pe(2),t(_e);var he=s(_e,2);{var Fe=fe=>{var ke=ba(),ce=a(ke);t(ke),p(we=>v(ce,`${we??""} gravity points remaining`),[()=>r.progress.progress.sg_remaining.toFixed(3)]),n(fe,ke)};m(he,fe=>{r.progress.progress.sg_remaining!=null&&fe(Fe)})}t(A),p(fe=>{v(re,`${fe??""}%`),Ce(oe,`width: ${r.progress.progress.percent_complete??""}%`)},[()=>r.progress.progress.percent_complete.toFixed(0)]),n(q,A)};m(ae,q=>{r.progress?.progress?.percent_complete!=null&&q(Q)})}p((q,A,H,X,re)=>{v(j,`${q??""} `),v(S,A),v(I,H),v(te,`${X??""} `),v(R,`${re??""} `)},[()=>f(e(_).currentSg),()=>f(r.batch.measured_og),()=>f(e(_).currentSg),()=>h(e(_).abv),()=>h(e(_).attenuation)]),n(u,C)},G=u=>{var C=me(),b=K(C);{var z=g=>{var w=ka(),y=a(w),S=s(a(y),2),U=a(S,!0);t(S),t(y);var P=s(y,2),D=s(a(P),2),V=a(D,!0);t(D),t(P);var I=s(P,2),Y=s(a(I),2),Z=a(Y,!0);t(Y),t(I);var $=s(I,2),W=s(a($),2),te=a(W,!0);t(W),t($),t(w),p((de,E,l,R)=>{v(U,de),v(V,E),v(Z,l),v(te,R)},[()=>f(r.batch.measured_og),()=>f(r.batch.measured_fg),()=>r.batch.measured_abv!=null?h(r.batch.measured_abv):"--",()=>r.batch.measured_attenuation!=null?h(r.batch.measured_attenuation):"--"]),n(g,w)},j=g=>{var w=xa();n(g,w)};m(b,g=>{r.batch.measured_og?g(z):g(j,!1)},!0)}n(u,C)};m(B,u=>{e(_)&&e(x)?u(T):u(G,!1)})}n(i,d)},$$slots:{default:!0}})}je()}var wa=o('<div class="timeline svelte-yskb8i"><div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Brew Date</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Started</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Ended</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Created</span> <span class="timeline-value svelte-yskb8i"> </span></div></div>');function Sa(L,r){be(r,!0);function _(f){return f?new Date(f).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}):"--"}function x(f){return f?new Date(f).toLocaleString("en-GB",{day:"numeric",month:"short",hour:"numeric",minute:"2-digit"}):"--"}ye(L,{title:"Timeline",children:(f,h)=>{var c=wa(),i=a(c),F=s(a(i),2),d=a(F,!0);t(F),t(i);var B=s(i,2),T=s(a(B),2),G=a(T,!0);t(T),t(B);var u=s(B,2),C=s(a(u),2),b=a(C,!0);t(C),t(u);var z=s(u,2),j=s(a(z),2),g=a(j,!0);t(j),t(z),t(c),p((w,y,S,U)=>{v(d,w),v(G,y),v(b,S),v(g,U)},[()=>_(r.batch.brew_date),()=>x(r.batch.start_time),()=>x(r.batch.end_time),()=>x(r.batch.created_at)]),n(f,c)},$$slots:{default:!0}}),je()}var Ba=o('<div class="signal-bar svelte-1kdxwtz"></div>'),Ca=o('<div class="signal-details svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="signal-text svelte-1kdxwtz"> </span></div>'),Fa=o('<div class="device-last-seen svelte-1kdxwtz"> </div>'),Ta=o('<div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!> <!>',1),Ra=o('<div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <div class="device-last-seen svelte-1kdxwtz">Not receiving data</div>',1),Ga=o('<div class="device-info svelte-1kdxwtz"><!></div>'),Ma=o('<button type="button" class="link-btn svelte-1kdxwtz">Link a device</button>'),Oa=o('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function La(L,r){be(r,!0);let _=O(()=>r.liveReading?.rssi?na(r.liveReading.rssi):null),x=O(()=>r.liveReading?.last_seen?yt(r.liveReading.last_seen):null);ye(L,{title:"Tracking Device",children:(f,h)=>{var c=me(),i=K(c);{var F=B=>{var T=Ga(),G=a(T);{var u=b=>{var z=Ta(),j=K(z),g=s(a(j));t(j);var w=s(j,2);{var y=P=>{var D=Ca(),V=a(D);mt(V,20,()=>Array(4),pt,(Z,$,W)=>{var te=Ba();p(()=>Ce(te,`
										height: ${6+W*3}px;
										background: ${(W<e(_).bars?e(_).color:"var(--bg-hover)")??""};
										opacity: ${W<e(_).bars?1:.4};
									`)),n(Z,te)}),t(V);var I=s(V,2),Y=a(I);t(I),t(D),p(()=>{Ce(I,`color: ${e(_).color??""}`),v(Y,`${e(_).label??""} (${r.liveReading.rssi??""} dBm)`)}),n(P,D)};m(w,P=>{e(_)&&P(y)})}var S=s(w,2);{var U=P=>{var D=Fa(),V=a(D);t(D),p(()=>v(V,`Updated ${e(x)??""}`)),n(P,D)};m(S,P=>{e(x)&&P(U)})}p(()=>v(g,` ${r.liveReading.color??""} Tilt - Connected`)),n(b,z)},C=b=>{var z=Ra(),j=K(z),g=s(a(j));t(j),pe(2),p(()=>v(g,` Device: ${r.batch.device_id??""}`)),n(b,z)};m(G,b=>{r.liveReading?b(u):b(C,!1)})}t(T),n(B,T)},d=B=>{var T=Oa(),G=s(a(T),2);{var u=C=>{var b=Ma();b.__click=function(...z){r.onEdit?.apply(this,z)},n(C,b)};m(G,C=>{r.onEdit&&C(u)})}t(T),n(B,T)};m(i,B=>{r.batch.device_id?B(F):B(d,!1)})}n(f,c)},$$slots:{default:!0}}),je()}Ie(["click"]);var Pa=o('<div class="target wide svelte-19u9n31"><span class="target-label svelte-19u9n31">Yeast</span> <span class="target-value svelte-19u9n31"> </span></div>'),Da=o('<div class="targets-grid svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div> <!></div>');function Ea(L,r){be(r,!0);function _(x){return x==null?"--":Ve(x)}ye(L,{title:"Recipe Targets",children:(x,f)=>{var h=Da(),c=a(h),i=s(a(c),2),F=a(i,!0);t(i),t(c);var d=s(c,2),B=s(a(d),2),T=a(B,!0);t(B),t(d);var G=s(d,2),u=s(a(G),2),C=a(u,!0);t(u),t(G);var b=s(G,2);{var z=j=>{var g=Pa(),w=s(a(g),2),y=a(w,!0);t(w),t(g),p(()=>v(y,r.recipe.yeast_name)),n(j,g)};m(b,j=>{r.recipe.yeast_name&&j(z)})}t(h),p((j,g,w)=>{v(F,j),v(T,g),v(C,w)},[()=>_(r.recipe.og_target),()=>_(r.recipe.fg_target),()=>r.recipe.abv_target!=null?`${r.recipe.abv_target.toFixed(1)}%`:"--"]),n(x,h)},$$slots:{default:!0}}),je()}var Ua=o('<p class="notes-content svelte-hkv31i"> </p>');function Aa(L,r){ye(L,{title:"Notes",children:(_,x)=>{var f=Ua(),h=a(f,!0);t(f),p(()=>v(h,r.notes)),n(_,f)},$$slots:{default:!0}})}var Na=o('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),Ha=o('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),Ia=o('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),Va=o('<span class="recipe-type svelte-g5au2j"> </span>'),Wa=o('<a class="recipe-link svelte-g5au2j"> <!></a>'),Ja=o('<option class="svelte-g5au2j"> </option>'),Ya=o('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">âš¡</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),qa=o('<div class="heater-details svelte-g5au2j"><div class="heater-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="heater-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns svelte-g5au2j"><button type="button">Force ON</button> <button type="button">Force OFF</button></div></div>',1),Ka=o('<div><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="heater-status svelte-g5au2j"><div>ðŸ”¥</div> <div class="heater-info svelte-g5au2j"><span> </span> <span class="heater-entity svelte-g5au2j"> </span></div></div> <!></div>'),Qa=o('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><span class="svelte-g5au2j"> </span> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),Xa=o('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!></div></div>',1),Za=o('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div>');function hs(L,r){be(r,!0);const _=()=>Xt(Zt,"$page",x),[x,f]=Qt();let h=null,c=null,i=ue(null),F=ue(null),d=ue(null),B=ue(!0),T=ue(null),G=ue(!1),u=ue(!1),C=ue(!1),b=O(()=>parseInt(_().params.id??"0"));const z={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},j=["planning","fermenting","conditioning","completed","archived"];let g=O(()=>e(i)?z[e(i).status]:z.planning),w=O(bt),y=O(()=>ft.config.ha_enabled&&ft.config.temp_control_enabled&&e(i)?.heater_entity_id),S=O(()=>{if(!e(i)?.device_id)return null;const l=e(i).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!l?.[1])return null;const R=l[1].toUpperCase();for(const ae of ra.tilts.values())if(ae.color.toUpperCase()===R)return ae;return null});async function U(){M(B,!0),M(T,null);try{if(M(i,await ea(e(b)),!0),e(i).status==="fermenting"||e(i).status==="conditioning")try{M(F,await gt(e(b)),!0)}catch{}if(e(i).heater_entity_id)try{M(d,await Ne(e(b)),!0)}catch{}}catch(l){M(T,l instanceof Error?l.message:"Failed to load batch",!0)}finally{M(B,!1)}}async function P(l){if(!(!e(i)||e(u))){M(u,!0);try{M(i,await _t(e(i).id,{status:l}),!0),(l==="fermenting"||l==="conditioning")&&M(F,await gt(e(i).id),!0)}catch(R){console.error("Failed to update status:",R)}finally{M(u,!1)}}}async function D(l){if(e(i)&&(M(i,await _t(e(i).id,l),!0),M(G,!1),e(i).heater_entity_id))try{M(d,await Ne(e(i).id),!0)}catch{}}async function V(){if(e(i)&&confirm(`Are you sure you want to delete "${e(i).name||"this batch"}"?`))try{await ta(e(i).id),$t("/batches")}catch{alert("Failed to delete batch")}}async function I(l){if(!(!e(i)||e(C))){M(C,!0);try{await aa(e(i).id,l),M(d,await Ne(e(i).id),!0)}catch(R){console.error("Failed to set override:",R)}finally{M(C,!1)}}}function Y(){if(h?.readyState===WebSocket.OPEN)return;const R=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;h=new WebSocket(R),h.onmessage=async ae=>{try{const Q=JSON.parse(ae.data);Q.type==="control_event"&&Q.batch_id===e(b)&&e(d)&&(Q.action==="heat_on"?M(d,{...e(d),heater_state:"on"},!0):Q.action==="heat_off"&&M(d,{...e(d),heater_state:"off"},!0))}catch{}},h.onclose=()=>{h=null,c=setTimeout(Y,3e3)},h.onerror=()=>{h?.close()}}function Z(){c&&(clearTimeout(c),c=null),h?.close(),h=null}function $(l){return l==null?"--":jt(l)}It(()=>{U(),Y()}),Vt(()=>{Z()});var W=Za();Yt("g5au2j",l=>{Wt(()=>{Jt.title=`${(e(i)?.name||"Batch")??""} | BrewSignal`})});var te=s(a(W),2);{var de=l=>{var R=Na();n(l,R)},E=l=>{var R=me(),ae=K(R);{var Q=A=>{var H=Ha(),X=s(a(H),2),re=a(X,!0);t(X);var _e=s(X,2);_e.__click=U,t(H),p(()=>v(re,e(T))),n(A,H)},q=A=>{var H=me(),X=K(H);{var re=oe=>{var he=Ia();n(oe,he)},_e=oe=>{var he=me(),Fe=K(he);{var fe=ce=>{ia(ce,{get batch(){return e(i)},onSubmit:D,onCancel:()=>M(G,!1)})},ke=ce=>{var we=Xa(),Te=K(we),Re=a(Te),Ge=a(Re),kt=a(Ge);t(Ge);var We=s(Ge,2),Me=a(We),xt=a(Me,!0);t(Me);var zt=s(Me,2);{var wt=k=>{var N=Wa(),J=a(N),ve=s(J);{var ee=se=>{var le=Va(),ne=a(le);t(le),p(()=>v(ne,`(${e(i).recipe.type??""})`)),n(se,le)};m(ve,se=>{e(i).recipe.type&&se(ee)})}t(N),p(()=>{ht(N,"href",`/recipes/${e(i).recipe.id??""}`),v(J,`${e(i).recipe.name??""} `)}),n(k,N)};m(zt,k=>{e(i).recipe&&k(wt)})}t(We),t(Re);var Je=s(Re,2),Oe=a(Je),ie=a(Oe);ie.__change=k=>P(k.currentTarget.value),mt(ie,21,()=>j,pt,(k,N)=>{var J=Ja(),ve=a(J,!0);t(J);var ee={};p(()=>{v(ve,z[e(N)].label),ee!==(ee=e(N))&&(J.value=(J.__value=e(N))??"")}),n(k,J)}),t(ie);var Ye;qt(ie),t(Oe);var qe=s(Oe,2);qe.__click=()=>M(G,!0);var St=s(qe,2);St.__click=V,t(Je),t(Te);var Ke=s(Te,2),Le=a(Ke),Qe=a(Le);{var Bt=k=>{{let N=O(()=>e(F)?.measured?.current_sg),J=O(()=>e(F)?.temperature?.current);pa(k,{get liveReading(){return e(S)},get currentSg(){return e(N)},get currentTemp(){return e(J)}})}};m(Qe,k=>{(e(S)||e(F)?.measured?.current_sg!=null)&&k(Bt)})}var Xe=s(Qe,2);{let k=O(()=>e(S)?.sg??e(F)?.measured?.current_sg);za(Xe,{get batch(){return e(i)},get currentSg(){return e(k)},get progress(){return e(F)}})}var Ct=s(Xe,2);{var Ft=k=>{Ea(k,{get recipe(){return e(i).recipe}})};m(Ct,k=>{e(i).recipe&&k(Ft)})}t(Le);var Ze=s(Le,2),$e=a(Ze);Sa($e,{get batch(){return e(i)}});var et=s($e,2);La(et,{get batch(){return e(i)},get liveReading(){return e(S)},onEdit:()=>M(G,!0)});var tt=s(et,2);{var Tt=k=>{var N=Ka();let J;var ve=s(a(N),2),ee=a(ve);let se;var le=s(ee,2),ne=a(le);let Se;var Ot=a(ne,!0);t(ne);var at=s(ne,2),Lt=a(at,!0);t(at),t(le),t(ve);var Pt=s(ve,2);{var Dt=Pe=>{var st=qa(),De=K(st),Ee=a(De),rt=s(a(Ee),2),Et=a(rt);t(rt),t(Ee);var it=s(Ee,2),vt=s(a(it),2),Ut=a(vt);t(vt),t(it),t(De);var lt=s(De,2);{var At=xe=>{var ze=Ya(),Ae=s(a(ze),2),Nt=a(Ae);t(Ae);var ut=s(Ae,2);ut.__click=()=>I(null),t(ze),p(Ht=>{v(Nt,`Override active: ${Ht??""}`),ut.disabled=e(C)},[()=>e(d).override_state?.toUpperCase()]),n(xe,ze)};m(lt,xe=>{e(d).override_active&&xe(At)})}var nt=s(lt,2),dt=s(a(nt),2),Be=a(dt);let ot;Be.__click=()=>I("on");var Ue=s(Be,2);let ct;Ue.__click=()=>I("off"),t(dt),t(nt),p((xe,ze)=>{v(Et,`${xe??""}${e(w)??""}`),v(Ut,`Â±${ze??""}${e(w)??""}`),ot=ge(Be,1,"override-btn svelte-g5au2j",null,ot,{active:e(d).override_state==="on"}),Be.disabled=e(C),ct=ge(Ue,1,"override-btn svelte-g5au2j",null,ct,{active:e(d).override_state==="off"}),Ue.disabled=e(C)},[()=>$(e(d).target_temp),()=>e(d).hysteresis?.toFixed(1)||"--"]),n(Pe,st)};m(Pt,Pe=>{e(d)&&Pe(Dt)})}t(N),p(()=>{J=ge(N,1,"info-card heater-card svelte-g5au2j",null,J,{"heater-on":e(d)?.heater_state==="on"}),se=ge(ee,1,"heater-icon-wrap svelte-g5au2j",null,se,{heating:e(d)?.heater_state==="on"}),Se=ge(ne,1,"heater-state svelte-g5au2j",null,Se,{on:e(d)?.heater_state==="on"}),v(Ot,e(d)?.heater_state==="on"?"HEATING":e(d)?.heater_state==="off"?"OFF":"Unknown"),v(Lt,e(i).heater_entity_id)}),n(k,N)},Rt=k=>{var N=me(),J=K(N);{var ve=ee=>{var se=Qa(),le=s(a(se),2),ne=a(le),Se=a(ne);t(ne),pe(2),t(le),t(se),p(()=>v(Se,`Heater: ${e(i).heater_entity_id??""}`)),n(ee,se)};m(J,ee=>{e(i).heater_entity_id&&e(i).status!=="fermenting"&&ee(ve)},!0)}n(k,N)};m(tt,k=>{e(y)&&e(i).status==="fermenting"?k(Tt):k(Rt,!1)})}var Gt=s(tt,2);{var Mt=k=>{Aa(k,{get notes(){return e(i).notes}})};m(Gt,k=>{e(i).notes&&k(Mt)})}t(Ze),t(Ke),p(()=>{v(kt,`#${(e(i).batch_number||"?")??""}`),v(xt,e(i).name||e(i).recipe?.name||"Unnamed Batch"),ie.disabled=e(u),Ce(ie,`color: ${e(g).color??""}; background: ${e(g).bg??""};`),Ye!==(Ye=e(i).status)&&(ie.value=(ie.__value=e(i).status)??"",Kt(ie,e(i).status))}),n(ce,we)};m(Fe,ce=>{e(G)?ce(fe):ce(ke,!1)},!0)}n(oe,he)};m(X,oe=>{e(i)?oe(_e,!1):oe(re)},!0)}n(A,H)};m(ae,A=>{e(T)?A(Q):A(q,!1)},!0)}n(l,R)};m(te,l=>{e(B)?l(de):l(E,!1)})}t(W),n(L,W),je(),f()}Ie(["click","change"]);export{hs as component,ps as universal};
