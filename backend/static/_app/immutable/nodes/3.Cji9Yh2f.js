import{d as se,f as n,a as v,c as ie,s as _}from"../chunks/BHvHOtuG.js";import{ab as le,ac as m,p as Na,ad as re,ae as ve,g as a,af as oe,s as o,V as ne,ag as l,ah as s,ai as de,aj as t,ak as Q,al as b,am as B,an as ce}from"../chunks/BeYMcFNd.js";import{e as ma,i as ba}from"../chunks/Cn7aBH5Z.js";import{i as w}from"../chunks/Cd5u1CHp.js";import{h as pe,g as fe,r as X,s as Pa,c as ue}from"../chunks/BVbD26w7.js";import{s as _e}from"../chunks/D4P9rzug.js";import{b as Y}from"../chunks/BperHIsi.js";import{b as me}from"../chunks/UEX34lHC.js";var be=n('<div class="loading-state svelte-36f20v"><div class="loading-spinner svelte-36f20v"></div> <span>Loading Tilts...</span></div>'),ge=n(`<div class="empty-state svelte-36f20v"><div class="empty-icon svelte-36f20v">ðŸ“Š</div> <h3 class="empty-title svelte-36f20v">No Tilts Found</h3> <p class="empty-description svelte-36f20v">Connect a Tilt hydrometer to start calibrating.
				Tilts will appear here once detected.</p></div>`),he=n("<option> </option>"),we=n('<div class="tilt-info svelte-36f20v"><span class="tilt-color-dot svelte-36f20v"></span> <span class="font-mono text-xs text-[var(--text-muted)]"> </span></div>'),ye=n('<button type="button" class="btn-danger-small svelte-36f20v">Clear All</button>'),xe=n('<div class="loading-inline svelte-36f20v"><div class="loading-spinner-small svelte-36f20v"></div> <span>Loading...</span></div>'),ke=n('<div class="table-row svelte-36f20v"><span class="font-mono"> </span> <span class="text-[var(--text-muted)]">â†’</span> <span class="font-mono text-[var(--amber-400)]"> </span></div>'),Te=n('<div class="calibration-table svelte-36f20v"><div class="table-header svelte-36f20v"><span>Raw</span> <span>â†’</span> <span>Actual</span></div> <!></div>'),Ce=n('<div class="no-points svelte-36f20v"><span>No calibration points yet</span></div>'),Fe=n('<!> <div class="add-point-form svelte-36f20v"><div class="form-row svelte-36f20v"><div class="form-group svelte-36f20v"><label for="sg-raw" class="svelte-36f20v">Raw SG</label> <input id="sg-raw" type="number" step="0.001" placeholder="1.050" class="input-field svelte-36f20v"/></div> <div class="form-arrow svelte-36f20v">â†’</div> <div class="form-group svelte-36f20v"><label for="sg-actual" class="svelte-36f20v">Actual SG</label> <input id="sg-actual" type="number" step="0.001" placeholder="1.048" class="input-field svelte-36f20v"/></div> <button type="button" class="btn-add svelte-36f20v" aria-label="Add SG calibration point"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg></button></div></div>',1),Ae=n('<button type="button" class="btn-danger-small svelte-36f20v">Clear All</button>'),Se=n('<div class="loading-inline svelte-36f20v"><div class="loading-spinner-small svelte-36f20v"></div> <span>Loading...</span></div>'),je=n('<div class="table-row svelte-36f20v"><span class="font-mono"> </span> <span class="text-[var(--text-muted)]">â†’</span> <span class="font-mono text-[var(--amber-400)]"> </span></div>'),Ge=n('<div class="calibration-table svelte-36f20v"><div class="table-header svelte-36f20v"><span> </span> <span>â†’</span> <span> </span></div> <!></div>'),Ne=n('<div class="no-points svelte-36f20v"><span>No calibration points yet</span></div>'),Pe=n('<!> <div class="add-point-form svelte-36f20v"><div class="form-row svelte-36f20v"><div class="form-group svelte-36f20v"><label for="temp-raw" class="svelte-36f20v"> </label> <input id="temp-raw" type="number" step="0.1" class="input-field svelte-36f20v"/></div> <div class="form-arrow svelte-36f20v">â†’</div> <div class="form-group svelte-36f20v"><label for="temp-actual" class="svelte-36f20v"> </label> <input id="temp-actual" type="number" step="0.1" class="input-field svelte-36f20v"/></div> <button type="button" class="btn-add svelte-36f20v" aria-label="Add temperature calibration point"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg></button></div></div>',1),Re=n(`<div class="card mb-6 svelte-36f20v"><div class="card-header svelte-36f20v"><h2 class="card-title svelte-36f20v">Select Tilt</h2></div> <div class="card-body svelte-36f20v"><div class="tilt-selector svelte-36f20v"><select class="select-input svelte-36f20v"></select> <!></div></div></div> <div class="grid gap-6 md:grid-cols-2"><div class="card svelte-36f20v"><div class="card-header flex items-center justify-between svelte-36f20v"><h2 class="card-title svelte-36f20v">Gravity (SG)</h2> <!></div> <div class="card-body svelte-36f20v"><p class="section-description svelte-36f20v">Add calibration points by measuring with a reference hydrometer.
						The system will interpolate between points.</p> <!></div></div> <div class="card svelte-36f20v"><div class="card-header flex items-center justify-between svelte-36f20v"><h2 class="card-title svelte-36f20v"> </h2> <!></div> <div class="card-body svelte-36f20v"><p class="section-description svelte-36f20v">Calibrate temperature by comparing with a reference thermometer.
						Values are stored in Â°F internally.</p> <!></div></div></div> <div class="info-section mt-6 svelte-36f20v"><h3 class="info-title svelte-36f20v">How Calibration Works</h3> <p class="info-text svelte-36f20v">Add at least two calibration points for best results. The system uses linear interpolation
				between points to correct readings. For single-point calibration, only an offset is applied.</p> <div class="info-tips svelte-36f20v"><div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">Tip:</span> <span>For SG, use distilled water (1.000) and a known sugar solution for two-point calibration.</span></div> <div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">Tip:</span> <span>For temperature, ice water (0Â°C/32Â°F) and room temp make good reference points.</span></div></div></div>`,1),Ve=n('<div class="page-container svelte-36f20v"><div class="page-header svelte-36f20v"><h1 class="page-title svelte-36f20v">Calibration</h1> <p class="page-description svelte-36f20v">Fine-tune SG and temperature readings with calibration points</p></div> <!></div>');function Ie(Ra,Va){le(Va,!0);let S=m(Na([])),u=m(null),Z=m(Na([])),ga=m(!0),D=m(!1),y=m(!1),P=m(""),R=m(""),V=m(""),$=m(""),L=B(fe),aa=B(()=>ue.config.temp_units==="C"),ea=B(()=>a(Z).filter(e=>e.type==="sg").sort((e,p)=>e.raw_value-p.raw_value)),ta=B(()=>a(Z).filter(e=>e.type==="temp").sort((e,p)=>e.raw_value-p.raw_value)),sa=B(()=>a(S).find(e=>e.id===a(u)));async function $a(){try{const e=await fetch("/api/tilts");e.ok&&(o(S,await e.json(),!0),a(S).length>0&&!a(u)&&o(u,a(S)[0].id,!0))}catch(e){console.error("Failed to load tilts:",e)}finally{o(ga,!1)}}async function ia(){if(a(u)){o(D,!0);try{const e=await fetch(`/api/tilts/${a(u)}/calibration`);e.ok&&o(Z,await e.json(),!0)}catch(e){console.error("Failed to load calibration points:",e)}finally{o(D,!1)}}}async function ha(e,p,ra){if(!a(u))return;const I=parseFloat(p),O=parseFloat(ra);if(!(isNaN(I)||isNaN(O))){o(y,!0);try{(await fetch(`/api/tilts/${a(u)}/calibration`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:e,raw_value:I,actual_value:O})})).ok&&(e==="sg"?(o(P,""),o(R,"")):(o(V,""),o($,"")),await ia())}catch(g){console.error("Failed to add calibration point:",g)}finally{o(y,!1)}}}async function wa(e){if(a(u)&&confirm(`Clear all ${e==="sg"?"gravity":"temperature"} calibration points?`)){o(y,!0);try{(await fetch(`/api/tilts/${a(u)}/calibration/${e}`,{method:"DELETE"})).ok&&await ia()}catch(p){console.error("Failed to clear calibration:",p)}finally{o(y,!1)}}}function ya(e){return e.toFixed(3)}function xa(e){return a(aa)?((e-32)*(5/9)).toFixed(1):e.toFixed(1)}re(()=>{$a()}),ve(()=>{a(u)&&ia()});var la=Ve();pe("36f20v",e=>{ne(()=>{de.title="Calibration | Tilt UI"})});var La=l(s(la),2);{var Ea=e=>{var p=be();v(e,p)},Ha=e=>{var p=ie(),ra=Q(p);{var I=g=>{var J=ge();v(g,J)},O=g=>{var J=Re(),va=Q(J),ka=l(s(va),2),Ta=s(ka),W=s(Ta);ma(W,21,()=>a(S),ba,(i,r)=>{var d=he(),x=s(d);t(d);var k={};b(()=>{_(x,`${a(r).color??""} â€” ${a(r).beer_name??""}`),k!==(k=a(r).id)&&(d.value=(d.__value=a(r).id)??"")}),v(i,d)}),t(W);var Ma=l(W,2);{var Ua=i=>{var r=we(),d=s(r),x=l(d,2),k=s(x,!0);t(x),t(r),b(T=>{_e(d,`background: var(--tilt-${T??""});`),_(k,a(sa).id)},[()=>a(sa).color.toLowerCase()]),v(i,r)};w(Ma,i=>{a(sa)&&i(Ua)})}t(Ta),t(ka),t(va);var Ca=l(va,2),oa=s(Ca),na=s(oa),Ba=l(s(na),2);{var Da=i=>{var r=ye();r.__click=()=>wa("sg"),b(()=>r.disabled=a(y)),v(i,r)};w(Ba,i=>{a(ea).length>0&&i(Da)})}t(na);var Fa=l(na,2),Ia=l(s(Fa),2);{var Oa=i=>{var r=xe();v(i,r)},Ja=i=>{var r=Fe(),d=Q(r);{var x=c=>{var F=Te(),M=l(s(F),2);ma(M,17,()=>a(ea),ba,(q,f)=>{var h=ke(),A=s(h),U=s(A,!0);t(A);var z=l(A,4),K=s(z,!0);t(z),t(h),b((pa,fa)=>{_(U,pa),_(K,fa)},[()=>ya(a(f).raw_value),()=>ya(a(f).actual_value)]),v(q,h)}),t(F),v(c,F)},k=c=>{var F=Ce();v(c,F)};w(d,c=>{a(ea).length>0?c(x):c(k,!1)})}var T=l(d,2),E=s(T),C=s(E),j=l(s(C),2);X(j),t(C);var H=l(C,4),G=l(s(H),2);X(G),t(H);var N=l(H,2);N.__click=()=>ha("sg",a(P),a(R)),t(E),t(T),b(()=>N.disabled=a(y)||!a(P)||!a(R)),Y(j,()=>a(P),c=>o(P,c)),Y(G,()=>a(R),c=>o(R,c)),v(i,r)};w(Ia,i=>{a(D)?i(Oa):i(Ja,!1)})}t(Fa),t(oa);var Aa=l(oa,2),da=s(Aa),ca=s(da),Wa=s(ca);t(ca);var qa=l(ca,2);{var za=i=>{var r=Ae();r.__click=()=>wa("temp"),b(()=>r.disabled=a(y)),v(i,r)};w(qa,i=>{a(ta).length>0&&i(za)})}t(da);var Sa=l(da,2),Ka=l(s(Sa),2);{var Qa=i=>{var r=Se();v(i,r)},Xa=i=>{var r=Pe(),d=Q(r);{var x=f=>{var h=Ge(),A=s(h),U=s(A),z=s(U);t(U);var K=l(U,4),pa=s(K);t(K),t(A);var fa=l(A,2);ma(fa,17,()=>a(ta),ba,(Ya,ja)=>{var ua=je(),_a=s(ua),Za=s(_a);t(_a);var Ga=l(_a,4),ae=s(Ga);t(Ga),t(ua),b((ee,te)=>{_(Za,`${ee??""}Â°`),_(ae,`${te??""}Â°`)},[()=>xa(a(ja).raw_value),()=>xa(a(ja).actual_value)]),v(Ya,ua)}),t(h),b(()=>{_(z,`Raw (${a(L)??""})`),_(pa,`Actual (${a(L)??""})`)}),v(f,h)},k=f=>{var h=Ne();v(f,h)};w(d,f=>{a(ta).length>0?f(x):f(k,!1)})}var T=l(d,2),E=s(T),C=s(E),j=s(C),H=s(j);t(j);var G=l(j,2);X(G),t(C);var N=l(C,4),c=s(N),F=s(c);t(c);var M=l(c,2);X(M),t(N);var q=l(N,2);q.__click=()=>ha("temp",a(V),a($)),t(E),t(T),b(()=>{_(H,`Raw ${a(L)??""}`),Pa(G,"placeholder",a(aa)?"20.0":"68.0"),_(F,`Actual ${a(L)??""}`),Pa(M,"placeholder",a(aa)?"19.5":"67.5"),q.disabled=a(y)||!a(V)||!a($)}),Y(G,()=>a(V),f=>o(V,f)),Y(M,()=>a($),f=>o($,f)),v(i,r)};w(Ka,i=>{a(D)?i(Qa):i(Xa,!1)})}t(Sa),t(Aa),t(Ca),ce(2),b(()=>_(Wa,`Temperature (${a(L)??""})`)),me(W,()=>a(u),i=>o(u,i)),v(g,J)};w(ra,g=>{a(S).length===0?g(I):g(O,!1)},!0)}v(e,p)};w(La,e=>{a(ga)?e(Ea):e(Ha,!1)})}t(la),v(Ra,la),oe()}se(["click"]);export{Ie as component};
