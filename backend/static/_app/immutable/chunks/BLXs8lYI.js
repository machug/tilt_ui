import{d as Te,f as g,e as Ae,a as u,s as f,t as ee}from"./BMR6TOGE.js";import{aa as Ee,an as n,p as m,ai as Ge,b as e,ao as _e,s as i,ap as Pe,ad as r,aq as _,ab as Ue,ac as l,af as s,ar as M,as as qe}from"./CJ9U_lt3.js";import{e as ae,i as te}from"./Bv8p5TEf.js";import{i as y}from"./BK4Po838.js";import{r as R}from"./CHurcNvB.js";import{b as D}from"./CAiyxBcm.js";import{b as le}from"./4F6_53_-.js";import{f as Le}from"./C_g1FNU9.js";import{t as je}from"./7aIyeNsM.js";var ze=g('<div class="error-banner svelte-8ou9a2"><span class="error-icon svelte-8ou9a2">!</span> </div>'),He=g("<option> <!></option>"),Je=g('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="recipe">Recipe</label> <select id="recipe" class="form-select svelte-8ou9a2"><option>No recipe (manual batch)</option><!></select> <span class="form-hint svelte-8ou9a2">Select a recipe to auto-fill targets</span></div>'),Ke=g("<option> </option>"),Qe=g("<option> <!></option>"),Ve=g('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="fg">Measured FG</label> <input type="number" id="fg" class="form-input svelte-8ou9a2" placeholder="1.010" step="0.001" min="0.990" max="1.100"/></div>'),We=g('<span class="spinner svelte-8ou9a2"></span> Saving...',1),Xe=g('<form class="batch-form svelte-8ou9a2"><div class="form-header svelte-8ou9a2"><h2 class="form-title svelte-8ou9a2"> </h2> <p class="form-description svelte-8ou9a2"> </p></div> <!> <div class="form-body svelte-8ou9a2"><!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="name">Batch Name</label> <input type="text" id="name" class="form-input svelte-8ou9a2" placeholder="e.g., Summer IPA #3" maxlength="200"/> <span class="form-hint svelte-8ou9a2">Optional - defaults to recipe name</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="status">Status</label> <select id="status" class="form-select svelte-8ou9a2"></select></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="device">Tracking Device</label> <select id="device" class="form-select svelte-8ou9a2"><option>No device assigned</option><!></select> <span class="form-hint svelte-8ou9a2">Link a Tilt to track live gravity and temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="brewDate">Brew Date</label> <input type="date" id="brewDate" class="form-input svelte-8ou9a2"/></div> <div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="og">Measured OG</label> <input type="number" id="og" class="form-input svelte-8ou9a2" placeholder="1.050" step="0.001" min="0.990" max="1.200"/></div> <!></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="notes">Notes</label> <textarea id="notes" class="form-textarea svelte-8ou9a2" placeholder="Brewing notes, observations, etc." rows="3"></textarea></div></div> <div class="form-footer svelte-8ou9a2"><button type="button" class="btn-cancel svelte-8ou9a2">Cancel</button> <button type="submit" class="btn-submit svelte-8ou9a2"><!></button></div></form>');function oa(be,v){Ee(v,!0);let w=n(m(v.batch?.name||"")),S=n(m(v.batch?.recipe_id||null)),T=n(m(v.batch?.device_id||null)),A=n(m(v.batch?.status||"planning")),C=n(m(v.batch?.brew_date?v.batch.brew_date.split("T")[0]:"")),k=n(m(v.batch?.measured_og?.toString()||"")),O=n(m(v.batch?.measured_fg?.toString()||"")),E=n(m(v.batch?.notes||"")),G=n(m([])),P=n(!0),h=n(!1),N=n(null),pe=_e(()=>Array.from(je.tilts.values()));const ge=[{value:"planning",label:"Planning"},{value:"fermenting",label:"Fermenting"},{value:"conditioning",label:"Conditioning"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}];let b=_e(()=>!!v.batch);async function he(){i(P,!0);try{i(G,await Le(),!0)}catch(a){console.error("Failed to load recipes:",a)}finally{i(P,!1)}}async function xe(a){if(a.preventDefault(),!e(h)){i(h,!0),i(N,null);try{const t={name:e(w)||void 0,status:e(A),device_id:e(T)||void 0,brew_date:e(C)?new Date(e(C)).toISOString():void 0,measured_og:e(k)?parseFloat(e(k)):void 0,notes:e(E)||void 0};e(b)||(t.recipe_id=e(S)||void 0),e(b)&&e(O)&&(t.measured_fg=parseFloat(e(O))),await v.onSubmit(t)}catch(t){i(N,t instanceof Error?t.message:"Failed to save batch",!0)}finally{i(h,!1)}}}Ge(()=>{if(!e(b)&&e(S)&&!e(w)){const a=e(G).find(t=>t.id===e(S));a&&i(w,a.name,!0)}}),Pe(()=>{he()});var I=Xe(),U=r(I),q=r(U),ye=r(q,!0);s(q);var se=l(q,2),we=r(se,!0);s(se),s(U);var re=l(U,2);{var Se=a=>{var t=ze(),o=l(r(t));s(t),_(()=>f(o,` ${e(N)??""}`)),u(a,t)};y(re,a=>{e(N)&&a(Se)})}var L=l(re,2),oe=r(L);{var Fe=a=>{var t=Je(),o=l(r(t),2),d=r(o);d.value=(d.__value=null)??"";var x=l(d);ae(x,17,()=>e(G),te,(F,p)=>{var c=He(),B=r(c),Ie=l(B);{var Me=$=>{var me=ee();_(Re=>f(me,`(OG: ${Re??""})`),[()=>e(p).og_target.toFixed(3)]),u($,me)};y(Ie,$=>{e(p).og_target&&$(Me)})}s(c);var fe={};_(()=>{f(B,`${e(p).name??""} `),fe!==(fe=e(p).id)&&(c.value=(c.__value=e(p).id)??"")}),u(F,c)}),s(o),M(2),s(t),_(()=>o.disabled=e(P)),le(o,()=>e(S),F=>i(S,F)),u(a,t)};y(oe,a=>{e(b)||a(Fe)})}var j=l(oe,2),ie=l(r(j),2);R(ie),M(2),s(j);var z=l(j,2),H=l(r(z),2);ae(H,21,()=>ge,te,(a,t)=>{var o=Ke(),d=r(o,!0);s(o);var x={};_(()=>{f(d,e(t).label),x!==(x=e(t).value)&&(o.value=(o.__value=e(t).value)??"")}),u(a,o)}),s(H),s(z);var J=l(z,2),K=l(r(J),2),Q=r(K);Q.value=(Q.__value=null)??"";var Be=l(Q);ae(Be,17,()=>e(pe),te,(a,t)=>{var o=Qe(),d=r(o),x=l(d);{var F=c=>{var B=ee();_(()=>f(B,`- ${e(t).beer_name??""}`)),u(c,B)};y(x,c=>{e(t).beer_name&&e(t).beer_name!=="Untitled"&&c(F)})}s(o);var p={};_(()=>{f(d,`${e(t).color??""} Tilt `),p!==(p=e(t).id)&&(o.value=(o.__value=e(t).id)??"")}),u(a,o)}),s(K),M(2),s(J);var V=l(J,2),ve=l(r(V),2);R(ve),s(V);var W=l(V,2),X=r(W),ne=l(r(X),2);R(ne),s(X);var De=l(X,2);{var Ce=a=>{var t=Ve(),o=l(r(t),2);R(o),s(t),D(o,()=>e(O),d=>i(O,d)),u(a,t)};y(De,a=>{e(b)&&a(Ce)})}s(W);var ue=l(W,2),de=l(r(ue),2);qe(de),s(ue),s(L);var ce=l(L,2),Y=r(ce);Y.__click=function(...a){v.onCancel?.apply(this,a)};var Z=l(Y,2),ke=r(Z);{var Oe=a=>{var t=We();M(),u(a,t)},Ne=a=>{var t=ee();_(()=>f(t,e(b)?"Save Changes":"Create Batch")),u(a,t)};y(ke,a=>{e(h)?a(Oe):a(Ne,!1)})}s(Z),s(ce),s(I),_(()=>{f(ye,e(b)?"Edit Batch":"New Batch"),f(we,e(b)?"Update batch details and measurements":"Create a new fermentation batch"),Y.disabled=e(h),Z.disabled=e(h)}),Ae("submit",I,xe),D(ie,()=>e(w),a=>i(w,a)),le(H,()=>e(A),a=>i(A,a)),le(K,()=>e(T),a=>i(T,a)),D(ve,()=>e(C),a=>i(C,a)),D(ne,()=>e(k),a=>i(k,a)),D(de,()=>e(E),a=>i(E,a)),u(be,I),Ue()}Te(["click"]);export{oa as B};
