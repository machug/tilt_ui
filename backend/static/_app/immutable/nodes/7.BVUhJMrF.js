import{d as ke,f as o,a as c,c as Me,s as d}from"../chunks/hWEB2Dyj.js";import{an as z,b as s,s as n,ag as Te,p as Ae,ao as Le,aj as i,aq as re,ai as Ne,e as Pe,al as $e,ak as a,am as e,ar as T,ah as le,as as ce}from"../chunks/DlOb-_Gl.js";import{e as de,i as ne}from"../chunks/DrYgZuka.js";import{i as A}from"../chunks/C6MV343X.js";import{h as Ee}from"../chunks/42hnd-d-.js";import{s as oe}from"../chunks/CqjIVC5T.js";import{f as Ue,u as Be,p as Fe}from"../chunks/BssyGhMx.js";const ge=300*1e3;class Se{#e=z(null);get cache(){return s(this.#e)}set cache(u){n(this.#e,u,!0)}async getDevices(u=!1){const _=Date.now();if(!u&&this.cache&&_-this.cache.timestamp<ge)return this.cache.data;const w=await Ue();return this.cache={data:w,timestamp:_},w}invalidate(){this.cache=null}getCachedDevices(){const u=Date.now();return this.cache&&u-this.cache.timestamp<ge?this.cache.data:null}}const O=new Se;var Re=o('<div class="loading-state svelte-j4gi7w">Loading devices...</div>'),qe=o('<div class="error-state svelte-j4gi7w"><p> </p> <button class="btn-secondary svelte-j4gi7w">Retry</button></div>'),He=o('<div class="empty-state svelte-j4gi7w"><p>No paired devices. Pair a device below to start logging readings.</p></div>'),Ie=o('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">MAC:</span> <span class="detail-value mono svelte-j4gi7w"> </span></div>'),Oe=o('<div class="device-card paired svelte-j4gi7w"><div class="device-header svelte-j4gi7w"><div class="device-info svelte-j4gi7w"><div class="device-color-badge svelte-j4gi7w"></div> <div><h3 class="device-name svelte-j4gi7w"> </h3> <p class="device-id svelte-j4gi7w"> </p></div></div> <div class="device-status paired svelte-j4gi7w"><span class="status-dot svelte-j4gi7w"></span> Paired</div></div> <div class="device-details svelte-j4gi7w"><div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Beer Name:</span> <span class="detail-value svelte-j4gi7w"> </span></div> <div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Last Seen:</span> <span class="detail-value svelte-j4gi7w"> </span></div> <!></div> <button class="btn-secondary btn-sm svelte-j4gi7w">Unpair Device</button></div>'),ze=o('<div class="device-grid svelte-j4gi7w"></div>'),Ge=o('<div class="empty-state svelte-j4gi7w"><p>No unpaired devices detected. Make sure your Tilt is floating and within Bluetooth range.</p></div>'),Je=o('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">MAC:</span> <span class="detail-value mono svelte-j4gi7w"> </span></div>'),Ke=o('<div class="device-card unpaired svelte-j4gi7w"><div class="device-header svelte-j4gi7w"><div class="device-info svelte-j4gi7w"><div class="device-color-badge svelte-j4gi7w"></div> <div><h3 class="device-name svelte-j4gi7w"> </h3> <p class="device-id svelte-j4gi7w"> </p></div></div> <div class="device-status unpaired svelte-j4gi7w"><span class="status-dot svelte-j4gi7w"></span> Unpaired</div></div> <div class="device-details svelte-j4gi7w"><div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Last Seen:</span> <span class="detail-value svelte-j4gi7w"> </span></div> <!></div> <button class="btn-primary btn-sm svelte-j4gi7w">Pair Device</button></div>'),Qe=o('<div class="device-grid svelte-j4gi7w"></div>'),Ve=o('<div class="devices-container svelte-j4gi7w"><section class="device-section svelte-j4gi7w"><h2 class="section-title svelte-j4gi7w"> </h2> <p class="section-description svelte-j4gi7w">These devices are actively logging readings</p> <!></section> <section class="device-section svelte-j4gi7w"><h2 class="section-title svelte-j4gi7w"> </h2> <p class="section-description svelte-j4gi7w">These devices are detected but not logging readings</p> <!></section></div>'),We=o('<div class="page-header svelte-j4gi7w"><h1 class="page-title svelte-j4gi7w">Devices</h1> <p class="page-description svelte-j4gi7w">Manage your Tilt hydrometer devices</p></div> <!>',1);function ia(ee,u){Te(u,!0);let _=z(Ae([])),w=z(!0),p=z(null);Le(async()=>{const t=O.getCachedDevices();t&&(n(_,t,!0),n(w,!1)),await q()});async function q(t=!1){n(w,!0),n(p,null);try{n(_,await O.getDevices(t),!0)}catch(v){n(p,v instanceof Error?v.message:"Failed to load devices",!0)}finally{n(w,!1)}}async function pe(t){n(p,null);try{await Fe(t),O.invalidate(),await q(!0)}catch(v){n(p,v instanceof Error?v.message:"Failed to pair device",!0)}}async function ue(t){n(p,null);try{await Be(t),O.invalidate(),await q(!0)}catch(v){n(p,v instanceof Error?v.message:"Failed to unpair device",!0)}}function ae(t){if(!t)return"Never seen";const v=Math.floor((Date.now()-new Date(t).getTime())/1e3);if(v<10)return"just now";if(v<60)return`${v}s ago`;const L=Math.floor(v/60);if(L<60)return`${L}m ago`;const N=Math.floor(L/60);return N<24?`${N}h ago`:`${Math.floor(N/24)}d ago`}let G=le(()=>s(_).filter(t=>t.paired)),J=le(()=>s(_).filter(t=>!t.paired));var se=We();Ee("j4gi7w",t=>{Pe(()=>{$e.title="Devices | BrewSignal"})});var _e=i(re(se),2);{var we=t=>{var v=Re();c(t,v)},he=t=>{var v=Me(),L=re(v);{var N=M=>{var h=qe(),f=a(h),P=a(f,!0);e(f);var K=i(f,2);K.__click=()=>q(!0),e(h),T(()=>d(P,s(p))),c(M,h)},te=M=>{var h=Ve(),f=a(h),P=a(f),K=a(P);e(P);var fe=i(P,4);{var je=l=>{var g=He();c(l,g)},me=l=>{var g=ze();de(g,21,()=>s(G),ne,(V,r)=>{var j=Oe(),m=a(j),$=a(m),E=a($),U=i(E,2),b=a(U),W=a(b);e(b);var B=i(b,2),X=a(B,!0);e(B),e(U),e($),ce(2),e(m);var y=i(m,2),D=a(y),F=i(a(D),2),Y=a(F,!0);e(F),e(D);var S=i(D,2),H=i(a(S),2),Z=a(H,!0);e(H),e(S);var x=i(S,2);{var C=k=>{var R=Ie(),ve=i(a(R),2),Ce=a(ve,!0);e(ve),e(R),T(()=>d(Ce,s(r).mac)),c(k,R)};A(x,k=>{s(r).mac&&k(C)})}e(y);var I=i(y,2);I.__click=()=>ue(s(r).id),e(j),T((k,R)=>{oe(E,`background: var(--tilt-${k??""})`),d(W,`${s(r).color??""} Tilt`),d(X,s(r).id),d(Y,s(r).beer_name),d(Z,R)},[()=>s(r).color.toLowerCase(),()=>ae(s(r).last_seen)]),c(V,j)}),e(g),c(l,g)};A(fe,l=>{s(G).length===0?l(je):l(me,!1)})}e(f);var ie=i(f,2),Q=a(ie),be=a(Q);e(Q);var ye=i(Q,4);{var De=l=>{var g=Ge();c(l,g)},xe=l=>{var g=Qe();de(g,21,()=>s(J),ne,(V,r)=>{var j=Ke(),m=a(j),$=a(m),E=a($),U=i(E,2),b=a(U),W=a(b);e(b);var B=i(b,2),X=a(B,!0);e(B),e(U),e($),ce(2),e(m);var y=i(m,2),D=a(y),F=i(a(D),2),Y=a(F,!0);e(F),e(D);var S=i(D,2);{var H=x=>{var C=Je(),I=i(a(C),2),k=a(I,!0);e(I),e(C),T(()=>d(k,s(r).mac)),c(x,C)};A(S,x=>{s(r).mac&&x(H)})}e(y);var Z=i(y,2);Z.__click=()=>pe(s(r).id),e(j),T((x,C)=>{oe(E,`background: var(--tilt-${x??""})`),d(W,`${s(r).color??""} Tilt`),d(X,s(r).id),d(Y,C)},[()=>s(r).color.toLowerCase(),()=>ae(s(r).last_seen)]),c(V,j)}),e(g),c(l,g)};A(ye,l=>{s(J).length===0?l(De):l(xe,!1)})}e(ie),e(h),T(()=>{d(K,`Paired Devices (${s(G).length??""})`),d(be,`Detected Devices (${s(J).length??""})`)}),c(M,h)};A(L,M=>{s(p)?M(N):M(te,!1)},!0)}c(t,v)};A(_e,t=>{s(w)?t(we):t(he,!1)})}c(ee,se),Ne()}ke(["click"]);export{ia as component};
