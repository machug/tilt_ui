import{d as Ie,f as d,s as l,a as v,c as be}from"../chunks/jyAcDmWg.js";import{al as a,ak as s,an as t,as as f,ah as ke,ar as X,c as e,ai as M,at as he,aj as ye,ap as Vt,aK as Wt,aw as Jt,am as Kt,ao as me,s as D}from"../chunks/DBUEpBwK.js";import{e as Ve,i as We}from"../chunks/CWBb8vPY.js";import{i as p}from"../chunks/Ce0eyuz5.js";import{h as Yt}from"../chunks/GnvximVd.js";import{s as bt}from"../chunks/BKC2WXbk.js";import{s as pe}from"../chunks/-yfH5Rgi.js";import{s as je}from"../chunks/Cmyp4dBw.js";import{i as qt,s as Qt}from"../chunks/Dx7-2BRZ.js";import{s as Xt,a as Zt}from"../chunks/kcwD9VOY.js";import{p as $t}from"../chunks/H0H4xxUt.js";import{g as ea}from"../chunks/DOtVTZph.js";import{k as ta,b as ft,l as Ne,u as mt,m as aa,s as sa}from"../chunks/DlMVHRlb.js";import{b as ra,g as ht,d as Je,e as jt,c as pt}from"../chunks/D-cBTwJC.js";import{t as ia}from"../chunks/y7-K11TG.js";import{B as la}from"../chunks/C1K0tKqr.js";import{s as va}from"../chunks/CIodzTVx.js";import{p as He}from"../chunks/ly048rjG.js";const na=!1,hs=Object.freeze(Object.defineProperty({__proto__:null,prerender:na},Symbol.toStringTag,{value:"Module"}));function kt(E){return E>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:E>=-60?{bars:3,color:"var(--positive)",label:"Good"}:E>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function yt(E){const r=Math.floor((Date.now()-new Date(E).getTime())/1e3);if(r<10)return"just now";if(r<60)return`${r}s ago`;const m=Math.floor(r/60);if(m<60)return`${m}m ago`;const C=Math.floor(m/60);return C<24?`${C}h ago`:`${Math.floor(C/24)}d ago`}var da=d('<div class="accent-bar svelte-1oyrwd9"></div>'),oa=d('<span class="card-icon svelte-1oyrwd9"> </span>'),ca=d('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),ua=d('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function ze(E,r){let m=He(r,"highlight",3,!1),C=He(r,"collapsible",3,!1),b=He(r,"expanded",3,!1);var j=ua();let o;var i=a(j);{var O=h=>{var w=da();v(h,w)};p(i,h=>{m()&&h(O)})}var n=s(i,2),F=a(n),R=a(F);{var P=h=>{var w=oa(),V=a(w,!0);t(w),f(()=>l(V,r.icon)),v(h,w)};p(R,h=>{r.icon&&h(P)})}var g=s(R,2),y=a(g,!0);t(g),t(F);var c=s(F,2);{var G=h=>{var w=ca();w.__click=function(...U){r.onToggle?.apply(this,U)};var V=a(w);let L;t(w),f(()=>{bt(w,"aria-label",b()?"Collapse":"Expand"),L=pe(V,0,"expand-icon svelte-1oyrwd9",null,L,{"rotate-180":b()})}),v(h,w)};p(c,h=>{C()&&r.onToggle&&h(G)})}t(n);var z=s(n,2);let _;var x=a(z);va(x,()=>r.children),t(z),t(j),f(()=>{o=pe(j,1,"batch-card svelte-1oyrwd9",null,o,{highlight:m()}),l(y,r.title),_=pe(z,1,"card-content svelte-1oyrwd9",null,_,{collapsed:C()&&!b()})}),v(E,j)}Ie(["click"]);var ga=d('<span class="unit svelte-lzskfi"> </span>'),_a=d('<div class="raw-values svelte-lzskfi"><span class="raw-label svelte-lzskfi">Raw:</span> <span class="raw-value svelte-lzskfi"> </span> <span class="raw-separator svelte-lzskfi">Â·</span> <span class="raw-value svelte-lzskfi"> </span></div>'),fa=d('<div class="signal-bar svelte-lzskfi"></div>'),ma=d('<div class="signal-section svelte-lzskfi"><div class="signal-bars svelte-lzskfi"></div> <div class="signal-info svelte-lzskfi"><span class="signal-label svelte-lzskfi"> </span> <span class="signal-rssi svelte-lzskfi"> </span></div></div>'),pa=d('<div class="last-seen svelte-lzskfi"> </div>'),ba=d('<div class="live-badge svelte-lzskfi"><span class="live-dot svelte-lzskfi"></span> <span class="live-text svelte-lzskfi">LIVE</span></div> <div class="readings-grid svelte-lzskfi"><div class="reading svelte-lzskfi"><div class="reading-value svelte-lzskfi"> <!></div> <div class="reading-label svelte-lzskfi"> </div></div> <div class="reading svelte-lzskfi"><div class="reading-value temp svelte-lzskfi"> <span class="unit svelte-lzskfi"> </span></div> <div class="reading-label svelte-lzskfi">Temperature</div></div></div> <!> <!> <!>',1);function ha(E,r){ke(r,!0);let m=M(()=>r.liveReading?.sg??r.currentSg),C=M(()=>r.liveReading?.temp??r.currentTemp),b=M(()=>r.liveReading?.sg_raw),j=M(()=>r.liveReading?.temp_raw),o=M(()=>r.liveReading?.rssi),i=M(()=>r.liveReading?.last_seen),O=M(()=>r.liveReading&&(r.liveReading.sg!==r.liveReading.sg_raw||r.liveReading.temp!==r.liveReading.temp_raw)),n=M(ra),F=M(ht);function R(c){return c==null?"--":Je(c)}function P(c){return c==null?"--":jt(c)}let g=M(()=>e(o)?kt(e(o)):null),y=M(()=>e(i)?yt(e(i)):null);ze(E,{title:"Live Readings",highlight:!0,children:(c,G)=>{var z=ba(),_=s(X(z),2),x=a(_),h=a(x),w=a(h),V=s(w);{var L=T=>{var k=ga(),S=a(k,!0);t(k),f(()=>l(S,e(n))),v(T,k)};p(V,T=>{e(n)!=="SG"&&T(L)})}t(h);var U=s(h,2),Y=a(U,!0);t(U),t(x);var W=s(x,2),q=a(W),Z=a(q),te=s(Z),J=a(te,!0);t(te),t(q),he(2),t(W),t(_);var ae=s(_,2);{var ue=T=>{var k=_a(),S=s(a(k),2),A=a(S,!0);t(S);var N=s(S,4),Q=a(N);t(N),t(k),f(($,ee)=>{l(A,$),l(Q,`${ee??""}${e(F)??""}`)},[()=>R(e(b)),()=>P(e(j))]),v(T,k)};p(ae,T=>{e(O)&&T(ue)})}var ve=s(ae,2);{var u=T=>{var k=ma(),S=a(k);Ve(S,20,()=>Array(4),We,(ge,Se,se)=>{var _e=fa();f(()=>je(_e,`
							height: ${8+se*4}px;
							background: ${(se<e(g).bars?e(g).color:"var(--bg-hover)")??""};
							opacity: ${se<e(g).bars?1:.4};
						`)),v(ge,_e)}),t(S);var A=s(S,2),N=a(A),Q=a(N);t(N);var $=s(N,2),ee=a($);t($),t(A),t(k),f(()=>{je(N,`color: ${e(g).color??""}`),l(Q,`${e(g).label??""} Signal`),l(ee,`${e(o)??""} dBm`)}),v(T,k)};p(ve,T=>{e(g)&&e(o)&&T(u)})}var H=s(ve,2);{var ie=T=>{var k=pa(),S=a(k);t(k),f(()=>l(S,`Updated ${e(y)??""}`)),v(T,k)};p(H,T=>{e(y)&&T(ie)})}f((T,k)=>{l(w,`${T??""} `),l(Y,e(n)==="SG"?"Gravity":e(n)==="Â°P"?"Plato":"Brix"),l(Z,`${k??""} `),l(J,e(F))},[()=>R(e(m)),()=>P(e(C))]),v(c,z)},$$slots:{default:!0}}),ye()}var ja=d('<div class="gravity-point target svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Target FG</div> <div class="point-value svelte-t80j9z"> </div></div>'),ka=d('<div class="progress-remaining svelte-t80j9z"> </div>'),ya=d('<div class="progress-section svelte-t80j9z"><div class="progress-header svelte-t80j9z"><span class="progress-label svelte-t80j9z">Fermentation Progress</span> <span class="progress-percent svelte-t80j9z"> </span></div> <div class="progress-bar-container svelte-t80j9z"><div class="progress-bar-bg svelte-t80j9z"></div> <div class="progress-bar-fill svelte-t80j9z"></div> <div class="progress-bar-shine svelte-t80j9z"></div></div> <!></div>'),za=d('<div class="current-sg svelte-t80j9z"><div class="sg-label svelte-t80j9z">Current Specific Gravity</div> <div class="sg-value svelte-t80j9z"> <span class="fermenting-badge svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> Fermenting</span></div></div> <div class="gravity-timeline svelte-t80j9z"><div class="timeline-line svelte-t80j9z"></div> <div class="gravity-point start svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Original Gravity</div> <div class="point-value svelte-t80j9z"> </div></div> <!> <div class="gravity-point current svelte-t80j9z"><div class="point-marker pulsing svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Current FG</div> <div class="point-value svelte-t80j9z"> </div></div></div> <div class="metrics-grid svelte-t80j9z"><div class="metric abv-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">%</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Alcohol by Volume</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div> <div class="metric attenuation-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">â†“</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Apparent Attenuation</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div></div> <!>',1),xa=d('<div class="measurements-grid svelte-t80j9z"><div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Original Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Final Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">ABV</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Attenuation</div> <div class="measurement-value svelte-t80j9z"> </div></div></div>'),wa=d('<div class="no-data svelte-t80j9z"><div class="no-data-icon svelte-t80j9z">â—‹</div> <p class="no-data-text svelte-t80j9z">Set Original Gravity to begin tracking fermentation metrics</p></div>');function Sa(E,r){ke(r,!0);let m=M(()=>{if(!r.batch.measured_og)return null;const o=r.currentSg??r.progress?.measured?.current_sg;if(!o)return null;const i=(r.batch.measured_og-o)*131.25,O=r.batch.measured_og-1,n=O!==0?(r.batch.measured_og-o)/O*100:0;return{currentSg:o,abv:Math.max(0,i),attenuation:Math.max(0,Math.min(100,n)),isFermenting:r.batch.status==="fermenting"||r.batch.status==="conditioning"}}),C=M(()=>e(m)?.isFermenting??!1);function b(o){return o==null?"--":Je(o)}function j(o){return o==null?"--":`${o.toFixed(1)}%`}{let o=M(()=>e(C)?"Fermentation Progress":"Fermentation Measurements");ze(E,{get title(){return e(o)},children:(i,O)=>{var n=be(),F=X(n);{var R=g=>{var y=za(),c=X(y),G=s(a(c),2),z=a(G);he(),t(G),t(c);var _=s(c,2),x=s(a(_),2),h=s(a(x),4),w=a(h,!0);t(h),t(x);var V=s(x,2);{var L=k=>{var S=ja(),A=s(a(S),4),N=a(A,!0);t(A),t(S),f(Q=>l(N,Q),[()=>b(r.batch.recipe.fg_target)]),v(k,S)};p(V,k=>{r.batch.recipe?.fg_target&&k(L)})}var U=s(V,2),Y=s(a(U),4),W=a(Y,!0);t(Y),t(U),t(_);var q=s(_,2),Z=a(q),te=s(a(Z),2),J=s(a(te),2),ae=a(J);he(),t(J),t(te),t(Z);var ue=s(Z,2),ve=s(a(ue),2),u=s(a(ve),2),H=a(u);he(),t(u),t(ve),t(ue),t(q);var ie=s(q,2);{var T=k=>{var S=ya(),A=a(S),N=s(a(A),2),Q=a(N);t(N),t(A);var $=s(A,2),ee=s(a($),2);he(2),t($);var ge=s($,2);{var Se=se=>{var _e=ka(),fe=a(_e);t(_e),f(Be=>l(fe,`${Be??""} gravity points remaining`),[()=>r.progress.progress.sg_remaining.toFixed(3)]),v(se,_e)};p(ge,se=>{r.progress.progress.sg_remaining!=null&&se(Se)})}t(S),f(se=>{l(Q,`${se??""}%`),je(ee,`width: ${r.progress.progress.percent_complete??""}%`)},[()=>r.progress.progress.percent_complete.toFixed(0)]),v(k,S)};p(ie,k=>{r.progress?.progress?.percent_complete!=null&&k(T)})}f((k,S,A,N,Q)=>{l(z,`${k??""} `),l(w,S),l(W,A),l(ae,`${N??""} `),l(H,`${Q??""} `)},[()=>b(e(m).currentSg),()=>b(r.batch.measured_og),()=>b(e(m).currentSg),()=>j(e(m).abv),()=>j(e(m).attenuation)]),v(g,y)},P=g=>{var y=be(),c=X(y);{var G=_=>{var x=xa(),h=a(x),w=s(a(h),2),V=a(w,!0);t(w),t(h);var L=s(h,2),U=s(a(L),2),Y=a(U,!0);t(U),t(L);var W=s(L,2),q=s(a(W),2),Z=a(q,!0);t(q),t(W);var te=s(W,2),J=s(a(te),2),ae=a(J,!0);t(J),t(te),t(x),f((ue,ve,u,H)=>{l(V,ue),l(Y,ve),l(Z,u),l(ae,H)},[()=>b(r.batch.measured_og),()=>b(r.batch.measured_fg),()=>r.batch.measured_abv!=null?j(r.batch.measured_abv):"--",()=>r.batch.measured_attenuation!=null?j(r.batch.measured_attenuation):"--"]),v(_,x)},z=_=>{var x=wa();v(_,x)};p(c,_=>{r.batch.measured_og?_(G):_(z,!1)},!0)}v(g,y)};p(F,g=>{e(m)&&e(C)?g(R):g(P,!1)})}v(i,n)},$$slots:{default:!0}})}ye()}var Ba=d('<div class="timeline svelte-yskb8i"><div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Brew Date</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Started</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Ended</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Created</span> <span class="timeline-value svelte-yskb8i"> </span></div></div>');function Ca(E,r){ke(r,!0);function m(b){return b?new Date(b).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}):"--"}function C(b){return b?new Date(b).toLocaleString("en-GB",{day:"numeric",month:"short",hour:"numeric",minute:"2-digit"}):"--"}ze(E,{title:"Timeline",children:(b,j)=>{var o=Ba(),i=a(o),O=s(a(i),2),n=a(O,!0);t(O),t(i);var F=s(i,2),R=s(a(F),2),P=a(R,!0);t(R),t(F);var g=s(F,2),y=s(a(g),2),c=a(y,!0);t(y),t(g);var G=s(g,2),z=s(a(G),2),_=a(z,!0);t(z),t(G),t(o),f((x,h,w,V)=>{l(n,x),l(P,h),l(c,w),l(_,V)},[()=>m(r.batch.brew_date),()=>C(r.batch.start_time),()=>C(r.batch.end_time),()=>C(r.batch.created_at)]),v(b,o)},$$slots:{default:!0}}),ye()}var Ta=d('<div class="signal-bar svelte-1kdxwtz"></div>'),Fa=d('<div class="signal-details svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="signal-text svelte-1kdxwtz"> </span></div>'),Ra=d('<div class="device-last-seen svelte-1kdxwtz"> </div>'),Ga=d('<div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!> <!>',1),Ma=d('<div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <div class="device-last-seen svelte-1kdxwtz">Not receiving data</div>',1),Oa=d('<div class="device-info svelte-1kdxwtz"><!></div>'),Pa=d('<button type="button" class="link-btn svelte-1kdxwtz">Link a device</button>'),Da=d('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function Ea(E,r){ke(r,!0);let m=M(()=>r.liveReading?.rssi?kt(r.liveReading.rssi):null),C=M(()=>r.liveReading?.last_seen?yt(r.liveReading.last_seen):null);ze(E,{title:"Tracking Device",children:(b,j)=>{var o=be(),i=X(o);{var O=F=>{var R=Oa(),P=a(R);{var g=c=>{var G=Ga(),z=X(G),_=s(a(z));t(z);var x=s(z,2);{var h=L=>{var U=Fa(),Y=a(U);Ve(Y,20,()=>Array(4),We,(Z,te,J)=>{var ae=Ta();f(()=>je(ae,`
										height: ${6+J*3}px;
										background: ${(J<e(m).bars?e(m).color:"var(--bg-hover)")??""};
										opacity: ${J<e(m).bars?1:.4};
									`)),v(Z,ae)}),t(Y);var W=s(Y,2),q=a(W);t(W),t(U),f(()=>{je(W,`color: ${e(m).color??""}`),l(q,`${e(m).label??""} (${r.liveReading.rssi??""} dBm)`)}),v(L,U)};p(x,L=>{e(m)&&L(h)})}var w=s(x,2);{var V=L=>{var U=Ra(),Y=a(U);t(U),f(()=>l(Y,`Updated ${e(C)??""}`)),v(L,U)};p(w,L=>{e(C)&&L(V)})}f(()=>l(_,` ${r.liveReading.color??""} Tilt - Connected`)),v(c,G)},y=c=>{var G=Ma(),z=X(G),_=s(a(z));t(z),he(2),f(()=>l(_,` Device: ${r.batch.device_id??""}`)),v(c,G)};p(P,c=>{r.liveReading?c(g):c(y,!1)})}t(R),v(F,R)},n=F=>{var R=Da(),P=s(a(R),2);{var g=y=>{var c=Pa();c.__click=function(...G){r.onEdit?.apply(this,G)},v(y,c)};p(P,y=>{r.onEdit&&y(g)})}t(R),v(F,R)};p(i,F=>{r.batch.device_id?F(O):F(n,!1)})}v(b,o)},$$slots:{default:!0}}),ye()}Ie(["click"]);var La=d('<div class="target wide svelte-19u9n31"><span class="target-label svelte-19u9n31">Yeast</span> <span class="target-value svelte-19u9n31"> </span></div>'),Ua=d('<div class="targets-grid svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div> <!></div>');function Aa(E,r){ke(r,!0);function m(C){return C==null?"--":Je(C)}ze(E,{title:"Recipe Targets",children:(C,b)=>{var j=Ua(),o=a(j),i=s(a(o),2),O=a(i,!0);t(i),t(o);var n=s(o,2),F=s(a(n),2),R=a(F,!0);t(F),t(n);var P=s(n,2),g=s(a(P),2),y=a(g,!0);t(g),t(P);var c=s(P,2);{var G=z=>{var _=La(),x=s(a(_),2),h=a(x,!0);t(x),t(_),f(()=>l(h,r.recipe.yeast_name)),v(z,_)};p(c,z=>{r.recipe.yeast_name&&z(G)})}t(j),f((z,_,x)=>{l(O,z),l(R,_),l(y,x)},[()=>m(r.recipe.og_target),()=>m(r.recipe.fg_target),()=>r.recipe.abv_target!=null?`${r.recipe.abv_target.toFixed(1)}%`:"--"]),v(C,j)},$$slots:{default:!0}}),ye()}var Na=d('<p class="notes-content svelte-hkv31i"> </p>');function Ha(E,r){ze(E,{title:"Notes",children:(m,C)=>{var b=Na(),j=a(b,!0);t(b),f(()=>l(j,r.notes)),v(m,b)},$$slots:{default:!0}})}var Ia=d('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),Va=d('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),Wa=d('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),Ja=d('<span class="recipe-type svelte-g5au2j"> </span>'),Ka=d('<a class="recipe-link svelte-g5au2j"> <!></a>'),Ya=d('<option class="svelte-g5au2j"> </option>'),qa=d('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">âš¡</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),Qa=d('<div class="heater-details svelte-g5au2j"><div class="heater-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="heater-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns svelte-g5au2j"><button type="button">Force ON</button> <button type="button">Force OFF</button></div></div>',1),Xa=d('<div><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="heater-status svelte-g5au2j"><div>ðŸ”¥</div> <div class="heater-info svelte-g5au2j"><span> </span> <span class="heater-entity svelte-g5au2j"> </span></div></div> <!></div>'),Za=d('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><span class="svelte-g5au2j"> </span> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),$a=d('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!></div></div>',1),es=d('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div>');function js(E,r){ke(r,!0);const m=()=>Zt($t,"$page",C),[C,b]=Xt();let j=null,o=null,i=me(null),O=me(null),n=me(null),F=me(!0),R=me(null),P=me(!1),g=me(!1),y=me(!1),c=M(()=>parseInt(m().params.id??"0"));const G={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},z=["planning","fermenting","conditioning","completed","archived"];let _=M(()=>e(i)?G[e(i).status]:G.planning),x=M(ht),h=M(()=>pt.config.ha_enabled&&pt.config.temp_control_enabled&&e(i)?.heater_entity_id),w=M(()=>{if(!e(i)?.device_id)return null;const u=e(i).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!u?.[1])return null;const H=u[1].toUpperCase();for(const ie of ia.tilts.values())if(ie.color.toUpperCase()===H)return ie;return null});async function V(){D(F,!0),D(R,null);try{if(D(i,await ta(e(c)),!0),e(i).status==="fermenting"||e(i).status==="conditioning")try{D(O,await ft(e(c)),!0)}catch{}if(e(i).heater_entity_id)try{D(n,await Ne(e(c)),!0)}catch{}}catch(u){D(R,u instanceof Error?u.message:"Failed to load batch",!0)}finally{D(F,!1)}}async function L(u){if(!(!e(i)||e(g))){D(g,!0);try{D(i,await mt(e(i).id,{status:u}),!0),(u==="fermenting"||u==="conditioning")&&D(O,await ft(e(i).id),!0)}catch(H){console.error("Failed to update status:",H)}finally{D(g,!1)}}}async function U(u){if(e(i)&&(D(i,await mt(e(i).id,u),!0),D(P,!1),e(i).heater_entity_id))try{D(n,await Ne(e(i).id),!0)}catch{}}async function Y(){if(e(i)&&confirm(`Are you sure you want to delete "${e(i).name||"this batch"}"?`))try{await aa(e(i).id),ea("/batches")}catch{alert("Failed to delete batch")}}async function W(u){if(!(!e(i)||e(y))){D(y,!0);try{await sa(e(i).id,u),D(n,await Ne(e(i).id),!0)}catch(H){console.error("Failed to set override:",H)}finally{D(y,!1)}}}function q(){if(j?.readyState===WebSocket.OPEN)return;const H=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;j=new WebSocket(H),j.onmessage=async ie=>{try{const T=JSON.parse(ie.data);T.type==="control_event"&&T.batch_id===e(c)&&e(n)&&(T.action==="heat_on"?D(n,{...e(n),heater_state:"on"},!0):T.action==="heat_off"&&D(n,{...e(n),heater_state:"off"},!0))}catch{}},j.onclose=()=>{j=null,o=setTimeout(q,3e3)},j.onerror=()=>{j?.close()}}function Z(){o&&(clearTimeout(o),o=null),j?.close(),j=null}function te(u){return u==null?"--":jt(u)}Vt(()=>{V(),q()}),Wt(()=>{Z()});var J=es();Yt("g5au2j",u=>{Jt(()=>{Kt.title=`${(e(i)?.name||"Batch")??""} | BrewSignal`})});var ae=s(a(J),2);{var ue=u=>{var H=Ia();v(u,H)},ve=u=>{var H=be(),ie=X(H);{var T=S=>{var A=Va(),N=s(a(A),2),Q=a(N,!0);t(N);var $=s(N,2);$.__click=V,t(A),f(()=>l(Q,e(R))),v(S,A)},k=S=>{var A=be(),N=X(A);{var Q=ee=>{var ge=Wa();v(ee,ge)},$=ee=>{var ge=be(),Se=X(ge);{var se=fe=>{la(fe,{get batch(){return e(i)},onSubmit:U,onCancel:()=>D(P,!1)})},_e=fe=>{var Be=$a(),Fe=X(Be),Re=a(Fe),Ge=a(Re),zt=a(Ge);t(Ge);var Ke=s(Ge,2),Me=a(Ke),xt=a(Me,!0);t(Me);var wt=s(Me,2);{var St=B=>{var I=Ka(),K=a(I),de=s(K);{var re=le=>{var oe=Ja(),ce=a(oe);t(oe),f(()=>l(ce,`(${e(i).recipe.type??""})`)),v(le,oe)};p(de,le=>{e(i).recipe.type&&le(re)})}t(I),f(()=>{bt(I,"href",`/recipes/${e(i).recipe.id??""}`),l(K,`${e(i).recipe.name??""} `)}),v(B,I)};p(wt,B=>{e(i).recipe&&B(St)})}t(Ke),t(Re);var Ye=s(Re,2),Oe=a(Ye),ne=a(Oe);ne.__change=B=>L(B.currentTarget.value),Ve(ne,21,()=>z,We,(B,I)=>{var K=Ya(),de=a(K,!0);t(K);var re={};f(()=>{l(de,G[e(I)].label),re!==(re=e(I))&&(K.value=(K.__value=e(I))??"")}),v(B,K)}),t(ne);var qe;qt(ne),t(Oe);var Qe=s(Oe,2);Qe.__click=()=>D(P,!0);var Bt=s(Qe,2);Bt.__click=Y,t(Ye),t(Fe);var Xe=s(Fe,2),Pe=a(Xe),Ze=a(Pe);{var Ct=B=>{{let I=M(()=>e(O)?.measured?.current_sg),K=M(()=>e(O)?.temperature?.current);ha(B,{get liveReading(){return e(w)},get currentSg(){return e(I)},get currentTemp(){return e(K)}})}};p(Ze,B=>{(e(w)||e(O)?.measured?.current_sg!=null)&&B(Ct)})}var $e=s(Ze,2);{let B=M(()=>e(w)?.sg??e(O)?.measured?.current_sg);Sa($e,{get batch(){return e(i)},get currentSg(){return e(B)},get progress(){return e(O)}})}var Tt=s($e,2);{var Ft=B=>{Aa(B,{get recipe(){return e(i).recipe}})};p(Tt,B=>{e(i).recipe&&B(Ft)})}t(Pe);var et=s(Pe,2),tt=a(et);Ca(tt,{get batch(){return e(i)}});var at=s(tt,2);Ea(at,{get batch(){return e(i)},get liveReading(){return e(w)},onEdit:()=>D(P,!0)});var st=s(at,2);{var Rt=B=>{var I=Xa();let K;var de=s(a(I),2),re=a(de);let le;var oe=s(re,2),ce=a(oe);let Ce;var Pt=a(ce,!0);t(ce);var rt=s(ce,2),Dt=a(rt,!0);t(rt),t(oe),t(de);var Et=s(de,2);{var Lt=De=>{var it=Qa(),Ee=X(it),Le=a(Ee),lt=s(a(Le),2),Ut=a(lt);t(lt),t(Le);var vt=s(Le,2),nt=s(a(vt),2),At=a(nt);t(nt),t(vt),t(Ee);var dt=s(Ee,2);{var Nt=xe=>{var we=qa(),Ae=s(a(we),2),Ht=a(Ae);t(Ae);var _t=s(Ae,2);_t.__click=()=>W(null),t(we),f(It=>{l(Ht,`Override active: ${It??""}`),_t.disabled=e(y)},[()=>e(n).override_state?.toUpperCase()]),v(xe,we)};p(dt,xe=>{e(n).override_active&&xe(Nt)})}var ot=s(dt,2),ct=s(a(ot),2),Te=a(ct);let ut;Te.__click=()=>W("on");var Ue=s(Te,2);let gt;Ue.__click=()=>W("off"),t(ct),t(ot),f((xe,we)=>{l(Ut,`${xe??""}${e(x)??""}`),l(At,`Â±${we??""}${e(x)??""}`),ut=pe(Te,1,"override-btn svelte-g5au2j",null,ut,{active:e(n).override_state==="on"}),Te.disabled=e(y),gt=pe(Ue,1,"override-btn svelte-g5au2j",null,gt,{active:e(n).override_state==="off"}),Ue.disabled=e(y)},[()=>te(e(n).target_temp),()=>e(n).hysteresis?.toFixed(1)||"--"]),v(De,it)};p(Et,De=>{e(n)&&De(Lt)})}t(I),f(()=>{K=pe(I,1,"info-card heater-card svelte-g5au2j",null,K,{"heater-on":e(n)?.heater_state==="on"}),le=pe(re,1,"heater-icon-wrap svelte-g5au2j",null,le,{heating:e(n)?.heater_state==="on"}),Ce=pe(ce,1,"heater-state svelte-g5au2j",null,Ce,{on:e(n)?.heater_state==="on"}),l(Pt,e(n)?.heater_state==="on"?"HEATING":e(n)?.heater_state==="off"?"OFF":"Unknown"),l(Dt,e(i).heater_entity_id)}),v(B,I)},Gt=B=>{var I=be(),K=X(I);{var de=re=>{var le=Za(),oe=s(a(le),2),ce=a(oe),Ce=a(ce);t(ce),he(2),t(oe),t(le),f(()=>l(Ce,`Heater: ${e(i).heater_entity_id??""}`)),v(re,le)};p(K,re=>{e(i).heater_entity_id&&e(i).status!=="fermenting"&&re(de)},!0)}v(B,I)};p(st,B=>{e(h)&&e(i).status==="fermenting"?B(Rt):B(Gt,!1)})}var Mt=s(st,2);{var Ot=B=>{Ha(B,{get notes(){return e(i).notes}})};p(Mt,B=>{e(i).notes&&B(Ot)})}t(et),t(Xe),f(()=>{l(zt,`#${(e(i).batch_number||"?")??""}`),l(xt,e(i).name||e(i).recipe?.name||"Unnamed Batch"),ne.disabled=e(g),je(ne,`color: ${e(_).color??""}; background: ${e(_).bg??""};`),qe!==(qe=e(i).status)&&(ne.value=(ne.__value=e(i).status)??"",Qt(ne,e(i).status))}),v(fe,Be)};p(Se,fe=>{e(P)?fe(se):fe(_e,!1)},!0)}v(ee,ge)};p(N,ee=>{e(i)?ee($,!1):ee(Q)},!0)}v(S,A)};p(ie,S=>{e(R)?S(T):S(k,!1)},!0)}v(u,H)};p(ae,u=>{e(F)?u(ue):u(ve,!1)})}t(J),v(E,J),ye(),b()}Ie(["click","change"]);export{js as component,hs as universal};
