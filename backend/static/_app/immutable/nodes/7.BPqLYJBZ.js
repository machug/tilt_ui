import{d as Pe,f as c,a as o,c as Be,s as g}from"../chunks/BQ88CgEU.js";import{ao as J,c as e,s as h,ah as Ee,p as Ue,ap as $e,ak as l,ar as we,aj as Ge,e as Re,am as Ve,al as t,an as a,as as w,ai as ue,at as fe}from"../chunks/CGXqq0_G.js";import{e as he,i as me}from"../chunks/payu-7ZH.js";import{i as f}from"../chunks/ziKwUJ4R.js";import{h as He}from"../chunks/BP8qDDK3.js";import{s as je}from"../chunks/BSw_pJTS.js";import{f as Ie,u as Oe,p as qe}from"../chunks/gKtBTYkw.js";const ye=300*1e3;class ze{#e=J(null);get cache(){return e(this.#e)}set cache(b){h(this.#e,b,!0)}async getDevices(b=!1){const D=Date.now();if(!b&&this.cache&&D-this.cache.timestamp<ye)return this.cache.data;const x=await Ie();return this.cache={data:x,timestamp:D},x}invalidate(){this.cache=null}getCachedDevices(){const b=Date.now();return this.cache&&b-this.cache.timestamp<ye?this.cache.data:null}}const z=new ze;var Je=c('<div class="loading-state svelte-j4gi7w">Loading devices...</div>'),Ke=c('<div class="error-state svelte-j4gi7w"><p> </p> <button class="btn-secondary svelte-j4gi7w">Retry</button></div>'),Qe=c('<div class="empty-state svelte-j4gi7w"><p>No paired devices. Pair a device below to start logging readings.</p></div>'),We=c('<div class="device-color-badge svelte-j4gi7w"></div>'),Xe=c('<div class="device-type-badge svelte-j4gi7w"><span class="device-type-label svelte-j4gi7w"> </span></div>'),Ye=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Beer Name:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),Ze=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">MAC:</span> <span class="detail-value mono svelte-j4gi7w"> </span></div>'),ea=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Battery:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),aa=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Firmware:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),ta=c('<div class="device-card paired svelte-j4gi7w"><div class="device-header svelte-j4gi7w"><div class="device-info svelte-j4gi7w"><!> <div><h3 class="device-name svelte-j4gi7w"> </h3> <p class="device-id svelte-j4gi7w"> </p></div></div> <div class="device-status paired svelte-j4gi7w"><span class="status-dot svelte-j4gi7w"></span> Paired</div></div> <div class="device-details svelte-j4gi7w"><!> <div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Last Seen:</span> <span class="detail-value svelte-j4gi7w"> </span></div> <!> <!> <!></div> <button class="btn-secondary btn-sm svelte-j4gi7w">Unpair Device</button></div>'),sa=c('<div class="device-grid svelte-j4gi7w"></div>'),ia=c('<div class="empty-state svelte-j4gi7w"><p>No unpaired devices detected. Make sure your devices are broadcasting and within range.</p></div>'),ra=c('<div class="device-color-badge svelte-j4gi7w"></div>'),va=c('<div class="device-type-badge svelte-j4gi7w"><span class="device-type-label svelte-j4gi7w"> </span></div>'),la=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">MAC:</span> <span class="detail-value mono svelte-j4gi7w"> </span></div>'),na=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Battery:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),da=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Firmware:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),oa=c('<div class="device-card unpaired svelte-j4gi7w"><div class="device-header svelte-j4gi7w"><div class="device-info svelte-j4gi7w"><!> <div><h3 class="device-name svelte-j4gi7w"> </h3> <p class="device-id svelte-j4gi7w"> </p></div></div> <div class="device-status unpaired svelte-j4gi7w"><span class="status-dot svelte-j4gi7w"></span> Unpaired</div></div> <div class="device-details svelte-j4gi7w"><div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Last Seen:</span> <span class="detail-value svelte-j4gi7w"> </span></div> <!> <!> <!></div> <button class="btn-primary btn-sm svelte-j4gi7w">Pair Device</button></div>'),ca=c('<div class="device-grid svelte-j4gi7w"></div>'),pa=c('<div class="devices-container svelte-j4gi7w"><section class="device-section svelte-j4gi7w"><h2 class="section-title svelte-j4gi7w"> </h2> <p class="section-description svelte-j4gi7w">These devices are actively logging readings</p> <!></section> <section class="device-section svelte-j4gi7w"><h2 class="section-title svelte-j4gi7w"> </h2> <p class="section-description svelte-j4gi7w">These devices are detected but not logging readings</p> <!></section></div>'),_a=c('<div class="page-header svelte-j4gi7w"><h1 class="page-title svelte-j4gi7w">Devices</h1> <p class="page-description svelte-j4gi7w">Manage your hydrometer devices (Tilt, iSpindel, GravityMon)</p></div> <!>',1);function ya(ne,b){Ee(b,!0);let D=J(Ue([])),x=J(!0),y=J(null);$e(async()=>{const i=z.getCachedDevices();i&&(h(D,i,!0),h(x,!1)),await I()});async function I(i=!1){h(x,!0),h(y,null);try{h(D,await z.getDevices(i),!0)}catch(_){h(y,_ instanceof Error?_.message:"Failed to load devices",!0)}finally{h(x,!1)}}async function be(i){h(y,null);try{await qe(i),z.invalidate(),await I(!0)}catch(_){h(y,_ instanceof Error?_.message:"Failed to pair device",!0)}}async function De(i){h(y,null);try{await Oe(i),z.invalidate(),await I(!0)}catch(_){h(y,_ instanceof Error?_.message:"Failed to unpair device",!0)}}function de(i){if(!i)return"Never seen";const _=Math.floor((Date.now()-new Date(i).getTime())/1e3);if(_<10)return"just now";if(_<60)return`${_}s ago`;const A=Math.floor(_/60);if(A<60)return`${A}m ago`;const P=Math.floor(A/60);return P<24?`${P}h ago`:`${Math.floor(P/24)}d ago`}function oe(i){return i.display_name?i.display_name:i.device_type==="tilt"&&i.color?`${i.color} Tilt`:i.device_type==="ispindel"?`iSpindel ${i.name}`:i.device_type==="gravitymon"?`GravityMon ${i.name}`:i.name}function ce(i){return{tilt:"Tilt",ispindel:"iSpindel",gravitymon:"GravityMon",floaty:"Floaty"}[i]||i}let K=ue(()=>e(D).filter(i=>i.paired)),Q=ue(()=>e(D).filter(i=>!i.paired));var pe=_a();He("j4gi7w",i=>{Re(()=>{Ve.title="Devices | BrewSignal"})});var xe=l(we(pe),2);{var Me=i=>{var _=Je();o(i,_)},Ce=i=>{var _=Be(),A=we(_);{var P=L=>{var M=Ke(),C=t(M),B=t(C,!0);a(C);var W=l(C,2);W.__click=()=>I(!0),a(M),w(()=>g(B,e(y))),o(L,M)},_e=L=>{var M=pa(),C=t(M),B=t(C),W=t(B);a(B);var Fe=l(B,4);{var ke=u=>{var m=Qe();o(u,m)},Ne=u=>{var m=sa();he(m,21,()=>e(K),me,(Y,r)=>{var F=ta(),k=t(F),E=t(k),U=t(E);{var Z=s=>{var v=We();w(p=>je(v,`background: var(--tilt-${p??""})`),[()=>e(r).color.toLowerCase()]),o(s,v)},ee=s=>{var v=Xe(),p=t(v),j=t(p,!0);a(p),a(v),w(le=>g(j,le),[()=>ce(e(r).device_type)]),o(s,v)};f(U,s=>{e(r).device_type==="tilt"&&e(r).color?s(Z):s(ee,!1)})}var $=l(U,2),N=t($),ae=t(N,!0);a(N);var G=l(N,2),te=t(G,!0);a(G),a($),a(E),fe(2),a(k);var T=l(k,2),S=t(T);{var O=s=>{var v=Ye(),p=l(t(v),2),j=t(p,!0);a(p),a(v),w(()=>g(j,e(r).beer_name)),o(s,v)};f(S,s=>{e(r).beer_name&&s(O)})}var R=l(S,2),V=l(t(R),2),se=t(V,!0);a(V),a(R);var H=l(R,2);{var ie=s=>{var v=Ze(),p=l(t(v),2),j=t(p,!0);a(p),a(v),w(()=>g(j,e(r).mac)),o(s,v)};f(H,s=>{e(r).device_type==="tilt"&&e(r).mac&&s(ie)})}var q=l(H,2);{var re=s=>{var v=ea(),p=l(t(v),2),j=t(p);a(p),a(v),w(le=>g(j,`${le??""}V`),[()=>e(r).battery_voltage.toFixed(2)]),o(s,v)};f(q,s=>{(e(r).device_type==="ispindel"||e(r).device_type==="gravitymon")&&Number.isFinite(e(r).battery_voltage)&&s(re)})}var ve=l(q,2);{var n=s=>{var v=aa(),p=l(t(v),2),j=t(p,!0);a(p),a(v),w(()=>g(j,e(r).firmware_version)),o(s,v)};f(ve,s=>{e(r).firmware_version&&s(n)})}a(T);var d=l(T,2);d.__click=()=>De(e(r).id),a(F),w((s,v)=>{g(ae,s),g(te,e(r).id),g(se,v)},[()=>oe(e(r)),()=>de(e(r).last_seen)]),o(Y,F)}),a(m),o(u,m)};f(Fe,u=>{e(K).length===0?u(ke):u(Ne,!1)})}a(C);var ge=l(C,2),X=t(ge),Te=t(X);a(X);var Le=l(X,4);{var Se=u=>{var m=ia();o(u,m)},Ae=u=>{var m=ca();he(m,21,()=>e(Q),me,(Y,r)=>{var F=oa(),k=t(F),E=t(k),U=t(E);{var Z=n=>{var d=ra();w(s=>je(d,`background: var(--tilt-${s??""})`),[()=>e(r).color.toLowerCase()]),o(n,d)},ee=n=>{var d=va(),s=t(d),v=t(s,!0);a(s),a(d),w(p=>g(v,p),[()=>ce(e(r).device_type)]),o(n,d)};f(U,n=>{e(r).device_type==="tilt"&&e(r).color?n(Z):n(ee,!1)})}var $=l(U,2),N=t($),ae=t(N,!0);a(N);var G=l(N,2),te=t(G,!0);a(G),a($),a(E),fe(2),a(k);var T=l(k,2),S=t(T),O=l(t(S),2),R=t(O,!0);a(O),a(S);var V=l(S,2);{var se=n=>{var d=la(),s=l(t(d),2),v=t(s,!0);a(s),a(d),w(()=>g(v,e(r).mac)),o(n,d)};f(V,n=>{e(r).device_type==="tilt"&&e(r).mac&&n(se)})}var H=l(V,2);{var ie=n=>{var d=na(),s=l(t(d),2),v=t(s);a(s),a(d),w(p=>g(v,`${p??""}V`),[()=>e(r).battery_voltage.toFixed(2)]),o(n,d)};f(H,n=>{(e(r).device_type==="ispindel"||e(r).device_type==="gravitymon")&&Number.isFinite(e(r).battery_voltage)&&n(ie)})}var q=l(H,2);{var re=n=>{var d=da(),s=l(t(d),2),v=t(s,!0);a(s),a(d),w(()=>g(v,e(r).firmware_version)),o(n,d)};f(q,n=>{e(r).firmware_version&&n(re)})}a(T);var ve=l(T,2);ve.__click=()=>be(e(r).id),a(F),w((n,d)=>{g(ae,n),g(te,e(r).id),g(R,d)},[()=>oe(e(r)),()=>de(e(r).last_seen)]),o(Y,F)}),a(m),o(u,m)};f(Le,u=>{e(Q).length===0?u(Se):u(Ae,!1)})}a(ge),a(M),w(()=>{g(W,`Paired Devices (${e(K).length??""})`),g(Te,`Detected Devices (${e(Q).length??""})`)}),o(L,M)};f(A,L=>{e(y)?L(P):L(_e,!1)},!0)}o(i,_)};f(xe,i=>{e(x)?i(Me):i(Ce,!1)})}o(ne,pe),Ge()}Pe(["click"]);export{ya as component};
