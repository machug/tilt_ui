import{d as Ke,f as _,e as Qe,a as n,s as x,t as pe,c as Ve}from"./shYhah8v.js";import{aa as We,an as d,p,ai as Xe,b as e,ao as be,s as i,ap as Ze,ad as r,aq as h,ab as $e,ac as s,af as l,ar as C,as as ea,at as Be}from"./DtKnEsEX.js";import{e as z,i as J}from"./hU7ve28I.js";import{i as w}from"./DprM_ape.js";import{r as A,c as aa}from"./BfFIEfaM.js";import{b as k}from"./CKCRqHsA.js";import{b as K}from"./BG8ESxBY.js";import{f as ta,a as sa}from"./DPw5OeXi.js";import{t as la}from"./BgHGPi20.js";var ra=_('<div class="error-banner svelte-8ou9a2"><span class="error-icon svelte-8ou9a2">!</span> </div>'),oa=_("<option> <!></option>"),ia=_('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="recipe">Recipe</label> <select id="recipe" class="form-select svelte-8ou9a2"><option>No recipe (manual batch)</option><!></select> <span class="form-hint svelte-8ou9a2">Select a recipe to auto-fill targets</span></div>'),na=_("<option> </option>"),va=_("<option> <!></option>"),ua=_('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="fg">Measured FG</label> <input type="number" id="fg" class="form-input svelte-8ou9a2" placeholder="1.010" step="0.001" min="0.990" max="1.100"/></div>'),da=_("<option> </option>"),ca=_('<span class="form-hint svelte-8ou9a2">Loading available switches from Home Assistant...</span>'),fa=_('<span class="form-hint svelte-8ou9a2">No switches found in Home Assistant</span>'),ma=_('<span class="form-hint svelte-8ou9a2">Select a switch or input_boolean entity to control the heater</span>'),_a=_('<div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempTarget">Target Temperature (°F)</label> <input type="number" id="tempTarget" class="form-input svelte-8ou9a2" placeholder="68" step="0.5" min="32" max="100"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempHysteresis">Hysteresis (°F)</label> <input type="number" id="tempHysteresis" class="form-input svelte-8ou9a2" placeholder="1.0" step="0.5" min="0.5" max="10"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div></div>'),pa=_('<div class="form-section svelte-8ou9a2"><h3 class="section-title svelte-8ou9a2">Temperature Control</h3> <span class="section-hint svelte-8ou9a2">Link a heater switch from Home Assistant to control fermentation temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="heaterEntity">Heater Switch</label> <select id="heaterEntity" class="form-select svelte-8ou9a2"><option>No heater assigned</option><!></select> <!></div> <!>',1),ba=_('<span class="spinner svelte-8ou9a2"></span> Saving...',1),ha=_('<form class="batch-form svelte-8ou9a2"><div class="form-header svelte-8ou9a2"><h2 class="form-title svelte-8ou9a2"> </h2> <p class="form-description svelte-8ou9a2"> </p></div> <!> <div class="form-body svelte-8ou9a2"><!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="name">Batch Name</label> <input type="text" id="name" class="form-input svelte-8ou9a2" placeholder="e.g., Summer IPA #3" maxlength="200"/> <span class="form-hint svelte-8ou9a2">Optional - defaults to recipe name</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="status">Status</label> <select id="status" class="form-select svelte-8ou9a2"></select></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="device">Tracking Device</label> <select id="device" class="form-select svelte-8ou9a2"><option>No device assigned</option><!></select> <span class="form-hint svelte-8ou9a2">Link a Tilt to track live gravity and temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="brewDate">Brew Date</label> <input type="date" id="brewDate" class="form-input date-input svelte-8ou9a2"/> <span class="form-hint svelte-8ou9a2">DD/MM/YYYY</span></div> <div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="og">Measured OG</label> <input type="number" id="og" class="form-input svelte-8ou9a2" placeholder="1.050" step="0.001" min="0.990" max="1.200"/></div> <!></div> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="notes">Notes</label> <textarea id="notes" class="form-textarea svelte-8ou9a2" placeholder="Brewing notes, observations, etc." rows="3"></textarea></div></div> <div class="form-footer svelte-8ou9a2"><button type="button" class="btn-cancel svelte-8ou9a2">Cancel</button> <button type="submit" class="btn-submit svelte-8ou9a2"><!></button></div></form>');function Ta(Ce,c){We(c,!0);let M=d(p(c.batch?.name||"")),O=d(p(c.batch?.recipe_id||null)),Q=d(p(c.batch?.device_id||null)),V=d(p(c.batch?.status||"planning")),I=d(p(c.batch?.brew_date?c.batch.brew_date.split("T")[0]:"")),L=d(p(c.batch?.measured_og?.toString()||"")),R=d(p(c.batch?.measured_fg?.toString()||"")),W=d(p(c.batch?.notes||"")),Y=d(p(c.batch?.heater_entity_id||"")),G=d(p(c.batch?.temp_target?.toString()||"")),P=d(p(c.batch?.temp_hysteresis?.toString()||"")),X=d(p([])),Z=d(p([])),$=d(!0),U=d(!1),N=d(!1),q=d(null),ke=be(()=>Array.from(la.tilts.values())),he=be(()=>aa.config.ha_enabled);const Ne=[{value:"planning",label:"Planning"},{value:"fermenting",label:"Fermenting"},{value:"conditioning",label:"Conditioning"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}];let F=be(()=>!!c.batch);async function Ae(){i($,!0);try{i(X,await ta(),!0)}catch(a){console.error("Failed to load recipes:",a)}finally{i($,!1)}}async function Me(){if(e(he)){i(U,!0);try{i(Z,await sa(),!0)}catch(a){console.error("Failed to load heater entities:",a)}finally{i(U,!1)}}}async function Oe(a){if(a.preventDefault(),!e(N)){i(N,!0),i(q,null);try{const t={name:e(M)||void 0,status:e(V),device_id:e(Q)||void 0,brew_date:e(I)?new Date(e(I)).toISOString():void 0,measured_og:e(L)?parseFloat(e(L)):void 0,notes:e(W)||void 0,heater_entity_id:e(Y)||void 0,temp_target:e(G)?parseFloat(e(G)):void 0,temp_hysteresis:e(P)?parseFloat(e(P)):void 0};e(F)||(t.recipe_id=e(O)||void 0),e(F)&&e(R)&&(t.measured_fg=parseFloat(e(R))),await c.onSubmit(t)}catch(t){i(q,t instanceof Error?t.message:"Failed to save batch",!0)}finally{i(N,!1)}}}Xe(()=>{if(!e(F)&&e(O)&&!e(M)){const a=e(X).find(t=>t.id===e(O));a&&i(M,a.name,!0)}}),Ze(()=>{Ae(),Me()});var j=ha(),ee=r(j),ae=r(ee),Ie=r(ae,!0);l(ae);var ge=s(ae,2),Le=r(ge,!0);l(ge),l(ee);var ye=s(ee,2);{var Re=a=>{var t=ra(),o=s(r(t));l(t),h(()=>x(o,` ${e(q)??""}`)),n(a,t)};w(ye,a=>{e(q)&&a(Re)})}var te=s(ye,2),xe=r(te);{var Ye=a=>{var t=ia(),o=s(r(t),2),f=r(o);f.value=(f.__value=null)??"";var g=s(f);z(g,17,()=>e(X),J,(D,y)=>{var b=oa(),E=r(b),me=s(E);{var _e=u=>{var m=pe();h(H=>x(m,`(OG: ${H??""})`),[()=>e(y).og_target.toFixed(3)]),n(u,m)};w(me,u=>{e(y).og_target&&u(_e)})}l(b);var v={};h(()=>{x(E,`${e(y).name??""} `),v!==(v=e(y).id)&&(b.value=(b.__value=e(y).id)??"")}),n(D,b)}),l(o),C(2),l(t),h(()=>o.disabled=e($)),K(o,()=>e(O),D=>i(O,D)),n(a,t)};w(xe,a=>{e(F)||a(Ye)})}var se=s(xe,2),we=s(r(se),2);A(we),C(2),l(se);var le=s(se,2),re=s(r(le),2);z(re,21,()=>Ne,J,(a,t)=>{var o=na(),f=r(o,!0);l(o);var g={};h(()=>{x(f,e(t).label),g!==(g=e(t).value)&&(o.value=(o.__value=e(t).value)??"")}),n(a,o)}),l(re),l(le);var oe=s(le,2),ie=s(r(oe),2),ne=r(ie);ne.value=(ne.__value=null)??"";var Ge=s(ne);z(Ge,17,()=>e(ke),J,(a,t)=>{var o=va(),f=r(o),g=s(f);{var D=b=>{var E=pe();h(()=>x(E,`- ${e(t).beer_name??""}`)),n(b,E)};w(g,b=>{e(t).beer_name&&e(t).beer_name!=="Untitled"&&b(D)})}l(o);var y={};h(()=>{x(f,`${e(t).color??""} Tilt `),y!==(y=e(t).id)&&(o.value=(o.__value=e(t).id)??"")}),n(a,o)}),l(ie),C(2),l(oe);var ve=s(oe,2),Se=s(r(ve),2);A(Se),C(2),l(ve);var ue=s(ve,2),de=r(ue),Fe=s(r(de),2);A(Fe),l(de);var Pe=s(de,2);{var Ue=a=>{var t=ua(),o=s(r(t),2);A(o),l(t),k(o,()=>e(R),f=>i(R,f)),n(a,t)};w(Pe,a=>{e(F)&&a(Ue)})}l(ue);var He=s(ue,2);{var qe=a=>{var t=pa(),o=s(Be(t),2),f=s(r(o),2),g=r(f);g.value=g.__value="";var D=s(g);z(D,17,()=>e(Z),J,(v,u)=>{var m=da(),H=r(m);l(m);var T={};h(()=>{x(H,`${e(u).friendly_name??""} (${e(u).state??""})`),T!==(T=e(u).entity_id)&&(m.value=(m.__value=e(u).entity_id)??"")}),n(v,m)}),l(f);var y=s(f,2);{var b=v=>{var u=ca();n(v,u)},E=v=>{var u=Ve(),m=Be(u);{var H=S=>{var B=fa();n(S,B)},T=S=>{var B=ma();n(S,B)};w(m,S=>{e(Z).length===0?S(H):S(T,!1)},!0)}n(v,u)};w(y,v=>{e(U)?v(b):v(E,!1)})}l(o);var me=s(o,2);{var _e=v=>{var u=_a(),m=r(u),H=s(r(m),2);A(H),C(2),l(m);var T=s(m,2),S=s(r(T),2);A(S),C(2),l(T),l(u),k(H,()=>e(G),B=>i(G,B)),k(S,()=>e(P),B=>i(P,B)),n(v,u)};w(me,v=>{e(Y)&&v(_e)})}h(()=>f.disabled=e(U)),K(f,()=>e(Y),v=>i(Y,v)),n(a,t)};w(He,a=>{e(he)&&a(qe)})}var De=s(He,2),Ee=s(r(De),2);ea(Ee),l(De),l(te);var Te=s(te,2),ce=r(Te);ce.__click=function(...a){c.onCancel?.apply(this,a)};var fe=s(ce,2),je=r(fe);{var ze=a=>{var t=ba();C(),n(a,t)},Je=a=>{var t=pe();h(()=>x(t,e(F)?"Save Changes":"Create Batch")),n(a,t)};w(je,a=>{e(N)?a(ze):a(Je,!1)})}l(fe),l(Te),l(j),h(()=>{x(Ie,e(F)?"Edit Batch":"New Batch"),x(Le,e(F)?"Update batch details and measurements":"Create a new fermentation batch"),ce.disabled=e(N),fe.disabled=e(N)}),Qe("submit",j,Oe),k(we,()=>e(M),a=>i(M,a)),K(re,()=>e(V),a=>i(V,a)),K(ie,()=>e(Q),a=>i(Q,a)),k(Se,()=>e(I),a=>i(I,a)),k(Fe,()=>e(L),a=>i(L,a)),k(Ee,()=>e(W),a=>i(W,a)),n(Ce,j),$e()}Ke(["click"]);export{Ta as B};
