import{p as r}from"./BeYMcFNd.js";const t=r({tilts:new Map,connected:!1});let e=null,n=null;function a(){if(e?.readyState===WebSocket.OPEN)return;const s=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;console.log("Connecting to WebSocket:",s),e=new WebSocket(s),e.onopen=()=>{console.log("WebSocket connected"),t.connected=!0,n&&(clearTimeout(n),n=null)},e.onmessage=c=>{try{const o=JSON.parse(c.data);t.tilts.set(o.id,o),t.tilts=new Map(t.tilts)}catch(o){console.error("Failed to parse WebSocket message:",o)}},e.onclose=()=>{console.log("WebSocket disconnected"),t.connected=!1,e=null,n=setTimeout(a,3e3)},e.onerror=c=>{console.error("WebSocket error:",c),e?.close()}}function p(){n&&(clearTimeout(n),n=null),e?.close(),e=null}async function d(l,s){try{if((await fetch(`/api/tilts/${l}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({beer_name:s})})).ok){const o=t.tilts.get(l);return o&&(o.beer_name=s,t.tilts=new Map(t.tilts)),!0}}catch(c){console.error("Failed to update beer name:",c)}return!1}export{a as c,p as d,t,d as u};
