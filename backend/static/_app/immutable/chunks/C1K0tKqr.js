import{d as ze,f as n,a as o,c as we,s as h,e as la,t as Ne}from"./jyAcDmWg.js";import{ah as Je,ao as u,p as y,ap as Ke,s as i,al as s,ak as r,c as e,ai as Se,an as t,aj as Ve,ar as z,as as b,aq as Ae,at as pe,ax as oa}from"./DBUEpBwK.js";import{e as Ce,i as Me}from"./CWBb8vPY.js";import{i as m}from"./Ce0eyuz5.js";import{r as ne}from"./BKC2WXbk.js";import{b as ae}from"./CltIZyO6.js";import{b as Oe}from"./Dx7-2BRZ.js";import{e as We,g as ia}from"./DlMVHRlb.js";import{c as na}from"./D-cBTwJC.js";import{f as va}from"./BssyGhMx.js";var ca=n('<button type="button" class="clear-btn svelte-1m8neh9">Clear Selection</button>'),da=n('<div class="loading svelte-1m8neh9"><div class="spinner svelte-1m8neh9"></div> <p>Loading recipes...</p></div>'),ua=n('<div class="error-box svelte-1m8neh9"><p class="error-text svelte-1m8neh9"> </p></div>'),ma=n('<div class="empty svelte-1m8neh9"><p class="empty-text svelte-1m8neh9">No recipes yet.</p> <a href="/recipes/import" class="import-link svelte-1m8neh9">Import your first recipe</a></div>'),fa=n('<p class="recipe-gravity svelte-1m8neh9"> </p>'),_a=n('<p class="recipe-yeast svelte-1m8neh9"> </p>'),pa=n('<div class="selected-recipe svelte-1m8neh9"><div class="recipe-info svelte-1m8neh9"><p class="recipe-name svelte-1m8neh9"> </p> <!> <!></div></div>'),ha=n('<span class="recipe-item-og svelte-1m8neh9"> </span>'),ba=n('<button type="button" class="recipe-item svelte-1m8neh9"><span class="recipe-item-name svelte-1m8neh9"> </span> <!></button>'),ga=n('<input id="recipe-search" type="text" placeholder="Search recipes..." class="search-input svelte-1m8neh9"/> <div class="recipe-list svelte-1m8neh9"></div>',1),ya=n('<div class="recipe-selector svelte-1m8neh9"><div class="selector-header svelte-1m8neh9"><label for="recipe-search" class="selector-label svelte-1m8neh9">Select Recipe (Optional)</label> <!></div> <!></div>');function xa(Re,c){Je(c,!0);let I=u(y([])),J=u(!0),te=u(null),P=u(""),ve=Se(()=>e(I).filter(v=>!e(P)||v.name.toLowerCase().includes(e(P).toLowerCase())||v.author?.toLowerCase().includes(e(P).toLowerCase()))),g=Se(()=>c.selectedRecipeId?e(I).find(v=>v.id===c.selectedRecipeId):null);Ke(async()=>{try{i(I,await We(),!0)}catch(v){i(te,v instanceof Error?v.message:"Failed to load recipes",!0),console.error("Failed to load recipes:",v)}finally{i(J,!1)}});function ce(v){c.onSelect(v)}function he(){c.onSelect(null)}var K=ya(),V=s(K),de=r(s(V),2);{var ue=v=>{var L=ca();L.__click=he,o(v,L)};m(de,v=>{e(g)&&v(ue)})}t(V);var me=r(V,2);{var be=v=>{var L=da();o(v,L)},Fe=v=>{var L=we(),W=z(L);{var fe=B=>{var X=ua(),S=s(X),ge=s(S,!0);t(S),t(X),b(()=>h(ge,e(te))),o(B,X)},D=B=>{var X=we(),S=z(X);{var ge=G=>{var re=ma();o(G,re)},De=G=>{var re=we(),ke=z(re);{var _e=N=>{var Z=pa(),U=s(Z),$=s(U),A=s($,!0);t($);var j=r($,2);{var M=F=>{var k=fa(),T=s(k);t(k),b((q,se)=>h(T,`${q??""} → ${se??""}`),[()=>e(g).og_target.toFixed(3),()=>e(g).fg_target.toFixed(3)]),o(F,k)};m(j,F=>{e(g).og_target&&e(g).fg_target&&F(M)})}var ee=r(j,2);{var xe=F=>{var k=_a(),T=s(k,!0);t(k),b(()=>h(T,e(g).yeast_name)),o(F,k)};m(ee,F=>{e(g).yeast_name&&F(xe)})}t(U),t(Z),b(()=>h(A,e(g).name)),o(N,Z)},ye=N=>{var Z=ga(),U=z(Z);ne(U);var $=r(U,2);Ce($,21,()=>e(ve),A=>A.id,(A,j)=>{var M=ba();M.__click=()=>ce(e(j));var ee=s(M),xe=s(ee,!0);t(ee);var F=r(ee,2);{var k=T=>{var q=ha(),se=s(q,!0);t(q),b(Ee=>h(se,Ee),[()=>e(j).og_target.toFixed(3)]),o(T,q)};m(F,T=>{e(j).og_target&&T(k)})}t(M),b(()=>h(xe,e(j).name)),o(A,M)}),t($),ae(U,()=>e(P),A=>i(P,A)),o(N,Z)};m(ke,N=>{e(g)?N(_e):N(ye,!1)})}o(G,re)};m(S,G=>{e(I).length===0?G(ge):G(De,!1)},!0)}o(B,X)};m(W,B=>{e(te)?B(fe):B(D,!1)},!0)}o(v,L)};m(me,v=>{e(J)?v(be):v(Fe,!1)})}t(K),o(Re,K),Ve()}ze(["click"]);var wa=n('<div class="error-banner svelte-8ou9a2"><span class="error-icon svelte-8ou9a2">!</span> </div>'),Sa=n('<p class="reference-text svelte-8ou9a2"> <!></p>'),Fa=n('<div class="recipe-reference svelte-8ou9a2"><p class="reference-label svelte-8ou9a2">From Recipe:</p> <!></div>'),Ca=n("<!> <!>",1),Ra=n("<option> </option>"),Da=n('<span class="form-hint svelte-8ou9a2">Loading devices...</span>'),ka=n('<div class="warning-message svelte-8ou9a2"><p class="svelte-8ou9a2">No paired devices available. Please <a href="/devices" class="svelte-8ou9a2">pair a device</a> before creating a batch.</p></div>'),Ea=n("<option> <!></option>"),Ha=n('<select id="device" class="form-select svelte-8ou9a2"><option>No device assigned</option><!></select> <span class="form-hint svelte-8ou9a2">Link a Tilt to track live gravity and temperature</span>',1),Ia=n('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="fg">Measured FG</label> <input type="number" id="fg" class="form-input svelte-8ou9a2" placeholder="1.010" step="0.001" min="0.990" max="1.100"/></div>'),La=n("<option> </option>"),Ta=n('<span class="form-hint svelte-8ou9a2">Loading available switches from Home Assistant...</span>'),Ba=n('<span class="form-hint svelte-8ou9a2">No switches found in Home Assistant</span>'),Na=n('<span class="form-hint svelte-8ou9a2">Select a switch or input_boolean entity to control the heater</span>'),Aa=n('<div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempTarget">Target Temperature (°F)</label> <input type="number" id="tempTarget" class="form-input svelte-8ou9a2" placeholder="68" step="0.5" min="32" max="100"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempHysteresis">Hysteresis (°F)</label> <input type="number" id="tempHysteresis" class="form-input svelte-8ou9a2" placeholder="1.0" step="0.5" min="0.5" max="10"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div></div>'),Ma=n('<div class="form-section svelte-8ou9a2"><h3 class="section-title svelte-8ou9a2">Temperature Control</h3> <span class="section-hint svelte-8ou9a2">Link a heater switch from Home Assistant to control fermentation temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="heaterEntity">Heater Switch</label> <select id="heaterEntity" class="form-select svelte-8ou9a2"><option>No heater assigned</option><!></select> <!></div> <!>',1),Oa=n('<span class="spinner svelte-8ou9a2"></span> Saving...',1),Ya=n('<form class="batch-form svelte-8ou9a2"><div class="form-header svelte-8ou9a2"><h2 class="form-title svelte-8ou9a2"> </h2> <p class="form-description svelte-8ou9a2"> </p></div> <!> <div class="form-body svelte-8ou9a2"><!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="name">Batch Name</label> <input type="text" id="name" class="form-input svelte-8ou9a2" placeholder="e.g., Summer IPA #3" maxlength="200"/> <span class="form-hint svelte-8ou9a2">Optional - defaults to recipe name</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="status">Status</label> <select id="status" class="form-select svelte-8ou9a2"></select></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="device">Tracking Device</label> <!></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="brewDate">Brew Date</label> <input type="date" id="brewDate" class="form-input date-input svelte-8ou9a2"/> <span class="form-hint svelte-8ou9a2">DD/MM/YYYY</span></div> <div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="og">Measured OG</label> <input type="number" id="og" class="form-input svelte-8ou9a2" placeholder="1.050" step="0.001" min="0.990" max="1.200"/></div> <!></div> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="notes">Notes</label> <textarea id="notes" class="form-textarea svelte-8ou9a2" placeholder="Brewing notes, observations, etc." rows="3"></textarea></div></div> <div class="form-footer svelte-8ou9a2"><button type="button" class="btn-cancel svelte-8ou9a2">Cancel</button> <button type="submit" class="btn-submit svelte-8ou9a2"><!></button></div></form>');function Wa(Re,c){Je(c,!0);let I=u(y(c.batch?.name||"")),J=u(y(c.batch?.recipe_id||null)),te=u(y(c.batch?.device_id||null)),P=u(y(c.batch?.status||"planning")),ve=u(y(c.batch?.brew_date?c.batch.brew_date.split("T")[0]:"")),g=u(y(c.batch?.measured_og?.toString()||"")),ce=u(y(c.batch?.measured_fg?.toString()||"")),he=u(y(c.batch?.notes||"")),K=u(y(c.batch?.heater_entity_id||"")),V=u(y(c.batch?.temp_target?.toString()||"")),de=u(y(c.batch?.temp_hysteresis?.toString()||"")),ue=u(y([])),me=u(y([])),be=u(y([])),Fe=u(!0),v=u(!1),L=u(!1),W=u(!1),fe=u(null),D=u(null),B=Se(()=>na.config.ha_enabled);const X=[{value:"planning",label:"Planning"},{value:"fermenting",label:"Fermenting"},{value:"conditioning",label:"Conditioning"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}];let S=Se(()=>!!c.batch);async function ge(){i(Fe,!0);try{i(ue,await We(),!0)}catch(a){console.error("Failed to load recipes:",a)}finally{i(Fe,!1)}}async function De(){i(L,!0);try{i(be,await va(!0),!0)}catch(a){console.error("Failed to load devices:",a)}finally{i(L,!1)}}async function G(){if(e(B)){i(v,!0);try{i(me,await ia(),!0)}catch(a){console.error("Failed to load heater entities:",a)}finally{i(v,!1)}}}function re(a){i(D,a,!0),a?(i(I,a.name,!0),i(J,a.id,!0),a.og_target&&i(g,a.og_target.toString(),!0)):i(J,null)}async function ke(a){if(a.preventDefault(),!e(W)){i(W,!0),i(fe,null);try{const l={name:e(I)||void 0,status:e(P),device_id:e(te)||void 0,brew_date:e(ve)?new Date(e(ve)).toISOString():void 0,measured_og:e(g)?parseFloat(e(g)):void 0,notes:e(he)||void 0,heater_entity_id:e(K)||void 0,temp_target:e(V)?parseFloat(e(V)):void 0,temp_hysteresis:e(de)?parseFloat(e(de)):void 0};e(S)||(l.recipe_id=e(J)||void 0),e(S)&&e(ce)&&(l.measured_fg=parseFloat(e(ce))),await c.onSubmit(l)}catch(l){i(fe,l instanceof Error?l.message:"Failed to save batch",!0)}finally{i(W,!1)}}}Ae(()=>{if(!e(S)&&e(J)&&!e(I)){const a=e(ue).find(l=>l.id===e(J));a&&i(I,a.name,!0)}}),Ae(()=>{e(B)&&e(me).length===0&&!e(v)&&G()}),Ae(()=>{if(c.initialRecipeId&&e(ue).length>0&&!e(D)){const a=e(ue).find(l=>l.id===c.initialRecipeId);a&&re(a)}}),Ke(()=>{ge(),De(),G()});var _e=Ya(),ye=s(_e),N=s(ye),Z=s(N,!0);t(N);var U=r(N,2),$=s(U,!0);t(U),t(ye);var A=r(ye,2);{var j=a=>{var l=wa(),_=r(s(l));t(l),b(()=>h(_,` ${e(fe)??""}`)),o(a,l)};m(A,a=>{e(fe)&&a(j)})}var M=r(A,2),ee=s(M);{var xe=a=>{var l=Ca(),_=z(l);{let x=Se(()=>e(D)?.id);xa(_,{get selectedRecipeId(){return e(x)},onSelect:re})}var C=r(_,2);{var O=x=>{var Y=Fa(),le=r(s(Y),2);{var oe=ie=>{var Q=Sa(),d=s(Q),f=r(d);{var p=E=>{var H=Ne();b((w,R)=>h(H,`(${w??""}-${R??""}°C)`),[()=>e(D).yeast_temp_min.toFixed(0),()=>e(D).yeast_temp_max.toFixed(0)]),o(E,H)};m(f,E=>{e(D).yeast_temp_min&&e(D).yeast_temp_max&&E(p)})}t(Q),b(()=>h(d,`Yeast: ${e(D).yeast_name??""} `)),o(ie,Q)};m(le,ie=>{e(D).yeast_name&&ie(oe)})}t(Y),o(x,Y)};m(C,x=>{e(D)&&x(O)})}o(a,l)};m(ee,a=>{e(S)||a(xe)})}var F=r(ee,2),k=r(s(F),2);ne(k),pe(2),t(F);var T=r(F,2),q=r(s(T),2);Ce(q,21,()=>X,Me,(a,l)=>{var _=Ra(),C=s(_,!0);t(_);var O={};b(()=>{h(C,e(l).label),O!==(O=e(l).value)&&(_.value=(_.__value=e(l).value)??"")}),o(a,_)}),t(q),t(T);var se=r(T,2),Ee=r(s(se),2);{var Xe=a=>{var l=Da();o(a,l)},Ze=a=>{var l=we(),_=z(l);{var C=x=>{var Y=ka();o(x,Y)},O=x=>{var Y=Ha(),le=z(Y),oe=s(le);oe.value=(oe.__value=null)??"";var ie=r(oe);Ce(ie,17,()=>e(be),Me,(Q,d)=>{var f=Ea(),p=s(f),E=r(p);{var H=R=>{var Qe=Ne();b(()=>h(Qe,`- ${e(d).beer_name??""}`)),o(R,Qe)};m(E,R=>{e(d).beer_name&&e(d).beer_name!=="Untitled"&&R(H)})}t(f);var w={};b(()=>{h(p,`${e(d).color??""} Tilt `),w!==(w=e(d).id)&&(f.value=(f.__value=e(d).id)??"")}),o(Q,f)}),t(le),pe(2),Oe(le,()=>e(te),Q=>i(te,Q)),o(x,Y)};m(_,x=>{e(be).length===0?x(C):x(O,!1)},!0)}o(a,l)};m(Ee,a=>{e(L)?a(Xe):a(Ze,!1)})}t(se);var He=r(se,2),Ye=r(s(He),2);ne(Ye),pe(2),t(He);var Ie=r(He,2),Le=s(Ie),Pe=r(s(Le),2);ne(Pe),t(Le);var $e=r(Le,2);{var ea=a=>{var l=Ia(),_=r(s(l),2);ne(_),t(l),ae(_,()=>e(ce),C=>i(ce,C)),o(a,l)};m($e,a=>{e(S)&&a(ea)})}t(Ie);var Ge=r(Ie,2);{var aa=a=>{var l=Ma(),_=r(z(l),2),C=r(s(_),2),O=s(C);O.value=O.__value="";var x=r(O);Ce(x,17,()=>e(me),Me,(d,f)=>{var p=La(),E=s(p);t(p);var H={};b(()=>{h(E,`${e(f).friendly_name??""} (${e(f).state??""})`),H!==(H=e(f).entity_id)&&(p.value=(p.__value=e(f).entity_id)??"")}),o(d,p)}),t(C);var Y=r(C,2);{var le=d=>{var f=Ta();o(d,f)},oe=d=>{var f=we(),p=z(f);{var E=w=>{var R=Ba();o(w,R)},H=w=>{var R=Na();o(w,R)};m(p,w=>{e(me).length===0?w(E):w(H,!1)},!0)}o(d,f)};m(Y,d=>{e(v)?d(le):d(oe,!1)})}t(_);var ie=r(_,2);{var Q=d=>{var f=Aa(),p=s(f),E=r(s(p),2);ne(E),pe(2),t(p);var H=r(p,2),w=r(s(H),2);ne(w),pe(2),t(H),t(f),ae(E,()=>e(V),R=>i(V,R)),ae(w,()=>e(de),R=>i(de,R)),o(d,f)};m(ie,d=>{e(K)&&d(Q)})}b(()=>C.disabled=e(v)),Oe(C,()=>e(K),d=>i(K,d)),o(a,l)};m(Ge,a=>{e(B)&&a(aa)})}var Ue=r(Ge,2),je=r(s(Ue),2);oa(je),t(Ue),t(M);var qe=r(M,2),Te=s(qe);Te.__click=function(...a){c.onCancel?.apply(this,a)};var Be=r(Te,2),ta=s(Be);{var ra=a=>{var l=Oa();pe(),o(a,l)},sa=a=>{var l=Ne();b(()=>h(l,e(S)?"Save Changes":"Create Batch")),o(a,l)};m(ta,a=>{e(W)?a(ra):a(sa,!1)})}t(Be),t(qe),t(_e),b(()=>{h(Z,e(S)?"Edit Batch":"New Batch"),h($,e(S)?"Update batch details and measurements":"Create a new fermentation batch"),Te.disabled=e(W),Be.disabled=e(W)}),la("submit",_e,ke),ae(k,()=>e(I),a=>i(I,a)),Oe(q,()=>e(P),a=>i(P,a)),ae(Ye,()=>e(ve),a=>i(ve,a)),ae(Pe,()=>e(g),a=>i(g,a)),ae(je,()=>e(he),a=>i(he,a)),o(Re,_e),Ve()}ze(["click"]);export{Wa as B};
