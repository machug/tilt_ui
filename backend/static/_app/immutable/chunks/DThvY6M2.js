import{p as d}from"./CGXqq0_G.js";const e=d({tilts:new Map,connected:!1,ambient:null,heater:{state:null,entity_id:null,last_changed:null,available:!1,loading:!1}});let a=null,l=null;function h(){if(a?.readyState===WebSocket.OPEN)return;const n=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;console.log("Connecting to WebSocket:",n),a=new WebSocket(n),a.onopen=()=>{console.log("WebSocket connected"),e.connected=!0,l&&(clearTimeout(l),l=null)},a.onmessage=s=>{try{const t=JSON.parse(s.data);if(t.type==="ambient"){e.ambient={temperature:t.temperature,humidity:t.humidity,timestamp:t.timestamp};return}if(t.type==="control_event"){t.action==="heat_on"?(e.heater.state="on",e.heater.last_changed=t.timestamp):t.action==="heat_off"&&(e.heater.state="off",e.heater.last_changed=t.timestamp);return}const r=t;e.tilts.set(r.id,r),e.tilts=new Map(e.tilts)}catch(t){console.error("Failed to parse WebSocket message:",t)}},a.onclose=()=>{console.log("WebSocket disconnected"),e.connected=!1,a=null,l=setTimeout(h,3e3)},a.onerror=s=>{console.error("WebSocket error:",s),a?.close()}}function u(){l&&(clearTimeout(l),l=null),a?.close(),a=null}let c=null;async function i(){try{e.heater.loading=!0;const o=await fetch("/api/control/heater");if(o.ok){const n=await o.json();e.heater.state=n.state,e.heater.entity_id=n.entity_id,e.heater.last_changed=n.last_changed,e.heater.available=n.available}}catch(o){console.error("Failed to fetch heater state:",o)}finally{e.heater.loading=!1}}function m(o=3e4){i(),c&&clearInterval(c),c=setInterval(i,o)}function p(){c&&(clearInterval(c),c=null)}export{p as a,h as c,u as d,m as s,e as t};
