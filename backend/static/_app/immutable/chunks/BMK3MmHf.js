import{d as sa,f as v,a as i,c as Ce,s as p,e as ya,t as ze}from"./BQ88CgEU.js";import{ah as la,ao as d,p as y,ap as ia,aj as oa,ak as l,al as s,s as o,c as e,ai as O,an as r,ar as $,as as h,aq as Te,at as _e,ax as xa}from"./CGXqq0_G.js";import{e as Re,i as Je}from"./payu-7ZH.js";import{i as m}from"./ziKwUJ4R.js";import{r as ne,s as De}from"./D2zVhfuI.js";import{b as V}from"./CL9D8AtU.js";import{b as Ke}from"./C5J5lxM1.js";import{j as na,k as wa}from"./Bzk6ZTds.js";import{c as G,f as Ca,a as Sa,g as Fa}from"./Do2ytZ8P.js";import{f as Ta}from"./BssyGhMx.js";var Da=v('<button type="button" class="clear-btn svelte-1m8neh9">Clear Selection</button>'),Ra=v('<div class="loading svelte-1m8neh9"><div class="spinner svelte-1m8neh9"></div> <p>Loading recipes...</p></div>'),ka=v('<div class="error-box svelte-1m8neh9"><p class="error-text svelte-1m8neh9"> </p></div>'),Ha=v('<div class="empty svelte-1m8neh9"><p class="empty-text svelte-1m8neh9">No recipes yet.</p> <a href="/recipes/import" class="import-link svelte-1m8neh9">Import your first recipe</a></div>'),Na=v('<p class="recipe-gravity svelte-1m8neh9"> </p>'),Ea=v('<p class="recipe-yeast svelte-1m8neh9"> </p>'),Ia=v('<div class="selected-recipe svelte-1m8neh9"><div class="recipe-info svelte-1m8neh9"><p class="recipe-name svelte-1m8neh9"> </p> <!> <!></div></div>'),La=v('<span class="recipe-item-og svelte-1m8neh9"> </span>'),Ma=v('<button type="button" class="recipe-item svelte-1m8neh9"><span class="recipe-item-name svelte-1m8neh9"> </span> <!></button>'),Ba=v('<input id="recipe-search" type="text" placeholder="Search recipes..." class="search-input svelte-1m8neh9"/> <div class="recipe-list svelte-1m8neh9"></div>',1),Aa=v('<div class="recipe-selector svelte-1m8neh9"><div class="selector-header svelte-1m8neh9"><label for="recipe-search" class="selector-label svelte-1m8neh9">Select Recipe (Optional)</label> <!></div> <!></div>');function Oa(ke,c){la(c,!0);let H=d(y([])),Y=d(!0),ee=d(null),U=d(""),ve=O(()=>e(H).filter(n=>!e(U)||n.name.toLowerCase().includes(e(U).toLowerCase())||n.author?.toLowerCase().includes(e(U).toLowerCase()))),b=O(()=>c.selectedRecipeId?e(H).find(n=>n.id===c.selectedRecipeId):null);ia(async()=>{try{o(H,await na(),!0)}catch(n){o(ee,n instanceof Error?n.message:"Failed to load recipes",!0),console.error("Failed to load recipes:",n)}finally{o(Y,!1)}});function ce(n){c.onSelect(n)}function pe(){c.onSelect(null)}var q=Aa(),he=s(q),He=l(s(he),2);{var Ne=n=>{var D=Da();D.__click=pe,i(n,D)};m(He,n=>{e(b)&&n(Ne)})}r(he);var Ee=l(he,2);{var be=n=>{var D=Ra();i(n,D)},ge=n=>{var D=Ce(),ye=$(D);{var Se=E=>{var S=ka(),te=s(S),xe=s(te,!0);r(te),r(S),h(()=>p(xe,e(ee))),i(E,S)},ae=E=>{var S=Ce(),te=$(S);{var xe=Q=>{var de=Ha();i(Q,de)},Ie=Q=>{var de=Ce(),ue=$(de);{var x=z=>{var g=Ia(),J=s(g),K=s(J),I=s(K,!0);r(K);var L=l(K,2);{var W=F=>{var N=Na(),B=s(N);r(N),h((se,fe)=>p(B,`${se??""} → ${fe??""}`),[()=>e(b).og_target.toFixed(3),()=>e(b).fg_target.toFixed(3)]),i(F,N)};m(L,F=>{e(b).og_target&&e(b).fg_target&&F(W)})}var M=l(L,2);{var re=F=>{var N=Ea(),B=s(N,!0);r(N),h(()=>p(B,e(b).yeast_name)),i(F,N)};m(M,F=>{e(b).yeast_name&&F(re)})}r(J),r(g),h(()=>p(I,e(b).name)),i(z,g)},we=z=>{var g=Ba(),J=$(g);ne(J);var K=l(J,2);Re(K,21,()=>e(ve),I=>I.id,(I,L)=>{var W=Ma();W.__click=()=>ce(e(L));var M=s(W),re=s(M,!0);r(M);var F=l(M,2);{var N=B=>{var se=La(),fe=s(se,!0);r(se),h(Le=>p(fe,Le),[()=>e(L).og_target.toFixed(3)]),i(B,se)};m(F,B=>{e(L).og_target&&B(N)})}r(W),h(()=>p(re,e(L).name)),i(I,W)}),r(K),V(J,()=>e(U),I=>o(U,I)),i(z,g)};m(ue,z=>{e(b)?z(x):z(we,!1)})}i(Q,de)};m(te,Q=>{e(H).length===0?Q(xe):Q(Ie,!1)},!0)}i(E,S)};m(ye,E=>{e(ee)?E(Se):E(ae,!1)},!0)}i(n,D)};m(Ee,n=>{e(Y)?n(be):n(ge,!1)})}r(q),i(ke,q),oa()}sa(["click"]);var Ya=v('<div class="error-banner svelte-8ou9a2"><span class="error-icon svelte-8ou9a2">!</span> </div>'),Ua=v('<p class="reference-text svelte-8ou9a2"> <!></p>'),Pa=v('<div class="recipe-reference svelte-8ou9a2"><p class="reference-label svelte-8ou9a2">From Recipe:</p> <!></div>'),ja=v("<option> </option>"),Ga=v('<span class="form-hint svelte-8ou9a2">Loading devices...</span>'),qa=v('<div class="warning-message svelte-8ou9a2"><p class="svelte-8ou9a2">No paired devices available. Please <a href="/devices" class="svelte-8ou9a2">pair a device</a> before creating a batch.</p></div>'),Qa=v("<option> <!></option>"),za=v('<select id="device" class="form-select svelte-8ou9a2"><option>No device assigned</option><!></select> <span class="form-hint svelte-8ou9a2">Link a Tilt to track live gravity and temperature</span>',1),Ja=v('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="fg">Measured FG</label> <input type="number" id="fg" class="form-input svelte-8ou9a2" placeholder="1.010" step="0.001" min="0.990" max="1.100"/></div>'),Ka=v("<option> </option>"),Wa=v('<span class="form-hint svelte-8ou9a2">Loading available switches from Home Assistant...</span>'),Xa=v('<span class="form-hint svelte-8ou9a2">No switches found in Home Assistant</span>'),Za=v('<span class="form-hint svelte-8ou9a2">Select a switch or input_boolean entity to control the heater</span>'),Va=v('<div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempTarget"> </label> <input type="number" id="tempTarget" class="form-input svelte-8ou9a2" placeholder="68" step="0.5"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempHysteresis"> </label> <input type="number" id="tempHysteresis" class="form-input svelte-8ou9a2" placeholder="1.0" step="0.5"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div></div>'),$a=v('<div class="form-section svelte-8ou9a2"><h3 class="section-title svelte-8ou9a2">Temperature Control</h3> <span class="section-hint svelte-8ou9a2">Link a heater switch from Home Assistant to control fermentation temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="heaterEntity">Heater Switch</label> <select id="heaterEntity" class="form-select svelte-8ou9a2"><option>No heater assigned</option><!></select> <!></div> <!>',1),et=v('<span class="spinner svelte-8ou9a2"></span> Saving...',1),at=v('<form class="batch-form svelte-8ou9a2"><div class="form-header svelte-8ou9a2"><h2 class="form-title svelte-8ou9a2"> </h2> <p class="form-description svelte-8ou9a2"> </p></div> <!> <div class="form-body svelte-8ou9a2"><!> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="name">Batch Name</label> <input type="text" id="name" class="form-input svelte-8ou9a2" placeholder="e.g., Summer IPA #3" maxlength="200"/> <span class="form-hint svelte-8ou9a2">Optional - defaults to recipe name</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="status">Status</label> <select id="status" class="form-select svelte-8ou9a2"></select></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="device">Tracking Device</label> <!></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="brewDate">Brew Date</label> <input type="date" id="brewDate" class="form-input date-input svelte-8ou9a2"/> <span class="form-hint svelte-8ou9a2">DD/MM/YYYY</span></div> <div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="og">Measured OG</label> <input type="number" id="og" class="form-input svelte-8ou9a2" placeholder="1.050" step="0.001" min="0.990" max="1.200"/></div> <!></div> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="notes">Notes</label> <textarea id="notes" class="form-textarea svelte-8ou9a2" placeholder="Brewing notes, observations, etc." rows="3"></textarea></div></div> <div class="form-footer svelte-8ou9a2"><button type="button" class="btn-cancel svelte-8ou9a2">Cancel</button> <button type="submit" class="btn-submit svelte-8ou9a2"><!></button></div></form>');function ut(ke,c){la(c,!0);let H=d(y(c.batch?.name||"")),Y=d(y(c.batch?.recipe_id||null)),ee=d(y(c.batch?.device_id||null)),U=d(y(c.batch?.status||"planning")),ve=d(y(c.batch?.brew_date?c.batch.brew_date.split("T")[0]:"")),b=d(y(c.batch?.measured_og?.toString()||"")),ce=d(y(c.batch?.measured_fg?.toString()||"")),pe=d(y(c.batch?.notes||"")),q=d(y(c.batch?.heater_entity_id||""));function he(a){return a==null?"":G.config.temp_units==="C"?Ca(a).toFixed(1):a.toFixed(1)}function He(a){return a==null?"":G.config.temp_units==="C"?(a*5/9).toFixed(1):a.toFixed(1)}function Ne(a){if(!a)return;const t=parseFloat(a);if(!isNaN(t))return G.config.temp_units==="C"?Sa(t):t}function Ee(a){if(!a)return;const t=parseFloat(a);if(!isNaN(t))return G.config.temp_units==="C"?t*9/5:t}let be=d(y(he(c.batch?.temp_target))),ge=d(y(He(c.batch?.temp_hysteresis))),n=d(y([])),D=d(y([])),ye=d(y([])),Se=d(!0),ae=d(!1),E=d(!1),S=d(!1),te=O(Fa),xe=O(()=>G.config.temp_units==="C"?0:32),Ie=O(()=>G.config.temp_units==="C"?38:100),Q=O(()=>G.config.temp_units==="C"?.3:.5),de=O(()=>G.config.temp_units==="C"?5.5:10),ue=d(null),x=d(null),we=O(()=>G.config.ha_enabled);const z=[{value:"planning",label:"Planning"},{value:"fermenting",label:"Fermenting"},{value:"conditioning",label:"Conditioning"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}];let g=O(()=>!!c.batch);async function J(){o(Se,!0);try{o(n,await na(),!0)}catch(a){console.error("Failed to load recipes:",a)}finally{o(Se,!1)}}async function K(){o(E,!0);try{o(ye,await Ta(!0),!0)}catch(a){console.error("Failed to load devices:",a)}finally{o(E,!1)}}async function I(){if(e(we)){o(ae,!0);try{o(D,await wa(),!0)}catch(a){console.error("Failed to load heater entities:",a)}finally{o(ae,!1)}}}function L(a){o(x,a,!0),a?(o(H,a.name,!0),o(Y,a.id,!0),a.og_target&&o(b,a.og_target.toString(),!0)):o(Y,null)}async function W(a){if(a.preventDefault(),!e(S)){o(S,!0),o(ue,null);try{const t={name:e(H)||void 0,status:e(U),device_id:e(ee)||void 0,brew_date:e(ve)?new Date(e(ve)).toISOString():void 0,measured_og:e(b)?parseFloat(e(b)):void 0,notes:e(pe)||void 0,heater_entity_id:e(q)||void 0,temp_target:Ne(e(be)),temp_hysteresis:Ee(e(ge))};e(g)?t.recipe_id=e(Y)||void 0:t.recipe_id=e(Y)||void 0,e(g)&&e(ce)&&(t.measured_fg=parseFloat(e(ce))),await c.onSubmit(t)}catch(t){o(ue,t instanceof Error?t.message:"Failed to save batch",!0)}finally{o(S,!1)}}}Te(()=>{if(!e(g)&&e(Y)&&!e(H)){const a=e(n).find(t=>t.id===e(Y));a&&o(H,a.name,!0)}}),Te(()=>{e(we)&&e(D).length===0&&!e(ae)&&I()}),Te(()=>{if(c.initialRecipeId&&e(n).length>0&&!e(x)){const a=e(n).find(t=>t.id===c.initialRecipeId);a&&L(a)}}),Te(()=>{if(e(g)&&c.batch?.recipe&&e(n).length>0&&!e(x)){const a=e(n).find(t=>t.id===c.batch.recipe_id);a&&o(x,a,!0)}}),ia(()=>{J(),K(),I()});var M=at(),re=s(M),F=s(re),N=s(F,!0);r(F);var B=l(F,2),se=s(B,!0);r(B),r(re);var fe=l(re,2);{var Le=a=>{var t=Ya(),_=l(s(t));r(t),h(()=>p(_,` ${e(ue)??""}`)),i(a,t)};m(fe,a=>{e(ue)&&a(Le)})}var Me=l(fe,2),We=s(Me);{let a=O(()=>e(x)?.id);Oa(We,{get selectedRecipeId(){return e(a)},onSelect:L})}var Xe=l(We,2);{var va=a=>{var t=Pa(),_=l(s(t),2);{var T=R=>{var k=Ua(),P=s(k),le=l(P);{var ie=oe=>{var X=ze();h((u,f)=>p(X,`(${u??""}-${f??""}°C)`),[()=>e(x).yeast_temp_min.toFixed(0),()=>e(x).yeast_temp_max.toFixed(0)]),i(oe,X)};m(le,oe=>{e(x).yeast_temp_min&&e(x).yeast_temp_max&&oe(ie)})}r(k),h(()=>p(P,`Yeast: ${e(x).yeast_name??""} `)),i(R,k)};m(_,R=>{e(x).yeast_name&&R(T)})}r(t),i(a,t)};m(Xe,a=>{e(x)&&a(va)})}var Be=l(Xe,2),Ze=l(s(Be),2);ne(Ze),_e(2),r(Be);var Ae=l(Be,2),Oe=l(s(Ae),2);Re(Oe,21,()=>z,Je,(a,t)=>{var _=ja(),T=s(_,!0);r(_);var R={};h(()=>{p(T,e(t).label),R!==(R=e(t).value)&&(_.value=(_.__value=e(t).value)??"")}),i(a,_)}),r(Oe),r(Ae);var Ye=l(Ae,2),ca=l(s(Ye),2);{var da=a=>{var t=Ga();i(a,t)},ua=a=>{var t=Ce(),_=$(t);{var T=k=>{var P=qa();i(k,P)},R=k=>{var P=za(),le=$(P),ie=s(le);ie.value=(ie.__value=null)??"";var oe=l(ie);Re(oe,17,()=>e(ye),Je,(X,u)=>{var f=Qa(),w=s(f),j=l(w);{var Z=A=>{var me=ze();h(()=>p(me,`- ${e(u).beer_name??""}`)),i(A,me)};m(j,A=>{e(u).beer_name&&e(u).beer_name!=="Untitled"&&A(Z)})}r(f);var C={};h(()=>{p(w,`${e(u).color??""} Tilt `),C!==(C=e(u).id)&&(f.value=(f.__value=e(u).id)??"")}),i(X,f)}),r(le),_e(2),Ke(le,()=>e(ee),X=>o(ee,X)),i(k,P)};m(_,k=>{e(ye).length===0?k(T):k(R,!1)},!0)}i(a,t)};m(ca,a=>{e(E)?a(da):a(ua,!1)})}r(Ye);var Ue=l(Ye,2),Ve=l(s(Ue),2);ne(Ve),_e(2),r(Ue);var Pe=l(Ue,2),je=s(Pe),$e=l(s(je),2);ne($e),r(je);var fa=l(je,2);{var ma=a=>{var t=Ja(),_=l(s(t),2);ne(_),r(t),V(_,()=>e(ce),T=>o(ce,T)),i(a,t)};m(fa,a=>{e(g)&&a(ma)})}r(Pe);var ea=l(Pe,2);{var _a=a=>{var t=$a(),_=l($(t),2),T=l(s(_),2),R=s(T);R.value=R.__value="";var k=l(R);Re(k,17,()=>e(D),Je,(u,f)=>{var w=Ka(),j=s(w);r(w);var Z={};h(()=>{p(j,`${e(f).friendly_name??""} (${e(f).state??""})`),Z!==(Z=e(f).entity_id)&&(w.value=(w.__value=e(f).entity_id)??"")}),i(u,w)}),r(T);var P=l(T,2);{var le=u=>{var f=Wa();i(u,f)},ie=u=>{var f=Ce(),w=$(f);{var j=C=>{var A=Xa();i(C,A)},Z=C=>{var A=Za();i(C,A)};m(w,C=>{e(D).length===0?C(j):C(Z,!1)},!0)}i(u,f)};m(P,u=>{e(ae)?u(le):u(ie,!1)})}r(_);var oe=l(_,2);{var X=u=>{var f=Va(),w=s(f),j=s(w),Z=s(j);r(j);var C=l(j,2);ne(C),_e(2),r(w);var A=l(w,2),me=s(A),ga=s(me);r(me);var Fe=l(me,2);ne(Fe),_e(2),r(A),r(f),h(()=>{p(Z,`Target Temperature (${e(te)??""})`),De(C,"min",e(xe)),De(C,"max",e(Ie)),p(ga,`Hysteresis (${e(te)??""})`),De(Fe,"min",e(Q)),De(Fe,"max",e(de))}),V(C,()=>e(be),Qe=>o(be,Qe)),V(Fe,()=>e(ge),Qe=>o(ge,Qe)),i(u,f)};m(oe,u=>{e(q)&&u(X)})}h(()=>T.disabled=e(ae)),Ke(T,()=>e(q),u=>o(q,u)),i(a,t)};m(ea,a=>{e(we)&&a(_a)})}var aa=l(ea,2),ta=l(s(aa),2);xa(ta),r(aa),r(Me);var ra=l(Me,2),Ge=s(ra);Ge.__click=function(...a){c.onCancel?.apply(this,a)};var qe=l(Ge,2),pa=s(qe);{var ha=a=>{var t=et();_e(),i(a,t)},ba=a=>{var t=ze();h(()=>p(t,e(g)?"Save Changes":"Create Batch")),i(a,t)};m(pa,a=>{e(S)?a(ha):a(ba,!1)})}r(qe),r(ra),r(M),h(()=>{p(N,e(g)?"Edit Batch":"New Batch"),p(se,e(g)?"Update batch details and measurements":"Create a new fermentation batch"),Ge.disabled=e(S),qe.disabled=e(S)}),ya("submit",M,W),V(Ze,()=>e(H),a=>o(H,a)),Ke(Oe,()=>e(U),a=>o(U,a)),V(Ve,()=>e(ve),a=>o(ve,a)),V($e,()=>e(b),a=>o(b,a)),V(ta,()=>e(pe),a=>o(pe,a)),i(ke,M),oa()}sa(["click"]);export{ut as B};
