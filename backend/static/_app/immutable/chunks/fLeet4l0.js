import{p as l}from"./BeYMcFNd.js";const o=l({tilts:new Map,connected:!1,ambient:null});let t=null,n=null;function a(){if(t?.readyState===WebSocket.OPEN)return;const c=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;console.log("Connecting to WebSocket:",c),t=new WebSocket(c),t.onopen=()=>{console.log("WebSocket connected"),o.connected=!0,n&&(clearTimeout(n),n=null)},t.onmessage=s=>{try{const e=JSON.parse(s.data);if(e.type==="ambient"){o.ambient={temperature:e.temperature,humidity:e.humidity,timestamp:e.timestamp};return}const i=e;o.tilts.set(i.id,i),o.tilts=new Map(o.tilts)}catch(e){console.error("Failed to parse WebSocket message:",e)}},t.onclose=()=>{console.log("WebSocket disconnected"),o.connected=!1,t=null,n=setTimeout(a,3e3)},t.onerror=s=>{console.error("WebSocket error:",s),t?.close()}}function u(){n&&(clearTimeout(n),n=null),t?.close(),t=null}async function d(r,c){try{if((await fetch(`/api/tilts/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({beer_name:c})})).ok){const e=o.tilts.get(r);return e&&(e.beer_name=c,o.tilts=new Map(o.tilts)),!0}}catch(s){console.error("Failed to update beer name:",s)}return!1}export{a as c,u as d,o as t,d as u};
