import{d as Se,f as g,s as u,a as o,c as Be}from"../chunks/DFbRLFGc.js";import{ah as Te,al as s,ak as l,an as t,as as k,c as r,ai as B,aj as De,at as X,ar as re,ao as z,p as Ce,ap as qe,aq as Oe,s as V,e as Re,am as ze}from"../chunks/-s7GvDYA.js";import{e as Me,i as He}from"../chunks/DSjxYGfQ.js";import{i as f}from"../chunks/DiA6E_7b.js";import{h as Qe}from"../chunks/BsCIOrMO.js";import{s as Je,r as Ke}from"../chunks/CXlnwKpw.js";import{s as _e}from"../chunks/DC-wEq0z.js";import{b as We}from"../chunks/BXlrlxF0.js";import{g as me}from"../chunks/x1uVTr0k.js";import{f as Xe,a as Ye}from"../chunks/DLyiWXp0.js";import{s as se}from"../chunks/CxDjpI2d.js";import{p as Ze}from"../chunks/BPBk5V8z.js";import{b as $e,d as et,e as tt,g as at}from"../chunks/BH1aWYKn.js";import{t as st}from"../chunks/BJZu1gQI.js";var rt=g('<span class="recipe-name svelte-6cd32a"> </span>'),nt=g('<span class="status-dot svelte-6cd32a"></span>'),it=g('<div class="metric svelte-6cd32a"><div class="metric-value temp svelte-6cd32a"> <span class="metric-unit svelte-6cd32a"> </span> <span class="temp-indicator svelte-6cd32a"> </span></div> <div class="metric-label svelte-6cd32a">Temp</div></div>'),lt=g('<div class="metric svelte-6cd32a"><div class="metric-value progress-value svelte-6cd32a"> <span class="metric-unit svelte-6cd32a">%</span></div> <div class="metric-label svelte-6cd32a">Progress</div></div>'),ct=g('<div class="progress-bar-container svelte-6cd32a"><div class="progress-bar svelte-6cd32a"></div> <div class="progress-markers svelte-6cd32a"><span class="svelte-6cd32a">0%</span> <span class="svelte-6cd32a">50%</span> <span class="svelte-6cd32a">100%</span></div></div>'),vt=g('<div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">ABV</span> <span class="stat-value svelte-6cd32a"> </span></div> <div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">Atten</span> <span class="stat-value svelte-6cd32a"> </span></div>',1),ot=g('<div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">Target FG</span> <span class="stat-value svelte-6cd32a"> </span></div>'),dt=g('<button type="button" class="action-btn svelte-6cd32a">View <svg class="action-icon svelte-6cd32a" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" class="svelte-6cd32a"></path></svg></button>'),ut=g('<button type="button" class="expand-btn svelte-6cd32a"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" class="svelte-6cd32a"></path></svg></button>'),gt=g('<div><div class="accent-stripe svelte-6cd32a"></div> <div class="card-content svelte-6cd32a"><div class="header svelte-6cd32a"><div class="header-left svelte-6cd32a"><div class="batch-number svelte-6cd32a"> </div> <div class="title-group svelte-6cd32a"><h3 class="batch-name svelte-6cd32a"> </h3> <!></div></div> <button type="button" class="status-pill svelte-6cd32a"><!> </button></div> <div class="metrics-row svelte-6cd32a"><div class="metric svelte-6cd32a"><div class="metric-value svelte-6cd32a"> <span class="metric-unit svelte-6cd32a"> </span></div> <div class="metric-label svelte-6cd32a"> </div></div> <!> <!></div> <!> <div class="stats-row svelte-6cd32a"><!> <!> <div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">Brewed</span> <span class="stat-value svelte-6cd32a"> </span></div></div> <div class="footer svelte-6cd32a"><span class="brew-date svelte-6cd32a"> </span> <div class="footer-actions svelte-6cd32a"><!> <!></div></div></div></div>');function mt(ne,a){Te(a,!0);let C=Ze(a,"expanded",3,!1);const H={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},E={in_range:{icon:"‚úì",color:"var(--positive)"},too_cold:{icon:"‚Üì",color:"#3b82f6"},too_hot:{icon:"‚Üë",color:"var(--negative)"},unknown:{icon:"?",color:"var(--text-muted)"}};let M=B(()=>H[a.batch.status]||H.planning),Y=B(()=>a.progress?.temperature?.status?E[a.progress.temperature.status]:E.unknown),Z=B($e),S=B(at);function T(e){return e==null?"--":et(e)}function ie(e){return e==null?"--":tt(e)}function $(){if(!a.batch.brew_date)return"--";const e=new Date(a.batch.brew_date),c=Math.floor((new Date().getTime()-e.getTime())/(1e3*60*60*24));return c===0?"Today":c===1?"1 day":`${c} days`}function Q(e){return e?new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"--"}let le=B($),J=B(()=>a.batch.name||a.batch.recipe?.name||"Unnamed Batch");var D=gt();let ee;var N=s(D),I=l(N,2),q=s(I),O=s(q),K=s(O),ce=s(K);t(K);var te=l(K,2),n=s(te),_=s(n,!0);t(n);var m=l(n,2);{var p=e=>{var i=rt(),c=s(i,!0);t(i),k(()=>u(c,a.batch.recipe.name)),o(e,i)};f(m,e=>{a.batch.recipe?.name&&a.batch.name&&a.batch.name!==a.batch.recipe.name&&e(p)})}t(te),t(O);var v=l(O,2);v.__click=()=>a.onStatusChange?.(a.batch.status);var d=s(v);{var w=e=>{var i=nt();o(e,i)};f(d,e=>{a.batch.status==="fermenting"&&e(w)})}var j=l(d);t(v),t(q);var G=l(q,2),L=s(G),x=s(L),y=s(x),F=l(y),U=s(F,!0);t(F),t(x);var R=l(x,2),P=s(R,!0);t(R),t(L);var A=l(L,2);{var ve=e=>{var i=it(),c=s(i),b=s(c),h=l(b),ae=s(h,!0);t(h);var W=l(h,2),ue=s(W,!0);t(W),t(c),X(2),t(i),k(ge=>{se(c,`color: ${r(Y).color??""};`),u(b,`${ge??""} `),u(ae,r(S)),u(ue,r(Y).icon)},[()=>ie(a.progress.temperature.current)]),o(e,i)};f(A,e=>{a.progress?.temperature?.current!=null&&e(ve)})}var Fe=l(A,2);{var Pe=e=>{var i=lt(),c=s(i),b=s(c);X(),t(c),X(2),t(i),k(h=>u(b,`${h??""} `),[()=>a.progress.progress.percent_complete.toFixed(0)]),o(e,i)};f(Fe,e=>{a.progress?.progress?.percent_complete!==void 0&&a.progress.progress.percent_complete!==null&&e(Pe)})}t(G);var pe=l(G,2);{var Ve=e=>{var i=ct(),c=s(i);X(2),t(i),k(()=>se(c,`width: ${a.progress?.progress?.percent_complete??0??""}%;`)),o(e,i)};f(pe,e=>{(a.batch.status==="fermenting"||a.batch.status==="conditioning")&&e(Ve)})}var oe=l(pe,2),fe=s(oe);{var je=e=>{var i=vt(),c=re(i),b=l(s(c),2),h=s(b);t(b),t(c);var ae=l(c,2),W=l(s(ae),2),ue=s(W);t(W),t(ae),k((ge,Ie)=>{u(h,`${ge??""}%`),u(ue,`${Ie??""}%`)},[()=>a.progress.measured.abv?.toFixed(1)??"--",()=>a.progress.measured.attenuation?.toFixed(0)??"--"]),o(e,i)};f(fe,e=>{a.batch.measured_og&&a.progress?.measured?.current_sg&&e(je)})}var be=l(fe,2);{var Ge=e=>{var i=ot(),c=l(s(i),2),b=s(c,!0);t(c),t(i),k(h=>u(b,h),[()=>T(a.progress.targets.fg)]),o(e,i)};f(be,e=>{a.progress?.targets?.fg&&e(Ge)})}var he=l(be,2),we=l(s(he),2),Le=s(we,!0);t(we),t(he),t(oe);var xe=l(oe,2),de=s(xe),Ue=s(de,!0);t(de);var ye=l(de,2),ke=s(ye);{var Ae=e=>{var i=dt();i.__click=function(...c){a.onViewDetails?.apply(this,c)},o(e,i)};f(ke,e=>{a.onViewDetails&&e(Ae)})}var Ee=l(ke,2);{var Ne=e=>{var i=ut();i.__click=function(...h){a.onToggleExpand?.apply(this,h)};var c=s(i);let b;t(i),k(()=>{Je(i,"aria-label",C()?"Collapse":"Expand"),b=_e(c,0,"expand-icon svelte-6cd32a",null,b,{"rotate-180":C()})}),o(e,i)};f(Ee,e=>{a.onToggleExpand&&e(Ne)})}t(ye),t(xe),t(I),t(D),k((e,i)=>{ee=_e(D,1,"batch-card svelte-6cd32a",null,ee,{expanded:C(),fermenting:a.batch.status==="fermenting"}),se(N,`background: ${r(M).color??""};`),u(ce,`#${(a.batch.batch_number||"?")??""}`),u(_,r(J)),se(v,`color: ${r(M).color??""}; background: ${r(M).bg??""};`),u(j,` ${r(M).label??""}`),u(y,`${e??""} `),u(U,r(Z)!=="SG"?r(Z):""),u(P,a.progress?.measured?.current_sg?"Current":"OG"),u(Le,r(le)),u(Ue,i)},[()=>T(a.progress?.measured?.current_sg??a.batch.measured_og),()=>Q(a.batch.brew_date)]),o(ne,D),De()}Se(["click"]);var _t=g('<button type="button"> </button>'),pt=g('<div class="loading-state svelte-40gn7n"><div class="spinner svelte-40gn7n"></div> <span>Loading batches...</span></div>'),ft=g('<div class="error-state svelte-40gn7n"><span class="error-icon svelte-40gn7n">!</span> <p> </p> <button type="button" class="retry-btn svelte-40gn7n">Retry</button></div>'),bt=g('<div class="empty-icon svelte-40gn7n">üç∫</div> <h3 class="svelte-40gn7n">No batches yet</h3> <p class="svelte-40gn7n">Create your first batch to start tracking fermentation</p> <button type="button" class="create-btn svelte-40gn7n">Create Batch</button>',1),ht=g('<div class="empty-icon svelte-40gn7n">üîç</div> <h3 class="svelte-40gn7n">No matches</h3> <p class="svelte-40gn7n">Try adjusting your filters or search query</p>',1),wt=g('<div class="empty-state svelte-40gn7n"><!></div>'),xt=g('<div class="batches-grid svelte-40gn7n"></div>'),yt=g('<div class="page-container svelte-40gn7n"><div class="page-header svelte-40gn7n"><div class="header-content svelte-40gn7n"><h1 class="page-title svelte-40gn7n">Batches</h1> <p class="page-description svelte-40gn7n">Track your fermentation batches</p></div> <button type="button" class="create-btn svelte-40gn7n"><svg class="btn-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg> New Batch</button></div> <div class="filters-row svelte-40gn7n"><div class="filter-chips svelte-40gn7n"></div> <div class="search-box svelte-40gn7n"><svg class="search-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input type="text" placeholder="Search batches..." class="search-input svelte-40gn7n"/></div></div> <!></div>');function At(ne,a){Te(a,!0);let C=z(Ce([])),H=z(Ce(new Map)),E=z(!0),M=z(null),Y=B(()=>new Map(r(C).filter(n=>n.device_id&&(n.status==="fermenting"||n.status==="conditioning")).map(n=>[n.device_id,n.id]))),Z=B(()=>{const n=new Map(r(H));for(const[_,m]of r(Y)){const p=st.tilts.get(_);if(p){const v=n.get(m)||{batch_id:m,measured:{},temperature:{},progress:{},targets:{}};n.set(m,{...v,measured:{...v.measured,current_sg:p.sg},temperature:{...v.temperature,current:p.temp,status:v.temperature?.yeast_min!==void 0&&v.temperature?.yeast_max!==void 0?p.temp<v.temperature.yeast_min?"too_cold":p.temp>v.temperature.yeast_max?"too_hot":"in_range":v.temperature?.status}})}}return n}),S=z(""),T=z("");const ie=[{value:"",label:"All Batches"},{value:"planning",label:"Planning"},{value:"fermenting",label:"Fermenting"},{value:"conditioning",label:"Conditioning"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}];let $=B(()=>r(C).filter(n=>{const _=!r(S)||n.status===r(S),m=!r(T)||(n.name?.toLowerCase().includes(r(T).toLowerCase())??!1)||(n.recipe?.name?.toLowerCase().includes(r(T).toLowerCase())??!1);return _&&m}));async function Q(){V(E,!0),V(M,null);try{V(C,await Xe(r(S)||void 0),!0);const n=["fermenting","conditioning"],m=r(C).filter(d=>n.includes(d.status)).map(async d=>{try{const w=await Ye(d.id);return[d.id,w]}catch{return null}}),p=await Promise.all(m),v=new Map;for(const d of p)d&&v.set(d[0],d[1]);V(H,v,!0)}catch(n){V(M,n instanceof Error?n.message:"Failed to load batches",!0)}finally{V(E,!1)}}function le(n){me(`/batches/${n}`)}qe(()=>{Q()}),Oe(()=>{r(S)!==void 0&&Q()});var J=yt();Qe("40gn7n",n=>{Re(()=>{ze.title="Batches | BrewSignal"})});var D=s(J),ee=l(s(D),2);ee.__click=()=>me("/batches/new"),t(D);var N=l(D,2),I=s(N);Me(I,21,()=>ie,He,(n,_)=>{var m=_t();let p;m.__click=()=>V(S,r(_).value,!0);var v=s(m,!0);t(m),k(()=>{p=_e(m,1,"filter-chip svelte-40gn7n",null,p,{active:r(S)===r(_).value}),u(v,r(_).label)}),o(n,m)}),t(I);var q=l(I,2),O=l(s(q),2);Ke(O),t(q),t(N);var K=l(N,2);{var ce=n=>{var _=pt();o(n,_)},te=n=>{var _=Be(),m=re(_);{var p=d=>{var w=ft(),j=l(s(w),2),G=s(j,!0);t(j);var L=l(j,2);L.__click=Q,t(w),k(()=>u(G,r(M))),o(d,w)},v=d=>{var w=Be(),j=re(w);{var G=x=>{var y=wt(),F=s(y);{var U=P=>{var A=bt(),ve=l(re(A),6);ve.__click=()=>me("/batches/new"),o(P,A)},R=P=>{var A=ht();X(4),o(P,A)};f(F,P=>{r(C).length===0?P(U):P(R,!1)})}t(y),o(x,y)},L=x=>{var y=xt();Me(y,21,()=>r($),F=>F.id,(F,U)=>{{let R=B(()=>r(Z).get(r(U).id));mt(F,{get batch(){return r(U)},get progress(){return r(R)},onViewDetails:()=>le(r(U).id)})}}),t(y),o(x,y)};f(j,x=>{r($).length===0?x(G):x(L,!1)},!0)}o(d,w)};f(m,d=>{r(M)?d(p):d(v,!1)},!0)}o(n,_)};f(K,n=>{r(E)?n(ce):n(te,!1)})}t(J),We(O,()=>r(T),n=>V(T,n)),o(ne,J),De()}Se(["click"]);export{At as component};
