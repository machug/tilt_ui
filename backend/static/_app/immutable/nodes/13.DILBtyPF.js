import{d as Qe,f as d,a as c,b as oe,s as g}from"../chunks/BQ88CgEU.js";import{ah as Ue,ao as w,p as We,ap as Xe,aj as Ye,e as Ze,ak as t,al as a,s as r,am as Ie,c as e,an as s,ai as P,as as M,at as k,ar as fe,av as es}from"../chunks/CGXqq0_G.js";import{e as ge,i as me}from"../chunks/payu-7ZH.js";import{i as _}from"../chunks/ziKwUJ4R.js";import{h as ss}from"../chunks/BP8qDDK3.js";import{r as be,a as we}from"../chunks/D2zVhfuI.js";import{f as as,p as ts,e as is}from"../chunks/JVot2skt.js";var ls=d('<div class="loading-state svelte-y9sisi"><div class="loading-spinner svelte-y9sisi"></div> <span class="svelte-y9sisi">Loading maintenance data...</span></div>'),rs=d('<span class="loading-dot svelte-y9sisi"></span> Refreshing...',1),ns=oe('<svg class="w-3.5 h-3.5 svelte-y9sisi" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" class="svelte-y9sisi"></path></svg> Refresh Report',1),vs=d('<div class="batch-item svelte-y9sisi"><span class="batch-id font-mono svelte-y9sisi"> </span> <span class="batch-count font-mono svelte-y9sisi"> </span></div>'),os=d('<div class="orphaned-summary svelte-y9sisi"><div class="stat-item svelte-y9sisi"><span class="stat-value font-mono text-orange-400 svelte-y9sisi"> </span> <span class="stat-label svelte-y9sisi">Orphaned Readings</span></div> <div class="stat-item svelte-y9sisi"><span class="stat-value font-mono text-orange-400 svelte-y9sisi"> </span> <span class="stat-label svelte-y9sisi">Deleted Batches</span></div></div> <div class="batch-breakdown svelte-y9sisi"><h3 class="breakdown-title svelte-y9sisi">Breakdown by Deleted Batch</h3> <div class="batch-list svelte-y9sisi"></div></div>',1),cs=d('<div class="empty-state svelte-y9sisi"><svg class="w-12 h-12 text-green-500 mb-3 svelte-y9sisi" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" class="svelte-y9sisi"></path></svg> <p class="empty-state-title svelte-y9sisi">No Orphaned Data</p> <p class="empty-state-description svelte-y9sisi">All readings are properly linked to active batches. No cleanup needed.</p></div>'),ds=d('<label class="checkbox-label batch-checkbox svelte-y9sisi"><input type="checkbox" class="checkbox-input svelte-y9sisi"/> <span class="checkbox-text svelte-y9sisi"> <span class="batch-reading-count svelte-y9sisi"> </span></span></label>'),ps=d('<span class="loading-dot svelte-y9sisi"></span> Previewing...',1),us=oe('<svg class="w-4 h-4 svelte-y9sisi" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" class="svelte-y9sisi"></path><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" class="svelte-y9sisi"></path></svg> Preview Cleanup',1),hs=d('<p class="text-muted svelte-y9sisi">Select at least one batch to preview cleanup</p>'),ys=d('<div class="preview-results svelte-y9sisi"><div class="preview-header svelte-y9sisi"><svg class="w-5 h-5 text-orange-400 svelte-y9sisi" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" class="svelte-y9sisi"></path></svg> <span class="preview-title svelte-y9sisi">Preview Results</span></div> <div class="preview-stats svelte-y9sisi"><div class="preview-stat svelte-y9sisi"><span class="preview-label svelte-y9sisi">Total Readings to Delete</span> <span class="preview-value font-mono svelte-y9sisi"> </span></div> <div class="preview-stat svelte-y9sisi"><span class="preview-label svelte-y9sisi">Batches Affected</span> <span class="preview-value font-mono svelte-y9sisi"> </span></div></div></div>'),_s=d('<span class="loading-dot svelte-y9sisi"></span> Deleting...',1),fs=oe('<svg class="w-4 h-4 svelte-y9sisi" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-y9sisi"></path></svg> Execute Cleanup',1),gs=d('<p class="text-muted mt-3 svelte-y9sisi">Preview cleanup first to enable execution</p>'),ms=d('<div class="card svelte-y9sisi"><div class="card-header svelte-y9sisi"><h2 class="card-title svelte-y9sisi">Cleanup Preview</h2></div> <div class="card-body svelte-y9sisi"><p class="section-description mb-4 svelte-y9sisi">Select which deleted batches you want to clean up. Preview the operation before executing.</p> <div class="batch-selection svelte-y9sisi"><div class="selection-header svelte-y9sisi"><label class="checkbox-label svelte-y9sisi"><input type="checkbox" class="checkbox-input svelte-y9sisi"/> <span class="checkbox-text svelte-y9sisi">Select All Batches</span></label></div> <div class="selection-list svelte-y9sisi"></div></div> <div class="action-row svelte-y9sisi"><button type="button" class="btn-warning svelte-y9sisi"><!></button> <!></div> <!></div></div> <div class="card danger-zone svelte-y9sisi"><div class="card-header svelte-y9sisi"><h2 class="card-title svelte-y9sisi">Execute Cleanup</h2></div> <div class="card-body svelte-y9sisi"><p class="section-description danger-text mb-4 svelte-y9sisi"><svg class="w-4 h-4 inline-block mr-1 svelte-y9sisi" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" class="svelte-y9sisi"></path></svg> This action permanently deletes readings and cannot be undone. Preview the cleanup first.</p> <button type="button" class="btn-danger svelte-y9sisi"><!></button> <!></div></div>',1),bs=d('<div class="alert alert-error svelte-y9sisi"><svg class="w-5 h-5 svelte-y9sisi" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-y9sisi"></path></svg> <span class="svelte-y9sisi"> </span></div>'),ws=d('<div class="alert alert-success svelte-y9sisi"><svg class="w-5 h-5 svelte-y9sisi" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" class="svelte-y9sisi"></path></svg> <span class="svelte-y9sisi"> </span></div>'),ks=d('<div class="grid gap-6 svelte-y9sisi"><div class="card svelte-y9sisi"><div class="card-header svelte-y9sisi"><div class="flex items-center justify-between svelte-y9sisi"><h2 class="card-title svelte-y9sisi">Orphaned Data Report</h2> <button type="button" class="btn-secondary-sm svelte-y9sisi"><!></button></div></div> <div class="card-body svelte-y9sisi"><!></div></div> <!> <!> <!></div>'),xs=d('<div class="page-container svelte-y9sisi"><div class="page-header svelte-y9sisi"><h1 class="page-title svelte-y9sisi">Data Maintenance</h1> <p class="page-description svelte-y9sisi">Manage orphaned data and clean up readings linked to deleted batches</p></div> <!></div>');function Os(ke,xe){Ue(xe,!0);let ce=w(!0),$=w(!1),q=w(!1),G=w(!1),m=w(null),u=w(null),h=w(We(new Set)),b=w(null),C=w(null),de=P(()=>e(m)&&e(m).orphaned_readings_count>0),J=P(()=>e(m)?Object.keys(e(m).batches_with_orphans).map(Number):[]),pe=P(()=>e(J).length>0&&e(h).size===e(J).length),Z=P(()=>e(h).size>0),I=P(()=>e(u)!==null&&e(u).total_count>0);async function ee(){try{r(b,null),r(m,await as(),!0)}catch(n){r(b,n instanceof Error?n.message:"Failed to load orphaned data",!0),console.error("Failed to load orphaned data:",n)}}async function Be(){r($,!0),r(b,null),r(C,null),r(u,null),e(h).clear();try{await ee()}finally{r($,!1)}}async function Me(){if(e(Z)){r(q,!0),r(b,null),r(C,null);try{r(u,await ts(Array.from(e(h))),!0)}catch(n){r(b,n instanceof Error?n.message:"Failed to preview cleanup",!0),console.error("Failed to preview cleanup:",n)}finally{r(q,!1)}}}async function je(){if(!(!e(I)||!e(u)||!confirm(`Are you sure you want to permanently delete ${e(u).total_count.toLocaleString()} readings?

This action cannot be undone.`))){r(G,!0),r(b,null),r(C,null);try{const y=await is(Array.from(e(h)));r(C,`Successfully deleted ${y.total_count.toLocaleString()} readings`),r(u,null),e(h).clear(),await ee()}catch(y){r(b,y instanceof Error?y.message:"Failed to execute cleanup",!0),console.error("Failed to execute cleanup:",y)}finally{r(G,!1)}}}function Ce(n){e(h).has(n)?e(h).delete(n):e(h).add(n),r(u,null)}function Le(){e(pe)?e(h).clear():r(h,new Set(e(J)),!0),r(u,null)}Xe(async()=>{await ee(),r(ce,!1)});var se=xs();ss("y9sisi",n=>{Ze(()=>{Ie.title="Data Maintenance | BrewSignal"})});var Se=t(a(se),2);{var De=n=>{var y=ls();c(n,y)},Oe=n=>{var y=ks(),ae=a(y),te=a(ae),ue=a(te),K=t(a(ue),2);K.__click=Be;var Pe=a(K);{var Ae=l=>{var o=rs();k(),c(l,o)},Re=l=>{var o=ns();k(),c(l,o)};_(Pe,l=>{e($)?l(Ae):l(Re,!1)})}s(K),s(ue),s(te);var he=t(te,2),ze=a(he);{var Ee=l=>{var o=os(),p=fe(o),f=a(p),L=a(f),A=a(L,!0);s(L),k(2),s(f);var R=t(f,2),S=a(R),Q=a(S,!0);s(S),k(2),s(R),s(p);var D=t(p,2),x=t(a(D),2);ge(x,21,()=>Object.entries(e(m).batches_with_orphans),me,(z,E)=>{var U=P(()=>es(e(E),2));let ie=()=>e(U)[0],le=()=>e(U)[1];var F=vs(),H=a(F),W=a(H);s(H);var N=t(H,2),j=a(N);s(N),s(F),M(re=>{g(W,`Batch #${ie()??""}`),g(j,`${re??""} readings`)},[()=>le().toLocaleString()]),c(z,F)}),s(x),s(D),M((z,E)=>{g(A,z),g(Q,E)},[()=>e(m).orphaned_readings_count.toLocaleString(),()=>Object.keys(e(m).batches_with_orphans).length]),c(l,o)},Fe=l=>{var o=cs();c(l,o)};_(ze,l=>{e(de)?l(Ee):l(Fe,!1)})}s(he),s(ae);var ye=t(ae,2);{var He=l=>{var o=ms(),p=fe(o),f=t(a(p),2),L=t(a(f),2),A=a(L),R=a(A),S=a(R);be(S),S.__change=Le,k(2),s(R),s(A);var Q=t(A,2);ge(Q,21,()=>e(J),me,(i,v)=>{var O=ds(),B=a(O);be(B),B.__change=()=>Ce(e(v));var T=t(B,2),X=a(T),V=t(X),Y=a(V);s(V),s(T),s(O),M((ne,ve)=>{we(B,ne),g(X,`Batch #${e(v)??""} `),g(Y,`(${ve??""} readings)`)},[()=>e(h).has(e(v)),()=>e(m).batches_with_orphans[e(v)].toLocaleString()]),c(i,O)}),s(Q),s(L);var D=t(L,2),x=a(D);x.__click=Me;var z=a(x);{var E=i=>{var v=ps();k(),c(i,v)},U=i=>{var v=us();k(),c(i,v)};_(z,i=>{e(q)?i(E):i(U,!1)})}s(x);var ie=t(x,2);{var le=i=>{var v=hs();c(i,v)};_(ie,i=>{e(Z)||i(le)})}s(D);var F=t(D,2);{var H=i=>{var v=ys(),O=t(a(v),2),B=a(O),T=t(a(B),2),X=a(T,!0);s(T),s(B);var V=t(B,2),Y=t(a(V),2),ne=a(Y,!0);s(Y),s(V),s(O),s(v),M((ve,Ke)=>{g(X,ve),g(ne,Ke)},[()=>e(u).total_count.toLocaleString(),()=>Object.keys(e(u).batch_breakdown).length]),c(i,v)};_(F,i=>{e(u)&&i(H)})}s(f),s(p);var W=t(p,2),N=t(a(W),2),j=t(a(N),2);j.__click=je;var re=a(j);{var $e=i=>{var v=_s();k(),c(i,v)},qe=i=>{var v=fs();k(),c(i,v)};_(re,i=>{e(G)?i($e):i(qe,!1)})}s(j);var Ge=t(j,2);{var Je=i=>{var v=gs();c(i,v)};_(Ge,i=>{e(I)||i(Je)})}s(N),s(W),M(()=>{we(S,e(pe)),x.disabled=!e(Z)||e(q),j.disabled=!e(I)||e(G)}),c(l,o)};_(ye,l=>{e(de)&&l(He)})}var _e=t(ye,2);{var Ne=l=>{var o=bs(),p=t(a(o),2),f=a(p,!0);s(p),s(o),M(()=>g(f,e(b))),c(l,o)};_(_e,l=>{e(b)&&l(Ne)})}var Te=t(_e,2);{var Ve=l=>{var o=ws(),p=t(a(o),2),f=a(p,!0);s(p),s(o),M(()=>g(f,e(C))),c(l,o)};_(Te,l=>{e(C)&&l(Ve)})}s(y),M(()=>K.disabled=e($)),c(n,y)};_(Se,n=>{e(ce)?n(De):n(Oe,!1)})}s(se),c(ke,se),Ye()}Qe(["click","change"]);export{Os as component};
