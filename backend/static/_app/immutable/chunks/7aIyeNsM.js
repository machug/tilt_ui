import{p as f}from"./CJ9U_lt3.js";const e=f({tilts:new Map,connected:!1,ambient:null,heater:{state:null,entity_id:null,last_changed:null,available:!1,loading:!1}});let r=null,s=null;function d(){if(r?.readyState===WebSocket.OPEN)return;const t=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;console.log("Connecting to WebSocket:",t),r=new WebSocket(t),r.onopen=()=>{console.log("WebSocket connected"),e.connected=!0,s&&(clearTimeout(s),s=null)},r.onmessage=o=>{try{const a=JSON.parse(o.data);if(a.type==="ambient"){e.ambient={temperature:a.temperature,humidity:a.humidity,timestamp:a.timestamp};return}if(a.type==="control_event"){a.action==="heat_on"?(e.heater.state="on",e.heater.last_changed=a.timestamp):a.action==="heat_off"&&(e.heater.state="off",e.heater.last_changed=a.timestamp);return}const l=a;e.tilts.set(l.id,l),e.tilts=new Map(e.tilts)}catch(a){console.error("Failed to parse WebSocket message:",a)}},r.onclose=()=>{console.log("WebSocket disconnected"),e.connected=!1,r=null,s=setTimeout(d,3e3)},r.onerror=o=>{console.error("WebSocket error:",o),r?.close()}}function u(){s&&(clearTimeout(s),s=null),r?.close(),r=null}let i=null;async function c(){try{e.heater.loading=!0;const n=await fetch("/api/control/heater");if(n.ok){const t=await n.json();e.heater.state=t.state,e.heater.entity_id=t.entity_id,e.heater.last_changed=t.last_changed,e.heater.available=t.available}}catch(n){console.error("Failed to fetch heater state:",n)}finally{e.heater.loading=!1}}async function p(n){try{e.heater.loading=!0;const t=await fetch("/api/control/heater",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:n})});if(t.ok){const o=await t.json();if(o.success)return e.heater.state=o.new_state,e.heater.last_changed=new Date().toISOString(),!0}return!1}catch(t){return console.error("Failed to toggle heater:",t),!1}finally{e.heater.loading=!1}}function g(n=3e4){c(),i&&clearInterval(i),i=setInterval(c,n)}function y(){i&&(clearInterval(i),i=null)}async function m(n,t){try{if((await fetch(`/api/tilts/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({beer_name:t})})).ok){const a=e.tilts.get(n);return a&&(a.beer_name=t,e.tilts=new Map(e.tilts)),!0}}catch(o){console.error("Failed to update beer name:",o)}return!1}async function w(n,t){try{if((await fetch(`/api/tilts/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({original_gravity:t})})).ok){const a=e.tilts.get(n);return a&&(a.original_gravity=t,e.tilts=new Map(e.tilts)),!0}}catch(o){console.error("Failed to update original gravity:",o)}return!1}export{p as a,y as b,d as c,u as d,w as e,c as f,g as s,e as t,m as u};
