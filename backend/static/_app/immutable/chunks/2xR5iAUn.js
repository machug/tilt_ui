import{d as qe,f as v,a as i,c as Me,s as p,e as ta,t as Te}from"./VJxl01KV.js";import{ag as Qe,an as u,p as x,ao as ze,s as o,ak as l,aj as r,b as e,ah as de,am as s,ai as Je,aq as ue,ar as h,ap as Be,as as ce,ay as ra}from"./Clf_rkwX.js";import{e as ge,i as Ne}from"./6J4h2roR.js";import{i as m}from"./DNJ1XFdY.js";import{r as ee}from"./BxC6Cf5S.js";import{b as J}from"./C7-835y7.js";import{b as Ae}from"./Dz4jTL_C.js";import{j as Ke,k as sa}from"./BWleEPaN.js";import{t as la}from"./NoyRYRAE.js";import{c as ia}from"./C1peeCbX.js";var oa=v('<button type="button" class="clear-btn svelte-1m8neh9">Clear Selection</button>'),na=v('<div class="loading svelte-1m8neh9"><div class="spinner svelte-1m8neh9"></div> <p>Loading recipes...</p></div>'),va=v('<div class="empty svelte-1m8neh9"><p class="empty-text svelte-1m8neh9">No recipes yet.</p> <a href="/recipes/import" class="import-link svelte-1m8neh9">Import your first recipe</a></div>'),ca=v('<p class="recipe-gravity svelte-1m8neh9"> </p>'),da=v('<p class="recipe-yeast svelte-1m8neh9"> </p>'),ua=v('<div class="selected-recipe svelte-1m8neh9"><div class="recipe-info svelte-1m8neh9"><p class="recipe-name svelte-1m8neh9"> </p> <!> <!></div></div>'),ma=v('<span class="recipe-item-og svelte-1m8neh9"> </span>'),fa=v('<button type="button" class="recipe-item svelte-1m8neh9"><span class="recipe-item-name svelte-1m8neh9"> </span> <!></button>'),_a=v('<input id="recipe-search" type="text" placeholder="Search recipes..." class="search-input svelte-1m8neh9"/> <div class="recipe-list svelte-1m8neh9"></div>',1),pa=v('<div class="recipe-selector svelte-1m8neh9"><div class="selector-header svelte-1m8neh9"><label for="recipe-search" class="selector-label svelte-1m8neh9">Select Recipe (Optional)</label> <!></div> <!></div>');function ha(ye,c){Qe(c,!0);let C=u(x([])),U=u(!0),M=u(""),me=de(()=>e(C).filter(n=>!e(M)||n.name.toLowerCase().includes(e(M).toLowerCase())||n.author?.toLowerCase().includes(e(M).toLowerCase()))),b=de(()=>c.selectedRecipeId?e(C).find(n=>n.id===c.selectedRecipeId):null);ze(async()=>{try{o(C,await Ke(),!0)}catch(n){console.error("Failed to load recipes:",n)}finally{o(U,!1)}});function K(n){c.onSelect(n)}function ae(){c.onSelect(null)}var V=pa(),q=l(V),te=r(l(q),2);{var re=n=>{var g=oa();g.__click=ae,i(n,g)};m(te,n=>{e(b)&&n(re)})}s(q);var se=r(q,2);{var le=n=>{var g=na();i(n,g)},pe=n=>{var g=Me(),ie=ue(g);{var F=D=>{var oe=va();i(D,oe)},xe=D=>{var oe=Me(),E=ue(oe);{var we=O=>{var Q=ua(),R=l(Q),L=l(R),k=l(L,!0);s(L);var Y=r(L,2);{var j=H=>{var w=ca(),T=l(w);s(w),h((X,Z)=>p(T,`${X??""} → ${Z??""}`),[()=>e(b).og_target.toFixed(3),()=>e(b).fg_target.toFixed(3)]),i(H,w)};m(Y,H=>{e(b).og_target&&e(b).fg_target&&H(j)})}var W=r(Y,2);{var ne=H=>{var w=da(),T=l(w,!0);s(w),h(()=>p(T,e(b).yeast_name)),i(H,w)};m(W,H=>{e(b).yeast_name&&H(ne)})}s(R),s(Q),h(()=>p(k,e(b).name)),i(O,Q)},he=O=>{var Q=_a(),R=ue(Q);ee(R);var L=r(R,2);ge(L,21,()=>e(me),k=>k.id,(k,Y)=>{var j=fa();j.__click=()=>K(e(Y));var W=l(j),ne=l(W,!0);s(W);var H=r(W,2);{var w=T=>{var X=ma(),Z=l(X,!0);s(X),h(be=>p(Z,be),[()=>e(Y).og_target.toFixed(3)]),i(T,X)};m(H,T=>{e(Y).og_target&&T(w)})}s(j),h(()=>p(ne,e(Y).name)),i(k,j)}),s(L),J(R,()=>e(M),k=>o(M,k)),i(O,Q)};m(E,O=>{e(b)?O(we):O(he,!1)})}i(D,oe)};m(ie,D=>{e(C).length===0?D(F):D(xe,!1)},!0)}i(n,g)};m(se,n=>{e(U)?n(le):n(pe,!1)})}s(V),i(ye,V),Je()}qe(["click"]);var ba=v('<div class="error-banner svelte-8ou9a2"><span class="error-icon svelte-8ou9a2">!</span> </div>'),ga=v('<p class="reference-text svelte-8ou9a2"> <!></p>'),ya=v('<div class="recipe-reference svelte-8ou9a2"><p class="reference-label svelte-8ou9a2">From Recipe:</p> <!></div>'),xa=v("<!> <!>",1),wa=v("<option> </option>"),Sa=v("<option> <!></option>"),Fa=v('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="fg">Measured FG</label> <input type="number" id="fg" class="form-input svelte-8ou9a2" placeholder="1.010" step="0.001" min="0.990" max="1.100"/></div>'),Ca=v("<option> </option>"),Ra=v('<span class="form-hint svelte-8ou9a2">Loading available switches from Home Assistant...</span>'),ka=v('<span class="form-hint svelte-8ou9a2">No switches found in Home Assistant</span>'),Ha=v('<span class="form-hint svelte-8ou9a2">Select a switch or input_boolean entity to control the heater</span>'),Ia=v('<div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempTarget">Target Temperature (°F)</label> <input type="number" id="tempTarget" class="form-input svelte-8ou9a2" placeholder="68" step="0.5" min="32" max="100"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempHysteresis">Hysteresis (°F)</label> <input type="number" id="tempHysteresis" class="form-input svelte-8ou9a2" placeholder="1.0" step="0.5" min="0.5" max="10"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div></div>'),Da=v('<div class="form-section svelte-8ou9a2"><h3 class="section-title svelte-8ou9a2">Temperature Control</h3> <span class="section-hint svelte-8ou9a2">Link a heater switch from Home Assistant to control fermentation temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="heaterEntity">Heater Switch</label> <select id="heaterEntity" class="form-select svelte-8ou9a2"><option>No heater assigned</option><!></select> <!></div> <!>',1),Ea=v('<span class="spinner svelte-8ou9a2"></span> Saving...',1),La=v('<form class="batch-form svelte-8ou9a2"><div class="form-header svelte-8ou9a2"><h2 class="form-title svelte-8ou9a2"> </h2> <p class="form-description svelte-8ou9a2"> </p></div> <!> <div class="form-body svelte-8ou9a2"><!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="name">Batch Name</label> <input type="text" id="name" class="form-input svelte-8ou9a2" placeholder="e.g., Summer IPA #3" maxlength="200"/> <span class="form-hint svelte-8ou9a2">Optional - defaults to recipe name</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="status">Status</label> <select id="status" class="form-select svelte-8ou9a2"></select></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="device">Tracking Device</label> <select id="device" class="form-select svelte-8ou9a2"><option>No device assigned</option><!></select> <span class="form-hint svelte-8ou9a2">Link a Tilt to track live gravity and temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="brewDate">Brew Date</label> <input type="date" id="brewDate" class="form-input date-input svelte-8ou9a2"/> <span class="form-hint svelte-8ou9a2">DD/MM/YYYY</span></div> <div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="og">Measured OG</label> <input type="number" id="og" class="form-input svelte-8ou9a2" placeholder="1.050" step="0.001" min="0.990" max="1.200"/></div> <!></div> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="notes">Notes</label> <textarea id="notes" class="form-textarea svelte-8ou9a2" placeholder="Brewing notes, observations, etc." rows="3"></textarea></div></div> <div class="form-footer svelte-8ou9a2"><button type="button" class="btn-cancel svelte-8ou9a2">Cancel</button> <button type="submit" class="btn-submit svelte-8ou9a2"><!></button></div></form>');function Ua(ye,c){Qe(c,!0);let C=u(x(c.batch?.name||"")),U=u(x(c.batch?.recipe_id||null)),M=u(x(c.batch?.device_id||null)),me=u(x(c.batch?.status||"planning")),b=u(x(c.batch?.brew_date?c.batch.brew_date.split("T")[0]:"")),K=u(x(c.batch?.measured_og?.toString()||"")),ae=u(x(c.batch?.measured_fg?.toString()||"")),V=u(x(c.batch?.notes||"")),q=u(x(c.batch?.heater_entity_id||"")),te=u(x(c.batch?.temp_target?.toString()||"")),re=u(x(c.batch?.temp_hysteresis?.toString()||"")),se=u(x([])),le=u(x([])),pe=u(!0),n=u(!1),g=u(!1),ie=u(null),F=u(null),xe=de(()=>Array.from(la.tilts.values())),D=de(()=>ia.config.ha_enabled);const oe=[{value:"planning",label:"Planning"},{value:"fermenting",label:"Fermenting"},{value:"conditioning",label:"Conditioning"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}];let E=de(()=>!!c.batch);async function we(){o(pe,!0);try{o(se,await Ke(),!0)}catch(a){console.error("Failed to load recipes:",a)}finally{o(pe,!1)}}async function he(){if(e(D)){o(n,!0);try{o(le,await sa(),!0)}catch(a){console.error("Failed to load heater entities:",a)}finally{o(n,!1)}}}function O(a){o(F,a,!0),a?(o(C,a.name,!0),o(U,a.id,!0),a.og_target&&o(K,a.og_target.toString(),!0)):o(U,null)}async function Q(a){if(a.preventDefault(),!e(g)){o(g,!0),o(ie,null);try{const t={name:e(C)||void 0,status:e(me),device_id:e(M)||void 0,brew_date:e(b)?new Date(e(b)).toISOString():void 0,measured_og:e(K)?parseFloat(e(K)):void 0,notes:e(V)||void 0,heater_entity_id:e(q)||void 0,temp_target:e(te)?parseFloat(e(te)):void 0,temp_hysteresis:e(re)?parseFloat(e(re)):void 0};e(E)||(t.recipe_id=e(U)||void 0),e(E)&&e(ae)&&(t.measured_fg=parseFloat(e(ae))),await c.onSubmit(t)}catch(t){o(ie,t instanceof Error?t.message:"Failed to save batch",!0)}finally{o(g,!1)}}}Be(()=>{if(!e(E)&&e(U)&&!e(C)){const a=e(se).find(t=>t.id===e(U));a&&o(C,a.name,!0)}}),Be(()=>{e(D)&&e(le).length===0&&!e(n)&&he()}),Be(()=>{if(c.initialRecipeId&&e(se).length>0&&!e(F)){const a=e(se).find(t=>t.id===c.initialRecipeId);a&&O(a)}}),ze(()=>{we(),he()});var R=La(),L=l(R),k=l(L),Y=l(k,!0);s(k);var j=r(k,2),W=l(j,!0);s(j),s(L);var ne=r(L,2);{var H=a=>{var t=ba(),d=r(l(t));s(t),h(()=>p(d,` ${e(ie)??""}`)),i(a,t)};m(ne,a=>{e(ie)&&a(H)})}var w=r(ne,2),T=l(w);{var X=a=>{var t=xa(),d=ue(t);{let G=de(()=>e(F)?.id);ha(d,{get selectedRecipeId(){return e(G)},onSelect:O})}var y=r(d,2);{var B=G=>{var z=ya(),$=r(l(z),2);{var ve=fe=>{var _e=ga(),f=l(_e),_=r(f);{var S=N=>{var A=Te();h((I,P)=>p(A,`(${I??""}-${P??""}°C)`),[()=>e(F).yeast_temp_min.toFixed(0),()=>e(F).yeast_temp_max.toFixed(0)]),i(N,A)};m(_,N=>{e(F).yeast_temp_min&&e(F).yeast_temp_max&&N(S)})}s(_e),h(()=>p(f,`Yeast: ${e(F).yeast_name??""} `)),i(fe,_e)};m($,fe=>{e(F).yeast_name&&fe(ve)})}s(z),i(G,z)};m(y,G=>{e(F)&&G(B)})}i(a,t)};m(T,a=>{e(E)||a(X)})}var Z=r(T,2),be=r(l(Z),2);ee(be),ce(2),s(Z);var Se=r(Z,2),Fe=r(l(Se),2);ge(Fe,21,()=>oe,Ne,(a,t)=>{var d=wa(),y=l(d,!0);s(d);var B={};h(()=>{p(y,e(t).label),B!==(B=e(t).value)&&(d.value=(d.__value=e(t).value)??"")}),i(a,d)}),s(Fe),s(Se);var Ce=r(Se,2),Re=r(l(Ce),2),ke=l(Re);ke.value=(ke.__value=null)??"";var Ve=r(ke);ge(Ve,17,()=>e(xe),Ne,(a,t)=>{var d=Sa(),y=l(d),B=r(y);{var G=$=>{var ve=Te();h(()=>p(ve,`- ${e(t).beer_name??""}`)),i($,ve)};m(B,$=>{e(t).beer_name&&e(t).beer_name!=="Untitled"&&$(G)})}s(d);var z={};h(()=>{p(y,`${e(t).color??""} Tilt `),z!==(z=e(t).id)&&(d.value=(d.__value=e(t).id)??"")}),i(a,d)}),s(Re),ce(2),s(Ce);var He=r(Ce,2),Oe=r(l(He),2);ee(Oe),ce(2),s(He);var Ie=r(He,2),De=l(Ie),Ye=r(l(De),2);ee(Ye),s(De);var We=r(De,2);{var Xe=a=>{var t=Fa(),d=r(l(t),2);ee(d),s(t),J(d,()=>e(ae),y=>o(ae,y)),i(a,t)};m(We,a=>{e(E)&&a(Xe)})}s(Ie);var je=r(Ie,2);{var Ze=a=>{var t=Da(),d=r(ue(t),2),y=r(l(d),2),B=l(y);B.value=B.__value="";var G=r(B);ge(G,17,()=>e(le),Ne,(f,_)=>{var S=Ca(),N=l(S);s(S);var A={};h(()=>{p(N,`${e(_).friendly_name??""} (${e(_).state??""})`),A!==(A=e(_).entity_id)&&(S.value=(S.__value=e(_).entity_id)??"")}),i(f,S)}),s(y);var z=r(y,2);{var $=f=>{var _=Ra();i(f,_)},ve=f=>{var _=Me(),S=ue(_);{var N=I=>{var P=ka();i(I,P)},A=I=>{var P=Ha();i(I,P)};m(S,I=>{e(le).length===0?I(N):I(A,!1)},!0)}i(f,_)};m(z,f=>{e(n)?f($):f(ve,!1)})}s(d);var fe=r(d,2);{var _e=f=>{var _=Ia(),S=l(_),N=r(l(S),2);ee(N),ce(2),s(S);var A=r(S,2),I=r(l(A),2);ee(I),ce(2),s(A),s(_),J(N,()=>e(te),P=>o(te,P)),J(I,()=>e(re),P=>o(re,P)),i(f,_)};m(fe,f=>{e(q)&&f(_e)})}h(()=>y.disabled=e(n)),Ae(y,()=>e(q),f=>o(q,f)),i(a,t)};m(je,a=>{e(D)&&a(Ze)})}var Ge=r(je,2),Pe=r(l(Ge),2);ra(Pe),s(Ge),s(w);var Ue=r(w,2),Ee=l(Ue);Ee.__click=function(...a){c.onCancel?.apply(this,a)};var Le=r(Ee,2),$e=l(Le);{var ea=a=>{var t=Ea();ce(),i(a,t)},aa=a=>{var t=Te();h(()=>p(t,e(E)?"Save Changes":"Create Batch")),i(a,t)};m($e,a=>{e(g)?a(ea):a(aa,!1)})}s(Le),s(Ue),s(R),h(()=>{p(Y,e(E)?"Edit Batch":"New Batch"),p(W,e(E)?"Update batch details and measurements":"Create a new fermentation batch"),Ee.disabled=e(g),Le.disabled=e(g)}),ta("submit",R,Q),J(be,()=>e(C),a=>o(C,a)),Ae(Fe,()=>e(me),a=>o(me,a)),Ae(Re,()=>e(M),a=>o(M,a)),J(Oe,()=>e(b),a=>o(b,a)),J(Ye,()=>e(K),a=>o(K,a)),J(Pe,()=>e(V),a=>o(V,a)),i(ye,R),Je()}qe(["click"]);export{Ua as B};
