import{d as Ge,f as d,s as _,a as c,c as Fe,t as Ue}from"../chunks/BQ88CgEU.js";import{ah as He,al as s,ak as i,an as a,as as B,c as e,ai as L,aj as Ne,at as pe,ar as fe,ao as W,p as Pe,ap as Re,aq as Ie,s as x,e as qe,am as ze}from"../chunks/CGXqq0_G.js";import{e as Oe}from"../chunks/payu-7ZH.js";import{i as m}from"../chunks/ziKwUJ4R.js";import{h as Qe}from"../chunks/BP8qDDK3.js";import{s as Ye,r as Je}from"../chunks/D2zVhfuI.js";import{s as ae}from"../chunks/DqcjHxzZ.js";import{b as Ke}from"../chunks/CL9D8AtU.js";import{g as Ve}from"../chunks/PXmCD-MB.js";import{a as We,b as Xe,d as Ze,g as $e,r as et,h as tt}from"../chunks/DLtesNQI.js";import{s as Ce}from"../chunks/BSw_pJTS.js";import{p as at}from"../chunks/B3wItnqC.js";import{b as st,d as rt,e as nt,g as it}from"../chunks/CtEhNW1g.js";import{t as lt}from"../chunks/DThvY6M2.js";var ct=d('<span class="recipe-name svelte-6cd32a"> </span>'),ot=d('<span class="status-dot svelte-6cd32a"></span>'),vt=d('<div class="metric svelte-6cd32a"><div class="metric-value temp svelte-6cd32a"> <span class="metric-unit svelte-6cd32a"> </span> <span class="temp-indicator svelte-6cd32a"> </span></div> <div class="metric-label svelte-6cd32a">Temp</div></div>'),dt=d('<div class="metric svelte-6cd32a"><div class="metric-value progress-value svelte-6cd32a"> <span class="metric-unit svelte-6cd32a">%</span></div> <div class="metric-label svelte-6cd32a">Progress</div></div>'),ut=d('<div class="progress-bar-container svelte-6cd32a"><div class="progress-bar svelte-6cd32a"></div> <div class="progress-markers svelte-6cd32a"><span class="svelte-6cd32a">0%</span> <span class="svelte-6cd32a">50%</span> <span class="svelte-6cd32a">100%</span></div></div>'),_t=d('<div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">ABV</span> <span class="stat-value svelte-6cd32a"> </span></div> <div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">Atten</span> <span class="stat-value svelte-6cd32a"> </span></div>',1),gt=d('<div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">Target FG</span> <span class="stat-value svelte-6cd32a"> </span></div>'),mt=d('<button type="button" class="action-btn svelte-6cd32a">View <svg class="action-icon svelte-6cd32a" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" class="svelte-6cd32a"></path></svg></button>'),pt=d('<button type="button" class="expand-btn svelte-6cd32a"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" class="svelte-6cd32a"></path></svg></button>'),ft=d('<div><div class="accent-stripe svelte-6cd32a"></div> <div class="card-content svelte-6cd32a"><div class="header svelte-6cd32a"><div class="header-left svelte-6cd32a"><div class="batch-number svelte-6cd32a"> </div> <div class="title-group svelte-6cd32a"><h3 class="batch-name svelte-6cd32a"> </h3> <!></div></div> <button type="button" class="status-pill svelte-6cd32a"><!> </button></div> <div class="metrics-row svelte-6cd32a"><div class="metric svelte-6cd32a"><div class="metric-value svelte-6cd32a"> <span class="metric-unit svelte-6cd32a"> </span></div> <div class="metric-label svelte-6cd32a"> </div></div> <!> <!></div> <!> <div class="stats-row svelte-6cd32a"><!> <!> <div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">Brewed</span> <span class="stat-value svelte-6cd32a"> </span></div></div> <div class="footer svelte-6cd32a"><span class="brew-date svelte-6cd32a"> </span> <div class="footer-actions svelte-6cd32a"><!> <!></div></div></div></div>');function ht(De,r){He(r,!0);let D=at(r,"expanded",3,!1);const se={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},X={in_range:{icon:"‚úì",color:"var(--positive)"},too_cold:{icon:"‚Üì",color:"#3b82f6"},too_hot:{icon:"‚Üë",color:"var(--negative)"},unknown:{icon:"?",color:"var(--text-muted)"}};let A=L(()=>se[r.batch.status]||se.planning),h=L(()=>r.progress?.temperature?.status?X[r.progress.temperature.status]:X.unknown),H=L(st),F=L(it);function he(t){return t==null?"--":rt(t)}function Me(t){return t==null?"--":nt(t)}function be(){if(!r.batch.brew_date)return"--";const t=new Date(r.batch.brew_date),o=Math.floor((new Date().getTime()-t.getTime())/(1e3*60*60*24));return o===0?"Today":o===1?"1 day":`${o} days`}function z(t){return t?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"--"}let Te=L(be),Se=L(()=>r.batch.name||r.batch.recipe?.name||"Unnamed Batch");var Z=ft();let O;var $=s(Z),re=i($,2),ne=s(re),Q=s(ne),ie=s(Q),le=s(ie);a(ie);var ee=i(ie,2),Y=s(ee),we=s(Y,!0);a(Y);var ce=i(Y,2);{var ye=t=>{var l=ct(),o=s(l,!0);a(l),B(()=>_(o,r.batch.recipe.name)),c(t,l)};m(ce,t=>{r.batch.recipe?.name&&r.batch.name&&r.batch.name!==r.batch.recipe.name&&t(ye)})}a(ee),a(Q);var J=i(Q,2);J.__click=()=>r.onStatusChange?.(r.batch.status);var oe=s(J);{var ke=t=>{var l=ot();c(t,l)};m(oe,t=>{r.batch.status==="fermenting"&&t(ke)})}var xe=i(oe);a(J),a(ne);var ve=i(ne,2),de=s(ve),ue=s(de),n=s(ue),v=i(n),b=s(v,!0);a(v),a(ue);var p=i(ue,2),f=s(p,!0);a(p),a(de);var u=i(de,2);{var j=t=>{var l=vt(),o=s(l),g=s(o),k=i(g),Be=s(k,!0);a(k);var me=i(k,2),Le=s(me,!0);a(me),a(o),pe(2),a(l),B(Ae=>{Ce(o,`color: ${e(h).color??""};`),_(g,`${Ae??""} `),_(Be,e(F)),_(Le,e(h).icon)},[()=>Me(r.progress.temperature.current)]),c(t,l)};m(u,t=>{r.progress?.temperature?.current!=null&&t(j)})}var K=i(u,2);{var _e=t=>{var l=dt(),o=s(l),g=s(o);pe(),a(o),pe(2),a(l),B(k=>_(g,`${k??""} `),[()=>r.progress.progress.percent_complete.toFixed(0)]),c(t,l)};m(K,t=>{r.progress?.progress?.percent_complete!==void 0&&r.progress.progress.percent_complete!==null&&t(_e)})}a(ve);var te=i(ve,2);{var N=t=>{var l=ut(),o=s(l);pe(2),a(l),B(()=>Ce(o,`width: ${r.progress?.progress?.percent_complete??0??""}%;`)),c(t,l)};m(te,t=>{(r.batch.status==="fermenting"||r.batch.status==="conditioning")&&t(N)})}var M=i(te,2),E=s(M);{var w=t=>{var l=_t(),o=fe(l),g=i(s(o),2),k=s(g);a(g),a(o);var Be=i(o,2),me=i(s(Be),2),Le=s(me);a(me),a(Be),B((Ae,Ee)=>{_(k,`${Ae??""}%`),_(Le,`${Ee??""}%`)},[()=>r.progress.measured.abv?.toFixed(1)??"--",()=>r.progress.measured.attenuation?.toFixed(0)??"--"]),c(t,l)};m(E,t=>{r.batch.measured_og&&r.progress?.measured?.current_sg&&t(w)})}var R=i(E,2);{var T=t=>{var l=gt(),o=i(s(l),2),g=s(o,!0);a(o),a(l),B(k=>_(g,k),[()=>he(r.progress.targets.fg)]),c(t,l)};m(R,t=>{r.progress?.targets?.fg&&t(T)})}var U=i(R,2),V=i(s(U),2),ge=s(V,!0);a(V),a(U),a(M);var I=i(M,2),y=s(I),S=s(y,!0);a(y);var P=i(y,2),q=s(P);{var je=t=>{var l=mt();l.__click=function(...o){r.onViewDetails?.apply(this,o)},c(t,l)};m(q,t=>{r.onViewDetails&&t(je)})}var C=i(q,2);{var G=t=>{var l=pt();l.__click=function(...k){r.onToggleExpand?.apply(this,k)};var o=s(l);let g;a(l),B(()=>{Ye(l,"aria-label",D()?"Collapse":"Expand"),g=ae(o,0,"expand-icon svelte-6cd32a",null,g,{"rotate-180":D()})}),c(t,l)};m(C,t=>{r.onToggleExpand&&t(G)})}a(P),a(I),a(re),a(Z),B((t,l)=>{O=ae(Z,1,"batch-card svelte-6cd32a",null,O,{expanded:D(),fermenting:r.batch.status==="fermenting"}),Ce($,`background: ${e(A).color??""};`),_(le,`#${(r.batch.batch_number||"?")??""}`),_(we,e(Se)),Ce(J,`color: ${e(A).color??""}; background: ${e(A).bg??""};`),_(xe,` ${e(A).label??""}`),_(n,`${t??""} `),_(b,e(H)!=="SG"?e(H):""),_(f,r.progress?.measured?.current_sg?"Current":"OG"),_(ge,e(Te)),_(S,l)},[()=>he(r.progress?.measured?.current_sg??r.batch.measured_og),()=>z(r.batch.brew_date)]),c(De,Z),Ne()}Ge(["click"]);var bt=d('<div><span> </span> <button type="button" class="notification-close svelte-40gn7n">√ó</button></div>'),wt=d('<div class="loading-state svelte-40gn7n"><div class="spinner svelte-40gn7n"></div> <span>Loading batches...</span></div>'),yt=d('<div class="error-state svelte-40gn7n"><span class="error-icon svelte-40gn7n">!</span> <p> </p> <button type="button" class="retry-btn svelte-40gn7n">Retry</button></div>'),kt=d('<button type="button" class="create-btn svelte-40gn7n">Create Batch</button>'),xt=d('<div class="empty-icon svelte-40gn7n">üç∫</div> <h3 class="svelte-40gn7n"> </h3> <p class="svelte-40gn7n"><!></p> <!>',1),Bt=d('<div class="empty-icon svelte-40gn7n">üîç</div> <h3 class="svelte-40gn7n">No matches</h3> <p class="svelte-40gn7n">Try adjusting your search query</p>',1),Ct=d('<div class="empty-state svelte-40gn7n"><!></div>'),Dt=d('<div class="deleted-badge svelte-40gn7n"><svg class="badge-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg> </div>'),Mt=d('<div class="batch-actions svelte-40gn7n"><button type="button" class="action-restore svelte-40gn7n"><svg class="action-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Restore</button> <button type="button" class="action-delete svelte-40gn7n"><svg class="action-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg> Permanent Delete</button></div>'),Tt=d('<div class="batch-wrapper svelte-40gn7n"><!> <!> <!></div>'),St=d('<div class="batches-grid svelte-40gn7n"></div>'),jt=d('<div class="page-container svelte-40gn7n"><!> <div class="page-header svelte-40gn7n"><div class="header-content svelte-40gn7n"><h1 class="page-title svelte-40gn7n">Batches</h1> <p class="page-description svelte-40gn7n">Track your fermentation batches</p></div> <button type="button" class="create-btn svelte-40gn7n"><svg class="btn-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg> New Batch</button></div> <div class="tabs-container svelte-40gn7n"><div class="tabs svelte-40gn7n"><button type="button">Active</button> <button type="button">Completed</button> <button type="button">Deleted</button></div> <div class="search-box svelte-40gn7n"><svg class="search-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input type="text" placeholder="Search batches..." class="search-input svelte-40gn7n"/></div></div> <!></div>');function Ot(De,r){He(r,!0);let D=W(Pe([])),se=W(Pe(new Map)),X=W(!0),A=W(null),h=W("active"),H=W(""),F=W(null),he=L(()=>new Map(e(D).filter(n=>n.device_id&&(n.status==="fermenting"||n.status==="conditioning")).map(n=>[n.device_id,n.id]))),Me=L(()=>{const n=new Map(e(se));for(const[v,b]of e(he)){const p=lt.tilts.get(v);if(p){const f=n.get(b)||{batch_id:b,status:"fermenting",measured:{},temperature:{status:"unknown"},progress:{},targets:{}};n.set(b,{...f,measured:{...f.measured,current_sg:p.sg},temperature:{...f.temperature,current:p.temp,status:f.temperature.yeast_min!==void 0&&f.temperature.yeast_max!==void 0?p.temp<f.temperature.yeast_min?"too_cold":p.temp>f.temperature.yeast_max?"too_hot":"in_range":f.temperature.status}})}}return n}),be=L(()=>e(D).filter(n=>!e(H)||(n.name?.toLowerCase().includes(e(H).toLowerCase())??!1)||(n.recipe?.name?.toLowerCase().includes(e(H).toLowerCase())??!1)));async function z(){x(X,!0),x(A,null);try{switch(e(h)){case"active":x(D,await Ze(),!0);break;case"completed":x(D,await Xe(),!0);break;case"deleted":x(D,await We(),!0);break}const n=["fermenting","conditioning"],b=e(D).filter(u=>n.includes(u.status)).map(async u=>{try{const j=await $e(u.id);return[u.id,j]}catch{return null}}),p=await Promise.all(b),f=new Map;for(const u of p)u&&f.set(u[0],u[1]);x(se,f,!0)}catch(n){x(A,n instanceof Error?n.message:"Failed to load batches",!0)}finally{x(X,!1)}}function Te(n){Ve(`/batches/${n}`)}async function Se(n,v){const b=e(h)==="deleted",p=b?"This will permanently delete this batch. This cannot be undone. Are you sure?":`Soft delete "${v}"? You can restore it later from the Deleted tab.`;if(confirm(p))try{await tt(n,b),O("Batch deleted successfully","success"),await z()}catch{O("Failed to delete batch","error")}}async function Z(n,v){try{await et(n),O(`"${v}" restored successfully`,"success"),await z()}catch{O("Failed to restore batch","error")}}function O(n,v){x(F,{message:n,type:v},!0),setTimeout(()=>{x(F,null)},3e3)}Re(()=>{z()}),Ie(()=>{e(h)!==void 0&&z()});var $=jt();Qe("40gn7n",n=>{qe(()=>{ze.title="Batches | BrewSignal"})});var re=s($);{var ne=n=>{var v=bt();let b;var p=s(v),f=s(p,!0);a(p);var u=i(p,2);u.__click=()=>x(F,null),a(v),B(()=>{b=ae(v,1,"notification svelte-40gn7n",null,b,{success:e(F).type==="success",error:e(F).type==="error"}),_(f,e(F).message)}),c(n,v)};m(re,n=>{e(F)&&n(ne)})}var Q=i(re,2),ie=i(s(Q),2);ie.__click=()=>Ve("/batches/new"),a(Q);var le=i(Q,2),ee=s(le),Y=s(ee);let we;Y.__click=()=>x(h,"active");var ce=i(Y,2);let ye;ce.__click=()=>x(h,"completed");var J=i(ce,2);let oe;J.__click=()=>x(h,"deleted"),a(ee);var ke=i(ee,2),xe=i(s(ke),2);Je(xe),a(ke),a(le);var ve=i(le,2);{var de=n=>{var v=wt();c(n,v)},ue=n=>{var v=Fe(),b=fe(v);{var p=u=>{var j=yt(),K=i(s(j),2),_e=s(K,!0);a(K);var te=i(K,2);te.__click=z,a(j),B(()=>_(_e,e(A))),c(u,j)},f=u=>{var j=Fe(),K=fe(j);{var _e=N=>{var M=Ct(),E=s(M);{var w=T=>{var U=xt(),V=i(fe(U),2),ge=s(V);a(V);var I=i(V,2),y=s(I);{var S=C=>{var G=Ue("Create your first batch to start tracking fermentation");c(C,G)},P=C=>{var G=Fe(),t=fe(G);{var l=g=>{var k=Ue("Complete a batch to see it here");c(g,k)},o=g=>{var k=Ue("Deleted batches will appear here");c(g,k)};m(t,g=>{e(h)==="completed"?g(l):g(o,!1)},!0)}c(C,G)};m(y,C=>{e(h)==="active"?C(S):C(P,!1)})}a(I);var q=i(I,2);{var je=C=>{var G=kt();G.__click=()=>Ve("/batches/new"),c(C,G)};m(q,C=>{e(h)==="active"&&C(je)})}B(()=>_(ge,`No ${e(h)??""} batches yet`)),c(T,U)},R=T=>{var U=Bt();pe(4),c(T,U)};m(E,T=>{e(D).length===0?T(w):T(R,!1)})}a(M),c(N,M)},te=N=>{var M=St();Oe(M,21,()=>e(be),E=>E.id,(E,w)=>{var R=Tt(),T=s(R);{var U=y=>{var S=Dt(),P=i(s(S));a(S),B(q=>_(P,` Deleted ${q??""}`),[()=>new Date(e(w).deleted_at).toLocaleDateString()]),c(y,S)};m(T,y=>{e(w).deleted_at&&y(U)})}var V=i(T,2);{let y=L(()=>e(Me).get(e(w).id));ht(V,{get batch(){return e(w)},get progress(){return e(y)},onViewDetails:()=>Te(e(w).id)})}var ge=i(V,2);{var I=y=>{var S=Mt(),P=s(S);P.__click=()=>Z(e(w).id,e(w).name||e(w).recipe?.name||"Unnamed Batch");var q=i(P,2);q.__click=()=>Se(e(w).id,e(w).name||e(w).recipe?.name||"Unnamed Batch"),a(S),c(y,S)};m(ge,y=>{e(w).deleted_at&&y(I)})}a(R),c(E,R)}),a(M),c(N,M)};m(K,N=>{e(be).length===0?N(_e):N(te,!1)},!0)}c(u,j)};m(b,u=>{e(A)?u(p):u(f,!1)},!0)}c(n,v)};m(ve,n=>{e(X)?n(de):n(ue,!1)})}a($),B(()=>{we=ae(Y,1,"tab svelte-40gn7n",null,we,{active:e(h)==="active"}),ye=ae(ce,1,"tab svelte-40gn7n",null,ye,{active:e(h)==="completed"}),oe=ae(J,1,"tab svelte-40gn7n",null,oe,{active:e(h)==="deleted"})}),Ke(xe,()=>e(H),n=>x(H,n)),c(De,$),Ne()}Ge(["click"]);export{Ot as component};
