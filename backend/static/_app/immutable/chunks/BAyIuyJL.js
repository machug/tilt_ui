import{d as qe,f,e as Ve,a as d,s as x,t as ue}from"./shYhah8v.js";import{aa as je,an as c,p as m,ai as ze,b as e,ao as de,s as i,ap as Je,ad as l,aq as g,ab as Ke,ac as s,af as r,ar as B,as as Qe,at as We}from"./DtKnEsEX.js";import{e as ce,i as me}from"./hU7ve28I.js";import{i as w}from"./DprM_ape.js";import{r as C,c as Xe}from"./BBJHTYQq.js";import{s as Ze}from"./DIoJNaxu.js";import{b as F}from"./CKCRqHsA.js";import{b as fe}from"./BG8ESxBY.js";import{f as $e}from"./CFb7vd2n.js";import{t as ea}from"./CYNGKJbs.js";var aa=f('<div class="error-banner svelte-8ou9a2"><span class="error-icon svelte-8ou9a2">!</span> </div>'),ta=f("<option> <!></option>"),sa=f('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="recipe">Recipe</label> <select id="recipe" class="form-select svelte-8ou9a2"><option>No recipe (manual batch)</option><!></select> <span class="form-hint svelte-8ou9a2">Select a recipe to auto-fill targets</span></div>'),ra=f("<option> </option>"),la=f("<option> <!></option>"),oa=f('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="fg">Measured FG</label> <input type="number" id="fg" class="form-input svelte-8ou9a2" placeholder="1.010" step="0.001" min="0.990" max="1.100"/></div>'),ia=f(`<span class="form-error svelte-8ou9a2">Must start with 'switch.' or 'input_boolean.'</span>`),na=f('<span class="form-hint svelte-8ou9a2">e.g., switch.fermenter_heater_1 or input_boolean.fermenter_heater_1</span>'),va=f('<div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempTarget">Target Temperature (°F)</label> <input type="number" id="tempTarget" class="form-input svelte-8ou9a2" placeholder="68" step="0.5" min="32" max="100"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempHysteresis">Hysteresis (°F)</label> <input type="number" id="tempHysteresis" class="form-input svelte-8ou9a2" placeholder="1.0" step="0.5" min="0.5" max="10"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div></div>'),ua=f('<div class="form-section svelte-8ou9a2"><h3 class="section-title svelte-8ou9a2">Temperature Control</h3> <span class="section-hint svelte-8ou9a2">Link a heater switch from Home Assistant to control fermentation temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="heaterEntity">Heater Switch Entity</label> <input type="text" id="heaterEntity" placeholder="switch.fermenter_heater"/> <!></div> <!>',1),da=f('<span class="spinner svelte-8ou9a2"></span> Saving...',1),ca=f('<form class="batch-form svelte-8ou9a2"><div class="form-header svelte-8ou9a2"><h2 class="form-title svelte-8ou9a2"> </h2> <p class="form-description svelte-8ou9a2"> </p></div> <!> <div class="form-body svelte-8ou9a2"><!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="name">Batch Name</label> <input type="text" id="name" class="form-input svelte-8ou9a2" placeholder="e.g., Summer IPA #3" maxlength="200"/> <span class="form-hint svelte-8ou9a2">Optional - defaults to recipe name</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="status">Status</label> <select id="status" class="form-select svelte-8ou9a2"></select></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="device">Tracking Device</label> <select id="device" class="form-select svelte-8ou9a2"><option>No device assigned</option><!></select> <span class="form-hint svelte-8ou9a2">Link a Tilt to track live gravity and temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="brewDate">Brew Date</label> <input type="date" id="brewDate" class="form-input date-input svelte-8ou9a2"/> <span class="form-hint svelte-8ou9a2">DD/MM/YYYY</span></div> <div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="og">Measured OG</label> <input type="number" id="og" class="form-input svelte-8ou9a2" placeholder="1.050" step="0.001" min="0.990" max="1.200"/></div> <!></div> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="notes">Notes</label> <textarea id="notes" class="form-textarea svelte-8ou9a2" placeholder="Brewing notes, observations, etc." rows="3"></textarea></div></div> <div class="form-footer svelte-8ou9a2"><button type="button" class="btn-cancel svelte-8ou9a2">Cancel</button> <button type="submit" class="btn-submit svelte-8ou9a2"><!></button></div></form>');function Sa(Te,n){je(n,!0);let k=c(m(n.batch?.name||"")),H=c(m(n.batch?.recipe_id||null)),q=c(m(n.batch?.device_id||null)),V=c(m(n.batch?.status||"planning")),N=c(m(n.batch?.brew_date?n.batch.brew_date.split("T")[0]:"")),A=c(m(n.batch?.measured_og?.toString()||"")),L=c(m(n.batch?.measured_fg?.toString()||"")),j=c(m(n.batch?.notes||"")),p=c(m(n.batch?.heater_entity_id||"")),R=c(m(n.batch?.temp_target?.toString()||"")),Y=c(m(n.batch?.temp_hysteresis?.toString()||"")),z=c(m([])),J=c(!0),M=c(!1),I=c(null),Ee=de(()=>Array.from(ea.tilts.values())),Be=de(()=>Xe.config.ha_enabled);const Ce=[{value:"planning",label:"Planning"},{value:"fermenting",label:"Fermenting"},{value:"conditioning",label:"Conditioning"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}];let S=de(()=>!!n.batch);function G(a){return/^(switch|input_boolean)\..+$/.test(a)}async function Me(){i(J,!0);try{i(z,await $e(),!0)}catch(a){console.error("Failed to load recipes:",a)}finally{i(J,!1)}}async function ke(a){if(a.preventDefault(),!e(M)){if(e(p)&&!G(e(p))){i(I,"Invalid heater entity format. Must start with 'switch.' or 'input_boolean.'");return}i(M,!0),i(I,null);try{const t={name:e(k)||void 0,status:e(V),device_id:e(q)||void 0,brew_date:e(N)?new Date(e(N)).toISOString():void 0,measured_og:e(A)?parseFloat(e(A)):void 0,notes:e(j)||void 0,heater_entity_id:e(p)||void 0,temp_target:e(R)?parseFloat(e(R)):void 0,temp_hysteresis:e(Y)?parseFloat(e(Y)):void 0};e(S)||(t.recipe_id=e(H)||void 0),e(S)&&e(L)&&(t.measured_fg=parseFloat(e(L))),await n.onSubmit(t)}catch(t){i(I,t instanceof Error?t.message:"Failed to save batch",!0)}finally{i(M,!1)}}}ze(()=>{if(!e(S)&&e(H)&&!e(k)){const a=e(z).find(t=>t.id===e(H));a&&i(k,a.name,!0)}}),Je(()=>{Me()});var P=ca(),K=l(P),Q=l(K),He=l(Q,!0);r(Q);var pe=s(Q,2),Ie=l(pe,!0);r(pe),r(K);var _e=s(K,2);{var Oe=a=>{var t=aa(),o=s(l(t));r(t),g(()=>x(o,` ${e(I)??""}`)),d(a,t)};w(_e,a=>{e(I)&&a(Oe)})}var W=s(_e,2),be=l(W);{var Ne=a=>{var t=sa(),o=s(l(t),2),u=l(o);u.value=(u.__value=null)??"";var y=s(u);ce(y,17,()=>e(z),me,(D,b)=>{var _=ta(),T=l(_),ne=s(T);{var v=E=>{var O=ue();g(U=>x(O,`(OG: ${U??""})`),[()=>e(b).og_target.toFixed(3)]),d(E,O)};w(ne,E=>{e(b).og_target&&E(v)})}r(_);var h={};g(()=>{x(T,`${e(b).name??""} `),h!==(h=e(b).id)&&(_.value=(_.__value=e(b).id)??"")}),d(D,_)}),r(o),B(2),r(t),g(()=>o.disabled=e(J)),fe(o,()=>e(H),D=>i(H,D)),d(a,t)};w(be,a=>{e(S)||a(Ne)})}var X=s(be,2),he=s(l(X),2);C(he),B(2),r(X);var Z=s(X,2),$=s(l(Z),2);ce($,21,()=>Ce,me,(a,t)=>{var o=ra(),u=l(o,!0);r(o);var y={};g(()=>{x(u,e(t).label),y!==(y=e(t).value)&&(o.value=(o.__value=e(t).value)??"")}),d(a,o)}),r($),r(Z);var ee=s(Z,2),ae=s(l(ee),2),te=l(ae);te.value=(te.__value=null)??"";var Ae=s(te);ce(Ae,17,()=>e(Ee),me,(a,t)=>{var o=la(),u=l(o),y=s(u);{var D=_=>{var T=ue();g(()=>x(T,`- ${e(t).beer_name??""}`)),d(_,T)};w(y,_=>{e(t).beer_name&&e(t).beer_name!=="Untitled"&&_(D)})}r(o);var b={};g(()=>{x(u,`${e(t).color??""} Tilt `),b!==(b=e(t).id)&&(o.value=(o.__value=e(t).id)??"")}),d(a,o)}),r(ae),B(2),r(ee);var se=s(ee,2),ge=s(l(se),2);C(ge),B(2),r(se);var re=s(se,2),le=l(re),ye=s(l(le),2);C(ye),r(le);var Le=s(le,2);{var Re=a=>{var t=oa(),o=s(l(t),2);C(o),r(t),F(o,()=>e(L),u=>i(L,u)),d(a,t)};w(Le,a=>{e(S)&&a(Re)})}r(re);var xe=s(re,2);{var Ye=a=>{var t=ua(),o=s(We(t),2),u=s(l(o),2);C(u);let y;var D=s(u,2);{var b=v=>{var h=ia();d(v,h)},_=v=>{var h=na();d(v,h)};w(D,v=>{e(p)&&!G(e(p))?v(b):v(_,!1)})}r(o);var T=s(o,2);{var ne=v=>{var h=va(),E=l(h),O=s(l(E),2);C(O),B(2),r(E);var U=s(E,2),De=s(l(U),2);C(De),B(2),r(U),r(h),F(O,()=>e(R),ve=>i(R,ve)),F(De,()=>e(Y),ve=>i(Y,ve)),d(v,h)};w(T,v=>{e(p)&&G(e(p))&&v(ne)})}g(v=>y=Ze(u,1,"form-input svelte-8ou9a2",null,y,v),[()=>({"input-error":e(p)&&!G(e(p))})]),F(u,()=>e(p),v=>i(p,v)),d(a,t)};w(xe,a=>{e(Be)&&a(Ye)})}var we=s(xe,2),Se=s(l(we),2);Qe(Se),r(we),r(W);var Fe=s(W,2),oe=l(Fe);oe.__click=function(...a){n.onCancel?.apply(this,a)};var ie=s(oe,2),Ge=l(ie);{var Pe=a=>{var t=da();B(),d(a,t)},Ue=a=>{var t=ue();g(()=>x(t,e(S)?"Save Changes":"Create Batch")),d(a,t)};w(Ge,a=>{e(M)?a(Pe):a(Ue,!1)})}r(ie),r(Fe),r(P),g(()=>{x(He,e(S)?"Edit Batch":"New Batch"),x(Ie,e(S)?"Update batch details and measurements":"Create a new fermentation batch"),oe.disabled=e(M),ie.disabled=e(M)}),Ve("submit",P,ke),F(he,()=>e(k),a=>i(k,a)),fe($,()=>e(V),a=>i(V,a)),fe(ae,()=>e(q),a=>i(q,a)),F(ge,()=>e(N),a=>i(N,a)),F(ye,()=>e(A),a=>i(A,a)),F(Se,()=>e(j),a=>i(j,a)),d(Te,P),Ke()}qe(["click"]);export{Sa as B};
