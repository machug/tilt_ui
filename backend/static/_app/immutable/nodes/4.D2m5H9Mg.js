import{d as $e,f as o,s as v,a as l,c as Be}from"../chunks/BQ88CgEU.js";import{al as a,ak as s,an as t,as as g,ah as De,ar as Y,c as e,ai as M,at as Se,aj as Le,ap as Yt,aL as qt,aF as Kt,am as Qt,ao as ge,s as m}from"../chunks/CGXqq0_G.js";import{e as kt,i as xt}from"../chunks/payu-7ZH.js";import{i as c}from"../chunks/ziKwUJ4R.js";import{h as Xt}from"../chunks/BP8qDDK3.js";import{s as zt}from"../chunks/D2zVhfuI.js";import{s as ze}from"../chunks/DqcjHxzZ.js";import{s as Ve}from"../chunks/BSw_pJTS.js";import{i as Zt,s as $t}from"../chunks/C5J5lxM1.js";import{s as ea,a as ta}from"../chunks/C-ohbqfQ.js";import{p as aa}from"../chunks/jEI8Ss-N.js";import{g as sa}from"../chunks/B06nuFKs.js";import{o as ra,g as ht,v as Ne,h as ia,u as jt,w as Xe}from"../chunks/DLtesNQI.js";import{b as la,g as wt,d as et,e as Ct,c as yt}from"../chunks/CtEhNW1g.js";import{t as va}from"../chunks/DThvY6M2.js";import{B as na}from"../chunks/BS99n6bK.js";import{s as oa}from"../chunks/CUQuFe4_.js";import{p as Ze}from"../chunks/B3wItnqC.js";const da=!1,Bs=Object.freeze(Object.defineProperty({__proto__:null,prerender:da},Symbol.toStringTag,{value:"Module"}));function ca(L){return L>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:L>=-60?{bars:3,color:"var(--positive)",label:"Good"}:L>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function Ft(L){const r=Math.floor((Date.now()-new Date(L).getTime())/1e3);if(r<10)return"just now";if(r<60)return`${r}s ago`;const j=Math.floor(r/60);if(j<60)return`${j}m ago`;const R=Math.floor(j/60);return R<24?`${R}h ago`:`${Math.floor(R/24)}d ago`}var ua=o('<div class="accent-bar svelte-1oyrwd9"></div>'),_a=o('<span class="card-icon svelte-1oyrwd9"> </span>'),ga=o('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),fa=o('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function Pe(L,r){let j=Ze(r,"highlight",3,!1),R=Ze(r,"collapsible",3,!1),f=Ze(r,"expanded",3,!1);var S=fa();let u;var i=a(S);{var T=h=>{var B=ua();l(h,B)};c(i,h=>{j()&&h(T)})}var d=s(i,2),w=a(d),C=a(w);{var E=h=>{var B=_a(),H=a(B,!0);t(B),g(()=>v(H,r.icon)),l(h,B)};c(C,h=>{r.icon&&h(E)})}var _=s(C,2),p=a(_,!0);t(_),t(w);var y=s(w,2);{var k=h=>{var B=ga();B.__click=function(...P){r.onToggle?.apply(this,P)};var H=a(B);let G;t(B),g(()=>{zt(B,"aria-label",f()?"Collapse":"Expand"),G=ze(H,0,"expand-icon svelte-1oyrwd9",null,G,{"rotate-180":f()})}),l(h,B)};c(y,h=>{R()&&r.onToggle&&h(k)})}t(d);var x=s(d,2);let b;var F=a(x);oa(F,()=>r.children),t(x),t(S),g(()=>{u=ze(S,1,"batch-card svelte-1oyrwd9",null,u,{highlight:j()}),v(p,r.title),b=ze(x,1,"card-content svelte-1oyrwd9",null,b,{collapsed:R()&&!f()})}),l(L,S)}$e(["click"]);var ma=o('<span class="unit svelte-lzskfi"> </span>'),pa=o('<div class="raw-values svelte-lzskfi"><span class="raw-label svelte-lzskfi">Raw:</span> <span class="raw-value svelte-lzskfi"> </span> <span class="raw-separator svelte-lzskfi">¬∑</span> <span class="raw-value svelte-lzskfi"> </span></div>'),ba=o('<div class="last-seen svelte-lzskfi"> </div>'),ha=o('<div class="live-badge svelte-lzskfi"><span class="live-dot svelte-lzskfi"></span> <span class="live-text svelte-lzskfi">LIVE</span></div> <div class="readings-grid svelte-lzskfi"><div class="reading svelte-lzskfi"><div class="reading-value svelte-lzskfi"> <!></div> <div class="reading-label svelte-lzskfi"> </div></div> <div class="reading svelte-lzskfi"><div class="reading-value temp svelte-lzskfi"> <span class="unit svelte-lzskfi"> </span></div> <div class="reading-label svelte-lzskfi">Temperature</div></div></div> <!> <!>',1);function ja(L,r){De(r,!0);let j=M(()=>r.liveReading?.sg??r.currentSg),R=M(()=>r.liveReading?.temp??r.currentTemp),f=M(()=>r.liveReading?.sg_raw),S=M(()=>r.liveReading?.temp_raw),u=M(()=>r.liveReading?.last_seen),i=M(()=>r.liveReading&&(r.liveReading.sg!==r.liveReading.sg_raw||r.liveReading.temp!==r.liveReading.temp_raw)),T=M(la),d=M(wt);function w(_){return _==null?"--":et(_)}function C(_){return _==null?"--":Ct(_)}let E=M(()=>e(u)?Ft(e(u)):null);Pe(L,{title:"Live Readings",highlight:!0,children:(_,p)=>{var y=ha(),k=s(Y(y),2),x=a(k),b=a(x),F=a(b),h=s(F);{var B=A=>{var D=ma(),ee=a(D,!0);t(D),g(()=>v(ee,e(T))),l(A,D)};c(h,A=>{e(T)!=="SG"&&A(B)})}t(b);var H=s(b,2),G=a(H,!0);t(H),t(x);var P=s(x,2),q=a(P),Q=a(q),$=s(Q),X=a($,!0);t($),t(q),Se(2),t(P),t(k);var le=s(k,2);{var Z=A=>{var D=pa(),ee=s(a(D),2),Ae=a(ee,!0);t(ee);var Te=s(ee,4),te=a(Te);t(Te),t(D),g((ae,n)=>{v(Ae,ae),v(te,`${n??""}${e(d)??""}`)},[()=>w(e(f)),()=>C(e(S))]),l(A,D)};c(le,A=>{e(i)&&A(Z)})}var _e=s(le,2);{var he=A=>{var D=ba(),ee=a(D);t(D),g(()=>v(ee,`Updated ${e(E)??""}`)),l(A,D)};c(_e,A=>{e(E)&&A(he)})}g((A,D)=>{v(F,`${A??""} `),v(G,e(T)==="SG"?"Gravity":e(T)==="¬∞P"?"Plato":"Brix"),v(Q,`${D??""} `),v(X,e(d))},[()=>w(e(j)),()=>C(e(R))]),l(_,y)},$$slots:{default:!0}}),Le()}var ya=o('<div class="gravity-point target svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Target FG</div> <div class="point-value svelte-t80j9z"> </div></div>'),ka=o('<div class="progress-remaining svelte-t80j9z"> </div>'),xa=o('<div class="progress-section svelte-t80j9z"><div class="progress-header svelte-t80j9z"><span class="progress-label svelte-t80j9z">Fermentation Progress</span> <span class="progress-percent svelte-t80j9z"> </span></div> <div class="progress-bar-container svelte-t80j9z"><div class="progress-bar-bg svelte-t80j9z"></div> <div class="progress-bar-fill svelte-t80j9z"></div> <div class="progress-bar-shine svelte-t80j9z"></div></div> <!></div>'),za=o('<div class="current-sg svelte-t80j9z"><div class="sg-label svelte-t80j9z">Current Specific Gravity</div> <div class="sg-value svelte-t80j9z"> <span class="fermenting-badge svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> Fermenting</span></div></div> <div class="gravity-timeline svelte-t80j9z"><div class="timeline-line svelte-t80j9z"></div> <div class="gravity-point start svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Original Gravity</div> <div class="point-value svelte-t80j9z"> </div></div> <!> <div class="gravity-point current svelte-t80j9z"><div class="point-marker pulsing svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Current FG</div> <div class="point-value svelte-t80j9z"> </div></div></div> <div class="metrics-grid svelte-t80j9z"><div class="metric abv-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">%</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Alcohol by Volume</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div> <div class="metric attenuation-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">‚Üì</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Apparent Attenuation</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div></div> <!>',1),wa=o('<div class="measurements-grid svelte-t80j9z"><div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Original Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Final Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">ABV</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Attenuation</div> <div class="measurement-value svelte-t80j9z"> </div></div></div>'),Ca=o('<div class="no-data svelte-t80j9z"><div class="no-data-icon svelte-t80j9z">‚óã</div> <p class="no-data-text svelte-t80j9z">Set Original Gravity to begin tracking fermentation metrics</p></div>');function Fa(L,r){De(r,!0);let j=M(()=>{if(!r.batch.measured_og)return null;const u=r.currentSg??r.progress?.measured?.current_sg;if(!u)return null;const i=(r.batch.measured_og-u)*131.25,T=r.batch.measured_og-1,d=T!==0?(r.batch.measured_og-u)/T*100:0;return{currentSg:u,abv:Math.max(0,i),attenuation:Math.max(0,Math.min(100,d)),isFermenting:r.batch.status==="fermenting"||r.batch.status==="conditioning"}}),R=M(()=>e(j)?.isFermenting??!1);function f(u){return u==null?"--":et(u)}function S(u){return u==null?"--":`${u.toFixed(1)}%`}{let u=M(()=>e(R)?"Fermentation Progress":"Fermentation Measurements");Pe(L,{get title(){return e(u)},children:(i,T)=>{var d=Be(),w=Y(d);{var C=_=>{var p=za(),y=Y(p),k=s(a(y),2),x=a(k);Se(),t(k),t(y);var b=s(y,2),F=s(a(b),2),h=s(a(F),4),B=a(h,!0);t(h),t(F);var H=s(F,2);{var G=te=>{var ae=ya(),n=s(a(ae),4),O=a(n,!0);t(n),t(ae),g(U=>v(O,U),[()=>f(r.batch.recipe.fg_target)]),l(te,ae)};c(H,te=>{r.batch.recipe?.fg_target&&te(G)})}var P=s(H,2),q=s(a(P),4),Q=a(q,!0);t(q),t(P),t(b);var $=s(b,2),X=a($),le=s(a(X),2),Z=s(a(le),2),_e=a(Z);Se(),t(Z),t(le),t(X);var he=s(X,2),A=s(a(he),2),D=s(a(A),2),ee=a(D);Se(),t(D),t(A),t(he),t($);var Ae=s($,2);{var Te=te=>{var ae=xa(),n=a(ae),O=s(a(n),2),U=a(O);t(O),t(n);var I=s(n,2),Ee=s(a(I),2);Se(2),t(I);var ne=s(I,2);{var ve=J=>{var fe=ka(),we=a(fe);t(fe),g(je=>v(we,`${je??""} gravity points remaining`),[()=>r.progress.progress.sg_remaining.toFixed(3)]),l(J,fe)};c(ne,J=>{r.progress.progress.sg_remaining!=null&&J(ve)})}t(ae),g(J=>{v(U,`${J??""}%`),Ve(Ee,`width: ${r.progress.progress.percent_complete??""}%`)},[()=>r.progress.progress.percent_complete.toFixed(0)]),l(te,ae)};c(Ae,te=>{r.progress?.progress?.percent_complete!=null&&te(Te)})}g((te,ae,n,O,U)=>{v(x,`${te??""} `),v(B,ae),v(Q,n),v(_e,`${O??""} `),v(ee,`${U??""} `)},[()=>f(e(j).currentSg),()=>f(r.batch.measured_og),()=>f(e(j).currentSg),()=>S(e(j).abv),()=>S(e(j).attenuation)]),l(_,p)},E=_=>{var p=Be(),y=Y(p);{var k=b=>{var F=wa(),h=a(F),B=s(a(h),2),H=a(B,!0);t(B),t(h);var G=s(h,2),P=s(a(G),2),q=a(P,!0);t(P),t(G);var Q=s(G,2),$=s(a(Q),2),X=a($,!0);t($),t(Q);var le=s(Q,2),Z=s(a(le),2),_e=a(Z,!0);t(Z),t(le),t(F),g((he,A,D,ee)=>{v(H,he),v(q,A),v(X,D),v(_e,ee)},[()=>f(r.batch.measured_og),()=>f(r.batch.measured_fg),()=>r.batch.measured_abv!=null?S(r.batch.measured_abv):"--",()=>r.batch.measured_attenuation!=null?S(r.batch.measured_attenuation):"--"]),l(b,F)},x=b=>{var F=Ca();l(b,F)};c(y,b=>{r.batch.measured_og?b(k):b(x,!1)},!0)}l(_,p)};c(w,_=>{e(j)&&e(R)?_(C):_(E,!1)})}l(i,d)},$$slots:{default:!0}})}Le()}var Ba=o('<div class="timeline svelte-yskb8i"><div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Brew Date</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Started</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Ended</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Created</span> <span class="timeline-value svelte-yskb8i"> </span></div></div>');function Sa(L,r){De(r,!0);function j(f){return f?new Date(f).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}):"--"}function R(f){return f?new Date(f).toLocaleString("en-GB",{day:"numeric",month:"short",hour:"numeric",minute:"2-digit"}):"--"}Pe(L,{title:"Timeline",children:(f,S)=>{var u=Ba(),i=a(u),T=s(a(i),2),d=a(T,!0);t(T),t(i);var w=s(i,2),C=s(a(w),2),E=a(C,!0);t(C),t(w);var _=s(w,2),p=s(a(_),2),y=a(p,!0);t(p),t(_);var k=s(_,2),x=s(a(k),2),b=a(x,!0);t(x),t(k),t(u),g((F,h,B,H)=>{v(d,F),v(E,h),v(y,B),v(b,H)},[()=>j(r.batch.brew_date),()=>R(r.batch.start_time),()=>R(r.batch.end_time),()=>R(r.batch.created_at)]),l(f,u)},$$slots:{default:!0}}),Le()}var Ta=o('<div class="signal-bar svelte-1kdxwtz"></div>'),Ra=o('<div class="signal-details svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="signal-text svelte-1kdxwtz"> </span></div>'),Oa=o('<div class="device-last-seen svelte-1kdxwtz"> </div>'),Ga=o('<div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!> <!>',1),Ma=o('<div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <div class="device-last-seen svelte-1kdxwtz">Not receiving data</div>',1),Da=o('<div class="device-info svelte-1kdxwtz"><!></div>'),La=o('<button type="button" class="link-btn svelte-1kdxwtz">Link a device</button>'),Pa=o('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function Aa(L,r){De(r,!0);let j=M(()=>r.liveReading?.rssi?ca(r.liveReading.rssi):null),R=M(()=>r.liveReading?.last_seen?Ft(r.liveReading.last_seen):null);Pe(L,{title:"Tracking Device",children:(f,S)=>{var u=Be(),i=Y(u);{var T=w=>{var C=Da(),E=a(C);{var _=y=>{var k=Ga(),x=Y(k),b=s(a(x));t(x);var F=s(x,2);{var h=G=>{var P=Ra(),q=a(P);kt(q,20,()=>Array(4),xt,(X,le,Z)=>{var _e=Ta();g(()=>Ve(_e,`
										height: ${6+Z*3}px;
										background: ${(Z<e(j).bars?e(j).color:"var(--bg-hover)")??""};
										opacity: ${Z<e(j).bars?1:.4};
									`)),l(X,_e)}),t(q);var Q=s(q,2),$=a(Q);t(Q),t(P),g(()=>{Ve(Q,`color: ${e(j).color??""}`),v($,`${e(j).label??""} (${r.liveReading.rssi??""} dBm)`)}),l(G,P)};c(F,G=>{e(j)&&G(h)})}var B=s(F,2);{var H=G=>{var P=Oa(),q=a(P);t(P),g(()=>v(q,`Updated ${e(R)??""}`)),l(G,P)};c(B,G=>{e(R)&&G(H)})}g(()=>v(b,` ${r.liveReading.color??""} Tilt - Connected`)),l(y,k)},p=y=>{var k=Ma(),x=Y(k),b=s(a(x));t(x),Se(2),g(()=>v(b,` Device: ${r.batch.device_id??""}`)),l(y,k)};c(E,y=>{r.liveReading?y(_):y(p,!1)})}t(C),l(w,C)},d=w=>{var C=Pa(),E=s(a(C),2);{var _=p=>{var y=La();y.__click=function(...k){r.onEdit?.apply(this,k)},l(p,y)};c(E,p=>{r.onEdit&&p(_)})}t(C),l(w,C)};c(i,w=>{r.batch.device_id?w(T):w(d,!1)})}l(f,u)},$$slots:{default:!0}}),Le()}$e(["click"]);const Ea=131.25;var Ua=o('<div class="target wide svelte-19u9n31"><span class="target-label svelte-19u9n31">Yeast</span> <span class="target-value svelte-19u9n31"> </span></div>'),Na=o('<div class="targets-grid svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div> <!></div>');function Va(L,r){De(r,!0);function j(f){return f==null?"--":et(f)}let R=M(()=>r.recipe.abv_target!=null?r.recipe.abv_target:r.recipe.og_target&&r.recipe.fg_target?(r.recipe.og_target-r.recipe.fg_target)*Ea:null);Pe(L,{title:"Recipe Targets",children:(f,S)=>{var u=Na(),i=a(u),T=s(a(i),2),d=a(T,!0);t(T),t(i);var w=s(i,2),C=s(a(w),2),E=a(C,!0);t(C),t(w);var _=s(w,2),p=s(a(_),2),y=a(p,!0);t(p),t(_);var k=s(_,2);{var x=b=>{var F=Ua(),h=s(a(F),2),B=a(h,!0);t(h),t(F),g(()=>v(B,r.recipe.yeast_name)),l(b,F)};c(k,b=>{r.recipe.yeast_name&&b(x)})}t(u),g((b,F,h)=>{v(d,b),v(E,F),v(y,h)},[()=>j(r.recipe.og_target),()=>j(r.recipe.fg_target),()=>e(R)!=null?`${e(R).toFixed(1)}%`:"--"]),l(f,u)},$$slots:{default:!0}}),Le()}var Ha=o('<p class="notes-content svelte-hkv31i"> </p>');function Ia(L,r){Pe(L,{title:"Notes",children:(j,R)=>{var f=Ha(),S=a(f,!0);t(f),g(()=>v(S,r.notes)),l(j,f)},$$slots:{default:!0}})}var Wa=o('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),Ja=o('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),Ya=o('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),qa=o('<span class="recipe-type svelte-g5au2j"> </span>'),Ka=o('<a class="recipe-link svelte-g5au2j"> <!></a>'),Qa=o('<option class="svelte-g5au2j"> </option>'),Xa=o('<div class="device-status heater svelte-g5au2j"><div>üî•</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Heater</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),Za=o('<div class="device-status cooler svelte-g5au2j"><div>‚ùÑÔ∏è</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Cooler</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),$a=o('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">‚ö°</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),es=o('<button type="button" class="override-btn heat-on svelte-g5au2j">Force Heat ON</button> <button type="button" class="override-btn heat-off svelte-g5au2j">Force Heat OFF</button>',1),ts=o('<button type="button" class="override-btn cool-on svelte-g5au2j">Force Cool ON</button> <button type="button" class="override-btn cool-off svelte-g5au2j">Force Cool OFF</button>',1),as=o('<div class="control-details svelte-g5au2j"><div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns-grid svelte-g5au2j"><!> <!> <button type="button" class="override-btn auto-mode svelte-g5au2j">Auto Mode</button></div></div>',1),ss=o('<div><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="device-status-grid svelte-g5au2j"><!> <!></div> <!></div>'),rs=o('<span class="svelte-g5au2j"> </span>'),is=o('<span class="svelte-g5au2j"> </span>'),ls=o('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><!> <!> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),vs=o('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!></div></div>',1),ns=o('<div class="modal-overlay svelte-g5au2j"><div class="modal svelte-g5au2j"><h2 class="modal-title svelte-g5au2j">Delete Batch?</h2> <p class="modal-text svelte-g5au2j"> </p> <div class="modal-actions svelte-g5au2j"><button type="button" class="modal-btn cancel svelte-g5au2j">Cancel</button> <button type="button" class="modal-btn delete svelte-g5au2j"> </button></div></div></div>'),os=o('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div> <!>',1);function Ss(L,r){De(r,!0);const j=()=>ta(aa,"$page",R),[R,f]=ea();let S=null,u=null,i=ge(null),T=ge(null),d=ge(null),w=ge(!0),C=ge(null),E=ge(!1),_=ge(!1),p=ge(!1),y=ge(!1),k=ge(!1),x=M(()=>parseInt(j().params.id??"0"));const b={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},F=["planning","fermenting","conditioning","completed","archived"];let h=M(()=>e(i)?b[e(i).status]:b.planning),B=M(wt),H=M(()=>yt.config.ha_enabled&&yt.config.temp_control_enabled&&(e(i)?.heater_entity_id||e(i)?.cooler_entity_id)),G=M(()=>{if(!e(i)?.device_id)return null;const n=e(i).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!n?.[1])return null;const O=n[1].toUpperCase();for(const U of va.tilts.values())if(U.color.toUpperCase()===O)return U;return null});async function P(){m(w,!0),m(C,null);try{if(m(i,await ra(e(x)),!0),e(i).status==="fermenting"||e(i).status==="conditioning")try{m(T,await ht(e(x)),!0)}catch{}if(e(i).heater_entity_id||e(i).cooler_entity_id)try{m(d,await Ne(e(x)),!0)}catch{}}catch(n){m(C,n instanceof Error?n.message:"Failed to load batch",!0)}finally{m(w,!1)}}async function q(n){if(!(!e(i)||e(_))){m(_,!0);try{m(i,await jt(e(i).id,{status:n}),!0),(n==="fermenting"||n==="conditioning")&&m(T,await ht(e(i).id),!0)}catch(O){console.error("Failed to update status:",O)}finally{m(_,!1)}}}async function Q(n){if(e(i)&&(m(i,await jt(e(i).id,n),!0),m(E,!1),e(i).heater_entity_id||e(i).cooler_entity_id))try{m(d,await Ne(e(i).id),!0)}catch{}}async function $(){if(e(i)){m(k,!0);try{await ia(e(i).id),sa("/batches")}catch(n){m(C,n instanceof Error?n.message:"Failed to delete batch",!0),m(k,!1),m(y,!1)}}}async function X(n,O){if(!(!e(i)||e(p))){m(p,!0);try{await Xe(e(i).id,O,60,n),m(d,await Ne(e(i).id),!0)}catch(U){console.error("Failed to set override:",U)}finally{m(p,!1)}}}async function le(){if(!(!e(i)||e(p))){m(p,!0);try{e(i).heater_entity_id&&await Xe(e(i).id,null,60,"heater"),e(i).cooler_entity_id&&await Xe(e(i).id,null,60,"cooler"),m(d,await Ne(e(i).id),!0)}catch(n){console.error("Failed to clear overrides:",n)}finally{m(p,!1)}}}function Z(){if(S?.readyState===WebSocket.OPEN)return;const O=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;S=new WebSocket(O),S.onmessage=async U=>{try{const I=JSON.parse(U.data);I.type==="control_event"&&I.batch_id===e(x)&&e(d)&&(I.action==="heat_on"?m(d,{...e(d),heater_state:"on"},!0):I.action==="heat_off"?m(d,{...e(d),heater_state:"off"},!0):I.action==="cool_on"?m(d,{...e(d),cooler_state:"on"},!0):I.action==="cool_off"&&m(d,{...e(d),cooler_state:"off"},!0))}catch{}},S.onclose=()=>{S=null,u=setTimeout(Z,3e3)},S.onerror=()=>{S?.close()}}function _e(){u&&(clearTimeout(u),u=null),S?.close(),S=null}function he(n){return n==null?"--":Ct(n)}Yt(()=>{P(),Z()}),qt(()=>{_e()});var A=os();Xt("g5au2j",n=>{Kt(()=>{Qt.title=`${(e(i)?.name||"Batch")??""} | BrewSignal`})});var D=Y(A),ee=s(a(D),2);{var Ae=n=>{var O=Wa();l(n,O)},Te=n=>{var O=Be(),U=Y(O);{var I=ne=>{var ve=Ja(),J=s(a(ve),2),fe=a(J,!0);t(J);var we=s(J,2);we.__click=P,t(ve),g(()=>v(fe,e(C))),l(ne,ve)},Ee=ne=>{var ve=Be(),J=Y(ve);{var fe=je=>{var Ue=Ya();l(je,Ue)},we=je=>{var Ue=Be(),Bt=Y(Ue);{var St=Re=>{na(Re,{get batch(){return e(i)},onSubmit:Q,onCancel:()=>m(E,!1)})},Tt=Re=>{var tt=vs(),He=Y(tt),Ie=a(He),We=a(Ie),Rt=a(We);t(We);var at=s(We,2),Je=a(at),Ot=a(Je,!0);t(Je);var Gt=s(Je,2);{var Mt=z=>{var N=Ka(),K=a(N),pe=s(K);{var oe=be=>{var ye=qa(),Oe=a(ye);t(ye),g(()=>v(Oe,`(${e(i).recipe.type??""})`)),l(be,ye)};c(pe,be=>{e(i).recipe.type&&be(oe)})}t(N),g(()=>{zt(N,"href",`/recipes/${e(i).recipe.id??""}`),v(K,`${e(i).recipe.name??""} `)}),l(z,N)};c(Gt,z=>{e(i).recipe&&z(Mt)})}t(at),t(Ie);var st=s(Ie,2),Ye=a(st),me=a(Ye);me.__change=z=>q(z.currentTarget.value),kt(me,21,()=>F,xt,(z,N)=>{var K=Qa(),pe=a(K,!0);t(K);var oe={};g(()=>{v(pe,b[e(N)].label),oe!==(oe=e(N))&&(K.value=(K.__value=e(N))??"")}),l(z,K)}),t(me);var rt;Zt(me),t(Ye);var it=s(Ye,2);it.__click=()=>m(E,!0);var Dt=s(it,2);Dt.__click=()=>m(y,!0),t(st),t(He);var lt=s(He,2),qe=a(lt),vt=a(qe);{var Lt=z=>{{let N=M(()=>e(T)?.measured?.current_sg),K=M(()=>e(T)?.temperature?.current);ja(z,{get liveReading(){return e(G)},get currentSg(){return e(N)},get currentTemp(){return e(K)}})}};c(vt,z=>{(e(G)||e(T)?.measured?.current_sg!=null)&&z(Lt)})}var nt=s(vt,2);{let z=M(()=>e(G)?.sg??e(T)?.measured?.current_sg);Fa(nt,{get batch(){return e(i)},get currentSg(){return e(z)},get progress(){return e(T)}})}var Pt=s(nt,2);{var At=z=>{Va(z,{get recipe(){return e(i).recipe}})};c(Pt,z=>{e(i).recipe&&z(At)})}t(qe);var ot=s(qe,2),dt=a(ot);Sa(dt,{get batch(){return e(i)}});var ct=s(dt,2);Aa(ct,{get batch(){return e(i)},get liveReading(){return e(G)},onEdit:()=>m(E,!0)});var ut=s(ct,2);{var Et=z=>{var N=ss();let K;var pe=s(a(N),2),oe=a(pe);{var be=se=>{var V=Xa(),W=a(V);let re;var ke=s(W,2),de=s(a(ke),2);let xe;var Ge=a(de,!0);t(de);var Ce=s(de,2),Me=a(Ce,!0);t(Ce),t(ke),t(V),g(()=>{re=ze(W,1,"device-icon-wrap svelte-g5au2j",null,re,{active:e(d)?.heater_state==="on"}),xe=ze(de,1,"device-state svelte-g5au2j",null,xe,{on:e(d)?.heater_state==="on"}),v(Ge,e(d)?.heater_state==="on"?"ON":"OFF"),v(Me,e(i).heater_entity_id)}),l(se,V)};c(oe,se=>{e(i).heater_entity_id&&se(be)})}var ye=s(oe,2);{var Oe=se=>{var V=Za(),W=a(V);let re;var ke=s(W,2),de=s(a(ke),2);let xe;var Ge=a(de,!0);t(de);var Ce=s(de,2),Me=a(Ce,!0);t(Ce),t(ke),t(V),g(()=>{re=ze(W,1,"device-icon-wrap svelte-g5au2j",null,re,{active:e(d)?.cooler_state==="on"}),xe=ze(de,1,"device-state svelte-g5au2j",null,xe,{on:e(d)?.cooler_state==="on"}),v(Ge,e(d)?.cooler_state==="on"?"ON":"OFF"),v(Me,e(i).cooler_entity_id)}),l(se,V)};c(ye,se=>{e(i).cooler_entity_id&&se(Oe)})}t(pe);var Ke=s(pe,2);{var Qe=se=>{var V=as(),W=Y(V),re=a(W),ke=s(a(re),2),de=a(ke);t(ke),t(re);var xe=s(re,2),Ge=s(a(xe),2),Ce=a(Ge);t(Ge),t(xe),t(W);var Me=s(W,2);{var Ht=ie=>{var ce=$a(),ue=s(a(ce),2),Fe=a(ue);t(ue);var bt=s(ue,2);bt.__click=()=>le(),t(ce),g(Jt=>{v(Fe,`Override active: ${Jt??""}`),bt.disabled=e(p)},[()=>e(d).override_state?.toUpperCase()]),l(ie,ce)};c(Me,ie=>{e(d).override_active&&ie(Ht)})}var _t=s(Me,2),gt=s(a(_t),2),ft=a(gt);{var It=ie=>{var ce=es(),ue=Y(ce);ue.__click=()=>X("heater","on");var Fe=s(ue,2);Fe.__click=()=>X("heater","off"),g(()=>{ue.disabled=e(p),Fe.disabled=e(p)}),l(ie,ce)};c(ft,ie=>{e(i).heater_entity_id&&ie(It)})}var mt=s(ft,2);{var Wt=ie=>{var ce=ts(),ue=Y(ce);ue.__click=()=>X("cooler","on");var Fe=s(ue,2);Fe.__click=()=>X("cooler","off"),g(()=>{ue.disabled=e(p),Fe.disabled=e(p)}),l(ie,ce)};c(mt,ie=>{e(i).cooler_entity_id&&ie(Wt)})}var pt=s(mt,2);pt.__click=()=>le(),t(gt),t(_t),g((ie,ce)=>{v(de,`${ie??""}${e(B)??""}`),v(Ce,`¬±${ce??""}${e(B)??""}`),pt.disabled=e(p)},[()=>he(e(d).target_temp),()=>e(d).hysteresis?.toFixed(1)||"--"]),l(se,V)};c(Ke,se=>{e(d)&&se(Qe)})}t(N),g(()=>K=ze(N,1,"info-card temp-control-card svelte-g5au2j",null,K,{"heater-on":e(d)?.heater_state==="on","cooler-on":e(d)?.cooler_state==="on"})),l(z,N)},Ut=z=>{var N=Be(),K=Y(N);{var pe=oe=>{var be=ls(),ye=s(a(be),2),Oe=a(ye);{var Ke=V=>{var W=rs(),re=a(W);t(W),g(()=>v(re,`Heater: ${e(i).heater_entity_id??""}`)),l(V,W)};c(Oe,V=>{e(i).heater_entity_id&&V(Ke)})}var Qe=s(Oe,2);{var se=V=>{var W=is(),re=a(W);t(W),g(()=>v(re,`Cooler: ${e(i).cooler_entity_id??""}`)),l(V,W)};c(Qe,V=>{e(i).cooler_entity_id&&V(se)})}Se(2),t(ye),t(be),l(oe,be)};c(K,oe=>{(e(i).heater_entity_id||e(i).cooler_entity_id)&&e(i).status!=="fermenting"&&oe(pe)},!0)}l(z,N)};c(ut,z=>{e(H)&&e(i).status==="fermenting"?z(Et):z(Ut,!1)})}var Nt=s(ut,2);{var Vt=z=>{Ia(z,{get notes(){return e(i).notes}})};c(Nt,z=>{e(i).notes&&z(Vt)})}t(ot),t(lt),g(()=>{v(Rt,`#${(e(i).batch_number||"?")??""}`),v(Ot,e(i).name||e(i).recipe?.name||"Unnamed Batch"),me.disabled=e(_),Ve(me,`color: ${e(h).color??""}; background: ${e(h).bg??""};`),rt!==(rt=e(i).status)&&(me.value=(me.__value=e(i).status)??"",$t(me,e(i).status))}),l(Re,tt)};c(Bt,Re=>{e(E)?Re(St):Re(Tt,!1)},!0)}l(je,Ue)};c(J,je=>{e(i)?je(we,!1):je(fe)},!0)}l(ne,ve)};c(U,ne=>{e(C)?ne(I):ne(Ee,!1)},!0)}l(n,O)};c(ee,n=>{e(w)?n(Ae):n(Te,!1)})}t(D);var te=s(D,2);{var ae=n=>{var O=ns();O.__click=()=>m(y,!1);var U=a(O);U.__click=we=>we.stopPropagation();var I=s(a(U),2),Ee=a(I);t(I);var ne=s(I,2),ve=a(ne);ve.__click=()=>m(y,!1);var J=s(ve,2);J.__click=$;var fe=a(J,!0);t(J),t(ne),t(U),t(O),g(()=>{v(Ee,`Are you sure you want to delete "${(e(i)?.name||"this batch")??""}"? This cannot be undone.`),ve.disabled=e(k),J.disabled=e(k),v(fe,e(k)?"Deleting...":"Delete Batch")}),l(n,O)};c(te,n=>{e(y)&&n(ae)})}l(L,A),Le(),f()}$e(["click","change"]);export{Ss as component,Bs as universal};
