import{d as Ie,f as o,s as v,a as n,c as me}from"../chunks/jyAcDmWg.js";import{al as a,ak as s,an as t,as as p,ah as he,ar as q,c as e,ai as O,at as pe,aj as je,ap as It,aK as Vt,aw as Wt,am as Jt,ao as ue,s as M}from"../chunks/DBUEpBwK.js";import{e as mt,i as pt}from"../chunks/CWBb8vPY.js";import{i as m}from"../chunks/Ce0eyuz5.js";import{h as Kt}from"../chunks/GnvximVd.js";import{s as bt}from"../chunks/BKC2WXbk.js";import{s as ge}from"../chunks/-yfH5Rgi.js";import{s as Ce}from"../chunks/Cmyp4dBw.js";import{i as Yt,s as qt}from"../chunks/Dx7-2BRZ.js";import{s as Qt,a as Xt}from"../chunks/kcwD9VOY.js";import{p as Zt}from"../chunks/Ck9yMklF.js";import{g as $t}from"../chunks/BtXxEXsw.js";import{k as ea,b as gt,l as Ne,u as _t,m as ta,s as aa}from"../chunks/DlMVHRlb.js";import{b as sa,g as ht,d as Ve,e as jt,c as ft}from"../chunks/D-cBTwJC.js";import{t as ra}from"../chunks/y7-K11TG.js";import{B as ia}from"../chunks/Bg_9MLhh.js";import{s as va}from"../chunks/CIodzTVx.js";import{p as He}from"../chunks/ly048rjG.js";const la=!1,ps=Object.freeze(Object.defineProperty({__proto__:null,prerender:la},Symbol.toStringTag,{value:"Module"}));function na(P){return P>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:P>=-60?{bars:3,color:"var(--positive)",label:"Good"}:P>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function yt(P){const r=Math.floor((Date.now()-new Date(P).getTime())/1e3);if(r<10)return"just now";if(r<60)return`${r}s ago`;const _=Math.floor(r/60);if(_<60)return`${_}m ago`;const x=Math.floor(_/60);return x<24?`${x}h ago`:`${Math.floor(x/24)}d ago`}var da=o('<div class="accent-bar svelte-1oyrwd9"></div>'),oa=o('<span class="card-icon svelte-1oyrwd9"> </span>'),ca=o('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),ua=o('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function ye(P,r){let _=He(r,"highlight",3,!1),x=He(r,"collapsible",3,!1),f=He(r,"expanded",3,!1);var b=ua();let c;var i=a(b);{var T=y=>{var S=da();n(y,S)};m(i,y=>{_()&&y(T)})}var d=s(i,2),B=a(d),F=a(B);{var G=y=>{var S=oa(),U=a(S,!0);t(S),p(()=>v(U,r.icon)),n(y,S)};m(F,y=>{r.icon&&y(G)})}var u=s(F,2),C=a(u,!0);t(u),t(B);var h=s(B,2);{var z=y=>{var S=ca();S.__click=function(...E){r.onToggle?.apply(this,E)};var U=a(S);let D;t(S),p(()=>{bt(S,"aria-label",f()?"Collapse":"Expand"),D=ge(U,0,"expand-icon svelte-1oyrwd9",null,D,{"rotate-180":f()})}),n(y,S)};m(h,y=>{x()&&r.onToggle&&y(z)})}t(d);var j=s(d,2);let g;var w=a(j);va(w,()=>r.children),t(j),t(b),p(()=>{c=ge(b,1,"batch-card svelte-1oyrwd9",null,c,{highlight:_()}),v(C,r.title),g=ge(j,1,"card-content svelte-1oyrwd9",null,g,{collapsed:x()&&!f()})}),n(P,b)}Ie(["click"]);var ga=o('<span class="unit svelte-lzskfi"> </span>'),_a=o('<div class="raw-values svelte-lzskfi"><span class="raw-label svelte-lzskfi">Raw:</span> <span class="raw-value svelte-lzskfi"> </span> <span class="raw-separator svelte-lzskfi">Â·</span> <span class="raw-value svelte-lzskfi"> </span></div>'),fa=o('<div class="last-seen svelte-lzskfi"> </div>'),ma=o('<div class="live-badge svelte-lzskfi"><span class="live-dot svelte-lzskfi"></span> <span class="live-text svelte-lzskfi">LIVE</span></div> <div class="readings-grid svelte-lzskfi"><div class="reading svelte-lzskfi"><div class="reading-value svelte-lzskfi"> <!></div> <div class="reading-label svelte-lzskfi"> </div></div> <div class="reading svelte-lzskfi"><div class="reading-value temp svelte-lzskfi"> <span class="unit svelte-lzskfi"> </span></div> <div class="reading-label svelte-lzskfi">Temperature</div></div></div> <!> <!>',1);function pa(P,r){he(r,!0);let _=O(()=>r.liveReading?.sg??r.currentSg),x=O(()=>r.liveReading?.temp??r.currentTemp),f=O(()=>r.liveReading?.sg_raw),b=O(()=>r.liveReading?.temp_raw),c=O(()=>r.liveReading?.last_seen),i=O(()=>r.liveReading&&(r.liveReading.sg!==r.liveReading.sg_raw||r.liveReading.temp!==r.liveReading.temp_raw)),T=O(sa),d=O(ht);function B(u){return u==null?"--":Ve(u)}function F(u){return u==null?"--":jt(u)}let G=O(()=>e(c)?yt(e(c)):null);ye(P,{title:"Live Readings",highlight:!0,children:(u,C)=>{var h=ma(),z=s(q(h),2),j=a(z),g=a(j),w=a(g),y=s(w);{var S=L=>{var l=ga(),R=a(l,!0);t(l),p(()=>v(R,e(T))),n(L,l)};m(y,L=>{e(T)!=="SG"&&L(S)})}t(g);var U=s(g,2),D=a(U,!0);t(U),t(j);var E=s(j,2),V=a(E),I=a(V),K=s(I),Z=a(K,!0);t(K),t(V),pe(2),t(E),t(z);var $=s(z,2);{var W=L=>{var l=_a(),R=s(a(l),2),ae=a(R,!0);t(R);var Q=s(R,4),Y=a(Q);t(Q),t(l),p((A,H)=>{v(ae,A),v(Y,`${H??""}${e(d)??""}`)},[()=>B(e(f)),()=>F(e(b))]),n(L,l)};m($,L=>{e(i)&&L(W)})}var te=s($,2);{var de=L=>{var l=fa(),R=a(l);t(l),p(()=>v(R,`Updated ${e(G)??""}`)),n(L,l)};m(te,L=>{e(G)&&L(de)})}p((L,l)=>{v(w,`${L??""} `),v(D,e(T)==="SG"?"Gravity":e(T)==="Â°P"?"Plato":"Brix"),v(I,`${l??""} `),v(Z,e(d))},[()=>B(e(_)),()=>F(e(x))]),n(u,h)},$$slots:{default:!0}}),je()}var ba=o('<div class="gravity-point target svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Target FG</div> <div class="point-value svelte-t80j9z"> </div></div>'),ha=o('<div class="progress-remaining svelte-t80j9z"> </div>'),ja=o('<div class="progress-section svelte-t80j9z"><div class="progress-header svelte-t80j9z"><span class="progress-label svelte-t80j9z">Fermentation Progress</span> <span class="progress-percent svelte-t80j9z"> </span></div> <div class="progress-bar-container svelte-t80j9z"><div class="progress-bar-bg svelte-t80j9z"></div> <div class="progress-bar-fill svelte-t80j9z"></div> <div class="progress-bar-shine svelte-t80j9z"></div></div> <!></div>'),ya=o('<div class="current-sg svelte-t80j9z"><div class="sg-label svelte-t80j9z">Current Specific Gravity</div> <div class="sg-value svelte-t80j9z"> <span class="fermenting-badge svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> Fermenting</span></div></div> <div class="gravity-timeline svelte-t80j9z"><div class="timeline-line svelte-t80j9z"></div> <div class="gravity-point start svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Original Gravity</div> <div class="point-value svelte-t80j9z"> </div></div> <!> <div class="gravity-point current svelte-t80j9z"><div class="point-marker pulsing svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Current FG</div> <div class="point-value svelte-t80j9z"> </div></div></div> <div class="metrics-grid svelte-t80j9z"><div class="metric abv-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">%</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Alcohol by Volume</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div> <div class="metric attenuation-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">â†“</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Apparent Attenuation</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div></div> <!>',1),ka=o('<div class="measurements-grid svelte-t80j9z"><div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Original Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Final Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">ABV</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Attenuation</div> <div class="measurement-value svelte-t80j9z"> </div></div></div>'),xa=o('<div class="no-data svelte-t80j9z"><div class="no-data-icon svelte-t80j9z">â—‹</div> <p class="no-data-text svelte-t80j9z">Set Original Gravity to begin tracking fermentation metrics</p></div>');function za(P,r){he(r,!0);let _=O(()=>{if(!r.batch.measured_og)return null;const c=r.currentSg??r.progress?.measured?.current_sg;if(!c)return null;const i=(r.batch.measured_og-c)*131.25,T=r.batch.measured_og-1,d=T!==0?(r.batch.measured_og-c)/T*100:0;return{currentSg:c,abv:Math.max(0,i),attenuation:Math.max(0,Math.min(100,d)),isFermenting:r.batch.status==="fermenting"||r.batch.status==="conditioning"}}),x=O(()=>e(_)?.isFermenting??!1);function f(c){return c==null?"--":Ve(c)}function b(c){return c==null?"--":`${c.toFixed(1)}%`}{let c=O(()=>e(x)?"Fermentation Progress":"Fermentation Measurements");ye(P,{get title(){return e(c)},children:(i,T)=>{var d=me(),B=q(d);{var F=u=>{var C=ya(),h=q(C),z=s(a(h),2),j=a(z);pe(),t(z),t(h);var g=s(h,2),w=s(a(g),2),y=s(a(w),4),S=a(y,!0);t(y),t(w);var U=s(w,2);{var D=Y=>{var A=ba(),H=s(a(A),4),X=a(H,!0);t(H),t(A),p(re=>v(X,re),[()=>f(r.batch.recipe.fg_target)]),n(Y,A)};m(U,Y=>{r.batch.recipe?.fg_target&&Y(D)})}var E=s(U,2),V=s(a(E),4),I=a(V,!0);t(V),t(E),t(g);var K=s(g,2),Z=a(K),$=s(a(Z),2),W=s(a($),2),te=a(W);pe(),t(W),t($),t(Z);var de=s(Z,2),L=s(a(de),2),l=s(a(L),2),R=a(l);pe(),t(l),t(L),t(de),t(K);var ae=s(K,2);{var Q=Y=>{var A=ja(),H=a(A),X=s(a(H),2),re=a(X);t(X),t(H);var _e=s(H,2),oe=s(a(_e),2);pe(2),t(_e);var be=s(_e,2);{var Te=fe=>{var ke=ha(),ce=a(ke);t(ke),p(we=>v(ce,`${we??""} gravity points remaining`),[()=>r.progress.progress.sg_remaining.toFixed(3)]),n(fe,ke)};m(be,fe=>{r.progress.progress.sg_remaining!=null&&fe(Te)})}t(A),p(fe=>{v(re,`${fe??""}%`),Ce(oe,`width: ${r.progress.progress.percent_complete??""}%`)},[()=>r.progress.progress.percent_complete.toFixed(0)]),n(Y,A)};m(ae,Y=>{r.progress?.progress?.percent_complete!=null&&Y(Q)})}p((Y,A,H,X,re)=>{v(j,`${Y??""} `),v(S,A),v(I,H),v(te,`${X??""} `),v(R,`${re??""} `)},[()=>f(e(_).currentSg),()=>f(r.batch.measured_og),()=>f(e(_).currentSg),()=>b(e(_).abv),()=>b(e(_).attenuation)]),n(u,C)},G=u=>{var C=me(),h=q(C);{var z=g=>{var w=ka(),y=a(w),S=s(a(y),2),U=a(S,!0);t(S),t(y);var D=s(y,2),E=s(a(D),2),V=a(E,!0);t(E),t(D);var I=s(D,2),K=s(a(I),2),Z=a(K,!0);t(K),t(I);var $=s(I,2),W=s(a($),2),te=a(W,!0);t(W),t($),t(w),p((de,L,l,R)=>{v(U,de),v(V,L),v(Z,l),v(te,R)},[()=>f(r.batch.measured_og),()=>f(r.batch.measured_fg),()=>r.batch.measured_abv!=null?b(r.batch.measured_abv):"--",()=>r.batch.measured_attenuation!=null?b(r.batch.measured_attenuation):"--"]),n(g,w)},j=g=>{var w=xa();n(g,w)};m(h,g=>{r.batch.measured_og?g(z):g(j,!1)},!0)}n(u,C)};m(B,u=>{e(_)&&e(x)?u(F):u(G,!1)})}n(i,d)},$$slots:{default:!0}})}je()}var wa=o('<div class="timeline svelte-yskb8i"><div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Brew Date</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Started</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Ended</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Created</span> <span class="timeline-value svelte-yskb8i"> </span></div></div>');function Sa(P,r){he(r,!0);function _(f){return f?new Date(f).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}):"--"}function x(f){return f?new Date(f).toLocaleString("en-GB",{day:"numeric",month:"short",hour:"numeric",minute:"2-digit"}):"--"}ye(P,{title:"Timeline",children:(f,b)=>{var c=wa(),i=a(c),T=s(a(i),2),d=a(T,!0);t(T),t(i);var B=s(i,2),F=s(a(B),2),G=a(F,!0);t(F),t(B);var u=s(B,2),C=s(a(u),2),h=a(C,!0);t(C),t(u);var z=s(u,2),j=s(a(z),2),g=a(j,!0);t(j),t(z),t(c),p((w,y,S,U)=>{v(d,w),v(G,y),v(h,S),v(g,U)},[()=>_(r.batch.brew_date),()=>x(r.batch.start_time),()=>x(r.batch.end_time),()=>x(r.batch.created_at)]),n(f,c)},$$slots:{default:!0}}),je()}var Ba=o('<div class="signal-bar svelte-1kdxwtz"></div>'),Ca=o('<div class="signal-details svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="signal-text svelte-1kdxwtz"> </span></div>'),Ta=o('<div class="device-last-seen svelte-1kdxwtz"> </div>'),Fa=o('<div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!> <!>',1),Ra=o('<div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <div class="device-last-seen svelte-1kdxwtz">Not receiving data</div>',1),Ga=o('<div class="device-info svelte-1kdxwtz"><!></div>'),Ma=o('<button type="button" class="link-btn svelte-1kdxwtz">Link a device</button>'),Oa=o('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function Pa(P,r){he(r,!0);let _=O(()=>r.liveReading?.rssi?na(r.liveReading.rssi):null),x=O(()=>r.liveReading?.last_seen?yt(r.liveReading.last_seen):null);ye(P,{title:"Tracking Device",children:(f,b)=>{var c=me(),i=q(c);{var T=B=>{var F=Ga(),G=a(F);{var u=h=>{var z=Fa(),j=q(z),g=s(a(j));t(j);var w=s(j,2);{var y=D=>{var E=Ca(),V=a(E);mt(V,20,()=>Array(4),pt,(Z,$,W)=>{var te=Ba();p(()=>Ce(te,`
										height: ${6+W*3}px;
										background: ${(W<e(_).bars?e(_).color:"var(--bg-hover)")??""};
										opacity: ${W<e(_).bars?1:.4};
									`)),n(Z,te)}),t(V);var I=s(V,2),K=a(I);t(I),t(E),p(()=>{Ce(I,`color: ${e(_).color??""}`),v(K,`${e(_).label??""} (${r.liveReading.rssi??""} dBm)`)}),n(D,E)};m(w,D=>{e(_)&&D(y)})}var S=s(w,2);{var U=D=>{var E=Ta(),V=a(E);t(E),p(()=>v(V,`Updated ${e(x)??""}`)),n(D,E)};m(S,D=>{e(x)&&D(U)})}p(()=>v(g,` ${r.liveReading.color??""} Tilt - Connected`)),n(h,z)},C=h=>{var z=Ra(),j=q(z),g=s(a(j));t(j),pe(2),p(()=>v(g,` Device: ${r.batch.device_id??""}`)),n(h,z)};m(G,h=>{r.liveReading?h(u):h(C,!1)})}t(F),n(B,F)},d=B=>{var F=Oa(),G=s(a(F),2);{var u=C=>{var h=Ma();h.__click=function(...z){r.onEdit?.apply(this,z)},n(C,h)};m(G,C=>{r.onEdit&&C(u)})}t(F),n(B,F)};m(i,B=>{r.batch.device_id?B(T):B(d,!1)})}n(f,c)},$$slots:{default:!0}}),je()}Ie(["click"]);var Da=o('<div class="target wide svelte-19u9n31"><span class="target-label svelte-19u9n31">Yeast</span> <span class="target-value svelte-19u9n31"> </span></div>'),Ea=o('<div class="targets-grid svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div> <!></div>');function La(P,r){he(r,!0);function _(x){return x==null?"--":Ve(x)}ye(P,{title:"Recipe Targets",children:(x,f)=>{var b=Ea(),c=a(b),i=s(a(c),2),T=a(i,!0);t(i),t(c);var d=s(c,2),B=s(a(d),2),F=a(B,!0);t(B),t(d);var G=s(d,2),u=s(a(G),2),C=a(u,!0);t(u),t(G);var h=s(G,2);{var z=j=>{var g=Da(),w=s(a(g),2),y=a(w,!0);t(w),t(g),p(()=>v(y,r.recipe.yeast_name)),n(j,g)};m(h,j=>{r.recipe.yeast_name&&j(z)})}t(b),p((j,g,w)=>{v(T,j),v(F,g),v(C,w)},[()=>_(r.recipe.og_target),()=>_(r.recipe.fg_target),()=>r.recipe.abv_target!=null?`${r.recipe.abv_target.toFixed(1)}%`:"--"]),n(x,b)},$$slots:{default:!0}}),je()}var Ua=o('<p class="notes-content svelte-hkv31i"> </p>');function Aa(P,r){ye(P,{title:"Notes",children:(_,x)=>{var f=Ua(),b=a(f,!0);t(f),p(()=>v(b,r.notes)),n(_,f)},$$slots:{default:!0}})}var Na=o('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),Ha=o('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),Ia=o('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),Va=o('<span class="recipe-type svelte-g5au2j"> </span>'),Wa=o('<a class="recipe-link svelte-g5au2j"> <!></a>'),Ja=o('<option class="svelte-g5au2j"> </option>'),Ka=o('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">âš¡</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),Ya=o('<div class="heater-details svelte-g5au2j"><div class="heater-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="heater-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns svelte-g5au2j"><button type="button">Force ON</button> <button type="button">Force OFF</button></div></div>',1),qa=o('<div><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="heater-status svelte-g5au2j"><div>ðŸ”¥</div> <div class="heater-info svelte-g5au2j"><span> </span> <span class="heater-entity svelte-g5au2j"> </span></div></div> <!></div>'),Qa=o('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><span class="svelte-g5au2j"> </span> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),Xa=o('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!></div></div>',1),Za=o('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div>');function bs(P,r){he(r,!0);const _=()=>Xt(Zt,"$page",x),[x,f]=Qt();let b=null,c=null,i=ue(null),T=ue(null),d=ue(null),B=ue(!0),F=ue(null),G=ue(!1),u=ue(!1),C=ue(!1),h=O(()=>parseInt(_().params.id??"0"));const z={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},j=["planning","fermenting","conditioning","completed","archived"];let g=O(()=>e(i)?z[e(i).status]:z.planning),w=O(ht),y=O(()=>ft.config.ha_enabled&&ft.config.temp_control_enabled&&e(i)?.heater_entity_id),S=O(()=>{if(!e(i)?.device_id)return null;const l=e(i).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!l?.[1])return null;const R=l[1].toUpperCase();for(const ae of ra.tilts.values())if(ae.color.toUpperCase()===R)return ae;return null});async function U(){M(B,!0),M(F,null);try{if(M(i,await ea(e(h)),!0),e(i).status==="fermenting"||e(i).status==="conditioning")try{M(T,await gt(e(h)),!0)}catch{}if(e(i).heater_entity_id)try{M(d,await Ne(e(h)),!0)}catch{}}catch(l){M(F,l instanceof Error?l.message:"Failed to load batch",!0)}finally{M(B,!1)}}async function D(l){if(!(!e(i)||e(u))){M(u,!0);try{M(i,await _t(e(i).id,{status:l}),!0),(l==="fermenting"||l==="conditioning")&&M(T,await gt(e(i).id),!0)}catch(R){console.error("Failed to update status:",R)}finally{M(u,!1)}}}async function E(l){if(e(i)&&(M(i,await _t(e(i).id,l),!0),M(G,!1),e(i).heater_entity_id))try{M(d,await Ne(e(i).id),!0)}catch{}}async function V(){if(e(i)&&confirm(`Are you sure you want to delete "${e(i).name||"this batch"}"?`))try{await ta(e(i).id),$t("/batches")}catch{alert("Failed to delete batch")}}async function I(l){if(!(!e(i)||e(C))){M(C,!0);try{await aa(e(i).id,l),M(d,await Ne(e(i).id),!0)}catch(R){console.error("Failed to set override:",R)}finally{M(C,!1)}}}function K(){if(b?.readyState===WebSocket.OPEN)return;const R=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;b=new WebSocket(R),b.onmessage=async ae=>{try{const Q=JSON.parse(ae.data);Q.type==="control_event"&&Q.batch_id===e(h)&&e(d)&&(Q.action==="heat_on"?M(d,{...e(d),heater_state:"on"},!0):Q.action==="heat_off"&&M(d,{...e(d),heater_state:"off"},!0))}catch{}},b.onclose=()=>{b=null,c=setTimeout(K,3e3)},b.onerror=()=>{b?.close()}}function Z(){c&&(clearTimeout(c),c=null),b?.close(),b=null}function $(l){return l==null?"--":jt(l)}It(()=>{U(),K()}),Vt(()=>{Z()});var W=Za();Kt("g5au2j",l=>{Wt(()=>{Jt.title=`${(e(i)?.name||"Batch")??""} | BrewSignal`})});var te=s(a(W),2);{var de=l=>{var R=Na();n(l,R)},L=l=>{var R=me(),ae=q(R);{var Q=A=>{var H=Ha(),X=s(a(H),2),re=a(X,!0);t(X);var _e=s(X,2);_e.__click=U,t(H),p(()=>v(re,e(F))),n(A,H)},Y=A=>{var H=me(),X=q(H);{var re=oe=>{var be=Ia();n(oe,be)},_e=oe=>{var be=me(),Te=q(be);{var fe=ce=>{ia(ce,{get batch(){return e(i)},onSubmit:E,onCancel:()=>M(G,!1)})},ke=ce=>{var we=Xa(),Fe=q(we),Re=a(Fe),Ge=a(Re),kt=a(Ge);t(Ge);var We=s(Ge,2),Me=a(We),xt=a(Me,!0);t(Me);var zt=s(Me,2);{var wt=k=>{var N=Wa(),J=a(N),ve=s(J);{var ee=se=>{var le=Va(),ne=a(le);t(le),p(()=>v(ne,`(${e(i).recipe.type??""})`)),n(se,le)};m(ve,se=>{e(i).recipe.type&&se(ee)})}t(N),p(()=>{bt(N,"href",`/recipes/${e(i).recipe.id??""}`),v(J,`${e(i).recipe.name??""} `)}),n(k,N)};m(zt,k=>{e(i).recipe&&k(wt)})}t(We),t(Re);var Je=s(Re,2),Oe=a(Je),ie=a(Oe);ie.__change=k=>D(k.currentTarget.value),mt(ie,21,()=>j,pt,(k,N)=>{var J=Ja(),ve=a(J,!0);t(J);var ee={};p(()=>{v(ve,z[e(N)].label),ee!==(ee=e(N))&&(J.value=(J.__value=e(N))??"")}),n(k,J)}),t(ie);var Ke;Yt(ie),t(Oe);var Ye=s(Oe,2);Ye.__click=()=>M(G,!0);var St=s(Ye,2);St.__click=V,t(Je),t(Fe);var qe=s(Fe,2),Pe=a(qe),Qe=a(Pe);{var Bt=k=>{{let N=O(()=>e(T)?.measured?.current_sg),J=O(()=>e(T)?.temperature?.current);pa(k,{get liveReading(){return e(S)},get currentSg(){return e(N)},get currentTemp(){return e(J)}})}};m(Qe,k=>{(e(S)||e(T)?.measured?.current_sg!=null)&&k(Bt)})}var Xe=s(Qe,2);{let k=O(()=>e(S)?.sg??e(T)?.measured?.current_sg);za(Xe,{get batch(){return e(i)},get currentSg(){return e(k)},get progress(){return e(T)}})}var Ct=s(Xe,2);{var Tt=k=>{La(k,{get recipe(){return e(i).recipe}})};m(Ct,k=>{e(i).recipe&&k(Tt)})}t(Pe);var Ze=s(Pe,2),$e=a(Ze);Sa($e,{get batch(){return e(i)}});var et=s($e,2);Pa(et,{get batch(){return e(i)},get liveReading(){return e(S)},onEdit:()=>M(G,!0)});var tt=s(et,2);{var Ft=k=>{var N=qa();let J;var ve=s(a(N),2),ee=a(ve);let se;var le=s(ee,2),ne=a(le);let Se;var Ot=a(ne,!0);t(ne);var at=s(ne,2),Pt=a(at,!0);t(at),t(le),t(ve);var Dt=s(ve,2);{var Et=De=>{var st=Ya(),Ee=q(st),Le=a(Ee),rt=s(a(Le),2),Lt=a(rt);t(rt),t(Le);var it=s(Le,2),vt=s(a(it),2),Ut=a(vt);t(vt),t(it),t(Ee);var lt=s(Ee,2);{var At=xe=>{var ze=Ka(),Ae=s(a(ze),2),Nt=a(Ae);t(Ae);var ut=s(Ae,2);ut.__click=()=>I(null),t(ze),p(Ht=>{v(Nt,`Override active: ${Ht??""}`),ut.disabled=e(C)},[()=>e(d).override_state?.toUpperCase()]),n(xe,ze)};m(lt,xe=>{e(d).override_active&&xe(At)})}var nt=s(lt,2),dt=s(a(nt),2),Be=a(dt);let ot;Be.__click=()=>I("on");var Ue=s(Be,2);let ct;Ue.__click=()=>I("off"),t(dt),t(nt),p((xe,ze)=>{v(Lt,`${xe??""}${e(w)??""}`),v(Ut,`Â±${ze??""}${e(w)??""}`),ot=ge(Be,1,"override-btn svelte-g5au2j",null,ot,{active:e(d).override_state==="on"}),Be.disabled=e(C),ct=ge(Ue,1,"override-btn svelte-g5au2j",null,ct,{active:e(d).override_state==="off"}),Ue.disabled=e(C)},[()=>$(e(d).target_temp),()=>e(d).hysteresis?.toFixed(1)||"--"]),n(De,st)};m(Dt,De=>{e(d)&&De(Et)})}t(N),p(()=>{J=ge(N,1,"info-card heater-card svelte-g5au2j",null,J,{"heater-on":e(d)?.heater_state==="on"}),se=ge(ee,1,"heater-icon-wrap svelte-g5au2j",null,se,{heating:e(d)?.heater_state==="on"}),Se=ge(ne,1,"heater-state svelte-g5au2j",null,Se,{on:e(d)?.heater_state==="on"}),v(Ot,e(d)?.heater_state==="on"?"HEATING":e(d)?.heater_state==="off"?"OFF":"Unknown"),v(Pt,e(i).heater_entity_id)}),n(k,N)},Rt=k=>{var N=me(),J=q(N);{var ve=ee=>{var se=Qa(),le=s(a(se),2),ne=a(le),Se=a(ne);t(ne),pe(2),t(le),t(se),p(()=>v(Se,`Heater: ${e(i).heater_entity_id??""}`)),n(ee,se)};m(J,ee=>{e(i).heater_entity_id&&e(i).status!=="fermenting"&&ee(ve)},!0)}n(k,N)};m(tt,k=>{e(y)&&e(i).status==="fermenting"?k(Ft):k(Rt,!1)})}var Gt=s(tt,2);{var Mt=k=>{Aa(k,{get notes(){return e(i).notes}})};m(Gt,k=>{e(i).notes&&k(Mt)})}t(Ze),t(qe),p(()=>{v(kt,`#${(e(i).batch_number||"?")??""}`),v(xt,e(i).name||e(i).recipe?.name||"Unnamed Batch"),ie.disabled=e(u),Ce(ie,`color: ${e(g).color??""}; background: ${e(g).bg??""};`),Ke!==(Ke=e(i).status)&&(ie.value=(ie.__value=e(i).status)??"",qt(ie,e(i).status))}),n(ce,we)};m(Te,ce=>{e(G)?ce(fe):ce(ke,!1)},!0)}n(oe,be)};m(X,oe=>{e(i)?oe(_e,!1):oe(re)},!0)}n(A,H)};m(ae,A=>{e(F)?A(Q):A(Y,!1)},!0)}n(l,R)};m(te,l=>{e(B)?l(de):l(L,!1)})}t(W),n(P,W),je(),f()}Ie(["click","change"]);export{bs as component,ps as universal};
