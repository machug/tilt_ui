import{d as ea,f as v,a as i,c as we,s as p,e as _a,t as je}from"./DFbRLFGc.js";import{ah as aa,ao as d,p as g,ap as ta,aj as ra,ak as l,al as s,s as o,c as e,ai as me,an as r,ar as ee,as as h,aq as Fe,at as fe,aw as pa}from"./-s7GvDYA.js";import{e as Ce,i as qe}from"./DSjxYGfQ.js";import{i as m}from"./DiA6E_7b.js";import{r as oe}from"./CXlnwKpw.js";import{b as $}from"./BXlrlxF0.js";import{b as Qe}from"./D9NHjgjI.js";import{b as sa,d as ha}from"./DLyiWXp0.js";import{c as xe,f as ba,a as ga,g as ya}from"./BH1aWYKn.js";import{f as xa}from"./BssyGhMx.js";var wa=v('<button type="button" class="clear-btn svelte-1m8neh9">Clear Selection</button>'),Sa=v('<div class="loading svelte-1m8neh9"><div class="spinner svelte-1m8neh9"></div> <p>Loading recipes...</p></div>'),Fa=v('<div class="error-box svelte-1m8neh9"><p class="error-text svelte-1m8neh9"> </p></div>'),Ca=v('<div class="empty svelte-1m8neh9"><p class="empty-text svelte-1m8neh9">No recipes yet.</p> <a href="/recipes/import" class="import-link svelte-1m8neh9">Import your first recipe</a></div>'),Ta=v('<p class="recipe-gravity svelte-1m8neh9"> </p>'),Da=v('<p class="recipe-yeast svelte-1m8neh9"> </p>'),Ra=v('<div class="selected-recipe svelte-1m8neh9"><div class="recipe-info svelte-1m8neh9"><p class="recipe-name svelte-1m8neh9"> </p> <!> <!></div></div>'),ka=v('<span class="recipe-item-og svelte-1m8neh9"> </span>'),Na=v('<button type="button" class="recipe-item svelte-1m8neh9"><span class="recipe-item-name svelte-1m8neh9"> </span> <!></button>'),Ea=v('<input id="recipe-search" type="text" placeholder="Search recipes..." class="search-input svelte-1m8neh9"/> <div class="recipe-list svelte-1m8neh9"></div>',1),Ha=v('<div class="recipe-selector svelte-1m8neh9"><div class="selector-header svelte-1m8neh9"><label for="recipe-search" class="selector-label svelte-1m8neh9">Select Recipe (Optional)</label> <!></div> <!></div>');function Ia(Te,c){aa(c,!0);let k=d(g([])),Y=d(!0),ae=d(null),U=d(""),ne=me(()=>e(k).filter(n=>!e(U)||n.name.toLowerCase().includes(e(U).toLowerCase())||n.author?.toLowerCase().includes(e(U).toLowerCase()))),b=me(()=>c.selectedRecipeId?e(k).find(n=>n.id===c.selectedRecipeId):null);ta(async()=>{try{o(k,await sa(),!0)}catch(n){o(ae,n instanceof Error?n.message:"Failed to load recipes",!0),console.error("Failed to load recipes:",n)}finally{o(Y,!1)}});function ve(n){c.onSelect(n)}function _e(){c.onSelect(null)}var Q=Ha(),pe=s(Q),De=l(s(pe),2);{var Re=n=>{var F=wa();F.__click=_e,i(n,F)};m(De,n=>{e(b)&&n(Re)})}r(pe);var ke=l(pe,2);{var he=n=>{var F=Sa();i(n,F)},be=n=>{var F=we(),ge=ee(F);{var Se=B=>{var w=Fa(),re=s(w),z=s(re,!0);r(re),r(w),h(()=>p(z,e(ae))),i(B,w)},te=B=>{var w=we(),re=ee(w);{var z=A=>{var ce=Ca();i(A,ce)},y=A=>{var ce=we(),M=ee(ce);{var Ne=P=>{var G=Ra(),J=s(G),N=s(J),E=s(N,!0);r(N);var H=l(N,2);{var K=C=>{var I=Ta(),L=s(I);r(I),h((X,de)=>p(L,`${X??""} → ${de??""}`),[()=>e(b).og_target.toFixed(3),()=>e(b).fg_target.toFixed(3)]),i(C,I)};m(H,C=>{e(b).og_target&&e(b).fg_target&&C(K)})}var W=l(H,2);{var ye=C=>{var I=Da(),L=s(I,!0);r(I),h(()=>p(L,e(b).yeast_name)),i(C,I)};m(W,C=>{e(b).yeast_name&&C(ye)})}r(J),r(G),h(()=>p(E,e(b).name)),i(P,G)},Ee=P=>{var G=Ea(),J=ee(G);oe(J);var N=l(J,2);Ce(N,21,()=>e(ne),E=>E.id,(E,H)=>{var K=Na();K.__click=()=>ve(e(H));var W=s(K),ye=s(W,!0);r(W);var C=l(W,2);{var I=L=>{var X=ka(),de=s(X,!0);r(X),h(He=>p(de,He),[()=>e(H).og_target.toFixed(3)]),i(L,X)};m(C,L=>{e(H).og_target&&L(I)})}r(K),h(()=>p(ye,e(H).name)),i(E,K)}),r(N),$(J,()=>e(U),E=>o(U,E)),i(P,G)};m(M,P=>{e(b)?P(Ne):P(Ee,!1)})}i(A,ce)};m(re,A=>{e(k).length===0?A(z):A(y,!1)},!0)}i(B,w)};m(ge,B=>{e(ae)?B(Se):B(te,!1)},!0)}i(n,F)};m(ke,n=>{e(Y)?n(he):n(be,!1)})}r(Q),i(Te,Q),ra()}ea(["click"]);var La=v('<div class="error-banner svelte-8ou9a2"><span class="error-icon svelte-8ou9a2">!</span> </div>'),Ba=v('<p class="reference-text svelte-8ou9a2"> <!></p>'),Aa=v('<div class="recipe-reference svelte-8ou9a2"><p class="reference-label svelte-8ou9a2">From Recipe:</p> <!></div>'),Ma=v("<option> </option>"),Oa=v('<span class="form-hint svelte-8ou9a2">Loading devices...</span>'),Ya=v('<div class="warning-message svelte-8ou9a2"><p class="svelte-8ou9a2">No paired devices available. Please <a href="/devices" class="svelte-8ou9a2">pair a device</a> before creating a batch.</p></div>'),Ua=v("<option> <!></option>"),Pa=v('<select id="device" class="form-select svelte-8ou9a2"><option>No device assigned</option><!></select> <span class="form-hint svelte-8ou9a2">Link a Tilt to track live gravity and temperature</span>',1),Ga=v('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="fg">Measured FG</label> <input type="number" id="fg" class="form-input svelte-8ou9a2" placeholder="1.010" step="0.001" min="0.990" max="1.100"/></div>'),ja=v("<option> </option>"),qa=v('<span class="form-hint svelte-8ou9a2">Loading available switches from Home Assistant...</span>'),Qa=v('<span class="form-hint svelte-8ou9a2">No switches found in Home Assistant</span>'),za=v('<span class="form-hint svelte-8ou9a2">Select a switch or input_boolean entity to control the heater</span>'),Ja=v('<div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempTarget"> </label> <input type="number" id="tempTarget" class="form-input svelte-8ou9a2" placeholder="68" step="0.5" min="32" max="100"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempHysteresis"> </label> <input type="number" id="tempHysteresis" class="form-input svelte-8ou9a2" placeholder="1.0" step="0.5" min="0.5" max="10"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div></div>'),Ka=v('<div class="form-section svelte-8ou9a2"><h3 class="section-title svelte-8ou9a2">Temperature Control</h3> <span class="section-hint svelte-8ou9a2">Link a heater switch from Home Assistant to control fermentation temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="heaterEntity">Heater Switch</label> <select id="heaterEntity" class="form-select svelte-8ou9a2"><option>No heater assigned</option><!></select> <!></div> <!>',1),Wa=v('<span class="spinner svelte-8ou9a2"></span> Saving...',1),Xa=v('<form class="batch-form svelte-8ou9a2"><div class="form-header svelte-8ou9a2"><h2 class="form-title svelte-8ou9a2"> </h2> <p class="form-description svelte-8ou9a2"> </p></div> <!> <div class="form-body svelte-8ou9a2"><!> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="name">Batch Name</label> <input type="text" id="name" class="form-input svelte-8ou9a2" placeholder="e.g., Summer IPA #3" maxlength="200"/> <span class="form-hint svelte-8ou9a2">Optional - defaults to recipe name</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="status">Status</label> <select id="status" class="form-select svelte-8ou9a2"></select></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="device">Tracking Device</label> <!></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="brewDate">Brew Date</label> <input type="date" id="brewDate" class="form-input date-input svelte-8ou9a2"/> <span class="form-hint svelte-8ou9a2">DD/MM/YYYY</span></div> <div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="og">Measured OG</label> <input type="number" id="og" class="form-input svelte-8ou9a2" placeholder="1.050" step="0.001" min="0.990" max="1.200"/></div> <!></div> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="notes">Notes</label> <textarea id="notes" class="form-textarea svelte-8ou9a2" placeholder="Brewing notes, observations, etc." rows="3"></textarea></div></div> <div class="form-footer svelte-8ou9a2"><button type="button" class="btn-cancel svelte-8ou9a2">Cancel</button> <button type="submit" class="btn-submit svelte-8ou9a2"><!></button></div></form>');function ot(Te,c){aa(c,!0);let k=d(g(c.batch?.name||"")),Y=d(g(c.batch?.recipe_id||null)),ae=d(g(c.batch?.device_id||null)),U=d(g(c.batch?.status||"planning")),ne=d(g(c.batch?.brew_date?c.batch.brew_date.split("T")[0]:"")),b=d(g(c.batch?.measured_og?.toString()||"")),ve=d(g(c.batch?.measured_fg?.toString()||"")),_e=d(g(c.batch?.notes||"")),Q=d(g(c.batch?.heater_entity_id||""));function pe(a){return a==null?"":xe.config.temp_units==="C"?ba(a).toFixed(1):a.toFixed(1)}function De(a){return a==null?"":xe.config.temp_units==="C"?(a*5/9).toFixed(1):a.toFixed(1)}function Re(a){if(!a)return;const t=parseFloat(a);if(!isNaN(t))return xe.config.temp_units==="C"?ga(t):t}function ke(a){if(!a)return;const t=parseFloat(a);if(!isNaN(t))return xe.config.temp_units==="C"?t*9/5:t}let he=d(g(pe(c.batch?.temp_target))),be=d(g(De(c.batch?.temp_hysteresis))),n=d(g([])),F=d(g([])),ge=d(g([])),Se=d(!0),te=d(!1),B=d(!1),w=d(!1),re=me(ya),z=d(null),y=d(null),A=me(()=>xe.config.ha_enabled);const ce=[{value:"planning",label:"Planning"},{value:"fermenting",label:"Fermenting"},{value:"conditioning",label:"Conditioning"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}];let M=me(()=>!!c.batch);async function Ne(){o(Se,!0);try{o(n,await sa(),!0)}catch(a){console.error("Failed to load recipes:",a)}finally{o(Se,!1)}}async function Ee(){o(B,!0);try{o(ge,await xa(!0),!0)}catch(a){console.error("Failed to load devices:",a)}finally{o(B,!1)}}async function P(){if(e(A)){o(te,!0);try{o(F,await ha(),!0)}catch(a){console.error("Failed to load heater entities:",a)}finally{o(te,!1)}}}function G(a){o(y,a,!0),a?(o(k,a.name,!0),o(Y,a.id,!0),a.og_target&&o(b,a.og_target.toString(),!0)):o(Y,null)}async function J(a){if(a.preventDefault(),!e(w)){o(w,!0),o(z,null);try{const t={name:e(k)||void 0,status:e(U),device_id:e(ae)||void 0,brew_date:e(ne)?new Date(e(ne)).toISOString():void 0,measured_og:e(b)?parseFloat(e(b)):void 0,notes:e(_e)||void 0,heater_entity_id:e(Q)||void 0,temp_target:Re(e(he)),temp_hysteresis:ke(e(be))};e(M)?t.recipe_id=e(Y)||void 0:t.recipe_id=e(Y)||void 0,e(M)&&e(ve)&&(t.measured_fg=parseFloat(e(ve))),await c.onSubmit(t)}catch(t){o(z,t instanceof Error?t.message:"Failed to save batch",!0)}finally{o(w,!1)}}}Fe(()=>{if(!e(M)&&e(Y)&&!e(k)){const a=e(n).find(t=>t.id===e(Y));a&&o(k,a.name,!0)}}),Fe(()=>{e(A)&&e(F).length===0&&!e(te)&&P()}),Fe(()=>{if(c.initialRecipeId&&e(n).length>0&&!e(y)){const a=e(n).find(t=>t.id===c.initialRecipeId);a&&G(a)}}),Fe(()=>{if(e(M)&&c.batch?.recipe&&e(n).length>0&&!e(y)){const a=e(n).find(t=>t.id===c.batch.recipe_id);a&&o(y,a,!0)}}),ta(()=>{Ne(),Ee(),P()});var N=Xa(),E=s(N),H=s(E),K=s(H,!0);r(H);var W=l(H,2),ye=s(W,!0);r(W),r(E);var C=l(E,2);{var I=a=>{var t=La(),_=l(s(t));r(t),h(()=>p(_,` ${e(z)??""}`)),i(a,t)};m(C,a=>{e(z)&&a(I)})}var L=l(C,2),X=s(L);{let a=me(()=>e(y)?.id);Ia(X,{get selectedRecipeId(){return e(a)},onSelect:G})}var de=l(X,2);{var He=a=>{var t=Aa(),_=l(s(t),2);{var S=T=>{var D=Ba(),j=s(D),se=l(j);{var le=ie=>{var Z=je();h((u,f)=>p(Z,`(${u??""}-${f??""}°C)`),[()=>e(y).yeast_temp_min.toFixed(0),()=>e(y).yeast_temp_max.toFixed(0)]),i(ie,Z)};m(se,ie=>{e(y).yeast_temp_min&&e(y).yeast_temp_max&&ie(le)})}r(D),h(()=>p(j,`Yeast: ${e(y).yeast_name??""} `)),i(T,D)};m(_,T=>{e(y).yeast_name&&T(S)})}r(t),i(a,t)};m(de,a=>{e(y)&&a(He)})}var Ie=l(de,2),ze=l(s(Ie),2);oe(ze),fe(2),r(Ie);var Le=l(Ie,2),Be=l(s(Le),2);Ce(Be,21,()=>ce,qe,(a,t)=>{var _=Ma(),S=s(_,!0);r(_);var T={};h(()=>{p(S,e(t).label),T!==(T=e(t).value)&&(_.value=(_.__value=e(t).value)??"")}),i(a,_)}),r(Be),r(Le);var Ae=l(Le,2),la=l(s(Ae),2);{var ia=a=>{var t=Oa();i(a,t)},oa=a=>{var t=we(),_=ee(t);{var S=D=>{var j=Ya();i(D,j)},T=D=>{var j=Pa(),se=ee(j),le=s(se);le.value=(le.__value=null)??"";var ie=l(le);Ce(ie,17,()=>e(ge),qe,(Z,u)=>{var f=Ua(),x=s(f),q=l(x);{var V=O=>{var ue=je();h(()=>p(ue,`- ${e(u).beer_name??""}`)),i(O,ue)};m(q,O=>{e(u).beer_name&&e(u).beer_name!=="Untitled"&&O(V)})}r(f);var R={};h(()=>{p(x,`${e(u).color??""} Tilt `),R!==(R=e(u).id)&&(f.value=(f.__value=e(u).id)??"")}),i(Z,f)}),r(se),fe(2),Qe(se,()=>e(ae),Z=>o(ae,Z)),i(D,j)};m(_,D=>{e(ge).length===0?D(S):D(T,!1)},!0)}i(a,t)};m(la,a=>{e(B)?a(ia):a(oa,!1)})}r(Ae);var Me=l(Ae,2),Je=l(s(Me),2);oe(Je),fe(2),r(Me);var Oe=l(Me,2),Ye=s(Oe),Ke=l(s(Ye),2);oe(Ke),r(Ye);var na=l(Ye,2);{var va=a=>{var t=Ga(),_=l(s(t),2);oe(_),r(t),$(_,()=>e(ve),S=>o(ve,S)),i(a,t)};m(na,a=>{e(M)&&a(va)})}r(Oe);var We=l(Oe,2);{var ca=a=>{var t=Ka(),_=l(ee(t),2),S=l(s(_),2),T=s(S);T.value=T.__value="";var D=l(T);Ce(D,17,()=>e(F),qe,(u,f)=>{var x=ja(),q=s(x);r(x);var V={};h(()=>{p(q,`${e(f).friendly_name??""} (${e(f).state??""})`),V!==(V=e(f).entity_id)&&(x.value=(x.__value=e(f).entity_id)??"")}),i(u,x)}),r(S);var j=l(S,2);{var se=u=>{var f=qa();i(u,f)},le=u=>{var f=we(),x=ee(f);{var q=R=>{var O=Qa();i(R,O)},V=R=>{var O=za();i(R,O)};m(x,R=>{e(F).length===0?R(q):R(V,!1)},!0)}i(u,f)};m(j,u=>{e(te)?u(se):u(le,!1)})}r(_);var ie=l(_,2);{var Z=u=>{var f=Ja(),x=s(f),q=s(x),V=s(q);r(q);var R=l(q,2);oe(R),fe(2),r(x);var O=l(x,2),ue=s(O),ma=s(ue);r(ue);var $e=l(ue,2);oe($e),fe(2),r(O),r(f),h(()=>{p(V,`Target Temperature (${e(re)??""})`),p(ma,`Hysteresis (${e(re)??""})`)}),$(R,()=>e(he),Ge=>o(he,Ge)),$($e,()=>e(be),Ge=>o(be,Ge)),i(u,f)};m(ie,u=>{e(Q)&&u(Z)})}h(()=>S.disabled=e(te)),Qe(S,()=>e(Q),u=>o(Q,u)),i(a,t)};m(We,a=>{e(A)&&a(ca)})}var Xe=l(We,2),Ze=l(s(Xe),2);pa(Ze),r(Xe),r(L);var Ve=l(L,2),Ue=s(Ve);Ue.__click=function(...a){c.onCancel?.apply(this,a)};var Pe=l(Ue,2),da=s(Pe);{var ua=a=>{var t=Wa();fe(),i(a,t)},fa=a=>{var t=je();h(()=>p(t,e(M)?"Save Changes":"Create Batch")),i(a,t)};m(da,a=>{e(w)?a(ua):a(fa,!1)})}r(Pe),r(Ve),r(N),h(()=>{p(K,e(M)?"Edit Batch":"New Batch"),p(ye,e(M)?"Update batch details and measurements":"Create a new fermentation batch"),Ue.disabled=e(w),Pe.disabled=e(w)}),_a("submit",N,J),$(ze,()=>e(k),a=>o(k,a)),Qe(Be,()=>e(U),a=>o(U,a)),$(Je,()=>e(ne),a=>o(ne,a)),$(Ke,()=>e(b),a=>o(b,a)),$(Ze,()=>e(_e),a=>o(_e,a)),i(Te,N),ra()}ea(["click"]);export{ot as B};
