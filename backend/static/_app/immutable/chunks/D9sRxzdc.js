import{d as Ve,f as n,a as i,c as Se,s as h,e as ca,t as Ye}from"./DFbRLFGc.js";import{ah as We,ao as d,p as y,ap as Xe,aj as Ze,ak as l,al as s,s as o,c as e,ai as ge,an as t,ar as ae,as as b,aq as De,at as be,aw as da}from"./-s7GvDYA.js";import{e as ke,i as Ue}from"./DSjxYGfQ.js";import{i as f}from"./DiA6E_7b.js";import{r as ne}from"./CXlnwKpw.js";import{b as ee}from"./BXlrlxF0.js";import{b as Pe}from"./D9NHjgjI.js";import{b as $e,d as ua}from"./DLyiWXp0.js";import{c as ma,g as fa}from"./BH1aWYKn.js";import{f as _a}from"./BssyGhMx.js";var pa=n('<button type="button" class="clear-btn svelte-1m8neh9">Clear Selection</button>'),ha=n('<div class="loading svelte-1m8neh9"><div class="spinner svelte-1m8neh9"></div> <p>Loading recipes...</p></div>'),ba=n('<div class="error-box svelte-1m8neh9"><p class="error-text svelte-1m8neh9"> </p></div>'),ga=n('<div class="empty svelte-1m8neh9"><p class="empty-text svelte-1m8neh9">No recipes yet.</p> <a href="/recipes/import" class="import-link svelte-1m8neh9">Import your first recipe</a></div>'),ya=n('<p class="recipe-gravity svelte-1m8neh9"> </p>'),xa=n('<p class="recipe-yeast svelte-1m8neh9"> </p>'),wa=n('<div class="selected-recipe svelte-1m8neh9"><div class="recipe-info svelte-1m8neh9"><p class="recipe-name svelte-1m8neh9"> </p> <!> <!></div></div>'),Sa=n('<span class="recipe-item-og svelte-1m8neh9"> </span>'),Fa=n('<button type="button" class="recipe-item svelte-1m8neh9"><span class="recipe-item-name svelte-1m8neh9"> </span> <!></button>'),Ca=n('<input id="recipe-search" type="text" placeholder="Search recipes..." class="search-input svelte-1m8neh9"/> <div class="recipe-list svelte-1m8neh9"></div>',1),Ra=n('<div class="recipe-selector svelte-1m8neh9"><div class="selector-header svelte-1m8neh9"><label for="recipe-search" class="selector-label svelte-1m8neh9">Select Recipe (Optional)</label> <!></div> <!></div>');function Da(Ee,c){We(c,!0);let k=d(y([])),M=d(!0),te=d(null),O=d(""),ve=ge(()=>e(k).filter(v=>!e(O)||v.name.toLowerCase().includes(e(O).toLowerCase())||v.author?.toLowerCase().includes(e(O).toLowerCase()))),g=ge(()=>c.selectedRecipeId?e(k).find(v=>v.id===c.selectedRecipeId):null);Xe(async()=>{try{o(k,await $e(),!0)}catch(v){o(te,v instanceof Error?v.message:"Failed to load recipes",!0),console.error("Failed to load recipes:",v)}finally{o(M,!1)}});function ce(v){c.onSelect(v)}function ye(){c.onSelect(null)}var q=Ra(),Q=s(q),de=l(s(Q),2);{var z=v=>{var E=pa();E.__click=ye,i(v,E)};f(de,v=>{e(g)&&v(z)})}t(Q);var ue=l(Q,2);{var xe=v=>{var E=ha();i(v,E)},Fe=v=>{var E=Se(),J=ae(E);{var Ce=_=>{var L=ba(),fe=s(L),S=s(fe,!0);t(fe),t(L),b(()=>h(S,e(te))),i(_,L)},me=_=>{var L=Se(),fe=ae(L);{var S=K=>{var re=ga();i(K,re)},He=K=>{var re=Se(),Re=ae(re);{var Ie=T=>{var B=wa(),V=s(B),Y=s(V),U=s(Y,!0);t(Y);var N=l(Y,2);{var W=F=>{var H=ya(),I=s(H);t(H),b((X,se)=>h(I,`${X??""} → ${se??""}`),[()=>e(g).og_target.toFixed(3),()=>e(g).fg_target.toFixed(3)]),i(F,H)};f(N,F=>{e(g).og_target&&e(g).fg_target&&F(W)})}var P=l(N,2);{var pe=F=>{var H=xa(),I=s(H,!0);t(H),b(()=>h(I,e(g).yeast_name)),i(F,H)};f(P,F=>{e(g).yeast_name&&F(pe)})}t(V),t(B),b(()=>h(U,e(g).name)),i(T,B)},_e=T=>{var B=Ca(),V=ae(B);ne(V);var Y=l(V,2);ke(Y,21,()=>e(ve),U=>U.id,(U,N)=>{var W=Fa();W.__click=()=>ce(e(N));var P=s(W),pe=s(P,!0);t(P);var F=l(P,2);{var H=I=>{var X=Sa(),se=s(X,!0);t(X),b(we=>h(se,we),[()=>e(N).og_target.toFixed(3)]),i(I,X)};f(F,I=>{e(N).og_target&&I(H)})}t(W),b(()=>h(pe,e(N).name)),i(U,W)}),t(Y),ee(V,()=>e(O),U=>o(O,U)),i(T,B)};f(Re,T=>{e(g)?T(Ie):T(_e,!1)})}i(K,re)};f(fe,K=>{e(k).length===0?K(S):K(He,!1)},!0)}i(_,L)};f(J,_=>{e(te)?_(Ce):_(me,!1)},!0)}i(v,E)};f(ue,v=>{e(M)?v(xe):v(Fe,!1)})}t(q),i(Ee,q),Ze()}Ve(["click"]);var ka=n('<div class="error-banner svelte-8ou9a2"><span class="error-icon svelte-8ou9a2">!</span> </div>'),Ea=n('<p class="reference-text svelte-8ou9a2"> <!></p>'),Ha=n('<div class="recipe-reference svelte-8ou9a2"><p class="reference-label svelte-8ou9a2">From Recipe:</p> <!></div>'),Ia=n("<option> </option>"),La=n('<span class="form-hint svelte-8ou9a2">Loading devices...</span>'),Ta=n('<div class="warning-message svelte-8ou9a2"><p class="svelte-8ou9a2">No paired devices available. Please <a href="/devices" class="svelte-8ou9a2">pair a device</a> before creating a batch.</p></div>'),Ba=n("<option> <!></option>"),Na=n('<select id="device" class="form-select svelte-8ou9a2"><option>No device assigned</option><!></select> <span class="form-hint svelte-8ou9a2">Link a Tilt to track live gravity and temperature</span>',1),Aa=n('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="fg">Measured FG</label> <input type="number" id="fg" class="form-input svelte-8ou9a2" placeholder="1.010" step="0.001" min="0.990" max="1.100"/></div>'),Ma=n("<option> </option>"),Oa=n('<span class="form-hint svelte-8ou9a2">Loading available switches from Home Assistant...</span>'),Ya=n('<span class="form-hint svelte-8ou9a2">No switches found in Home Assistant</span>'),Ua=n('<span class="form-hint svelte-8ou9a2">Select a switch or input_boolean entity to control the heater</span>'),Pa=n('<div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempTarget"> </label> <input type="number" id="tempTarget" class="form-input svelte-8ou9a2" placeholder="68" step="0.5" min="32" max="100"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempHysteresis"> </label> <input type="number" id="tempHysteresis" class="form-input svelte-8ou9a2" placeholder="1.0" step="0.5" min="0.5" max="10"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div></div>'),Ga=n('<div class="form-section svelte-8ou9a2"><h3 class="section-title svelte-8ou9a2">Temperature Control</h3> <span class="section-hint svelte-8ou9a2">Link a heater switch from Home Assistant to control fermentation temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="heaterEntity">Heater Switch</label> <select id="heaterEntity" class="form-select svelte-8ou9a2"><option>No heater assigned</option><!></select> <!></div> <!>',1),ja=n('<span class="spinner svelte-8ou9a2"></span> Saving...',1),qa=n('<form class="batch-form svelte-8ou9a2"><div class="form-header svelte-8ou9a2"><h2 class="form-title svelte-8ou9a2"> </h2> <p class="form-description svelte-8ou9a2"> </p></div> <!> <div class="form-body svelte-8ou9a2"><!> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="name">Batch Name</label> <input type="text" id="name" class="form-input svelte-8ou9a2" placeholder="e.g., Summer IPA #3" maxlength="200"/> <span class="form-hint svelte-8ou9a2">Optional - defaults to recipe name</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="status">Status</label> <select id="status" class="form-select svelte-8ou9a2"></select></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="device">Tracking Device</label> <!></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="brewDate">Brew Date</label> <input type="date" id="brewDate" class="form-input date-input svelte-8ou9a2"/> <span class="form-hint svelte-8ou9a2">DD/MM/YYYY</span></div> <div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="og">Measured OG</label> <input type="number" id="og" class="form-input svelte-8ou9a2" placeholder="1.050" step="0.001" min="0.990" max="1.200"/></div> <!></div> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="notes">Notes</label> <textarea id="notes" class="form-textarea svelte-8ou9a2" placeholder="Brewing notes, observations, etc." rows="3"></textarea></div></div> <div class="form-footer svelte-8ou9a2"><button type="button" class="btn-cancel svelte-8ou9a2">Cancel</button> <button type="submit" class="btn-submit svelte-8ou9a2"><!></button></div></form>');function at(Ee,c){We(c,!0);let k=d(y(c.batch?.name||"")),M=d(y(c.batch?.recipe_id||null)),te=d(y(c.batch?.device_id||null)),O=d(y(c.batch?.status||"planning")),ve=d(y(c.batch?.brew_date?c.batch.brew_date.split("T")[0]:"")),g=d(y(c.batch?.measured_og?.toString()||"")),ce=d(y(c.batch?.measured_fg?.toString()||"")),ye=d(y(c.batch?.notes||"")),q=d(y(c.batch?.heater_entity_id||"")),Q=d(y(c.batch?.temp_target?.toString()||"")),de=d(y(c.batch?.temp_hysteresis?.toString()||"")),z=d(y([])),ue=d(y([])),xe=d(y([])),Fe=d(!0),v=d(!1),E=d(!1),J=d(!1),Ce=ge(fa),me=d(null),_=d(null),L=ge(()=>ma.config.ha_enabled);const fe=[{value:"planning",label:"Planning"},{value:"fermenting",label:"Fermenting"},{value:"conditioning",label:"Conditioning"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}];let S=ge(()=>!!c.batch);async function He(){o(Fe,!0);try{o(z,await $e(),!0)}catch(a){console.error("Failed to load recipes:",a)}finally{o(Fe,!1)}}async function K(){o(E,!0);try{o(xe,await _a(!0),!0)}catch(a){console.error("Failed to load devices:",a)}finally{o(E,!1)}}async function re(){if(e(L)){o(v,!0);try{o(ue,await ua(),!0)}catch(a){console.error("Failed to load heater entities:",a)}finally{o(v,!1)}}}function Re(a){o(_,a,!0),a?(o(k,a.name,!0),o(M,a.id,!0),a.og_target&&o(g,a.og_target.toString(),!0)):o(M,null)}async function Ie(a){if(a.preventDefault(),!e(J)){o(J,!0),o(me,null);try{const r={name:e(k)||void 0,status:e(O),device_id:e(te)||void 0,brew_date:e(ve)?new Date(e(ve)).toISOString():void 0,measured_og:e(g)?parseFloat(e(g)):void 0,notes:e(ye)||void 0,heater_entity_id:e(q)||void 0,temp_target:e(Q)?parseFloat(e(Q)):void 0,temp_hysteresis:e(de)?parseFloat(e(de)):void 0};e(S)?r.recipe_id=e(M)||void 0:r.recipe_id=e(M)||void 0,e(S)&&e(ce)&&(r.measured_fg=parseFloat(e(ce))),await c.onSubmit(r)}catch(r){o(me,r instanceof Error?r.message:"Failed to save batch",!0)}finally{o(J,!1)}}}De(()=>{if(!e(S)&&e(M)&&!e(k)){const a=e(z).find(r=>r.id===e(M));a&&o(k,a.name,!0)}}),De(()=>{e(L)&&e(ue).length===0&&!e(v)&&re()}),De(()=>{if(c.initialRecipeId&&e(z).length>0&&!e(_)){const a=e(z).find(r=>r.id===c.initialRecipeId);a&&Re(a)}}),De(()=>{if(e(S)&&c.batch?.recipe&&e(z).length>0&&!e(_)){const a=e(z).find(r=>r.id===c.batch.recipe_id);a&&o(_,a,!0)}}),Xe(()=>{He(),K(),re()});var _e=qa(),T=s(_e),B=s(T),V=s(B,!0);t(B);var Y=l(B,2),U=s(Y,!0);t(Y),t(T);var N=l(T,2);{var W=a=>{var r=ka(),p=l(s(r));t(r),b(()=>h(p,` ${e(me)??""}`)),i(a,r)};f(N,a=>{e(me)&&a(W)})}var P=l(N,2),pe=s(P);{let a=ge(()=>e(_)?.id);Da(pe,{get selectedRecipeId(){return e(a)},onSelect:Re})}var F=l(pe,2);{var H=a=>{var r=Ha(),p=l(s(r),2);{var w=C=>{var R=Ea(),G=s(R),le=l(G);{var ie=oe=>{var Z=Ye();b((u,m)=>h(Z,`(${u??""}-${m??""}°C)`),[()=>e(_).yeast_temp_min.toFixed(0),()=>e(_).yeast_temp_max.toFixed(0)]),i(oe,Z)};f(le,oe=>{e(_).yeast_temp_min&&e(_).yeast_temp_max&&oe(ie)})}t(R),b(()=>h(G,`Yeast: ${e(_).yeast_name??""} `)),i(C,R)};f(p,C=>{e(_).yeast_name&&C(w)})}t(r),i(a,r)};f(F,a=>{e(_)&&a(H)})}var I=l(F,2),X=l(s(I),2);ne(X),be(2),t(I);var se=l(I,2),we=l(s(se),2);ke(we,21,()=>fe,Ue,(a,r)=>{var p=Ia(),w=s(p,!0);t(p);var C={};b(()=>{h(w,e(r).label),C!==(C=e(r).value)&&(p.value=(p.__value=e(r).value)??"")}),i(a,p)}),t(we),t(se);var Le=l(se,2),ea=l(s(Le),2);{var aa=a=>{var r=La();i(a,r)},ta=a=>{var r=Se(),p=ae(r);{var w=R=>{var G=Ta();i(R,G)},C=R=>{var G=Na(),le=ae(G),ie=s(le);ie.value=(ie.__value=null)??"";var oe=l(ie);ke(oe,17,()=>e(xe),Ue,(Z,u)=>{var m=Ba(),x=s(m),j=l(x);{var $=A=>{var he=Ye();b(()=>h(he,`- ${e(u).beer_name??""}`)),i(A,he)};f(j,A=>{e(u).beer_name&&e(u).beer_name!=="Untitled"&&A($)})}t(m);var D={};b(()=>{h(x,`${e(u).color??""} Tilt `),D!==(D=e(u).id)&&(m.value=(m.__value=e(u).id)??"")}),i(Z,m)}),t(le),be(2),Pe(le,()=>e(te),Z=>o(te,Z)),i(R,G)};f(p,R=>{e(xe).length===0?R(w):R(C,!1)},!0)}i(a,r)};f(ea,a=>{e(E)?a(aa):a(ta,!1)})}t(Le);var Te=l(Le,2),Ge=l(s(Te),2);ne(Ge),be(2),t(Te);var Be=l(Te,2),Ne=s(Be),je=l(s(Ne),2);ne(je),t(Ne);var ra=l(Ne,2);{var sa=a=>{var r=Aa(),p=l(s(r),2);ne(p),t(r),ee(p,()=>e(ce),w=>o(ce,w)),i(a,r)};f(ra,a=>{e(S)&&a(sa)})}t(Be);var qe=l(Be,2);{var la=a=>{var r=Ga(),p=l(ae(r),2),w=l(s(p),2),C=s(w);C.value=C.__value="";var R=l(C);ke(R,17,()=>e(ue),Ue,(u,m)=>{var x=Ma(),j=s(x);t(x);var $={};b(()=>{h(j,`${e(m).friendly_name??""} (${e(m).state??""})`),$!==($=e(m).entity_id)&&(x.value=(x.__value=e(m).entity_id)??"")}),i(u,x)}),t(w);var G=l(w,2);{var le=u=>{var m=Oa();i(u,m)},ie=u=>{var m=Se(),x=ae(m);{var j=D=>{var A=Ya();i(D,A)},$=D=>{var A=Ua();i(D,A)};f(x,D=>{e(ue).length===0?D(j):D($,!1)},!0)}i(u,m)};f(G,u=>{e(v)?u(le):u(ie,!1)})}t(p);var oe=l(p,2);{var Z=u=>{var m=Pa(),x=s(m),j=s(x),$=s(j);t(j);var D=l(j,2);ne(D),be(2),t(x);var A=l(x,2),he=s(A),va=s(he);t(he);var Ke=l(he,2);ne(Ke),be(2),t(A),t(m),b(()=>{h($,`Target Temperature (${e(Ce)??""})`),h(va,`Hysteresis (${e(Ce)??""})`)}),ee(D,()=>e(Q),Oe=>o(Q,Oe)),ee(Ke,()=>e(de),Oe=>o(de,Oe)),i(u,m)};f(oe,u=>{e(q)&&u(Z)})}b(()=>w.disabled=e(v)),Pe(w,()=>e(q),u=>o(q,u)),i(a,r)};f(qe,a=>{e(L)&&a(la)})}var Qe=l(qe,2),ze=l(s(Qe),2);da(ze),t(Qe),t(P);var Je=l(P,2),Ae=s(Je);Ae.__click=function(...a){c.onCancel?.apply(this,a)};var Me=l(Ae,2),ia=s(Me);{var oa=a=>{var r=ja();be(),i(a,r)},na=a=>{var r=Ye();b(()=>h(r,e(S)?"Save Changes":"Create Batch")),i(a,r)};f(ia,a=>{e(J)?a(oa):a(na,!1)})}t(Me),t(Je),t(_e),b(()=>{h(V,e(S)?"Edit Batch":"New Batch"),h(U,e(S)?"Update batch details and measurements":"Create a new fermentation batch"),Ae.disabled=e(J),Me.disabled=e(J)}),ca("submit",_e,Ie),ee(X,()=>e(k),a=>o(k,a)),Pe(we,()=>e(O),a=>o(O,a)),ee(Ge,()=>e(ve),a=>o(ve,a)),ee(je,()=>e(g),a=>o(g,a)),ee(ze,()=>e(ye),a=>o(ye,a)),i(Ee,_e),Ze()}Ve(["click"]);export{at as B};
