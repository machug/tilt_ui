import{d as Pe,f as c,a as o,c as Be,s as g}from"../chunks/BQ88CgEU.js";import{ao as J,c as e,s as h,ah as Ee,p as Ue,ap as $e,ak as l,ar as ue,aj as Ge,e as Re,am as Ve,al as t,an as a,as as u,ai as we,at as fe}from"../chunks/CGXqq0_G.js";import{e as he,i as je}from"../chunks/payu-7ZH.js";import{i as f}from"../chunks/ziKwUJ4R.js";import{h as He}from"../chunks/BP8qDDK3.js";import{s as me}from"../chunks/BSw_pJTS.js";import{f as Ie,u as Oe,p as qe}from"../chunks/gKtBTYkw.js";const ye=300*1e3;class ze{#e=J(null);get cache(){return e(this.#e)}set cache(b){h(this.#e,b,!0)}async getDevices(b=!1){const D=Date.now();if(!b&&this.cache&&D-this.cache.timestamp<ye)return this.cache.data;const x=await Ie();return this.cache={data:x,timestamp:D},x}invalidate(){this.cache=null}getCachedDevices(){const b=Date.now();return this.cache&&b-this.cache.timestamp<ye?this.cache.data:null}}const z=new ze;var Je=c('<div class="loading-state svelte-j4gi7w">Loading devices...</div>'),Ke=c('<div class="error-state svelte-j4gi7w"><p> </p> <button class="btn-secondary svelte-j4gi7w">Retry</button></div>'),Qe=c('<div class="empty-state svelte-j4gi7w"><p>No paired devices. Pair a device below to start logging readings.</p></div>'),We=c('<div class="device-color-badge svelte-j4gi7w"></div>'),Xe=c('<div class="device-type-badge svelte-j4gi7w"><span class="device-type-label svelte-j4gi7w"> </span></div>'),Ye=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Beer Name:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),Ze=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">MAC:</span> <span class="detail-value mono svelte-j4gi7w"> </span></div>'),ea=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Battery:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),aa=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Firmware:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),ta=c('<div class="device-card paired svelte-j4gi7w"><div class="device-header svelte-j4gi7w"><div class="device-info svelte-j4gi7w"><!> <div><h3 class="device-name svelte-j4gi7w"> </h3> <p class="device-id svelte-j4gi7w"> </p></div></div> <div class="device-status paired svelte-j4gi7w"><span class="status-dot svelte-j4gi7w"></span> Paired</div></div> <div class="device-details svelte-j4gi7w"><!> <div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Last Seen:</span> <span class="detail-value svelte-j4gi7w"> </span></div> <!> <!> <!></div> <button class="btn-secondary btn-sm svelte-j4gi7w">Unpair Device</button></div>'),sa=c('<div class="device-grid svelte-j4gi7w"></div>'),ia=c('<div class="empty-state svelte-j4gi7w"><p>No unpaired devices detected. Make sure your devices are broadcasting and within range.</p></div>'),ra=c('<div class="device-color-badge svelte-j4gi7w"></div>'),va=c('<div class="device-type-badge svelte-j4gi7w"><span class="device-type-label svelte-j4gi7w"> </span></div>'),la=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">MAC:</span> <span class="detail-value mono svelte-j4gi7w"> </span></div>'),na=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Battery:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),da=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Firmware:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),oa=c('<div class="device-card unpaired svelte-j4gi7w"><div class="device-header svelte-j4gi7w"><div class="device-info svelte-j4gi7w"><!> <div><h3 class="device-name svelte-j4gi7w"> </h3> <p class="device-id svelte-j4gi7w"> </p></div></div> <div class="device-status unpaired svelte-j4gi7w"><span class="status-dot svelte-j4gi7w"></span> Unpaired</div></div> <div class="device-details svelte-j4gi7w"><div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Last Seen:</span> <span class="detail-value svelte-j4gi7w"> </span></div> <!> <!> <!></div> <button class="btn-primary btn-sm svelte-j4gi7w">Pair Device</button></div>'),ca=c('<div class="device-grid svelte-j4gi7w"></div>'),pa=c('<div class="devices-container svelte-j4gi7w"><section class="device-section svelte-j4gi7w"><h2 class="section-title svelte-j4gi7w"> </h2> <p class="section-description svelte-j4gi7w">These devices are actively logging readings</p> <!></section> <section class="device-section svelte-j4gi7w"><h2 class="section-title svelte-j4gi7w"> </h2> <p class="section-description svelte-j4gi7w">These devices are detected but not logging readings</p> <!></section></div>'),_a=c('<div class="page-header svelte-j4gi7w"><h1 class="page-title svelte-j4gi7w">Devices</h1> <p class="page-description svelte-j4gi7w">Manage your hydrometer devices (Tilt, iSpindel, GravityMon)</p></div> <!>',1);function ya(ne,b){Ee(b,!0);let D=J(Ue([])),x=J(!0),y=J(null);$e(async()=>{const r=z.getCachedDevices();r&&(h(D,r,!0),h(x,!1)),await I()});async function I(r=!1){h(x,!0),h(y,null);try{h(D,await z.getDevices(r),!0)}catch(_){h(y,_ instanceof Error?_.message:"Failed to load devices",!0)}finally{h(x,!1)}}async function be(r){h(y,null);try{await qe(r),z.invalidate(),await I(!0)}catch(_){h(y,_ instanceof Error?_.message:"Failed to pair device",!0)}}async function De(r){h(y,null);try{await Oe(r),z.invalidate(),await I(!0)}catch(_){h(y,_ instanceof Error?_.message:"Failed to unpair device",!0)}}function de(r){if(!r)return"Never seen";const _=Math.floor((Date.now()-new Date(r).getTime())/1e3);if(_<10)return"just now";if(_<60)return`${_}s ago`;const A=Math.floor(_/60);if(A<60)return`${A}m ago`;const P=Math.floor(A/60);return P<24?`${P}h ago`:`${Math.floor(P/24)}d ago`}function oe(r){return r.display_name?r.display_name:r.device_type==="tilt"&&r.color?`${r.color} Tilt`:r.device_type==="ispindel"?`iSpindel ${r.name}`:r.device_type==="gravitymon"?`GravityMon ${r.name}`:r.name}function ce(r){return{tilt:"Tilt",ispindel:"iSpindel",gravitymon:"GravityMon",floaty:"Floaty"}[r]||r}let K=we(()=>e(D).filter(r=>r.paired)),Q=we(()=>e(D).filter(r=>!r.paired));var pe=_a();He("j4gi7w",r=>{Re(()=>{Ve.title="Devices | BrewSignal"})});var xe=l(ue(pe),2);{var Me=r=>{var _=Je();o(r,_)},Ce=r=>{var _=Be(),A=ue(_);{var P=N=>{var M=Ke(),C=t(M),B=t(C,!0);a(C);var W=l(C,2);W.__click=()=>I(!0),a(M),u(()=>g(B,e(y))),o(N,M)},_e=N=>{var M=pa(),C=t(M),B=t(C),W=t(B);a(B);var ke=l(B,4);{var Fe=w=>{var j=Qe();o(w,j)},Te=w=>{var j=sa();he(j,21,()=>e(K),je,(Y,s)=>{var k=ta(),F=t(k),E=t(F),U=t(E);{var Z=i=>{var v=We();u(p=>me(v,`background: var(--tilt-${p??""})`),[()=>e(s).color.toLowerCase()]),o(i,v)},ee=i=>{var v=Xe(),p=t(v),m=t(p,!0);a(p),a(v),u(le=>g(m,le),[()=>ce(e(s).device_type)]),o(i,v)};f(U,i=>{e(s).device_type==="tilt"&&e(s).color?i(Z):i(ee,!1)})}var $=l(U,2),T=t($),ae=t(T,!0);a(T);var G=l(T,2),te=t(G,!0);a(G),a($),a(E),fe(2),a(F);var L=l(F,2),S=t(L);{var O=i=>{var v=Ye(),p=l(t(v),2),m=t(p,!0);a(p),a(v),u(()=>g(m,e(s).beer_name)),o(i,v)};f(S,i=>{e(s).beer_name&&i(O)})}var R=l(S,2),V=l(t(R),2),se=t(V,!0);a(V),a(R);var H=l(R,2);{var ie=i=>{var v=Ze(),p=l(t(v),2),m=t(p,!0);a(p),a(v),u(()=>g(m,e(s).mac)),o(i,v)};f(H,i=>{e(s).device_type==="tilt"&&e(s).mac&&i(ie)})}var q=l(H,2);{var re=i=>{var v=ea(),p=l(t(v),2),m=t(p);a(p),a(v),u(le=>g(m,`${le??""}V`),[()=>e(s).battery_voltage.toFixed(2)]),o(i,v)};f(q,i=>{(e(s).device_type==="ispindel"||e(s).device_type==="gravitymon")&&e(s).battery_voltage!==null&&e(s).battery_voltage!==void 0&&i(re)})}var ve=l(q,2);{var n=i=>{var v=aa(),p=l(t(v),2),m=t(p,!0);a(p),a(v),u(()=>g(m,e(s).firmware_version)),o(i,v)};f(ve,i=>{e(s).firmware_version&&i(n)})}a(L);var d=l(L,2);d.__click=()=>De(e(s).id),a(k),u((i,v)=>{g(ae,i),g(te,e(s).id),g(se,v)},[()=>oe(e(s)),()=>de(e(s).last_seen)]),o(Y,k)}),a(j),o(w,j)};f(ke,w=>{e(K).length===0?w(Fe):w(Te,!1)})}a(C);var ge=l(C,2),X=t(ge),Le=t(X);a(X);var Ne=l(X,4);{var Se=w=>{var j=ia();o(w,j)},Ae=w=>{var j=ca();he(j,21,()=>e(Q),je,(Y,s)=>{var k=oa(),F=t(k),E=t(F),U=t(E);{var Z=n=>{var d=ra();u(i=>me(d,`background: var(--tilt-${i??""})`),[()=>e(s).color.toLowerCase()]),o(n,d)},ee=n=>{var d=va(),i=t(d),v=t(i,!0);a(i),a(d),u(p=>g(v,p),[()=>ce(e(s).device_type)]),o(n,d)};f(U,n=>{e(s).device_type==="tilt"&&e(s).color?n(Z):n(ee,!1)})}var $=l(U,2),T=t($),ae=t(T,!0);a(T);var G=l(T,2),te=t(G,!0);a(G),a($),a(E),fe(2),a(F);var L=l(F,2),S=t(L),O=l(t(S),2),R=t(O,!0);a(O),a(S);var V=l(S,2);{var se=n=>{var d=la(),i=l(t(d),2),v=t(i,!0);a(i),a(d),u(()=>g(v,e(s).mac)),o(n,d)};f(V,n=>{e(s).device_type==="tilt"&&e(s).mac&&n(se)})}var H=l(V,2);{var ie=n=>{var d=na(),i=l(t(d),2),v=t(i);a(i),a(d),u(p=>g(v,`${p??""}V`),[()=>e(s).battery_voltage.toFixed(2)]),o(n,d)};f(H,n=>{(e(s).device_type==="ispindel"||e(s).device_type==="gravitymon")&&e(s).battery_voltage!==null&&e(s).battery_voltage!==void 0&&n(ie)})}var q=l(H,2);{var re=n=>{var d=da(),i=l(t(d),2),v=t(i,!0);a(i),a(d),u(()=>g(v,e(s).firmware_version)),o(n,d)};f(q,n=>{e(s).firmware_version&&n(re)})}a(L);var ve=l(L,2);ve.__click=()=>be(e(s).id),a(k),u((n,d)=>{g(ae,n),g(te,e(s).id),g(R,d)},[()=>oe(e(s)),()=>de(e(s).last_seen)]),o(Y,k)}),a(j),o(w,j)};f(Ne,w=>{e(Q).length===0?w(Se):w(Ae,!1)})}a(ge),a(M),u(()=>{g(W,`Paired Devices (${e(K).length??""})`),g(Le,`Detected Devices (${e(Q).length??""})`)}),o(N,M)};f(A,N=>{e(y)?N(P):N(_e,!1)},!0)}o(r,_)};f(xe,r=>{e(x)?r(Me):r(Ce,!1)})}o(ne,pe),Ge()}Pe(["click"]);export{ya as component};
